---
layout: post
category : h5
tagline: ""
tags : [laya,h5,3d]
---
{% include JB/setup %}

###  动机

网络游戏所有资源都是从网络加载的，需要压缩资源。因为你不知道用户用的网络带宽是多少，体积越大的游戏，进入游戏的等待时间越慢。而且微信小游戏对游戏体积也有限制。所以能把资源压缩到最小，对游戏的数据有很大帮助。
而图片资源是所有游戏资源中最大的。把游戏中的图片资源压缩是最重要的。

### 格式对比

腊鸭默认的格式是png，jpg。jpg因为是有损压缩格式，体积还可以接受。但是png的体积就非常大了。

目前可选的其它图片格式

# png8

默认的png每个像素32位的，png8每个像素只有8位。这个格式能有效的减少体积。而且不用写过多代码，但是精度有点低。渐变色的时候能明显感受出质量下降。

# gif

质量更不好

# bpg

基于视频压缩的格式。体积最小，质量最好。但是没有浏览器默认支持这个格式。

# webp

体积很小，质量不错。谷歌浏览器，安卓系统，ios12，基于谷歌内核的edge浏览器，支持这个格式。只有一些ios系统，和ie，老edge不支持这个格式。

把格式压缩成这种格式是最佳选择。

### 实现

通过代码判断是否支持webp

```js
var canvas:Object = Browser.window.document.createElement('canvas');
canvas.width = 2;
canvas.height = 2;
canvas.style.width = 2 + "px";
canvas.style.height = 2 + "px";
var isSupport = !![].map && canvas.toDataURL('image/webp').indexOf('data:image/webp') == 0;		
```

如果支持这个格式就用原生的渲染，如果不支持用 libwebp-0.6.0.min.js 软件解码

需要改动几个类

```Texture2d;WebglImage```

###  最终效果

<a href='https://lizhi.gitee.io/h5/img/webp.html'>测试demo</a>


