var Laya=window.Laya=function(h,t){var u={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,e){return 1==arguments.length?u.__presubstr.call(this,t):u.__presubstr.call(this,t,0<e?e:this.length+e)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var n=0;n<t;n++)i[n]=e;return i},__extend:function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=Object.getOwnPropertyDescriptor(e,i),r=n.get,a=n.set;r||a?r&&a?Object.defineProperty(t,i,n):(r&&Object.defineProperty(t,i,r),a&&Object.defineProperty(t,i,a)):t[i]=e[i]}function s(){u.un(this,"constructor",t)}s.prototype=e.prototype,t.prototype=new s,u.un(t.prototype,"__imps",u.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;for(var i in t=t||{},e)t[i]=e[i];return t},__package:function(t,e){if(!u.__packages[t]){u.__packages[t]=!0;var i=h,n=t.split(".");if(1<n.length)for(var r=0,a=n.length-1;r<a;r++){var s=i[n[r]];i=s||(i[n[r]]={})}i[n[n.length-1]]||(i[n[n.length-1]]=e||{})}},__hasOwnProperty:function(t,e){return e=e||this,Object.hasOwnProperty.call(e,t)||function t(e,i){if(Object.hasOwnProperty.call(i.prototype,e))return!0;var n=i.prototype.__super;return null==n?null:t(e,n)}(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e===String)return"string"==typeof t;if(e===Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},__int:function(t){return t?parseInt(t):0},interface:function(t,e){u.__package(t,{});var i=u.__internals,n=i[t]=i[t]||{self:t};if(e){var r=e.split(",");n.extend=[];for(var a=0;a<r.length;a++){var s=r[a];i[s]=i[s]||{self:s},n.extend.push(i[s])}}var o=h,l=t.split(".");for(a=0;a<l.length-1;a++)o=o[l[a]];o[l[l.length-1]]={__interface__:t}},class:function(t,e,i,n){if(i&&u.__extend(t,i),e)if(u.__package(e,t),u.__classmap[e]=t,0<e.indexOf(".")){if(0==e.indexOf("laya.")){var r=e.split(".");n=n||r[r.length-1],u[n]&&console.log("Warning!,this class["+n+"] already exist:",u[n]),u[n]=t}}else"Main"==e?h.Main=t:(u[e]&&console.log("Error!,this class["+e+"] already exist:",u[e]),u[e]=t);var a=u.un,s=t.prototype;a(s,"hasOwnProperty",u.__hasOwnProperty),a(s,"__class",t),a(s,"__super",i),a(s,"__className",e),a(t,"__super",i),a(t,"__className",e),a(t,"__isclass",!0),a(t,"super",function(t){this.__super.call(t)})},imps:function(t,e){if(!e)return null;var r=t.__imps||u.un(t,"__imps",{});function a(t){var e,i;if((e=u.__internals[t])&&(r[t]=!0,i=e.extend))for(var n=0;n<i.length;n++)a(i[n].self)}for(var i in e)a(i)},superSet:function(t,e,i,n){var r=t.prototype["_$set_"+i];r&&r.call(e,n)},superGet:function(t,e,i){var n=t.prototype["_$get_"+i];return n?n.call(e):null},getset:function(t,e,i,n,r){t?(n&&(e["_$GET_"+i]=n),r&&(e["_$SET_"+i]=r)):(n&&u.un(e,"_$get_"+i,n),r&&u.un(e,"_$set_"+i,r)),n&&r?Object.defineProperty(e,i,{get:n,set:r,enumerable:!1,configurable:!0}):(n&&Object.defineProperty(e,i,{get:n,enumerable:!1,configurable:!0}),r&&Object.defineProperty(e,i,{set:r,enumerable:!1,configurable:!0}))},static:function(i,n){for(var r=0,t=n.length;r<t;r+=2)if("length"==n[r])i.length=n[r+1].call(i);else{function e(){var e=n[r],t=n[r+1];Object.defineProperty(i,e,{get:function(){return delete this[e],this[e]=t.call(this)},set:function(t){delete this[e],this[e]=t},enumerable:!0,configurable:!0})}e()}},un:function(t,e,i){return i||(i=t[e]),u.__propun.value=i,Object.defineProperty(t,e,u.__propun),i},uns:function(e,t){t.forEach(function(t){u.un(e,t)})}};return h.console=h.console||{log:function(){}},h.trace=h.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),u}(window,document);!function(d,e,S){S.un,S.uns;var m=S.static,E=S.class,v=S.getset,R=S.__newvec;S.interface("laya.ui.IItem"),S.interface("laya.ui.ISelect"),S.interface("laya.d3.core.IClone"),S.interface("laya.runtime.IMarket"),S.interface("laya.filters.IFilter"),S.interface("laya.display.ILayout"),S.interface("laya.resource.IDispose"),S.interface("laya.runtime.IConchNode"),S.interface("laya.webgl.shapes.IShape"),S.interface("laya.d3.graphics.IVertex"),S.interface("laya.webgl.submit.ISubmit"),S.interface("laya.filters.IFilterAction"),S.interface("laya.d3.core.scene.ITreeNode"),S.interface("laya.webgl.text.ICharSegment"),S.interface("laya.runtime.ICPlatformClass"),S.interface("laya.d3.core.render.IRenderable"),S.interface("laya.webgl.canvas.save.ISaveData"),S.interface("laya.webgl.resource.IMergeAtlasBitmap"),S.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var M=function(){function a(){}return E(a,"laya.utils.RunDriver"),a.FILTER_ACTIONS=[],a.pixelRatio=-1,a._charSizeTestDiv=null,a.now=function(){return Date.now()},a.getWindow=function(){return d},a.getPixelRatio=function(){if(a.pixelRatio<0){var t=vn.context,e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;(a.pixelRatio=(vn.window.devicePixelRatio||1)/e)<1&&(a.pixelRatio=1)}return a.pixelRatio},a.getIncludeStr=function(t){return null},a.createShaderCondition=function(t){var e="(function() {return "+t+";})";return S._runScript(e)},a.fontMap=[],a.measureText=function(t,e){var i=a.hanzi.test(t);if(i&&a.fontMap[e])return a.fontMap[e];var n=vn.context;n.font=e;var r=n.measureText(t);return i&&(a.fontMap[e]=r),r},a.getWebGLContext=function(t){},a.beginFlush=function(){},a.endFinish=function(){},a.addToAtlas=null,a.flashFlushImage=function(t){},a.drawToCanvas=function(t,e,i,n,r,a){var s=Ys.create("2D"),o=new un(i,n,s);return cn.renders[e]._fun(t,o,r,a),s},a.createParticleTemplate2D=null,a.createGLTextur=null,a.createWebGLContext2D=null,a.changeWebGLSize=function(t,e){},a.createRenderSprite=function(t,e){return new cn(t,e)},a.createFilterAction=function(t){return new ji},a.createGraphics=function(){return new f},a.clear=function(t){hn._context.ctx.clear()},a.cancelLoadByUrl=function(t){},a.clearAtlas=function(t){},a.isAtlas=function(t){return!1},a.addTextureToAtlas=function(t){},a.getTexturePixels=function(t,e,i,n,r){return null},a.skinAniSprite=function(){return null},a.update3DLoop=function(){},m(a,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),a}(),l=(v(1,S,"alertGlobalError",null,function(t){var a=0;vn.window.onerror=t?function(t,e,i,n,r){a++<5&&r&&alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+r.stack||r)}:null}),S.init=function(t,e,i){for(var n=[],r=2,a=arguments.length;r<a;r++)n.push(arguments[r]);if(!S._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=S._arrayBufferSlice),S._isinit=!0,vn.__init__(),dn.__init__(),f.__init__(),S.timer=new Mn,S.scaleTimer=new Mn,S.loader=new Pr,Vn.__init__(),r=0;for(var s=n.length;r<s;r++)n[r].enable&&n[r].enable();return Wi.__init__(),Gi.__init__(),_n.__init__(),xn.beginCheck(),S._currentStage=S.stage=new Ns,S.stage.conchModel&&S.stage.conchModel.setRootNode(),S._getUrlPath(),S.render=new hn(0,0),S.stage.size(t,e),cn.__init__(),Hi.__init__(),Xi.instance.__init__(S.stage,hn.canvas),To.__init__(),rn.autoStopMusic=!0,an.__init__(),hn.canvas}},S._getUrlPath=function(){var t=vn.window.location,e=t.pathname;e=":"==e.charAt(2)?e.substring(1):e,on.rootPath=on.basePath=on.getPath("file:"==t.protocol?e:t.protocol+"//"+t.host+t.pathname)},S._arrayBufferSlice=function(t,e){var i=new Uint8Array(this,t,e-t),n=new Uint8Array(i.length);return n.set(i),n.buffer},S._runScript=function(t){return vn.window[S._evcode](t)},S.stage=null,S.timer=null,S.scaleTimer=null,S.loader=null,S.version="1.8.0beta",S.render=null,S._currentStage=null,S._isinit=!1,S.MiniAdpter={init:function(){d.navigator&&d.navigator.userAgent&&-1<d.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},m(S,["conchMarket",function(){return this.conchMarket=d.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=d.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){var l;function e(){this._events=null}E(e,"laya.events.EventDispatcher");var t=e.prototype;return t.hasListener=function(t){return!!(this._events&&this._events[t])},t.event=function(t,e){if(!this._events||!this._events[t])return!1;var i=this._events[t];if(i.run)i.once&&delete this._events[t],null!=e?i.runWith(e):i.run();else{for(var n=0,r=i.length;n<r;n++){var a=i[n];a&&(null!=e?a.runWith(e):a.run()),a&&!a.once||(i.splice(n,1),n--,r--)}0===i.length&&this._events&&delete this._events[t]}return!0},t.on=function(t,e,i,n){return this._createListener(t,e,i,n,!1)},t.once=function(t,e,i,n){return this._createListener(t,e,i,n,!0)},t._createListener=function(t,e,i,n,r,a){void 0===a&&(a=!0),a&&this.off(t,e,i,r);var s=l.create(e||this,i,n,r);this._events||(this._events={});var o=this._events;return o[t]?o[t].run?o[t]=[o[t],s]:o[t].push(s):o[t]=s,this},t.off=function(t,e,i,n){if(void 0===n&&(n=!1),!this._events||!this._events[t])return this;var r=this._events[t];if(null!=r)if(r.run)e&&r.caller!==e||r.method!==i||n&&!r.once||(delete this._events[t],r.recover());else{for(var a=0,s=0,o=r.length;s<o;s++){var l=r[s];l?!l||e&&l.caller!==e||l.method!==i||n&&!l.once||(a++,r[s]=null,l.recover()):a++}a===o&&delete this._events[t]}return this},t.offAll=function(t){var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this},t._recoverHandlers=function(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;-1<e;e--)t[e]&&(t[e].recover(),t[e]=null)},t.isMouseEvent=function(t){return e.MOUSE_EVENTS[t]},e.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},e.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0}),l=function(t){function r(t,e,i,n){r.__super.call(this,t,e,i,n)}return E(r,"",C),r.prototype.recover=function(){0<this._id&&(this._id=0,r._pool.push(this.clear()))},r.create=function(t,e,i,n){return void 0===n&&(n=!0),r._pool.length?r._pool.pop().setTo(t,e,i,n):new r(t,e,i,n)},r._pool=[],r}()},e}()),C=function(){function r(t,e,i,n){this.once=!1,void(this._id=0)===n&&(n=!1),this.setTo(t,e,i,n)}E(r,"laya.utils.Handler");var t=r.prototype;return t.setTo=function(t,e,i,n){return this._id=r._gid++,this.caller=t,this.method=e,this.args=i,this.once=n,this},t.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},t.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},t.clear=function(){return this.caller=null,this.method=null,this.args=null,this},t.recover=function(){0<this._id&&(this._id=0,r._pool.push(this.clear()))},r.create=function(t,e,i,n){return void 0===n&&(n=!0),r._pool.length?r._pool.pop().setTo(t,e,i,n):new r(t,e,i,n)},r._pool=[],r._gid=1,r}(),i=function(){function t(){}return E(t,"code.CommonData"),t.GameEndDownTime=120,t.GameStart=!1,t.ClickSkinCount=0,t.GameCount=0,t}(),y=function(){function t(){}return E(t,"code.ConfigMgr"),t.Init=function(){},t.LoadRobotName=function(){},t.UserLevelConfig={},t.SkinConfig={},t.ClassicRobotConfig={},m(t,["Names",function(){return this.Names=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"]}]),t}(),x=function(){function t(){}return E(t,"code.CrowdDataMgr"),t.Init=function(){(t.UserData={}).UserName="player1",t.UserData.Level=10},t.LoadLocalUserData=function(){},t.UnLockNewSkinAndNotice=function(t){},t.IsUnlock=function(t){return!1},t.CurLockProgress=function(t){return 0},t.RobotKey=function(t){return"1,二名,1|10,3|7,3|7,3|6,1|6,2|5,3|8,3|7,3|7,,,,,,,,,,".split(",")[t+1].split("|")},t.UserData=null,t}(),h=function(){function t(t,e,i){this.c=0,this.b=0,this.a=0,this.c=i,this.b=e,this.a=t}return E(t,"code.Face"),t}(),b=function(){function t(){this.level=null,this.infoCollector=null,this.playerPrefab=null,this.leaderPrefab=null,this.childPrefabs=null,this.playerLeader=null,this.aiCount=9,this.allLeaders=[],this.allPoints=[],this._playerUseId=0,this.scene=null}E(t,"code.GameManager");var e=t.prototype;return e.Init=function(){},e.OnGameOver=function(){},e.OnDestroy=function(){},e.StartGame=function(){console.log("[RunningMan] Play Game Starting ..."),this.allLeaders.push(this.playerLeader);var t=[];for(t.push(this._playerUseId);t.length<this.aiCount+1;){var e=Math.random()*this.childPrefabs.length>>0;-1==t.indexOf(e)&&(this.SpawnLeader(e,t.length),t.push(e))}for(var i=[];i.length<this.aiCount;){var n=y.Names[y.Names.length*Math.random()>>0];-1==i.indexOf(n)&&i.push(n)}var r,a=0,s=null;for(var o in this.allLeaders)(r=this.allLeaders[o]).isPlayerControll?(r.userName=x.UserData.UserName,r.EnablePlayerCollider()):(r.userName=i.pop(),r.EnableControl()),a<r.followers.length&&(a=r.followers.length,s=r);s&&s.ShowCrown(!0),console.log("[RunningMan] Show banner ads ...")},e.EnablePlayerController=function(){this.playerLeader._transform.getComponentByType(fa).pause=!1,this.playerLeader._transform.getComponentByType(ts).EnableControl()},e.SpawnPlayer=function(t,e){null==e&&(e=this.playerLeader._transform.transform.position);var i=this.playerLeader._transform;i.transform.position=e,this.playerLeader.child&&(this.playerLeader.child.removeSelf(),this.playerLeader.child=null);var n=ys.instantiate(this.childPrefabs[t]);this.playerLeader._transform.addChild(n),n.transform.localPosition=new we,n.transform.localRotationEuler=new we,n.transform.localScale=this.childPrefabs[t].transform.localScale,i.getChildAt(0)instanceof laya.d3.core.MeshSprite3D&&n instanceof laya.d3.core.MeshSprite3D&&(i.getChildAt(0).meshRender.material=n.meshRender.material),this.playerLeader.child=n,this.playerLeader.InitFollowerCount(),this._playerUseId=t},e.SpawnLeader=function(t,e){for(var i=this.allPoints[Math.random()*this.allPoints.length>>0];we.distance(i,this.playerLeader._transform.transform.position)<=50;)i=this.allPoints[Math.random()*this.allPoints.length>>0];var n=ys.instantiate(this.leaderPrefab,null,!1),r=n.getChildAt(0);r.transform.position=i;var a=ys.instantiate(this.childPrefabs[t],null,!1);r.addChild(a),a.transform.localPosition=new we,a.transform.localRotationEuler=new we,a.transform.localScale=this.childPrefabs[t].transform.localScale;var s=r.getComponentByType(ts);s.child=a,s.followerPrefab=this.leaderPrefab.getChildAt(0).getComponentByType(ts).followerPrefab,s.attackIndex=e,s.InitFollowerCount(x.UserData.Level),s.owner.tag="Leader",this.allLeaders.push(s),this.scene.addChild(n)},v(1,t,"Instance",function(){return null==t._instance&&(t._instance=new t).Init(),t._instance}),t._instance=null,t}(),u=function(){function t(){this.faces=null,this.vertices=null}return E(t,"code.Geometry"),t.prototype.mergeVertices=function(){var t,e,i,n,r,a,s={},o=new Array,l=[],h=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)t=this.vertices[i],null==s[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(s[e]=i,o.push(t),l[i]=o.length-1):l[i]=l[s[e]];var u=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=l[r.a],r.b=l[r.b],r.c=l[r.c],a=[r.a,r.b,r.c];for(var c=0;c<3;c++)if(a[c]==a[(c+1)%3]){c,u.push(i);break}}for(i=u.length-1;0<=i;i--){var d=u[i];this.faces.splice(d,1)}var _=this.vertices.length-o.length;return this.vertices=o,_},t}(),n=function(){function g(t){this.levelUrl="res/unity/level.ls",this.navUrl="meshes/level2.js",this.modelUrl="res/threeDimen/skinModel/LayaMonkey/LayaMonkey.lh",this.onComp=null,this.camera=null,this.scene=null,this.leader=null,this.model=null,S.loader.load([{url:this.navUrl,type:"json"}],C.create(this,this.onNavLoaded)),this.onComp=t}E(g,"code.Level");var t=g.prototype;return t.onNavLoaded=function(){for(var t=S.loader.getRes(this.navUrl),e=t.vertices,i=t.faces,n=[],r=0;r<i.length;r+=5)n.push(new h(i[r+1],i[r+2],i[r+3]));var a=[];for(r=0;r<e.length;r+=3)a.push(new we(e[r],e[r+1],e[r+2]));b.Instance.allPoints=a;var s=new u;s.faces=n,s.vertices=a;var o=vn.window.patrol.buildNodes(s);vn.window.patrol.setZoneData("level",o),g.playerNavMeshGroup=vn.window.patrol.getGroup("level",new we(-3.5,.5,5.5)),S.loader.create([this.levelUrl,this.modelUrl],C.create(this,this.onLevelLoaded))},t.onLevelLoaded=function(){var t=ys.load(this.modelUrl);this.model=new ys,this.model.addChild(t),t.transform.rotate(new we(0,Math.PI,0)),t.transform.scale=new we(3,3,3),t.transform.translate(new we(0,1,0));var e=new io(1,1,1),i=new Vo(e),n=new us;i.meshRender.material=n,x.Init(),y.Init(),b.Instance.playerPrefab=this.model,b.Instance.childPrefabs=[];for(var r=0;r<20;r++)b.Instance.childPrefabs.push(this.model);this.scene=vs.load(this.levelUrl),b.Instance.scene=this.scene,S.stage.addChild(this.scene);var a=this.scene.addChild(new Lo);a.color=new we(1,1,1),a.direction=new we(1,-1,0);var s=this.scene.getChildByName("FollowerGenerator"),o=new ys;o.addComponent(_a),o.addComponent(qa);var l=o.addComponent(fs);o.addComponent(Sa),o.addComponent($a),o.addComponent(pa);var h=b.Instance.playerPrefab;(n=new us).diffuseColor=new we(1,0,0),n.diffuseTexture=Gs.load("res/layabox.png"),l.setFromBoundBox(i.meshFilter.sharedMesh.boundingBox),this.scene.getChildByName("Ground").meshRender.material=new is;var u,c=new Vo(new no);for(var d in c.meshRender.material=n,s._childs){(u=s._childs[d]).addChild(ys.instantiate(c));var _=u.addComponent(ca);_.followerAnimMeshPrefab=h,_.followerPrefab=o}var f=this.scene.getChildByName("Player").getChildByName("Leader");f.removeAllComponent(),f.addComponent(_a).navMeshGroup=g.playerNavMeshGroup,this.leader=f.addComponent(ts),(l=f.addComponent(fs)).setFromBoundBox(i.meshFilter.sharedMesh.boundingBox),f.addComponent(Sa),f.tag="Leader",this.leader.followerPrefab=o,b.Instance.playerLeader=this.leader,this.camera=this.scene.getChildByName("Main Camera"),this.camera.addComponent(la).noWalks=this.scene.getChildByName("NoWalk")._childs,this.camera.addComponent(da).target=this.leader._transform;var m=new Do;m.transform.localRotationEuler=new we(-90,0,0),m.transform.localPosition=new we(0,200,0),f.addComponent(fa),this.camera.addComponent(pa);var p=new ys;(f=new ys).name="Leader",f.addComponent(_a),f.addComponent(ts).followerPrefab=o,(l=f.addComponent(fs)).setFromBoundBox(i.meshFilter.sharedMesh.boundingBox),f.addComponent(Sa),f.tag="Leader",p.addChild(f),b.Instance.leaderPrefab=p,this.onComp.run()},g.playerNavMeshGroup=null,g}(),c=function(){function t(){}return E(t,"code.Random"),t.GeneratePointInCycle=function(t){var e=2*Math.random()*Math.PI,i=Math.sqrt(Math.random())*t,n=Math.sin(e)*i,r=Math.cos(e)*i;return new en(n,r)},t}(),t=function(){function t(){this.level=null,xr._triggerCollision=ma._triggerCollision,gr.init(0,0,!0),S.stage.scaleMode="full",S.stage.screenMode="none",Cn.show(),S.loader.load("res/atlas/comp.atlas",C.create(this,this.onUILoaded))}E(t,"LayaAir3D");var e=t.prototype;return e.onUILoaded=function(){b.Instance.level=this.level=new n(new C(this,this.onLoaded))},e.getRandomBox=function(t){var e=new Vo(t),i=new us;return i.diffuseColor=this.fromHSV(Math.random(),1,1),e.meshRender.material=i,e},e.onLoaded=function(){(new lh).show()},e.fromHSV=function(t,e,i){var n=NaN,r=NaN,a=NaN;if(0==e)n=r=a=i;else{var s=6*t,o=s>>0,l=s-o,h=i*(1-e),u=i*(1-e*l),c=i*(1-e*(1-l));switch(o){case 0:n=i,r=c,a=h;break;case 1:n=u,r=i,a=h;break;case 2:n=h,r=i,a=c;break;case 3:n=h,r=u,a=i;break;case 4:n=c,r=h,a=i;break;case 5:n=i,r=h,a=u}}return new we(n,r,a)},t}(),T=(function(){function t(){this.levelUrl="res/unity/level.ls",this.navUrl="meshes/level2.js",this.scene=null,this.camera=null,this.player=null,this.target=null,this.pathLine=null,this.mesh=null,this.material=null,gr.init(0,0,!0),S.stage.scaleMode="full",S.stage.screenMode="none",Cn.show(),this.scene=S.stage.addChild(new vs),this.camera=this.scene.addChild(new Do(0,.1,1e4)),this.camera.transform.translate(new we(-10,14,10)),this.camera.transform.lookAt(we.ZERO,we.Up),this.camera.clearColor=null,this.camera.addComponent(hh);var t=this.scene.addChild(new Lo);t.color=new we(.6,.6,.6),t.direction=new we(1,-1,0),this.mesh=new io(1,1,1),this.player=new Vo(this.mesh),this.material=new us,this.player.meshRender.material=this.material,this.scene.addChild(this.player),this.player.transform.position=new we(-3.5,.5,5.5),this.target=new Vo(this.mesh),this.target.meshRender.material=this.material,this.scene.addChild(this.target),this.target.transform.position=this.player.transform.position.clone(),S.loader.create(this.levelUrl,C.create(this,this.onLevelLoaded)),this.pathLine=new ys,this.scene.addChild(this.pathLine)}E(t,"NavTest");var e=t.prototype;e.onLevelLoaded=function(){var t=vs.load(this.levelUrl).getChildByName("nav");this.scene.addChild(t),S.loader.load(this.navUrl,C.create(this,this.onNavLoaded),null,"json")},e.onNavLoaded=function(){for(var t=S.loader.getRes(this.navUrl),e=t.vertices,i=t.faces,n=[],r=0;r<i.length;r+=5)n.push(new h(i[r+1],i[r+2],i[r+3]));var a=[];for(r=0;r<e.length;r+=3)a.push(new we(e[r],e[r+1],e[r+2]));var s=new u;s.faces=n,s.vertices=a;var o=vn.window.patrol.buildNodes(s);vn.window.patrol.setZoneData("level",o),this.playerNavMeshGroup=vn.window.patrol.getGroup("level",new we(-3.5,.5,5.5)),S.stage.on("click",this,this.onClick);var l=new Vo(new to(e,i));l.meshRender.material=this.material,this.scene.addChild(l)},e.onClick=function(){var t=new Ee(new we,new we);this.camera.viewportPointToRay(new Re(Xi.instance.mouseX,Xi.instance.mouseY),t);var e=new we,i=new be(we.Up,0);if(pe.intersectsRayAndPlaneRP(t,i,e),e){this.target.transform.position=e;var n=vn.window.patrol.findPath(this.player.transform.position,this.target.transform.position,"level",this.playerNavMeshGroup);if(n&&n.length){var r=n;this.pathLine.removeChildren(),console.log("start",this.player.transform.position.x,this.player.transform.position.y,this.player.transform.position.z);for(var a=0;a<r.length;a++){console.log(r[a].x,r[a].y,r[a].z);var s=new Vo(this.mesh);s.transform.position=r[a],this.pathLine.addChild(s),s.meshRender.material=this.material}console.log("end",this.target.transform.position.x,this.target.transform.position.y,this.target.transform.position.z)}}}}(),function(){function t(){}return E(t,"Config"),t.WebGLTextCacheCount=500,t.atlasEnable=!1,t.showCanvasMark=!1,t.animationInterval=50,t.isAntialias=!1,t.isAlpha=!1,t.premultipliedAlpha=!0,t.isStencil=!0,t.preserveDrawingBuffer=!1,t}()),A=function(){function t(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return E(t,"laya.ani.AnimationContent"),t}(),D=function(){function t(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return E(t,"laya.ani.AnimationNodeContent"),t}(),r=function(){function t(){}return E(t,"laya.ani.AnimationParser01"),t.parse=function(t,e){var i=e.__getBuffer(),n=0,r=0,a=0,s=0,o=0,l=0,h=0,u=e.readUTFString();t._aniClassName=u;var c,d=e.readUTFString().split("\n"),_=e.getUint8(),f=e.getUint32(),m=e.getUint32();0<f&&(c=i.slice(f,m));var p=new yn(c);for(0<m&&(t._publicExtData=i.slice(m,i.byteLength)),t._useParent=!!e.getUint8(),t._anis.length=_,n=0;n<_;n++){var g=t._anis[n]=new A;g.nodes=new Array;var v=g.name=d[e.getUint16()];t._aniMap[v]=n,g.bone3DMap={},g.playTime=e.getFloat32();var y=g.nodes.length=e.getUint8();for(r=g.totalKeyframeDatasLength=0;r<y;r++){var x=g.nodes[r]=new D;x.childs=[];var b=e.getInt16();0<=b&&(x.name=d[b],g.bone3DMap[x.name]=r),x.keyFrame=new Array,x.parentIndex=e.getInt16(),-1==x.parentIndex?x.parent=null:x.parent=g.nodes[x.parentIndex],x.lerpType=e.getUint8();var T=e.getUint32();p.pos=T;var S=x.keyframeWidth=p.getUint16();if(g.totalKeyframeDatasLength+=S,0===x.lerpType||1===x.lerpType)for(x.interpolationMethod=[],x.interpolationMethod.length=S,a=0;a<S;a++)x.interpolationMethod[a]=xa.interpolation[p.getUint8()];null!=x.parent&&x.parent.childs.push(x);var E=e.getUint16();0<E&&(x.extenData=i.slice(e.pos,e.pos+E),e.pos+=E);var R,w=e.getUint16(),C=0;for(a=0,s=x.keyFrame.length=w;a<s;a++){if((R=x.keyFrame[a]=new L).duration=e.getFloat32(),R.startTime=C,2===x.lerpType){R.interpolationData=[];var I,M=e.getUint8();switch(I=e.getFloat32()){case 254:for(R.interpolationData.length=S,h=0;h<S;h++)R.interpolationData[h]=0;break;case 255:for(R.interpolationData.length=S,h=0;h<S;h++)R.interpolationData[h]=5;break;default:for(R.interpolationData.push(I),l=1;l<M;l++)R.interpolationData.push(e.getFloat32())}}for(R.data=new Float32Array(S),o=0;o<S;o++)R.data[o]=e.getFloat32(),-1e-8<R.data[o]&&R.data[o]<1e-8&&(R.data[o]=0);C+=R.duration}R.startTime=g.playTime,x.playTime=g.playTime,t._calculateKeyFrame(x,w,S)}}},t}(),a=function(){function b(){}return E(b,"laya.ani.AnimationParser02"),b.READ_DATA=function(){b._DATA.offset=b._reader.getUint32(),b._DATA.size=b._reader.getUint32()},b.READ_BLOCK=function(){for(var t=b._BLOCK.count=b._reader.getUint16(),e=b._BLOCK.blockStarts=[],i=b._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(b._reader.getUint32()),i.push(b._reader.getUint32())},b.READ_STRINGS=function(){var t=b._reader.getUint32(),e=b._reader.getUint16(),i=b._reader.pos;b._reader.pos=t+b._DATA.offset;for(var n=0;n<e;n++)b._strings[n]=b._reader.readUTFString();b._reader.pos=i},b.parse=function(t,e){b._templet=t;(b._reader=e).__getBuffer();b.READ_DATA(),b.READ_BLOCK(),b.READ_STRINGS();for(var i=0,n=b._BLOCK.count;i<n;i++){var r=e.getUint16(),a=b._strings[r],s=b["READ_"+a];if(null==s)throw new Error("model file err,no this function:"+r+" "+a);s.call()}},b.READ_ANIMATIONS=function(){var t=b._reader,e=t.__getBuffer(),i=0,n=0,r=0,a=0,s=t.getUint16(),o=[];for(o.length=s,i=0;i<s;i++)o[i]=xa.interpolation[t.getByte()];var l=t.getUint8();for(b._templet._anis.length=l,i=0;i<l;i++){var h=b._templet._anis[i]={};h.nodes=new Array;var u=h.name=b._strings[t.getUint16()];b._templet._aniMap[u]=i,h.bone3DMap={},h.playTime=t.getFloat32();var c=h.nodes.length=t.getInt16();for(n=h.totalKeyframeDatasLength=0;n<c;n++){var d=h.nodes[n]={};d.keyframeWidth=s,d.childs=[];var _=t.getUint16();0<=_&&(d.name=b._strings[_],h.bone3DMap[d.name]=n),d.keyFrame=new Array,d.parentIndex=t.getInt16(),-1==d.parentIndex?d.parent=null:d.parent=h.nodes[d.parentIndex],h.totalKeyframeDatasLength+=s,d.interpolationMethod=o,null!=d.parent&&d.parent.childs.push(d);var f=t.getUint16(),m=null,p=null;for(r=0,a=d.keyFrame.length=f;r<a;r++){(m=d.keyFrame[r]={}).startTime=t.getFloat32(),p&&(p.duration=m.startTime-p.startTime);var g=b._DATA.offset,v=t.getUint32(),y=4*s,x=e.slice(g+v,g+v+y);m.data=new Float32Array(x),p=m}m.duration=0,d.playTime=h.playTime,b._templet._calculateKeyFrame(d,f,s)}}},b._templet=null,b._reader=null,b._strings=[],m(b,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),b}(),s=(function(){function t(){}E(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2}(),function(){function t(){this.mesh=null,this.transform=null,this.context=null,this.mode=0}E(t,"laya.ani.bone.canvasmesh.CanvasMeshRender");var e=t.prototype;return e.renderToContext=function(t){this.context=t.ctx||t,this.mesh&&(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh))},e._renderNoIndexes=function(t){var e=0,i=t.vertices.length/2,n=0;for(e=0;e<i-2;e++)n=2*e,this._renderDrawTriangle(t,n,n+2,n+4)},e._renderWithIndexes=function(t){var e=t.indexes,i=0,n=e.length;for(i=0;i<n;i+=3){var r=2*e[i],a=2*e[i+1],s=2*e[i+2];this._renderDrawTriangle(t,r,a,s)}},e._renderDrawTriangle=function(t,e,i,n){var r=this.context,a=t.uvs,s=t.vertices,o=t.texture,l=o.bitmap,h=l.source,u=o.width,c=o.height,d=l.width,_=l.height,f=NaN,m=NaN,p=NaN,g=NaN,v=NaN,y=NaN;if(t.useUvTransform){var x=t.uvTransform;f=(a[e]*x.a+a[e+1]*x.c+x.tx)*d,m=(a[i]*x.a+a[i+1]*x.c+x.tx)*d,p=(a[n]*x.a+a[n+1]*x.c+x.tx)*d,g=(a[e]*x.b+a[e+1]*x.d+x.ty)*_,v=(a[i]*x.b+a[i+1]*x.d+x.ty)*_,y=(a[n]*x.b+a[n+1]*x.d+x.ty)*_}else f=a[e]*d,m=a[i]*d,p=a[n]*d,g=a[e+1]*_,v=a[i+1]*_,y=a[n+1]*_;var b=s[e],T=s[i],S=s[n],E=s[e+1],R=s[i+1],w=s[n+1];if(0<t.canvasPadding){var C=t.canvasPadding,I=t.canvasPadding,M=(b+T+S)/3,A=(E+R+w)/3,D=b-M,L=E-A,V=Math.sqrt(D*D+L*L);b=M+D/V*(V+C),E=A+L/V*(V+I),L=R-A,T=M+(D=T-M)/(V=Math.sqrt(D*D+L*L))*(V+C),R=A+L/V*(V+I),L=w-A,S=M+(D=S-M)/(V=Math.sqrt(D*D+L*L))*(V+C),w=A+L/V*(V+I)}if(r.save(),this.transform){var N=this.transform;r.transform(N.a,N.b,N.c,N.d,N.tx,N.ty)}r.beginPath(),r.moveTo(b,E),r.lineTo(T,R),r.lineTo(S,w),r.closePath(),r.clip();var P=1/(f*v+g*p+m*y-v*p-g*m-f*y),F=b*v+g*S+T*y-v*S-g*T-b*y,O=f*T+b*p+m*S-T*p-b*m-f*S,B=f*v*S+g*T*p+b*m*y-b*v*p-g*m*S-f*T*y,G=E*v+g*w+R*y-v*w-g*R-E*y,W=f*R+E*p+m*w-R*p-E*m-f*w,U=f*v*w+g*R*p+E*m*y-E*v*p-g*m*w-f*R*y;r.transform(F*P,G*P,O*P,W*P,B*P,U*P),r.drawImage(h,o.uv[0]*d,o.uv[1]*_,u,c,o.uv[0]*d,o.uv[1]*_,u,c),r.restore()},t}()),o=function(){function t(){this.texture=null,this.uvs=[0,0,1,0,1,1,0,1],this.vertices=[0,0,100,0,100,100,0,100],this.indexes=[0,1,3,3,1,2],this.uvTransform=null,this.useUvTransform=!1,this.canvasPadding=1}return E(t,"laya.ani.bone.canvasmesh.MeshData"),t.prototype.getBounds=function(){return nn._getWrapRec(this.vertices)},t}(),f=function(){function c(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,hn.isConchNode){this._nativeObj=new d._conchGraphics,this.id=this._nativeObj.conchID}}E(c,"laya.display.Graphics");var t=c.prototype;return t.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},t.clear=function(t){void 0===t&&(t=!1);var e=0,i=0;if(t){var n=this._one;if(this._cmds){for(i=this._cmds.length,e=0;e<i;e++)!(n=this._cmds[e])||n.callee!==hn._context._drawTexture&&n.callee!==hn._context._drawTextureWithTransform||(n[0]=null,c._cache.push(n));this._cmds.length=0}else n&&(!n||n.callee!==hn._context._drawTexture&&n.callee!==hn._context._drawTextureWithTransform||(n[0]=null,c._cache.push(n)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(e=0,i=this._vectorgraphArray.length;e<i;e++)Ln.getInstance().deleteShape(this._vectorgraphArray[e]);this._vectorgraphArray.length=0}},t._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},t._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new Zi,this._graphicBounds._graphics=this)},t._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},t._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},t.getBounds=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(t)},t.getBoundPoints=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(t)},t._addCmd=function(t){this._cmds=this._cmds||[],t.callee=t.shift(),this._cmds.push(t)},t.setFilters=function(t){this._saveToCmd(hn._context._setFilters,t)},t.drawTexture=function(t,e,i,n,r,a,s){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),!t||s<.01)return null;n||(n=t.sourceWidth),r||(r=t.sourceHeight),s=s<0?0:1<s?1:s;var o,l=!hn.isWebGL&&(vn.onFirefox||vn.onEdge||vn.onIE||vn.onSafari)?.5:0,h=n/t.sourceWidth,u=r/t.sourceHeight;return n=t.width*h,r=t.height*u,t.loaded&&(n<=0||r<=0)?null:(e+=t.offsetX*h,i+=t.offsetY*u,this._sp&&(this._sp._renderType|=512),e-=l,i-=l,n+=2*l,r+=2*l,c._cache.length?((o=c._cache.pop())[0]=t,o[1]=e,o[2]=i,o[3]=n,o[4]=r,o[5]=a,o[6]=s):o=[t,e,i,n,r,a,s],o.callee=a||1!=s?hn._context._drawTextureWithTransform:hn._context._drawTexture,null!=this._one||a||1!=s?this._saveToCmd(o.callee,o):(this._one=o,this._render=this._renderOneImg),t.loaded||t.once("loaded",this,this._textureLoaded,[t,o]),this._repaint(),o)},t.cleanByTexture=function(t,e,i,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),!t)return this.clear();if(this._one&&this._render===this._renderOneImg){n||(n=t.sourceWidth),r||(r=t.sourceHeight);var a=n/t.sourceWidth,s=r/t.sourceHeight;n=t.width*a,r=t.height*s,e+=t.offsetX*a,i+=t.offsetY*s,this._one[0]=t,this._one[1]=e,this._one[2]=i,this._one[3]=n,this._one[4]=r,this._repaint()}else this.clear(),t&&this.drawTexture(t,e,i,n,r)},t.drawTextures=function(t,e){t&&this._saveToCmd(hn._context._drawTextures,[t,e])},t.fillTexture=function(t,e,i,n,r,a,s){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a="repeat"),t){var o=[t,e,i,n,r,a,s||en.EMPTY,{}];t.loaded||t.once("loaded",this,this._textureLoaded,[t,o]),this._saveToCmd(hn._context._fillTexture,o)}},t._textureLoaded=function(t,e){e[3]=e[3]||t.width,e[4]=e[4]||t.height,this._repaint()},t.fillCircle=function(t,e,i,n,r,a,s){i.bitmap.enableMerageInAtlas=!1;var o=new Float32Array(2*(s+1)),l=new Float32Array(2*(s+1)),h=new Uint16Array(3*s),u=2*Math.PI/s,c=0;o[0]=n,o[1]=r,l[0]=n/i.width,l[1]=r/i.height;for(var d=2,_=0;_<s;_++){var f=a*Math.cos(c)+n,m=a*Math.sin(c)+r;o[d]=f,o[d+1]=m,l[d]=f/i.width,l[d+1]=m/i.height,c+=u,d+=2}for(_=d=0;_<s;_++)h[d++]=0,h[d++]=_+1,h[d++]=s+1<=_+2?1:_+2;this.drawTriangles(i,t,e,o,l,h)},t.drawTriangles=function(t,e,i,n,r,a,s,o,l,h){void 0===o&&(o=1),this._saveToCmd(hn._context.drawTriangles,[t,e,i,n,r,a,s,o,l,h])},t._saveToCmd=function(t,e){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=e,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),e.callee=t,this._repaint(),e},t.clipRect=function(t,e,i,n){this._saveToCmd(hn._context._clipRect,[t,e,i,n])},t.fillText=function(t,e,i,n,r,a,s){void 0===s&&(s=0),this._saveToCmd(hn._context._fillText,[t,e,i,n||Wi.defaultFont,r,a])},t.fillBorderText=function(t,e,i,n,r,a,s,o){this._saveToCmd(hn._context._fillBorderText,[t,e,i,n||Wi.defaultFont,r,a,s,o])},t.strokeText=function(t,e,i,n,r,a,s){this._saveToCmd(hn._context._strokeText,[t,e,i,n||Wi.defaultFont,r,a,s])},t.alpha=function(t){t=t<0?0:1<t?1:t,this._saveToCmd(hn._context._alpha,[t])},t.setAlpha=function(t){t=t<0?0:1<t?1:t,this._saveToCmd(hn._context._setAlpha,[t])},t.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(hn._context._transform,[t,e,i])},t.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(hn._context._rotate,[t,e,i])},t.scale=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._saveToCmd(hn._context._scale,[t,e,i,n])},t.translate=function(t,e){this._saveToCmd(hn._context._translate,[t,e])},t.save=function(){this._saveToCmd(hn._context._save,[])},t.restore=function(){this._saveToCmd(hn._context._restore,[])},t.replaceText=function(t){this._repaint();var e=this._cmds;if(e){for(var i=e.length-1;-1<i;i--)if(this._isTextCmd(e[i].callee))return e[i][0].toUpperCase?e[i][0]=t:e[i][0].setText(t),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=t:this._one[0].setText(t),!0;return!1},t._isTextCmd=function(t){return t===hn._context._fillText||t===hn._context._fillBorderText||t===hn._context._strokeText},t.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(e)for(var i=e.length-1;-1<i;i--)this._isTextCmd(e[i].callee)&&(e[i][4]=t,e[i][0].toUpperCase||(e[i][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=t,this._one[0].toUpperCase||(this._one[0].changed=!0))},t.loadImage=function(t,e,i,n,r,a){var s=this;void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var o=kr.getRes(t);function l(t){t&&(s.drawTexture(t,e,i,n,r),null!=a&&a.call(s._sp,t))}o?l(o):S.loader.load(t,C.create(null,l),null,"image")},t._renderEmpty=function(t,e,i,n){},t._renderAll=function(t,e,i,n){for(var r,a=this._cmds,s=0,o=a.length;s<o;s++)(r=a[s]).callee.call(e,i,n,r)},t._renderOne=function(t,e,i,n){this._one.callee.call(e,i,n,this._one)},t._renderOneImg=function(t,e,i,n){this._one.callee.call(e,i,n,this._one),2305!==t._renderType&&(t._renderType|=1)},t.drawLine=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=0;hn.isWebGL&&(s=Ln.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s));var o=a%2==0?0:.5,l=[t+o,e+o,i+o,n+o,r,a,s];this._saveToCmd(hn._context._drawLine,l)},t.drawLines=function(t,e,i,n,r){void 0===r&&(r=1);var a=0;if(i&&!(i.length<4)){hn.isWebGL&&(a=Ln.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(a));var s=r%2==0?0:.5,o=[t+s,e+s,i,n,r,a];this._saveToCmd(hn._context._drawLines,o)}},t.drawCurves=function(t,e,i,n,r){void 0===r&&(r=1);var a=[t,e,i,n,r];this._saveToCmd(hn._context._drawCurves,a)},t.drawRect=function(t,e,i,n,r,a,s){void 0===s&&(s=1);var o=a?s/2:0,l=a?s:0,h=[t+o,e+o,i-l,n-l,r,a,s];this._saveToCmd(hn._context._drawRect,h)},t.drawCircle=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=r?a/2:0,o=0;hn.isWebGL&&(o=Ln.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(o));var l=[t,e,i-s,n,r,a,o];this._saveToCmd(hn._context._drawCircle,l)},t.drawPie=function(t,e,i,n,r,a,s,o){void 0===o&&(o=1);var l=s?o/2:0,h=s?o:0,u=0;hn.isWebGL&&(u=Ln.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(u));var c=[t+l,e+l,i-h,n,r,a,s,o,u];c[3]=Dn.toRadian(n),c[4]=Dn.toRadian(r),this._saveToCmd(hn._context._drawPie,c)},t.drawPoly=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=0,o=!1;hn.isWebGL&&(s=Ln.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s),o=!(6<i.length));var l=r?a%2==0?0:.5:0,h=[t+l,e+l,i,n,r,a,s,o];this._saveToCmd(hn._context._drawPoly,h)},t.drawPath=function(t,e,i,n,r){var a=[t,e,i,n,r];this._saveToCmd(hn._context._drawPath,a)},v(0,t,"cmds",function(){return this._cmds},function(t){this._sp&&(this._sp._renderType|=512),this._cmds=t,this._render=this._renderAll,this._repaint()}),c.__init__=function(){if(hn.isConchNode){for(var t=laya.display.Graphics.prototype,e=vn.window.ConchGraphics.prototype,i=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],n=0,r=i.length;n<=r;n++){var a=i[n];t[a]=e[a]}t._saveToCmd=null,e.drawImageS&&(t.drawTextures=function(t,e){if(t&&t.loaded&&t.bitmap&&t.source){var i=t.uv,n=t.bitmap.width,r=t.bitmap.height;this.drawImageS(t.bitmap.source,i[0]*n,i[1]*r,(i[2]-i[0])*n,(i[5]-i[3])*r,t.offsetX,t.offsetY,t.width,t.height,e)}}),t.drawTexture=function(t,e,i,n,r,a,s){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),t)if(t.loaded){if(t.loaded&&t.bitmap&&t.source&&(n||(n=t.sourceWidth),r||(r=t.sourceHeight),s=s<0?0:1<s?1:s,n=n-t.sourceWidth+t.width,r=r-t.sourceHeight+t.height,!(n<=0||r<=0))){e+=t.offsetX,i+=t.offsetY;var o=t.uv,l=t.bitmap.width,h=t.bitmap.height;o[4]<o[0]&&o[5]<o[1]?this.drawImageM(t.bitmap.source,o[4]*l,o[5]*h,(o[0]-o[4])*l,(o[1]-o[5])*h,e,i,n,r,a,s):this.drawImageM(t.bitmap.source,o[0]*l,o[1]*h,(o[2]-o[0])*l,(o[5]-o[3])*h,e,i,n,r,a,s),this._repaint()}}else t.once("loaded",this,function(){this.drawTexture(t,e,i,n,r,a)})},t.fillTexture=function(t,e,i,n,r,a,s){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a="repeat"),t&&t.loaded){var o,l=hn._context.ctx,h=t.bitmap.width,u=t.bitmap.height,c=t.uv;o=t.uv!=Hr.DEF_UV?l.createPattern(t.bitmap.source,a,c[0]*h,c[1]*u,(c[2]-c[0])*h,(c[5]-c[3])*u):l.createPattern(t.bitmap.source,a);var d=0,_=0;s&&(e+=s.x%t.width,i+=s.y%t.height,d-=s.x%t.width,_-=s.y%t.height),this._fillImage(o,e,i,d,_,n,r)}}}},c._cache=[],c}(),L=function(){function t(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return E(t,"laya.ani.KeyFramesContent"),t}(),_=function(){function u(){}return E(u,"laya.ani.math.BezierLerp"),u.getBezierRate=function(t,e,i,n,r){var a=u._getBezierParamKey(e,i,n,r),s=100*a+t;if(u._bezierResultCache[s])return u._bezierResultCache[s];var o,l=u._getBezierPoints(e,i,n,r,a),h=0;for(o=l.length,h=0;h<o;h+=2)if(t<=l[h])return u._bezierResultCache[s]=l[h+1],l[h+1];return u._bezierResultCache[s]=1},u._getBezierParamKey=function(t,e,i,n){return 100*(100*(100*(100*t+e)+i)+n)},u._getBezierPoints=function(t,e,i,n,r){return u._bezierPointsCache[r]?u._bezierPointsCache[r]:(a=[0,0,t,e,i,n,1,1],s=(new Qi).getBezierPoints(a,100,3),u._bezierPointsCache[r]=s);var a,s},u._bezierResultCache={},u._bezierPointsCache={},u}(),p=function(){function N(){}return E(N,"laya.d3.animation.AnimationClipParser01"),N.READ_DATA=function(){N._DATA.offset=N._reader.getUint32(),N._DATA.size=N._reader.getUint32()},N.READ_BLOCK=function(){for(var t=N._BLOCK.count=N._reader.getUint16(),e=N._BLOCK.blockStarts=[],i=N._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(N._reader.getUint32()),i.push(N._reader.getUint32())},N.READ_STRINGS=function(){var t=N._reader.getUint32(),e=N._reader.getUint16(),i=N._reader.pos;N._reader.pos=t+N._DATA.offset;for(var n=0;n<e;n++)N._strings[n]=N._reader.readUTFString();N._reader.pos=i},N.parse=function(t,e){N._animationClip=t;(N._reader=e).__getBuffer();N.READ_DATA(),N.READ_BLOCK(),N.READ_STRINGS();for(var i=0,n=N._BLOCK.count;i<n;i++){var r=e.getUint16(),a=N._strings[r],s=N["READ_"+a];if(null==s)throw new Error("model file err,no this function:"+r+" "+a);s.call()}},N.READ_ANIMATIONS=function(){var t,e=0,i=0,n=N._reader,r=n.__getBuffer(),a=[],s=n.getUint8();for(a.length=s,e=0;e<s;e++)a[e]=n.getUint16();var o=[],l=n.getUint16();for(o.length=l,e=0;e<l;e++)o[e]=n.getFloat32();var h=N._animationClip;h.name=N._strings[n.getUint16()];var u=h._duration=n.getFloat32();h.islooping=!!n.getByte(),h._frameRate=n.getInt16();var c=n.getInt16(),d=h._nodes=new Array;d.length=c,(h._publicClipDatas=[]).length=c;var _=h._nodesMap={},f=0,m=0;for(e=0;e<c;e++){t=d[e]=new Z;var p=n.getUint16(),g=t.path=[];for(g.length=p,i=0;i<p;i++)g[i]=N._strings[n.getUint16()];var v=g.join("/"),y=_[v];y||(_[v]=y=[]),y.push(t);var x=n.getInt16();-1!==x&&(t.componentType=N._strings[x]);var b=W._propertyIndexDic[N._strings[n.getUint16()]];if(null==b)throw new Error("AnimationClipParser01:unknown property name.");var T=b<4,S=!T||T&&""===g[0];(t._cacheProperty=S)?f++:m++,t.propertyNameID=b;var E=a[n.getUint8()];t.keyFrameWidth=E/4;var R=t.keyFrames=[],w=R.length=n.getUint16(),C=null,I=NaN;for(i=0;i<w;i++){var M=R[i]=new U;I=M.startTime=o[n.getUint16()];var A=n.pos;M.inTangent=new Float32Array(r.slice(A,A+E)),n.pos+=E,A=n.pos,M.outTangent=new Float32Array(r.slice(A,A+E)),n.pos+=E,A=n.pos,M.data=new Float32Array(r.slice(A,A+E)),n.pos+=E,C&&(C.next=M,C.duration=I-C.startTime),C=M}M.next=null,M.duration=u-I}var D=h._nodeToCachePropertyMap=new Int32Array(c),L=h._cachePropertyMap=new Int32Array(f),V=h._unCachePropertyMap=new Int32Array(m);for(f=m=0,e=0;e<c;e++)(t=d[e])._cacheProperty?(D[e]=f,L[f++]=e):V[m++]=e},N._animationClip=null,N._reader=null,N._strings=[],m(N,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),N}(),g=function(){function B(){}return E(B,"laya.d3.animation.AnimationClipParser02"),B.READ_DATA=function(){B._DATA.offset=B._reader.getUint32(),B._DATA.size=B._reader.getUint32()},B.READ_BLOCK=function(){for(var t=B._BLOCK.count=B._reader.getUint16(),e=B._BLOCK.blockStarts=[],i=B._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(B._reader.getUint32()),i.push(B._reader.getUint32())},B.READ_STRINGS=function(){var t=B._reader.getUint32(),e=B._reader.getUint16(),i=B._reader.pos;B._reader.pos=t+B._DATA.offset;for(var n=0;n<e;n++)B._strings[n]=B._reader.readUTFString();B._reader.pos=i},B.parse=function(t,e){B._animationClip=t;(B._reader=e).__getBuffer();B.READ_DATA(),B.READ_BLOCK(),B.READ_STRINGS();for(var i=0,n=B._BLOCK.count;i<n;i++){var r=e.getUint16(),a=B._strings[r],s=B["READ_"+a];if(null==s)throw new Error("model file err,no this function:"+r+" "+a);s.call()}},B.READ_ANIMATIONS=function(){var t,e=0,i=0,n=B._reader,r=n.__getBuffer(),a=[],s=n.getUint8();for(a.length=s,e=0;e<s;e++)a[e]=n.getUint16();var o=[],l=n.getUint16();for(o.length=l,e=0;e<l;e++)o[e]=n.getFloat32();var h=B._animationClip;h.name=B._strings[n.getUint16()];var u=h._duration=n.getFloat32();h.islooping=!!n.getByte(),h._frameRate=n.getInt16();var c=n.getInt16(),d=h._nodes=new Array;d.length=c,(h._publicClipDatas=[]).length=c;var _=h._nodesMap={},f=0,m=0;for(e=0;e<c;e++){t=d[e]=new Z;var p=n.getUint16(),g=t.path=[];for(g.length=p,i=0;i<p;i++)g[i]=B._strings[n.getUint16()];var v=g.join("/"),y=_[v];y||(_[v]=y=[]),y.push(t);var x=n.getInt16();-1!==x&&(t.componentType=B._strings[x]);var b=W._propertyIndexDic[B._strings[n.getUint16()]];if(null==b)throw new Error("AnimationClipParser02:unknown property name.");var T=b<4,S=!T||T&&""===g[0];(t._cacheProperty=S)?f++:m++,t.propertyNameID=b;var E=a[n.getUint8()];t.keyFrameWidth=E/4;var R=t.keyFrames=[],w=R.length=n.getUint16(),C=null,I=NaN;for(i=0;i<w;i++){var M=R[i]=new U;I=M.startTime=o[n.getUint16()];var A=n.pos;M.inTangent=new Float32Array(r.slice(A,A+E)),n.pos+=E,A=n.pos,M.outTangent=new Float32Array(r.slice(A,A+E)),n.pos+=E,A=n.pos,M.data=new Float32Array(r.slice(A,A+E)),n.pos+=E,C&&(C.next=M,C.duration=I-C.startTime),C=M}M.next=null,M.duration=u-I}var D=n.getUint16();for(e=0;e<D;e++){var L,V=new G;V.time=n.getFloat32(),V.eventName=B._strings[n.getUint16()];var N=n.getUint16();for(0<N&&(V.params=L=[]),i=0;i<N;i++){switch(n.getByte()){case 0:L.push(!!n.getByte());break;case 1:L.push(n.getInt32());break;case 2:L.push(n.getFloat32());break;case 3:L.push(B._strings[n.getUint16()]);break;default:throw new Error("unknown type.")}}h.addEvent(V)}var P=h._nodeToCachePropertyMap=new Int32Array(c),F=h._cachePropertyMap=new Int32Array(f),O=h._unCachePropertyMap=new Int32Array(m);for(f=m=0,e=0;e<c;e++)(t=d[e])._cacheProperty?(P[e]=f,F[f++]=e):O[m++]=e},B._animationClip=null,B._reader=null,B._strings=[],m(B,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),B}(),G=function(){function t(){this.time=NaN,this.eventName=null,this.params=null}return E(t,"laya.d3.animation.AnimationEvent"),t}(),W=function(){function n(){this._childs=[],this.transform=new Er(this)}E(n,"laya.d3.animation.AnimationNode");var t=n.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.addChild=function(t){t._parent=this,t.transform.setParent(this.transform),this._childs.push(t)},t.removeChild=function(t){var e=this._childs.indexOf(t);-1!==e&&this._childs.splice(e,1)},t.getChildByName=function(t){for(var e=0,i=this._childs.length;e<i;e++){var n=this._childs[e];if(n.name===t)return n}return null},t.getChildByIndex=function(t){return this._childs[t]},t.getChildCount=function(){return this._childs.length},t.cloneTo=function(t){var e=t;e.name=this.name;for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i],a=r.clone();e.addChild(a);var s=r.transform,o=a.transform;o.setLocalPosition(s.getLocalPosition()),o.setLocalRotation(s.getLocalRotation()),o.setLocalScale(s.getLocalScale()),o._localRotationEuler=s._localRotationEuler,o._setWorldMatrixIgnoreUpdate(s.getWorldMatrix())}},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},n.__init__=function(){n.registerAnimationNodeProperty("localPosition",n._getLocalPosition,n._setLocalPosition),n.registerAnimationNodeProperty("localRotation",n._getLocalRotation,n._setLocalRotation),n.registerAnimationNodeProperty("localScale",n._getLocalScale,n._setLocalScale),n.registerAnimationNodeProperty("localRotationEuler",n._getLocalRotationEuler,n._setLocalRotationEuler),n.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",n._getParticleRenderSharedMaterialTintColor,n._setParticleRenderSharedMaterialTintColor),n.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",n._getMeshRenderSharedMaterialTilingOffset,n._setMeshRenderSharedMaterialTilingOffset),n.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",n._getMeshRenderSharedMaterialAlbedo,n._setMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",n._getSkinnedMeshRenderSharedMaterialTilingOffset,n._setSkinnedMeshRenderSharedMaterialTilingOffset),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",n._getSkinnedMeshRenderSharedMaterialAlbedo,n._setSkinnedMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",n._getMeshRenderSharedMaterialAlbedo,n._setMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",n._getSkinnedMeshRenderSharedMaterialAlbedo,n._setSkinnedMeshRenderSharedMaterialAlbedo),n.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",n._getMeshRenderSharedMaterialIntensity,n._setMeshRenderSharedMaterialIntensity),n.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",n._getMeshRenderSharedMaterialAlpha,n._setMeshRenderSharedMaterialAlpha),n.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",n._getMeshRenderSharedMaterialAlphaColor,n._setMeshRenderSharedMaterialAlphaColor),n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",n._getMeshRenderSharedMaterialBaseColor,n._setMeshRenderSharedMaterialBaseColor),n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",n._getMeshRenderSharedMaterialDissolve,n._setMeshRenderSharedMaterialDissolve),n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",n._getMeshRenderSharedMaterialDissolveSpeed,n._setMeshRenderSharedMaterialDissolveSpeed),n.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",n._getMeshRenderSharedMaterialMMultiplier,n._setMeshRenderSharedMaterialMMultiplier),n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",n._getMeshRenderSharedMaterialBaseScrollSpeedX,n._setMeshRenderSharedMaterialBaseScrollSpeedX),n.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",n._getMeshRenderSharedMaterialBaseScrollSpeedY,n._setMeshRenderSharedMaterialBaseScrollSpeedY),n.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",n._getMeshRenderSharedMaterialSecondScrollSpeedX,n._setMeshRenderSharedMaterialSecondScrollSpeedX),n.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",n._getMeshRenderSharedMaterialSecondScrollSpeedY,n._setMeshRenderSharedMaterialSecondScrollSpeedY),n.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",n._getMeshRenderSharedMaterialDetailTilingOffset,n._setMeshRenderSharedMaterialDetailTilingOffset),n.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",n._getMeshRenderSharedMaterialDissolveTilingOffset,n._setMeshRenderSharedMaterialDissolveTilingOffset),n.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",n._getMeshRenderSharedMaterialMaskTilingOffset,n._setMeshRenderSharedMaterialMaskTilingOffset)},n.registerAnimationNodeProperty=function(t,e,i){if(n._propertyIndexDic[t])throw new Error("AnimationNode: this propertyName has registered.");n._propertyIndexDic[t]=n._propertyIDCounter,n._propertyGetFuncs[n._propertyIDCounter]=e,n._propertySetFuncs[n._propertyIDCounter]=i,n._propertyIDCounter++},n._getLocalPosition=function(t,e){return t?t.transform.getLocalPosition():e._transform.localPosition.elements},n._setLocalPosition=function(t,e,i){if(t)t.transform.setLocalPosition(i);else{var n=e._transform,r=n.localPosition;r.elements=i,n.localPosition=r}},n._getLocalRotation=function(t,e){return t?t.transform.getLocalRotation():e._transform.localRotation.elements},n._setLocalRotation=function(t,e,i){if(t)t.transform.setLocalRotation(i);else{var n=e._transform,r=n.localRotation;r.elements=i,n.localRotation=r}},n._getLocalScale=function(t,e){return t?t.transform.getLocalScale():e._transform.localScale.elements},n._setLocalScale=function(t,e,i){if(t)t.transform.setLocalScale(i);else{var n=e._transform,r=n.localScale;r.elements=i,n.localScale=r}},n._getLocalRotationEuler=function(t,e){return t?t.transform.getLocalRotationEuler():e._transform.localRotationEuler.elements},n._setLocalRotationEuler=function(t,e,i){if(t)t.transform.setLocalRotationEuler(i);else{var n=e._transform,r=n.localRotationEuler;r.elements=i,n.localRotationEuler=r}},n._getMeshRenderSharedMaterialTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return e.meshRender.sharedMaterial.tilingOffset.elements},n._setMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).tilingOffset).elements=i,n.tilingOffset=r)}else(r=(n=e.meshRender.material).tilingOffset).elements=i,n.tilingOffset=r},n._getMeshRenderSharedMaterialAlbedo=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.albedoColor.elements:null}return e.meshRender.sharedMaterial.albedoColor.elements},n._setMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).albedoColor).elements=i,n.albedoColor=r)}else(r=(n=e.meshRender.material).albedoColor).elements=i,n.albedoColor=r},n._getSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return e.skinnedMeshRender.sharedMaterial.tilingOffset.elements},n._setSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=r)}else(r=(n=e.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=r},n._getSkinnedMeshRenderSharedMaterialAlbedo=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return e.skinnedMeshRender.sharedMaterial.albedoColor.elements},n._setSkinnedMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=r)}else(r=(n=e.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=r},n._getParticleRenderSharedMaterialTintColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.particleRender.sharedMaterial.tintColor.elements:null}return e.particleRender.sharedMaterial.tintColor.elements},n._setParticleRenderSharedMaterialTintColor=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.particleRender.material).tintColor).elements=i,n.tintColor=r)}else(r=(n=e.particleRender.material).tintColor).elements=i,n.tintColor=r},n._getMeshRenderSharedMaterialAlphaColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.alphaColor.elements:null}return e.meshRender.sharedMaterial.alphaColor.elements},n._setMeshRenderSharedMaterialAlphaColor=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).alphaColor).elements=i,n.alphaColor=r)}else(r=(n=e.meshRender.material).alphaColor).elements=i,n.alphaColor=r},n._getMeshRenderSharedMaterialBaseColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseColor.elements:null}return e.meshRender.sharedMaterial.baseColor.elements},n._setMeshRenderSharedMaterialBaseColor=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).baseColor).elements=i,n.baseColor=r)}else(r=(n=e.meshRender.material).baseColor).elements=i,n.baseColor=r},n._getMeshRenderSharedMaterialDissolve=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolve:0}return e.meshRender.sharedMaterial.dissolve},n._setMeshRenderSharedMaterialDissolve=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.dissolve=i[0])}else e.meshRender.material.dissolve=i[0]},n._getMeshRenderSharedMaterialDissolveSpeed=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolveSpeed:0}return e.meshRender.sharedMaterial.dissolveSpeed},n._setMeshRenderSharedMaterialDissolveSpeed=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.dissolveSpeed=i[0])}else e.meshRender.material.dissolveSpeed=i[0]},n._getMeshRenderSharedMaterialMMultiplier=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.mMultiplier:0}return e.meshRender.sharedMaterial.mMultiplier},n._setMeshRenderSharedMaterialMMultiplier=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.mMultiplier=i[0])}else e.meshRender.material.mMultiplier=i[0]},n._getMeshRenderSharedMaterialBaseScrollSpeedX=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return e.meshRender.sharedMaterial.baseScrollSpeedX},n._setMeshRenderSharedMaterialBaseScrollSpeedX=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.baseScrollSpeedX=i[0])}else e.meshRender.material.baseScrollSpeedX=i[0]},n._getMeshRenderSharedMaterialBaseScrollSpeedY=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return e.meshRender.sharedMaterial.baseScrollSpeedY},n._setMeshRenderSharedMaterialBaseScrollSpeedY=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.baseScrollSpeedY=i[0])}else e.meshRender.material.baseScrollSpeedY=i[0]},n._getMeshRenderSharedMaterialSecondScrollSpeedX=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return e.meshRender.sharedMaterial.secondScrollSpeedX},n._setMeshRenderSharedMaterialSecondScrollSpeedX=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.secondScrollSpeedX=i[0])}else e.meshRender.material.secondScrollSpeedX=i[0]},n._getMeshRenderSharedMaterialSecondScrollSpeedY=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return e.meshRender.sharedMaterial.secondScrollSpeedY},n._setMeshRenderSharedMaterialSecondScrollSpeedY=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.secondScrollSpeedY=i[0])}else e.meshRender.material.secondScrollSpeedY=i[0]},n._getMeshRenderSharedMaterialAlpha=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.alpha:0}return e.meshRender.sharedMaterial.alpha},n._setMeshRenderSharedMaterialAlpha=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.alpha=i[0])}else e.meshRender.material.alpha=i[0]},n._getMeshRenderSharedMaterialIntensity=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.intensity:0}return e.meshRender.sharedMaterial.intensity},n._setMeshRenderSharedMaterialIntensity=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.intensity=i[0])}else e.meshRender.material.intensity=i[0]},n._getMeshRenderSharedMaterialDetailTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return e.meshRender.sharedMaterial.detailTilingOffset.elements},n._setMeshRenderSharedMaterialDetailTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).detailTilingOffset).elements=i,n.detailTilingOffset=r)}else(r=(n=e.meshRender.material).detailTilingOffset).elements=i,n.detailTilingOffset=r},n._getMeshRenderSharedMaterialDissolveTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return e.meshRender.sharedMaterial.dissolveTilingOffset.elements},n._setMeshRenderSharedMaterialDissolveTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).dissolveTilingOffset).elements=i,n.dissolveTilingOffset=r)}else(r=(n=e.meshRender.material).dissolveTilingOffset).elements=i,n.dissolveTilingOffset=r},n._getMeshRenderSharedMaterialMaskTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return e.meshRender.sharedMaterial.maskTilingOffset.elements},n._setMeshRenderSharedMaterialMaskTilingOffset=function(t,e,i){var n,r;if(t){var a=t.transform._entity;a&&((r=(n=a.owner.meshRender.material).maskTilingOffset).elements=i,n.maskTilingOffset=r)}else(r=(n=e.meshRender.material).maskTilingOffset).elements=i,n.maskTilingOffset=r},n._propertyIDCounter=0,n._propertyIndexDic={},n._propertySetFuncs=[],n._propertyGetFuncs=[],n}(),U=function(){function t(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return E(t,"laya.d3.animation.Keyframe"),t}(),Z=function(){function t(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return E(t,"laya.d3.animation.KeyframeNode"),t}(),w=function(){function t(){this._tempVector30=new we,this._tempVector31=new we,this._tempVector32=new we,this._a=new we,this._b=new we,this._c=new we,this._d=new we}E(t,"laya.d3.core.glitter.SplineCurvePositionVelocity");var e=t.prototype;return e.Init=function(t,e,i,n){t.cloneTo(this._d),e.cloneTo(this._c),we.scale(t,2,this._a),we.scale(i,2,this._tempVector30),we.subtract(this._a,this._tempVector30,this._a),we.add(this._a,e,this._a),we.add(this._a,n,this._a),we.scale(i,3,this._b),we.scale(t,3,this._tempVector30),we.subtract(this._b,this._tempVector30,this._b),we.subtract(this._b,n,this._b),we.scale(e,2,this._tempVector30),we.subtract(this._b,this._tempVector30,this._b)},e.Slerp=function(t,e){we.scale(this._a,t*t*t,this._tempVector30),we.scale(this._b,t*t,this._tempVector31),we.scale(this._c,t,this._tempVector32),we.add(this._tempVector30,this._tempVector31,e),we.add(e,this._tempVector32,e),we.add(e,this._d,e)},t}(),V=function(){function r(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}E(r,"laya.d3.core.Layer");var t=r.prototype;return t._binarySearchIndex=function(){for(var t=0,e=r._collsionTestList.length-1,i=0;t<=e;){i=Math.floor((t+e)/2);var n=r._collsionTestList[i];if(n==this._number)return i;n>this._number?e=i-1:t=i+1}return t},t._addCollider=function(t){0===this._colliders.length&&r._collsionTestList.splice(this._binarySearchIndex(),0,this._number),t._isRigidbody?(this._colliders.unshift(t),this._nonRigidbodyOffset++):this._colliders.push(t)},t._removeCollider=function(t){var e=this._colliders.indexOf(t);e<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(e,1),0===this._colliders.length&&r._collsionTestList.splice(r._collsionTestList.indexOf(this._number),1)},v(0,t,"number",function(){return this._number}),v(0,t,"visible",function(){return this._visible},function(t){this._visible=t,r._visibleLayers=t?r._visibleLayers|this.mask:r._visibleLayers&~this.mask}),v(0,t,"mask",function(){return this._mask}),v(1,r,"visibleLayers",function(){return r._visibleLayers},function(t){r._visibleLayers=t;for(var e=0,i=r._layerList.length;e<i;e++){var n=r._layerList[e];n._visible=0!=(n._mask&r._visibleLayers)}}),r.__init__=function(){r._layerList.length=31;for(var t=0;t<31;t++){var e=new r;(r._layerList[t]=e).visible=0===t?(e.name="Default Layer",!0):(e.name="Layer-"+t,!1),e._number=t,e._mask=Math.pow(2,t)}r.currentCreationLayer=r._layerList[0]},r.getLayerByNumber=function(t){if(t<0||30<t)throw new Error("无法返回指定Layer，该number超出范围！");return r._layerList[t]},r.getLayerByName=function(t){for(var e=0;e<31;e++)if(r._layerList[e].name===t)return r._layerList[e];throw new Error("无法返回指定Layer,该name不存在")},r.isVisible=function(t){return 0!=(t&r._currentCameraCullingMask&r._visibleLayers)},r._layerList=[],r._visibleLayers=2147483647,r._collsionTestList=[],r._currentCameraCullingMask=2147483647,r.maxCount=31,r.currentCreationLayer=null,r}(),wt=function(){function t(t,e,i){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=t,this._minCount=e,this._maxCount=i}E(t,"laya.d3.core.particleShuriKen.module.Burst");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._time=this._time,e._minCount=this._minCount,e._maxCount=this._maxCount},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,e,"time",function(){return this._time}),v(0,e,"minCount",function(){return this._minCount}),v(0,e,"maxCount",function(){return this._maxCount}),t}(),Ct=function(){function t(t){this._color=null,this.enbale=!1,this._color=t}E(t,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var e=t.prototype;return e.cloneTo=function(t){var e=t;this._color.cloneTo(e._color),e.enbale=this.enbale},e.clone=function(){var t;switch(this._color.type){case 0:t=At.createByConstant(this._color.constant.clone());break;case 1:t=At.createByGradient(this._color.gradient.clone());break;case 2:t=At.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:t=At.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},v(0,e,"color",function(){return this._color}),t}(),I=function(){function t(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}E(t,"laya.d3.core.particleShuriKen.module.Emission");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),e._destroy=function(){this._bursts=null,this._destroyed=!0},e.getBurstsCount=function(){return this._bursts.length},e.getBurstByIndex=function(t){return this._bursts[t]},e.addBurst=function(t){var e=this._bursts.length;if(0<e)for(var i=0;i<e;i++)this._bursts[i].time>t.time&&this._bursts.splice(i,0,t);this._bursts.push(t)},e.removeBurst=function(t){var e=this._bursts.indexOf(t);-1!==e&&this._bursts.splice(e,1)},e.removeBurstByIndex=function(t){this._bursts.splice(t,1)},e.clearBurst=function(){this._bursts.length=0},e.cloneTo=function(t){var e=t,i=e._bursts;i.length=this._bursts.length;for(var n=0,r=this._bursts.length;n<r;n++){var a=i[n];a?this._bursts[n].cloneTo(a):i[n]=this._bursts[n].clone()}e._emissionRate=this._emissionRate,e.enbale=this.enbale},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,e,"destroyed",function(){return this._destroyed}),v(0,e,"emissionRate",function(){return this._emissionRate},function(t){if(t<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=t}),t}(),It=function(){function n(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}E(n,"laya.d3.core.particleShuriKen.module.FrameOverTime");var t=n.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,this._overTime.cloneTo(e._overTime),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._overTimeMin.cloneTo(e._overTimeMin),this._overTimeMax.cloneTo(e._overTimeMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,t,"frameOverTimeData",function(){return this._overTime}),v(0,t,"constant",function(){return this._constant}),v(0,t,"type",function(){return this._type}),v(0,t,"frameOverTimeDataMin",function(){return this._overTimeMin}),v(0,t,"constantMin",function(){return this._constantMin}),v(0,t,"frameOverTimeDataMax",function(){return this._overTimeMax}),v(0,t,"constantMax",function(){return this._constantMax}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByOverTime=function(t){var e=new n;return e._type=1,e._overTime=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=2,i._constantMin=t,i._constantMax=e,i},n.createByRandomTwoOverTime=function(t,e){var i=new n;return i._type=3,i._overTimeMin=t,i._overTimeMax=e,i},n}(),Mt=function(){function h(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}E(h,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var t=h.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,e._constant=this._constant,this._constantSeparate.cloneTo(e._constantSeparate),this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,t,"gradientZ",function(){return this._gradientZ}),v(0,t,"constant",function(){return this._constant}),v(0,t,"gradient",function(){return this._gradient}),v(0,t,"separateAxes",function(){return this._separateAxes}),v(0,t,"type",function(){return this._type}),v(0,t,"constantSeparate",function(){return this._constantSeparate}),v(0,t,"gradientX",function(){return this._gradientX}),v(0,t,"gradientY",function(){return this._gradientY}),v(0,t,"gradientW",function(){return this._gradientW}),v(0,t,"gradientMin",function(){return this._gradientMin}),v(0,t,"constantMin",function(){return this._constantMin}),v(0,t,"gradientMax",function(){return this._gradientMax}),v(0,t,"constantMax",function(){return this._constantMax}),v(0,t,"gradientWMin",function(){return this._gradientWMin}),v(0,t,"constantMinSeparate",function(){return this._constantMinSeparate}),v(0,t,"constantMaxSeparate",function(){return this._constantMaxSeparate}),v(0,t,"gradientXMin",function(){return this._gradientXMin}),v(0,t,"gradientXMax",function(){return this._gradientXMax}),v(0,t,"gradientWMax",function(){return this._gradientWMax}),v(0,t,"gradientYMin",function(){return this._gradientYMin}),v(0,t,"gradientYMax",function(){return this._gradientYMax}),v(0,t,"gradientZMin",function(){return this._gradientZMin}),v(0,t,"gradientZMax",function(){return this._gradientZMax}),h.createByConstant=function(t){var e=new h;return e._type=0,e._separateAxes=!1,e._constant=t,e},h.createByConstantSeparate=function(t){var e=new h;return e._type=0,e._separateAxes=!0,e._constantSeparate=t,e},h.createByGradient=function(t){var e=new h;return e._type=1,e._separateAxes=!1,e._gradient=t,e},h.createByGradientSeparate=function(t,e,i,n){var r=new h;return r._type=1,r._separateAxes=!0,r._gradientX=t,r._gradientY=e,r._gradientZ=i,r._gradientW=n,r},h.createByRandomTwoConstant=function(t,e){var i=new h;return i._type=2,i._separateAxes=!1,i._constantMin=t,i._constantMax=e,i},h.createByRandomTwoConstantSeparate=function(t,e){var i=new h;return i._type=2,i._separateAxes=!0,i._constantMinSeparate=t,i._constantMaxSeparate=e,i},h.createByRandomTwoGradient=function(t,e){var i=new h;return i._type=3,i._separateAxes=!1,i._gradientMin=t,i._gradientMax=e,i},h.createByRandomTwoGradientSeparate=function(t,e,i,n,r,a,s,o){var l=new h;return l._type=3,l._separateAxes=!0,l._gradientXMin=t,l._gradientXMax=e,l._gradientYMin=i,l._gradientYMax=n,l._gradientZMin=r,l._gradientZMax=a,l._gradientWMin=s,l._gradientWMax=o,l},h}(),At=function(){function n(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}E(n,"laya.d3.core.particleShuriKen.module.GradientColor");var t=n.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradient.cloneTo(e._gradient),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,t,"gradient",function(){return this._gradient}),v(0,t,"constant",function(){return this._constant}),v(0,t,"type",function(){return this._type}),v(0,t,"gradientMin",function(){return this._gradientMin}),v(0,t,"constantMin",function(){return this._constantMin}),v(0,t,"gradientMax",function(){return this._gradientMax}),v(0,t,"constantMax",function(){return this._constantMax}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByGradient=function(t){var e=new n;return e._type=1,e._gradient=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=2,i._constantMin=t,i._constantMax=e,i},n.createByRandomTwoGradient=function(t,e){var i=new n;return i._type=3,i._gradientMin=t,i._gradientMax=e,i},n}(),N=function(){function t(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}E(t,"laya.d3.core.particleShuriKen.module.GradientDataColor");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.addAlpha=function(t,e){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==t&&(t=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._alphaElements[this._alphaCurrentLength++]=t,this._alphaElements[this._alphaCurrentLength++]=e):console.log("GradientDataColor warning:data count must lessEqual than 4")},e.addRGB=function(t,e){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==t&&(t=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),this._rgbElements[this._rgbCurrentLength++]=t,this._rgbElements[this._rgbCurrentLength++]=e.x,this._rgbElements[this._rgbCurrentLength++]=e.y,this._rgbElements[this._rgbCurrentLength++]=e.z):console.log("GradientDataColor warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t,i=0,n=0;e._alphaCurrentLength=this._alphaCurrentLength;var r=e._alphaElements;for(r.length=this._alphaElements.length,i=0,n=this._alphaElements.length;i<n;i++)r[i]=this._alphaElements[i];e._rgbCurrentLength=this._rgbCurrentLength;var a=e._rgbElements;for(a.length=this._rgbElements.length,i=0,n=this._rgbElements.length;i<n;i++)a[i]=this._rgbElements[i]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,e,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),v(0,e,"rgbGradientCount",function(){return this._rgbCurrentLength/4}),t}(),P=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}E(t,"laya.d3.core.particleShuriKen.module.GradientDataInt");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("Warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),F=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}E(t,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("GradientDataNumber warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("GradientDataNumber warning:data count must lessEqual than 4")},e.getKeyByIndex=function(t){return this._elements[2*t]},e.getValueByIndex=function(t){return this._elements[2*t+1]},e.getAverageValue=function(){for(var t=0,e=this._currentLength-2;t<e;t+=2){this._elements[t+1];this._elements[t+3],this._elements[t+2]-this._elements[t]}return 0},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),Dt=function(){function o(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}E(o,"laya.d3.core.particleShuriKen.module.GradientSize");var t=o.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.getMaxSizeInGradient=function(){var t=0,e=0,i=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(t=0,e=this._gradientX.gradientCount;t<e;t++)i=Math.max(i,this._gradientX.getValueByIndex(t));for(t=0,e=this._gradientY.gradientCount;t<e;t++)i=Math.max(i,this._gradientY.getValueByIndex(t))}else for(t=0,e=this._gradient.gradientCount;t<e;t++)i=Math.max(i,this._gradient.getValueByIndex(t));break;case 1:i=this._separateAxes?(i=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),i=Math.max(i,this._constantMinSeparate.y),Math.max(i,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(t=0,e=this._gradientXMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMin.getValueByIndex(t));for(t=0,e=this._gradientXMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMax.getValueByIndex(t));for(t=0,e=this._gradientYMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientYMin.getValueByIndex(t));for(t=0,e=this._gradientZMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientZMax.getValueByIndex(t))}else{for(t=0,e=this._gradientMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientMin.getValueByIndex(t));for(t=0,e=this._gradientMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientMax.getValueByIndex(t))}}return i},t.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,t,"gradientZ",function(){return this._gradientZ}),v(0,t,"gradient",function(){return this._gradient}),v(0,t,"separateAxes",function(){return this._separateAxes}),v(0,t,"type",function(){return this._type}),v(0,t,"gradientMin",function(){return this._gradientMin}),v(0,t,"constantMin",function(){return this._constantMin}),v(0,t,"gradientX",function(){return this._gradientX}),v(0,t,"gradientY",function(){return this._gradientY}),v(0,t,"gradientMax",function(){return this._gradientMax}),v(0,t,"constantMax",function(){return this._constantMax}),v(0,t,"constantMinSeparate",function(){return this._constantMinSeparate}),v(0,t,"constantMaxSeparate",function(){return this._constantMaxSeparate}),v(0,t,"gradientXMin",function(){return this._gradientXMin}),v(0,t,"gradientXMax",function(){return this._gradientXMax}),v(0,t,"gradientYMin",function(){return this._gradientYMin}),v(0,t,"gradientYMax",function(){return this._gradientYMax}),v(0,t,"gradientZMin",function(){return this._gradientZMin}),v(0,t,"gradientZMax",function(){return this._gradientZMax}),o.createByGradient=function(t){var e=new o;return e._type=0,e._separateAxes=!1,e._gradient=t,e},o.createByGradientSeparate=function(t,e,i){var n=new o;return n._type=0,n._separateAxes=!0,n._gradientX=t,n._gradientY=e,n._gradientZ=i,n},o.createByRandomTwoConstant=function(t,e){var i=new o;return i._type=1,i._separateAxes=!1,i._constantMin=t,i._constantMax=e,i},o.createByRandomTwoConstantSeparate=function(t,e){var i=new o;return i._type=1,i._separateAxes=!0,i._constantMinSeparate=t,i._constantMaxSeparate=e,i},o.createByRandomTwoGradient=function(t,e){var i=new o;return i._type=2,i._separateAxes=!1,i._gradientMin=t,i._gradientMax=e,i},o.createByRandomTwoGradientSeparate=function(t,e,i,n,r,a){var s=new o;return s._type=2,s._separateAxes=!0,s._gradientXMin=t,s._gradientXMax=e,s._gradientYMin=i,s._gradientYMax=n,s._gradientZMin=r,s._gradientZMax=a,s},o}(),Lt=function(){function o(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}E(o,"laya.d3.core.particleShuriKen.module.GradientVelocity");var t=o.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,t,"gradientZ",function(){return this._gradientZ}),v(0,t,"constant",function(){return this._constant}),v(0,t,"type",function(){return this._type}),v(0,t,"gradientXMax",function(){return this._gradientXMax}),v(0,t,"constantMin",function(){return this._constantMin}),v(0,t,"gradientX",function(){return this._gradientX}),v(0,t,"gradientY",function(){return this._gradientY}),v(0,t,"gradientXMin",function(){return this._gradientXMin}),v(0,t,"constantMax",function(){return this._constantMax}),v(0,t,"gradientYMin",function(){return this._gradientYMin}),v(0,t,"gradientYMax",function(){return this._gradientYMax}),v(0,t,"gradientZMin",function(){return this._gradientZMin}),v(0,t,"gradientZMax",function(){return this._gradientZMax}),o.createByConstant=function(t){var e=new o;return e._type=0,e._constant=t,e},o.createByGradient=function(t,e,i){var n=new o;return n._type=1,n._gradientX=t,n._gradientY=e,n._gradientZ=i,n},o.createByRandomTwoConstant=function(t,e){var i=new o;return i._type=2,i._constantMin=t,i._constantMax=e,i},o.createByRandomTwoGradient=function(t,e,i,n,r,a){var s=new o;return s._type=3,s._gradientXMin=t,s._gradientXMax=e,s._gradientYMin=i,s._gradientYMax=n,s._gradientZMin=r,s._gradientZMax=a,s},o}(),Vt=function(){function t(t){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=t}E(t,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._angularVelocity.cloneTo(e._angularVelocity),e.enbale=this.enbale},e.clone=function(){var t;switch(this._angularVelocity.type){case 0:t=this._angularVelocity.separateAxes?Mt.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):Mt.createByConstant(this._angularVelocity.constant);break;case 1:t=this._angularVelocity.separateAxes?Mt.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):Mt.createByGradient(this._angularVelocity.gradient.clone());break;case 2:t=this._angularVelocity.separateAxes?Mt.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):Mt.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:t=this._angularVelocity.separateAxes?Mt.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):Mt.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},v(0,e,"angularVelocity",function(){return this._angularVelocity}),t}(),O=function(){function t(){this.enable=!1,this.randomDirection=!1}E(t,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e._getShapeBoundBox=function(t){throw new Error("BaseShape: must override it.")},e._getSpeedBoundBox=function(t){throw new Error("BaseShape: must override it.")},e.generatePositionAndDirection=function(t,e,i,n){throw new Error("BaseShape: must override it.")},e._calculateProceduralBounds=function(t,e,i){this._getShapeBoundBox(t);var n=t.min,r=t.max;we.multiply(n,e,n),we.multiply(r,e,r);var a=new _e(new we,new we);this.randomDirection?(a.min=new we(-1,-1,-1),a.max=new we(1,1,1)):this._getSpeedBoundBox(a);var s=new _e(new we,new we),o=s.min,l=s.max;we.scale(a.min,i.y,o),we.scale(a.max,i.y,l),we.add(t.min,o,o),we.add(t.max,l,l),we.min(t.min,o,t.min),we.max(t.max,o,t.max);var h=new _e(new we,new we),u=h.min,c=h.max;we.scale(a.min,i.x,u),we.scale(a.max,i.x,c),we.min(h.min,c,o),we.max(h.min,c,l),we.min(t.min,o,t.min),we.max(t.max,o,t.max)},e.cloneTo=function(t){t.enable=this.enable},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}(),B=function(){function a(){}return E(a,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),a._randomPointUnitArcCircle=function(t,e,i){var n=e.elements,r=NaN;r=i?i.getFloat()*t:Math.random()*t,n[0]=Math.cos(r),n[1]=Math.sin(r)},a._randomPointInsideUnitArcCircle=function(t,e,i){var n=e.elements;a._randomPointUnitArcCircle(t,e,i);var r=NaN;r=i?Math.pow(i.getFloat(),.5):Math.pow(Math.random(),.5),n[0]=n[0]*r,n[1]=n[1]*r},a._randomPointUnitCircle=function(t,e){var i=t.elements,n=NaN;n=e?e.getFloat()*Math.PI*2:Math.random()*Math.PI*2,i[0]=Math.cos(n),i[1]=Math.sin(n)},a._randomPointInsideUnitCircle=function(t,e){var i=t.elements;a._randomPointUnitCircle(t);var n=NaN;n=e?Math.pow(e.getFloat(),.5):Math.pow(Math.random(),.5),i[0]=i[0]*n,i[1]=i[1]*n},a._randomPointUnitSphere=function(t,e){var i=t.elements,n=NaN,r=NaN;r=e?(n=i[2]=2*e.getFloat()-1,e.getFloat()*Math.PI*2):(n=i[2]=2*Math.random()-1,Math.random()*Math.PI*2);var a=Math.sqrt(1-n*n);i[0]=a*Math.cos(r),i[1]=a*Math.sin(r)},a._randomPointInsideUnitSphere=function(t,e){var i=t.elements;a._randomPointUnitSphere(t);var n=NaN;n=e?Math.pow(e.getFloat(),1/3):Math.pow(Math.random(),1/3),i[0]=i[0]*n,i[1]=i[1]*n,i[2]=i[2]*n},a._randomPointInsideHalfUnitBox=function(t,e){var i=t.elements;i[2]=e?(i[0]=e.getFloat()-.5,i[1]=e.getFloat()-.5,e.getFloat()-.5):(i[0]=Math.random()-.5,i[1]=Math.random()-.5,Math.random()-.5)},a}(),Nt=function(){function t(t){this._size=null,this.enbale=!1,this._size=t}E(t,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._size.cloneTo(e._size),e.enbale=this.enbale},e.clone=function(){var t;switch(this._size.type){case 0:t=this._size.separateAxes?Dt.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):Dt.createByGradient(this._size.gradient.clone());break;case 1:t=this._size.separateAxes?Dt.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):Dt.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:t=this._size.separateAxes?Dt.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):Dt.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},v(0,e,"size",function(){return this._size}),t}(),Pt=function(){function n(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}E(n,"laya.d3.core.particleShuriKen.module.StartFrame");var t=n.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,e._constantMin=this._constantMin,e._constantMax=this._constantMax},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,t,"constant",function(){return this._constant}),v(0,t,"type",function(){return this._type}),v(0,t,"constantMin",function(){return this._constantMin}),v(0,t,"constantMax",function(){return this._constantMax}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=1,i._constantMin=t,i._constantMax=e,i},n}(),Ft=function(){function t(t,e){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new Re(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=t,this._startFrame=e}E(t,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this.tiles.cloneTo(e.tiles),e.type=this.type,e.randomRow=this.randomRow,this._frame.cloneTo(e._frame),this._startFrame.cloneTo(e._startFrame),e.cycles=this.cycles,e.enableUVChannels=this.enableUVChannels,e.enable=this.enable},e.clone=function(){var t,e;switch(this._frame.type){case 0:t=It.createByConstant(this._frame.constant);break;case 1:t=It.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:t=It.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:t=It.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:e=Pt.createByConstant(this._startFrame.constant);break;case 1:e=Pt.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var i=new this.constructor(t,e);return this.tiles.cloneTo(i.tiles),i.type=this.type,i.randomRow=this.randomRow,i.cycles=this.cycles,i.enableUVChannels=this.enableUVChannels,i.enable=this.enable,i},v(0,e,"frame",function(){return this._frame}),v(0,e,"startFrame",function(){return this._startFrame}),t}(),Ot=function(){function t(t){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=t}E(t,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._velocity.cloneTo(e._velocity),e.enbale=this.enbale,e.space=this.space},e.clone=function(){var t;switch(this._velocity.type){case 0:t=Lt.createByConstant(this._velocity.constant.clone());break;case 1:t=Lt.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:t=Lt.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:t=Lt.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e.space=this.space,e},v(0,e,"velocity",function(){return this._velocity}),t}(),H=function(){function G(){}return E(G,"laya.d3.core.particleShuriKen.ShurikenParticleData"),G._getStartLifetimeFromGradient=function(t,e){for(var i=1,n=t.gradientCount;i<n;i++){var r=t.getKeyByIndex(i);if(e<=r){var a=t.getKeyByIndex(i-1),s=(e-a)/(r-a);return $i.lerp(t.getValueByIndex(i-1),t.getValueByIndex(i),s)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")},G._randomInvertRoationArray=function(t,e,i,n,r){var a=NaN;n?(n.seed=r[6],a=n.getFloat(),r[6]=n.seed):a=Math.random(),e[2]=a<i?(e[0]=-t[0],e[1]=-t[1],-t[2]):(e[0]=t[0],e[1]=t[1],t[2])},G._randomInvertRoation=function(t,e,i,n){var r=NaN;return i?(i.seed=n[6],r=i.getFloat(),n[6]=i.seed):r=Math.random(),r<e&&(t=-t),t},G.create=function(t,e,i){var n=t.autoRandomSeed,r=t._rand,a=t._randomSeeds;switch(t.startColorType){case 0:var s=t.startColorConstant.elements;G.startColor[0]=s[0],G.startColor[1]=s[1],G.startColor[2]=s[2],G.startColor[3]=s[3];break;case 2:n?$i.lerpVector4(t.startColorConstantMin.elements,t.startColorConstantMax.elements,Math.random(),G.startColor):(r.seed=a[3],$i.lerpVector4(t.startColorConstantMin.elements,t.startColorConstantMax.elements,r.getFloat(),G.startColor),a[3]=r.seed)}var o=t.colorOverLifetime;if(o&&o.enbale){var l=o.color;switch(l.type){case 0:G.startColor[0]=G.startColor[0]*l.constant.x,G.startColor[1]=G.startColor[1]*l.constant.y,G.startColor[2]=G.startColor[2]*l.constant.z,G.startColor[3]=G.startColor[3]*l.constant.w;break;case 2:var h=NaN;n?h=Math.random():(r.seed=a[10],h=r.getFloat(),a[10]=r.seed);var u=l.constantMin,c=l.constantMax;G.startColor[0]=G.startColor[0]*$i.lerp(u.x,c.x,h),G.startColor[1]=G.startColor[1]*$i.lerp(u.y,c.y,h),G.startColor[2]=G.startColor[2]*$i.lerp(u.z,c.z,h),G.startColor[3]=G.startColor[3]*$i.lerp(u.w,c.w,h)}}var d=G.startSize;switch(t.startSizeType){case 0:if(t.threeDStartSize){var _=t.startSizeConstantSeparate;d[0]=_.x,d[1]=_.y,d[2]=_.z}else d[0]=d[1]=d[2]=t.startSizeConstant;break;case 2:if(t.threeDStartSize){var f=t.startSizeConstantMinSeparate,m=t.startSizeConstantMaxSeparate;n?(d[0]=$i.lerp(f.x,m.x,Math.random()),d[1]=$i.lerp(f.y,m.y,Math.random()),d[2]=$i.lerp(f.z,m.z,Math.random())):(r.seed=a[4],d[0]=$i.lerp(f.x,m.x,r.getFloat()),d[1]=$i.lerp(f.y,m.y,r.getFloat()),d[2]=$i.lerp(f.z,m.z,r.getFloat()),a[4]=r.seed)}else n?d[0]=d[1]=d[2]=$i.lerp(t.startSizeConstantMin,t.startSizeConstantMax,Math.random()):(r.seed=a[4],d[0]=d[1]=d[2]=$i.lerp(t.startSizeConstantMin,t.startSizeConstantMax,r.getFloat()),a[4]=r.seed)}var p=t.sizeOverLifetime;if(p&&p.enbale&&1===p.size.type){var g=p.size;if(g.separateAxes)n?(d[0]=d[0]*$i.lerp(g.constantMinSeparate.x,g.constantMaxSeparate.x,Math.random()),d[1]=d[1]*$i.lerp(g.constantMinSeparate.y,g.constantMaxSeparate.y,Math.random()),d[2]=d[2]*$i.lerp(g.constantMinSeparate.z,g.constantMaxSeparate.z,Math.random())):(r.seed=a[11],d[0]=d[0]*$i.lerp(g.constantMinSeparate.x,g.constantMaxSeparate.x,r.getFloat()),d[1]=d[1]*$i.lerp(g.constantMinSeparate.y,g.constantMaxSeparate.y,r.getFloat()),d[2]=d[2]*$i.lerp(g.constantMinSeparate.z,g.constantMaxSeparate.z,r.getFloat()),a[11]=r.seed);else{var v=NaN;n?v=$i.lerp(g.constantMin,g.constantMax,Math.random()):(r.seed=a[11],v=$i.lerp(g.constantMin,g.constantMax,r.getFloat()),a[11]=r.seed),d[0]=d[0]*v,d[1]=d[1]*v,d[2]=d[2]*v}}var y=e.renderMode;if(1!==y)switch(t.startRotationType){case 0:if(t.threeDStartRotation){var x=t.startRotationConstantSeparate,b=G._tempVector30.elements;G._randomInvertRoationArray(x.elements,b,t.randomizeRotationDirection,n?null:r,a),G.startRotation[0]=b[0],G.startRotation[1]=b[1],G.startRotation[2]=4!==y?-b[2]:b[2]}else G.startRotation[0]=G._randomInvertRoation(t.startRotationConstant,t.randomizeRotationDirection,n?null:r,a);break;case 2:if(t.threeDStartRotation){var T=t.startRotationConstantMinSeparate,S=t.startRotationConstantMaxSeparate,E=G._tempVector30.elements;n?(E[0]=$i.lerp(T.x,S.x,Math.random()),E[1]=$i.lerp(T.y,S.y,Math.random()),E[2]=$i.lerp(T.z,S.z,Math.random())):(r.seed=a[5],E[0]=$i.lerp(T.x,S.x,r.getFloat()),E[1]=$i.lerp(T.y,S.y,r.getFloat()),E[2]=$i.lerp(T.z,S.z,r.getFloat()),a[5]=r.seed),G._randomInvertRoationArray(E,E,t.randomizeRotationDirection,n?null:r,a),G.startRotation[0]=E[0],G.startRotation[1]=E[1],G.startRotation[2]=4!==y?-E[2]:E[2]}else n?G.startRotation[0]=G._randomInvertRoation($i.lerp(t.startRotationConstantMin,t.startRotationConstantMax,Math.random()),t.randomizeRotationDirection,n?null:r,a):(r.seed=a[5],G.startRotation[0]=G._randomInvertRoation($i.lerp(t.startRotationConstantMin,t.startRotationConstantMax,r.getFloat()),t.randomizeRotationDirection,n?null:r,a),a[5]=r.seed)}switch(t.startLifetimeType){case 0:G.startLifeTime=t.startLifetimeConstant;break;case 1:G.startLifeTime=G._getStartLifetimeFromGradient(t.startLifeTimeGradient,t.emissionTime);break;case 2:n?G.startLifeTime=$i.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,Math.random()):(r.seed=a[7],G.startLifeTime=$i.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,r.getFloat()),a[7]=r.seed);break;case 3:var R=t.emissionTime;n?G.startLifeTime=$i.lerp(G._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,R),G._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,R),Math.random()):(r.seed=a[7],G.startLifeTime=$i.lerp(G._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,R),G._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,R),r.getFloat()),a[7]=r.seed)}switch(t.startSpeedType){case 0:G.startSpeed=t.startSpeedConstant;break;case 2:n?G.startSpeed=$i.lerp(t.startSpeedConstantMin,t.startSpeedConstantMax,Math.random()):(r.seed=a[8],G.startSpeed=$i.lerp(t.startSpeedConstantMin,t.startSpeedConstantMax,r.getFloat()),a[8]=r.seed)}var w=t.textureSheetAnimation;if(w&&w.enable){var C=w.tiles,I=C.x,M=C.y,A=1/I,D=1/M,L=0,V=w.startFrame;switch(V.type){case 0:L=V.constant;break;case 1:n?L=$i.lerp(V.constantMin,V.constantMax,Math.random()):(r.seed=a[14],L=$i.lerp(V.constantMin,V.constantMax,r.getFloat()),a[14]=r.seed)}var N=w.frame;switch(N.type){case 0:L+=N.constant;break;case 2:n?L+=$i.lerp(N.constantMin,N.constantMax,Math.random()):(r.seed=a[15],L+=$i.lerp(N.constantMin,N.constantMax,r.getFloat()),a[15]=r.seed)}var P=0;switch(w.type){case 0:P=Math.floor(L/I);break;case 1:w.randomRow?n?P=Math.floor(Math.random()*M):(r.seed=a[13],P=Math.floor(r.getFloat()*M),a[13]=r.seed):P=w.rowIndex}var F=Math.floor(L%I);(G.startUVInfo=G.startUVInfo)[0]=A,G.startUVInfo[1]=D,G.startUVInfo[2]=F*A,G.startUVInfo[3]=P*D}else(G.startUVInfo=G.startUVInfo)[0]=1,G.startUVInfo[1]=1,G.startUVInfo[2]=0,G.startUVInfo[3]=0;switch(t.simulationSpace){case 0:var O=i.position.elements;G.simulationWorldPostion[0]=O[0],G.simulationWorldPostion[1]=O[1],G.simulationWorldPostion[2]=O[2];var B=i.rotation.elements;G.simulationWorldRotation[0]=B[0],G.simulationWorldRotation[1]=B[1],G.simulationWorldRotation[2]=B[2],G.simulationWorldRotation[3]=B[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}},G.startLifeTime=NaN,G.startSpeed=NaN,m(G,["_tempVector30",function(){return this._tempVector30=new we},"_tempQuaternion",function(){return this._tempQuaternion=new Te},"startColor",function(){return this.startColor=new Float32Array(4)},"startSize",function(){return this.startSize=new Float32Array(3)},"startRotation",function(){return this.startRotation=new Float32Array(3)},"startUVInfo",function(){return this.startUVInfo=new Float32Array(4)},"simulationWorldPostion",function(){return this.simulationWorldPostion=new Float32Array(3)},"simulationWorldRotation",function(){return this.simulationWorldRotation=new Float32Array(4)}]),G}(),k=function(){function t(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new Ve,this._vb=ws.create(t._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=Rs.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=Us.nameKey.getID("LINE"),this._shaderCompile=Xr._preCompileShader[this._sharderNameID]}E(t,"laya.d3.core.PhasorSpriter3D");var e=t.prototype;return e.line=function(t,e,i,n){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t.x,t.y,t.z,e.x,e.y,e.z,e.w),this.addVertex(i.x,i.y,i.z,n.x,n.y,n.z,n.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},e.circle=function(t,e,i,n,r,a){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*e,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/e,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*t,Math.cos(this._tempNumver0)*t,0,i,n,r,a),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},e.plane=function(t,e,i,n,r,a,s,o,l){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i,a,s,o,l),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i,a,s,o,l),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i,a,s,o,l),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i,a,s,o,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},e.box=function(t,e,i,n,r,a,s,o,l,h){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempNumver2=a/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,s,o,l,h),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,s,o,l,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},e.cone=function(t,e,i,n,r,a,s){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*i+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*i>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/i,this.addVertexIndex(0,e,0,n,r,a,s,this._tempUint0),this.addVertexIndex(0,0,0,n,r,a,s,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<i;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,a,s,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==i-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,a,s,this._tempUint0+(this._tempInt0+i)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==i-1?this.addIndexes(this._tempUint1+i+2):this.addIndexes(this._tempUint1+this._tempInt0+i+1),this.addIndexes(this._tempUint1+this._tempInt0+i),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},e.boundingBoxLine=function(t,e,i,n,r,a,s,o,l,h){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t,r,a,s,o,l,h),this.addVertex(n,r,a,s,o,l,h),this.addVertex(t,e,a,s,o,l,h),this.addVertex(n,e,a,s,o,l,h),this.addVertex(n,r,i,s,o,l,h),this.addVertex(t,r,i,s,o,l,h),this.addVertex(n,e,i,s,o,l,h),this.addVertex(t,e,i,s,o,l,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},e.addVertex=function(t,e,i,n,r,a,s){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=t,this._vbData[this._posInVBData+1]=e,this._vbData[this._posInVBData+2]=i,this._vbData[this._posInVBData+3]=n,this._vbData[this._posInVBData+4]=r,this._vbData[this._posInVBData+5]=a,this._vbData[this._posInVBData+6]=s,this._posInVBData+=this._floatSizePerVer,this},e.addVertexIndex=function(t,e,i,n,r,a,s,o){return this._hasBegun||this.addVertexIndexException(),this._vbData[o]=t,this._vbData[o+1]=e,this._vbData[o+2]=i,this._vbData[o+3]=n,this._vbData[o+4]=r,this._vbData[o+5]=a,this._vbData[o+6]=s,(o+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=o),this},e.addIndexes=function(t){var e=arguments;this._hasBegun||this.addVertexIndexException();for(var i=0;i<e.length;i++)this._ibData[this._posInIBData]=e[i],this._posInIBData++;return this},e.begin=function(t,e){return this._hasBegun&&this.beginException0(),1!==t&&4!==t&&this.beginException1(),this._primitiveType=t,this._camera=e,this._hasBegun=!0,this},e.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},e.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(t._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),Cn.drawCall++,mr.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},e.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},e.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},e.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},e.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},e.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},e.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(28,[new lt(0,"vector3",0),new lt(12,"vector4",1)])}]),t}(),X=function(){function t(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++t._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new Ve}E(t,"laya.d3.core.render.RenderElement");var e=t.prototype;return e.getDynamicBatchBakedVertexs=function(t){for(var e=this._renderObj._getVertexBuffer(t),i=e.getData().slice(),n=e.vertexDeclaration,r=n.getVertexElementByUsage(0).offset/4,a=n.getVertexElementByUsage(3).offset/4,s=this._sprite3D.transform,o=s.worldMatrix,l=s.rotation,h=n.vertexStride/4,u=0,c=i.length;u<c;u+=h){var d=u+r,_=u+a;ke.transformVector3ArrayToVector3ArrayCoordinate(i,d,o,i,d),ke.transformVector3ArrayByQuat(i,_,l,i,_)}return i},e.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},e._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},v(0,e,"id",function(){return this._id}),v(0,e,"renderObj",function(){return this._renderObj},function(t){this._renderObj!==t&&(this._renderObj=t)}),t._uniqueIDCounter=0,t}(),Y=function(){function e(t){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++e._uniqueIDCounter,this._needSort=!1,this._scene=t,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[]}E(e,"laya.d3.core.render.RenderQueue");var t=e.prototype;return t._sortOpaqueFunc=function(t,e){if(t._render&&e._render){var i=t._material.renderQueue-e._material.renderQueue;return 0===i?t._render._distanceForSort-e._render._distanceForSort:i}return 0},t._sortAlphaFunc=function(t,e){if(t._render&&e._render){var i=t._material.renderQueue-e._material.renderQueue;return 0===i?e._render._distanceForSort-t._render._distanceForSort:i}return 0},t._begainRenderElement=function(t,e,i){return!!e._beforeRender(t)},t._sortAlpha=function(t){e._cameraPosition=t,this._finalElements.sort(this._sortAlphaFunc)},t._sortOpaque=function(t){e._cameraPosition=t,this._finalElements.sort(this._sortOpaqueFunc)},t._preRender=function(t){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},t._render=function(t,e){for(var i,n,r,a,s,o,l=Cn.loopCount,h=this._scene,u=t.camera,c=(u.id,!1),d=0,_=this._finalElements.length;d<_;d++){var f,m,p,g=this._finalElements[d];if(null!=g._onPreRenderFunction&&g._onPreRenderFunction.call(g._sprite3D,t),0===g._type){if(t.owner=p=g._sprite3D,t.renderElement=g,p._preRenderUpdateComponents(t),f=g.renderObj,m=g._material,this._begainRenderElement(t,f,m)){if(i=f._getVertexBuffers(),r=(n=f._getVertexBuffer(0)).vertexDeclaration,c=(a=t._shader=m._getShader(h._shaderDefineValue,r.shaderDefineValue,p._shaderDefineValue)).bind()||l!==a._uploadLoopCount,i){if(a._uploadVertexBuffer!==i||c){for(var v=0;v<i.length;v++){var y=i[v];a.uploadAttributesX(y.vertexDeclaration.shaderValues.data,y)}a._uploadVertexBuffer=i}}else(a._uploadVertexBuffer!==n||c)&&(a.uploadAttributes(r.shaderValues.data,null),a._uploadVertexBuffer=n);(a._uploadScene!==h||c)&&(a.uploadSceneUniforms(h._shaderValues.data),a._uploadScene=h),(u!==a._uploadCamera||a._uploadSprite3D!==p||c)&&(a.uploadSpriteUniforms(p._shaderValues.data),a._uploadSprite3D=p),(u!==a._uploadCamera||c)&&(a.uploadCameraUniforms(u._shaderValues.data),a._uploadCamera=u),(a._uploadMaterial!==m||c)&&(m._upload(),a._uploadMaterial=m),s!==m?(m._setRenderStateBlendDepth(),m._setRenderStateFrontFace(e,p.transform),s=m,o=p):o!==p&&(m._setRenderStateFrontFace(e,p.transform),o=p),f._render(t),a._uploadLoopCount=l}p._postRenderUpdateComponents(t)}else if(2===g._type){g.renderObj;t.owner=p=g._sprite3D,t.renderElement=g,t._batchIndexStart=g._tempBatchIndexStart,t._batchIndexEnd=g._tempBatchIndexEnd,f=g.renderObj,m=g._material,this._begainRenderElement(t,f,m)&&(r=(n=f._getVertexBuffer(0)).vertexDeclaration,c=(a=t._shader=m._getShader(h._shaderDefineValue,r.shaderDefineValue,p._shaderDefineValue)).bind()||l!==a._uploadLoopCount,(a._uploadVertexBuffer!==n||c)&&(a.uploadAttributes(r.shaderValues.data,null),a._uploadVertexBuffer=n),(a._uploadScene!==h||c)&&(a.uploadSceneUniforms(h._shaderValues.data),a._uploadScene=h),(u!==a._uploadCamera||a._uploadSprite3D!==p||c)&&(a.uploadSpriteUniforms(p._shaderValues.data),a._uploadSprite3D=p),(u!==a._uploadCamera||c)&&(a.uploadCameraUniforms(u._shaderValues.data),a._uploadCamera=u),(a._uploadMaterial!==m||c)&&(m._upload(),a._uploadMaterial=m),s!==m?(m._setRenderStateBlendDepth(),m._setRenderStateFrontFace(e,p.transform),s=m,o=p):o!==p&&(m._setRenderStateFrontFace(e,p.transform),o=p),f._render(t),a._uploadLoopCount=l)}}},t._renderShadow=function(t,e){for(var i,n,r,a,s,o=Cn.loopCount,l=this._scene,h=t.camera,u=!1,c=0,d=this._finalElements.length;c<d;c++){var _,f,m,p=this._finalElements[c];0===p._type&&(t.owner=m=p._sprite3D,e||m._projectionViewWorldUpdateCamera===h&&m._projectionViewWorldUpdateLoopCount===Cn.loopCount||(m._render._renderUpdate(t._projectionViewMatrix),m._projectionViewWorldUpdateLoopCount=Cn.loopCount,m._projectionViewWorldUpdateCamera=h),t.renderElement=p,m._preRenderUpdateComponents(t),_=p.renderObj,f=p._material,this._begainRenderElement(t,_,null)&&(n=(i=_._getVertexBuffer(0)).vertexDeclaration,u=(r=t._shader=f._getShader(l._shaderDefineValue,n.shaderDefineValue,m._shaderDefineValue)).bind()||o!==r._uploadLoopCount,(r._uploadVertexBuffer!==i||u)&&(r.uploadAttributes(n.shaderValues.data,null),r._uploadVertexBuffer=i),(h!==r._uploadCamera||r._uploadSprite3D!==m||u)&&(r.uploadSpriteUniforms(m._shaderValues.data),r._uploadSprite3D=m),(h!==r._uploadCamera||u)&&(r.uploadCameraUniforms(h._shaderValues.data),r._uploadCamera=h),(r._uploadMaterial!==f||u)&&(f._upload(),r._uploadMaterial=f),r._uploadRenderElement,a!==f?(f._setRenderStateFrontFace(!1,m.transform),a=f,s=m):s!==m&&(f._setRenderStateFrontFace(!1,m.transform),s=m),_._render(t),r._uploadLoopCount=o),m._postRenderUpdateComponents(t))}},t._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},t._addRenderElement=function(t){this._renderElements.push(t),this._needSort=!0},t._addDynamicBatchElement=function(t){this._dynamicBatchCombineRenderElements.push(t)},v(0,t,"id",function(){return this._id}),e._uniqueIDCounter=0,e._cameraPosition=null,e}(),z=function(){function t(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return E(t,"laya.d3.core.render.RenderState"),t.clientWidth=0,t.clientHeight=0,t}(),j=function(){function s(t,e){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new me(new we,0),this._corners=[new we,new we,new we,new we,new we,new we,new we,new we],this._boundingBoxCenter=new we,this._children=R(8),this._objects=[],this._tempBoundBoxCorners=[new we,new we,new we,new we,new we,new we,new we,new we],this._scene=t,this._currentDepth=e}E(s,"laya.d3.core.scene.OctreeNode");var t=s.prototype;return S.imps(t,{"laya.d3.core.scene.ITreeNode":!0}),t.init=function(t,e){var i=new we,n=new we;we.scale(e,-.5,i),we.scale(e,.5,n),we.add(i,t,i),we.add(n,t,n),this.exactBox=new _e(i,n),this.relaxBox=new _e(i,n)},t.addTreeNode=function(t){1===pe.boxContainsBox(this._relaxBox,t.boundingBox)?this.addNodeDown(t,0):this.addObject(t)},t.addChild=function(t){var e=this._children[t];if(null==e){e=new s(this._scene,this._currentDepth+1),(this._children[t]=e)._parent=this,we.subtract(this._exactBox.max,this._exactBox.min,s.tempSize),we.multiply(s.tempSize,s._octreeSplit[t],s.tempCenter),we.add(this._exactBox.min,s.tempCenter,s.tempCenter),we.scale(s.tempSize,.25,s.tempSize);var i=new we,n=new we;we.subtract(s.tempCenter,s.tempSize,i),we.add(s.tempCenter,s.tempSize,n),e.exactBox=new _e(i,n),we.scale(s.tempSize,s.relax,s.tempSize);var r=new we,a=new we;we.subtract(s.tempCenter,s.tempSize,r),we.add(s.tempCenter,s.tempSize,a),e.relaxBox=new _e(r,a)}return e},t.addObject=function(t){(t._treeNode=this)._objects.push(t)},t.removeObject=function(t){if(t._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var e=this._objects.indexOf(t);return-1!==e&&(this._objects.splice(e,1),!0)},t.clearObject=function(){this._objects.length=0},t.addNodeUp=function(t,e){this._parent&&1!==pe.boxContainsBox(this._exactBox,t.boundingBox)?this._parent.addNodeUp(t,e-1):this.addNodeDown(t,e)},t.addNodeDown=function(t,e){if(e<this._scene.treeLevel){var i=this.inChildIndex(t.boundingBoxCenter),n=this.addChild(i);1===pe.boxContainsBox(n._relaxBox,t.boundingBox)?n.addNodeDown(t,++e):this.addObject(t)}else this.addObject(t)},t.inChildIndex=function(t){return 4*(t.z<this._boundingBoxCenter.z?0:1)+2*(t.y<this._boundingBoxCenter.y?0:1)+(t.x<this._boundingBoxCenter.x?0:1)},t.updateObject=function(t){1===pe.boxContainsBox(this._relaxBox,t.boundingBox)?(this.removeObject(t),t._treeNode=null,this.addNodeDown(t,this._currentDepth)):this._parent&&(this.removeObject(t),t._treeNode=null,this._parent.addNodeUp(t,this._currentDepth-1))},t.cullingObjects=function(t,e,i,n,r){var a,s=0,o=0,l=0,h=this._scene._dynamicBatchManager;for(s=0,a=this._objects.length;s<a;s++){var u=this._objects[s];if(V.isVisible(u._owner.layer.mask)&&u.enable){if(e&&(Cn.treeSpriteCollision+=1,0===t.containsBoundSphere(u.boundingSphere)))continue;u._renderUpdate(r),u._distanceForSort=we.distance(u.boundingSphere.center,n)+u.sortingFudge;var c=u._renderElements;for(o=0,l=c.length;o<l;o++){var d=c[o],_=d._staticBatch;if(_&&_._material===d._material)_._addBatchRenderElement(d);else{var f=d.renderObj;f.triangleCount<10&&1===f._vertexBufferCount&&f._getIndexBuffer()&&d._material.renderQueue<2&&d._canDynamicBatch&&!u._owner.isStatic?h._addPrepareRenderElement(d):this._scene.getRenderQueue(d._material.renderQueue)._addRenderElement(d)}}}}for(s=0;s<8;s++){var m=this._children[s];if(null!=m){var p=e;if(e){var g=t.containsBoundBox(m._relaxBox);if(Cn.treeNodeCollision+=1,0===g)continue;p=2===g}m.cullingObjects(t,p,i,n,r)}}},t.cullingShadowObjects=function(t,e,i,n,r){var a,s=0,o=0,l=0;this._scene._dynamicBatchManager;for(s=0,a=this._objects.length;s<a;s++){var h=this._objects[s];if(h.castShadow&&V.isVisible(h._owner.layer.mask)&&h.enable){if(i&&0===t[0].containsBoundSphere(h.boundingSphere))continue;for(var u=1,c=t.length;u<c;u++){var d=e[u-1];if(0!==t[u].containsBoundSphere(h.boundingSphere)){var _=h._renderElements;for(o=0,l=_.length;o<l;o++)d._addRenderElement(_[o])}}}}for(s=0;s<8;s++){var f=this._children[s];if(null!=f){var m=i;if(i){var p=t[0].containsBoundBox(f._relaxBox);if(0===p)continue;m=2===p}f.cullingShadowObjects(t,e,m,n,r)}}},t.cullingShadowObjectsOnePSSM=function(t,e,i,n,r,a){var s,o=e[0],l=0,h=0,u=0;for(l=0,s=this._objects.length;l<s;l++){var c=this._objects[l];if(c.castShadow&&V.isVisible(c._owner.layer.mask)&&c.enable){if(n&&0===t.containsBoundSphere(c.boundingSphere))continue;c._renderUpdate(i);var d=c._renderElements;for(h=0,u=d.length;h<u;h++)o._addRenderElement(d[h])}}for(l=0;l<8;l++){var _=this._children[l];if(null!=_){var f=n;if(n){var m=t.containsBoundBox(_._relaxBox);if(0===m)continue;f=2===m}_.cullingShadowObjectsOnePSSM(t,e,i,f,r,a)}}},t.renderBoudingBox=function(t){this._renderBoudingBox(t);for(var e=0;e<8;++e){var i=this._children[e];i&&i.renderBoudingBox(t)}},t.buildAllChild=function(t){if(t<this._scene.treeLevel)for(var e=0;e<8;e++){this.addChild(e).buildAllChild(t+1)}},t._renderBoudingBox=function(t){},v(0,t,"exactBox",function(){return this._exactBox},function(t){this._exactBox=t,we.add(t.min,t.max,this._boundingBoxCenter),we.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),v(0,t,"relaxBox",function(){return this._relaxBox},function(t){(this._relaxBox=t).getCorners(this._corners),me.createfromPoints(this._corners,this._boundingSphere)}),s.debugMode=!1,s.relax=1.15,s.CHILDNUM=8,m(s,["tempVector0",function(){return this.tempVector0=new we},"tempSize",function(){return this.tempSize=new we},"tempCenter",function(){return this.tempCenter=new we},"_octreeSplit",function(){return this._octreeSplit=[new we(.25,.25,.25),new we(.75,.25,.25),new we(.25,.75,.25),new we(.75,.75,.25),new we(.25,.25,.75),new we(.75,.25,.75),new we(.25,.75,.75),new we(.75,.75,.75)]}]),s}(),J=function(){function t(t,e,i,n){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),this._r=t,this._g=e,this._b=i,this._a=n}return E(t,"laya.d3.core.trail.module.Color"),t.prototype.cloneTo=function(t){t._r=this._r,t._g=this._g,t._b=this._b,t._a=this._a},m(t,["RED",function(){return this.RED=new t(1,0,0,1)},"GREEN",function(){return this.GREEN=new t(0,1,0,1)},"BLUE",function(){return this.BLUE=new t(0,0,1,1)},"CYAN",function(){return this.CYAN=new t(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new t(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new t(1,0,1,1)},"GRAY",function(){return this.GRAY=new t(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new t(1,1,1,1)},"BLACK",function(){return this.BLACK=new t(0,0,0,1)}]),t}(),K=function(){function t(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}E(t,"laya.d3.core.trail.module.Gradient");var e=t.prototype;return e.setKeys=function(t,e){var i,n;this._colorKeys=t;for(var r=this.index=0;r<t.length;r++){var a=(i=t[r]).color;this._colorKeyData[this.index++]=a._r,this._colorKeyData[this.index++]=a._g,this._colorKeyData[this.index++]=a._b,this._colorKeyData[this.index++]=i.time}this._alphaKeys=e;for(var s=this.index=0;s<e.length;s++)n=e[s],this._alphaKeyData[this.index++]=n.alpha,this._alphaKeyData[this.index++]=n.time},e.cloneTo=function(t){var e=0,i=0,n=this.colorKeys,r=[];for(e=0,i=n.length;e<i;e++){var a=new q;n[e].cloneTo(a),r.push(a)}var s=this.alphaKeys,o=[];for(e=0,i=s.length;e<i;e++){var l=new Q;s[e].cloneTo(l),o.push(l)}t.setKeys(r,o)},v(0,e,"mode",function(){return this._mode},function(t){this._mode=t}),v(0,e,"colorKeys",function(){return this._colorKeys},function(t){this._colorKeys=t;for(var e=this.index=0;e<t.length;e++){var i=t[e],n=i.color;this._colorKeyData[this.index++]=n._r,this._colorKeyData[this.index++]=n._g,this._colorKeyData[this.index++]=n._b,this._colorKeyData[this.index++]=i.time}}),v(0,e,"alphaKeys",function(){return this._alphaKeys},function(t){this._alphaKeys=t;for(var e=this.index=0;e<t.length;e++){var i=t[e];this._alphaKeyData[this.index++]=i.alpha,this._alphaKeyData[this.index++]=i.time}}),t}(),Q=function(){function t(t,e){this._alpha=NaN,this._time=NaN,void 0===t&&(t=0),void 0===e&&(e=0),this._alpha=t,this._time=e}E(t,"laya.d3.core.trail.module.GradientAlphaKey");var e=t.prototype;return e.cloneTo=function(t){t.alpha=this.alpha,t.time=this.time},v(0,e,"alpha",function(){return this._alpha},function(t){this._alpha=t}),v(0,e,"time",function(){return this._time},function(t){this._time=t}),t}(),q=function(){function t(t,e){this._color=null,this._time=NaN,void 0===e&&(e=0),this._color=t||new J,this._time=e}E(t,"laya.d3.core.trail.module.GradientColorKey");var e=t.prototype;return e.cloneTo=function(t){this.color.cloneTo(t.color),t.time=this.time},v(0,e,"color",function(){return this._color},function(t){this._color=t}),v(0,e,"time",function(){return this._time},function(t){this._time=t}),t}(),$=(function(){function t(){}E(t,"laya.d3.core.trail.module.GradientMode"),t.Blend=0,t.Fixed=1}(),function(){function t(){}E(t,"laya.d3.core.trail.module.TextureMode"),t.Stretch=0,t.Tile=1}(),function(){function t(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}return E(t,"laya.d3.core.trail.module.TrailKeyFrame"),t.prototype.cloneTo=function(t){t.time=this.time,t.inTangent=this.inTangent,t.outTangent=this.outTangent,t.value=this.value},t}()),tt=function(){function e(t){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new we,this._curPosition=new we,this._delVector3=new we,this._lastFixedVertexPosition=new we,this._pointAtoBVector3=new we,this._pointA=new we,this._pointB=new we,this._owner=t,this._id=e.renderElementCount++,0==this._id?t._owner.transform.position.cloneTo(this._lastPosition):t._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new ws(et.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new ws(et.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}E(e,"laya.d3.core.trail.TrailRenderElement");var t=e.prototype;return S.imps(t,{"laya.d3.core.render.IRenderable":!0}),t._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},t._addTrailByFirstPosition=function(t,e){we.subtract(e,t,this._delVector3),we.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),we.normalize(this._pointAtoBVector3,this._pointAtoBVector3),we.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},t._addTrailByNextPosition=function(t){we.subtract(t,this._lastFixedVertexPosition,this._delVector3),we.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),we.normalize(this._pointAtoBVector3,this._pointAtoBVector3),we.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=we.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=ge.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(t),this._virtualVerticesCount=2)},t._updateVerticesByPosition=function(t){this._pointe=t.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},t._updateVertexBuffer2=function(){var t,e=0,i=0,n=0;for(n=0,t=(this._verticesCount+this._virtualVerticesCount)/2;n<t;n++)i=0==this._owner.textureMode?(this._VerticesToTailLength[n]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[n],this._vertices2[e++]=1-i,this._vertices2[e++]=1-i;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},t._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},t._updateDisappear=function(){var t,e=0;for(e=this._curDisappearIndex,t=(this._verticesCount+this._virtualVerticesCount)/2;e<t;e++)this._owner._curtime-this._everyGroupVertexBirthTime[e]>=this._owner.time+ge.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},t._beforeRender=function(t){return this._camera=t.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),we.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},t._render=function(t){this._isDead||(mr.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),Cn.drawCall++,Cn.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},t._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer1:1===t?this._vertexBuffer2:null},t._getVertexBuffers=function(){return this._vertexBuffers},t._getIndexBuffer=function(){return null},t.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},t._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},v(0,t,"_vertexBufferCount",function(){return this._vertexBuffers.length}),v(0,t,"triangleCount",function(){return 0}),e.renderElementCount=0,e}(),et=function(){function t(){}E(t,"laya.d3.core.trail.VertexTrail");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration1}),v(1,t,"vertexDeclaration1",function(){return t._vertexDeclaration1}),v(1,t,"vertexDeclaration2",function(){return t._vertexDeclaration2}),m(t,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new ot(32,[new lt(0,"vector3",0),new lt(12,"vector3",41),new lt(24,"single",33),new lt(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new ot(4,[new lt(0,"single",38)])}]),t}(),it=function(){function x(t){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=t}E(x,"laya.d3.graphics.DynamicBatch");var t=x.prototype;return S.imps(t,{"laya.d3.core.render.IRenderable":!0}),t._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},t._getIndexBuffer=function(){return this._indexBuffer},t._getCombineRenderElementFromPool=function(t,e,i){var n=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return n||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=n=new X,n._sprite3D=new Vo),n._sprite3D._render._renderUpdate(i),n},t._getRenderElement=function(t,e,i){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*x.maxVertexCount),this._indexDatas=new Uint16Array(x.maxIndexCount),this._vertexBuffer=ws.create(this._vertexDeclaration,x.maxVertexCount,35048),this._indexBuffer=Rs.create("ushort",x.maxIndexCount,35048));for(var n=this._merageElements.length=0,r=0,a=0,s=this._combineRenderElements.length;a<s;a++){var o=this._combineRenderElements[a],l=o.getDynamicBatchBakedVertexs(0),h=o.getBakedIndices(),u=o._sprite3D.transform._isFrontFaceInvert,c=n/(this._vertexDeclaration.vertexStride/4),d=r,_=d+h.length;o._tempBatchIndexStart=d,o._tempBatchIndexEnd=_,this._indexDatas.set(h,r);var f=0;if(u)for(f=d;f<_;f+=3){this._indexDatas[f]=c+this._indexDatas[f];var m=this._indexDatas[f+1],p=this._indexDatas[f+2];this._indexDatas[f+1]=c+p,this._indexDatas[f+2]=c+m}else for(f=d;f<_;f+=3)this._indexDatas[f]=c+this._indexDatas[f],this._indexDatas[f+1]=c+this._indexDatas[f+1],this._indexDatas[f+2]=c+this._indexDatas[f+2];r+=h.length,this._vertexDatas.set(l,n),n+=l.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),a=this._combineRenderElementPoolIndex=0,s=this._materials.length;a<s;a++){var g=this._getCombineRenderElementFromPool(t,e,i);g._type=2,g._staticBatch=null;var v=(g.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[a]]._tempBatchIndexStart,y=a+1===this._materialToRenderElementsOffsets.length?r:this._combineRenderElements[this._materialToRenderElementsOffsets[a+1]]._tempBatchIndexStart;g._tempBatchIndexStart=v,g._tempBatchIndexEnd=y,g._material=this._materials[a],this._merageElements.push(g)}},t._addCombineRenderObjTest=function(t){var e=t.renderObj,i=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,n=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount;return!(x.maxVertexCount<n||x.maxIndexCount<i)},t._addCombineRenderObj=function(t){var e=t.renderObj;this._combineRenderElements.push(t),this._currentCombineIndexCount=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount},t._addCombineMaterial=function(t){this._materials.push(t)},t._addMaterialToRenderElementOffset=function(t){this._materialToRenderElementsOffsets.push(t)},t._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},t._addToRenderQueue=function(t,e,i,n){this._getRenderElement(e,i,n);for(var r=0,a=this._materials.length;r<a;r++)t.getRenderQueue(this._materials[r].renderQueue)._addDynamicBatchElement(this._merageElements[r])},t._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},t._render=function(t){var e=t._batchIndexEnd-t._batchIndexStart;mr.mainContext.drawElements(4,e,5123,2*t._batchIndexStart),Cn.drawCall++,Cn.trianglesFaces+=e/3},t._getVertexBuffers=function(){return null},v(0,t,"_vertexBufferCount",function(){return 1}),v(0,t,"triangleCount",function(){return this._indexBuffer.indexCount/3}),v(0,t,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),x.maxVertexCount=2e4,x.maxIndexCount=4e4,x.maxCombineTriangleCount=10,x}(),nt=function(){function x(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}E(x,"laya.d3.graphics.DynamicBatchManager");var t=x.prototype;return t.getDynamicBatch=function(t,e){var i,n=t.id.toString()+e;return this._dynamicBatches[n]?i=this._dynamicBatches[n]:this._dynamicBatches[n]=i=new it(t),i},t._garbageCollection=function(){for(var t in this._dynamicBatches)0===this._dynamicBatches[t].combineRenderElementsCount&&delete this._dynamicBatches[t]},t._addPrepareRenderElement=function(t){this._prepareDynamicBatchCombineElements.push(t)},t._finishCombineDynamicBatch=function(t){var e,i,n;this._prepareDynamicBatchCombineElements.sort(x._sortPrepareDynamicBatch);for(var r,a,s,o,l,h=-1,u=!0,c=0,d=-1,_=0,f=this._prepareDynamicBatchCombineElements.length;_<f;_++){var m=(a=this._prepareDynamicBatchCombineElements[_]).renderObj._getVertexBuffer(0).vertexDeclaration,p=i!==m;p&&(c=0,i=m);var g=c!==h;if(g&&(h=c),(p||g)&&(s=this.getDynamicBatch(m,c),e=null),u)if(s._addCombineRenderObjTest(a)){if(e!==(r=a._material))o&&(t.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,d=-1),o=r,d=s.combineRenderElementsCount,l=a,e=r;else if(o){var v=l.renderObj,y=a.renderObj;v._getVertexBuffer().vertexCount+y._getVertexBuffer().vertexCount>it.maxVertexCount||v._getIndexBuffer().indexCount+y._getIndexBuffer().indexCount>it.maxIndexCount?(t.getRenderQueue(l._material.renderQueue)._addRenderElement(l),o=r,d=s.combineRenderElementsCount,l=a):(s._addCombineMaterial(o),s._addMaterialToRenderElementOffset(d),s._addCombineRenderObj(l),l=o=null,d=-1,s._addCombineRenderObj(a))}else s._addCombineRenderObj(a);u=!0}else o&&(t.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,d=-1),c++,u=!1;else n=this._prepareDynamicBatchCombineElements[_-1],s._addMaterialToRenderElementOffset(s.combineRenderElementsCount),e=n._material,s._addCombineMaterial(e),s._addCombineRenderObj(n),u=!0,e!==(r=a._material)?(o=r,d=s.combineRenderElementsCount,l=a):s._addCombineRenderObj(a),e=r}o&&(t.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=o=null,d=-1),this._prepareDynamicBatchCombineElements.length=0},t._clearRenderElements=function(){for(var t in this._dynamicBatches)this._dynamicBatches[t]._clearRenderElements()},t._addToRenderQueue=function(t,e,i,n){for(var r in this._dynamicBatches){var a=this._dynamicBatches[r];0<a.combineRenderElementsCount&&a._addToRenderQueue(t,e,i,n)}},t.dispose=function(){this._dynamicBatches=null},x._sortPrepareDynamicBatch=function(t,e){return t._mainSortID-e._mainSortID},x}(),rt=function(){function t(){}return E(t,"laya.d3.graphics.FrustumCulling"),t.renderShadowObjectCulling=function(t,e,i,n,r){var a=0,s=0,o=0,l=0;for(a=0,o=i.length;a<o;a++){var h=i[a];h&&h._clearRenderElements()}var u,c,d,_=t._cullingRenders;if(1<r){for(a=0,o=t._cullingRendersLength;a<o;a++)if((u=_[a]).castShadow&&V.isVisible(u._owner.layer.mask)&&u.enable)for(var f=1,m=e.length;f<m;f++)if(c=i[f-1],0!==e[f].containsBoundSphere(u.boundingSphere))for(s=0,l=(d=u._renderElements).length;s<l;s++)c._addRenderElement(d[s])}else for(a=0,o=t._cullingRendersLength;a<o;a++)if((u=_[a]).castShadow&&V.isVisible(u._owner.layer.mask)&&u.enable&&0!==e[0].containsBoundSphere(u.boundingSphere))for(u._renderUpdate(n),c=i[0],s=0,l=(d=u._renderElements).length;s<l;s++)c._addRenderElement(d[s])},t.renderShadowObjectCullingOctree=function(t,e,i,n,r){for(var a=0,s=i.length;a<s;a++){var o=i[a];o&&o._clearRenderElements()}1<r?t.treeRoot.cullingShadowObjects(e,i,!0,0,t):t.treeRoot.cullingShadowObjectsOnePSSM(e[0],i,n,!0,0,t)},t.renderObjectCulling=function(t,e,i,n,r,a){var s=0,o=0,l=0,h=0,u=e._quenes,c=e._dynamicBatchManager,d=e._cullingRenders;for(s=0,o=u.length;s<o;s++){var _=u[s];_&&_._clearRenderElements()}var f=at._staticBatchManagers;for(s=0,o=f.length;s<o;s++)f[s]._clearRenderElements();c._clearRenderElements();var m=i.transform.position;for(s=0,o=e._cullingRendersLength;s<o;s++){var p=d[s];if(V.isVisible(p._owner.layer.mask)&&p.enable&&0!==t.containsBoundSphere(p.boundingSphere)&&p._renderUpdate(a)){p._distanceForSort=we.distance(p.boundingSphere.center,m)+p.sortingFudge;var g=p._renderElements;for(l=0,h=g.length;l<h;l++){var v=g[l],y=v._staticBatch;if(y&&y._material===v._material)y._addBatchRenderElement(v);else{var x=v.renderObj;x.triangleCount<10&&1===x._vertexBufferCount&&x._getIndexBuffer()&&v._material.renderQueue<2&&v._canDynamicBatch&&!p._owner.isStatic?c._addPrepareRenderElement(v):e.getRenderQueue(v._material.renderQueue)._addRenderElement(v)}}}}for(s=0,o=f.length;s<o;s++)f[s]._addToRenderQueue(e,n,r,a);c._finishCombineDynamicBatch(e),c._addToRenderQueue(e,n,r,a)},t.renderObjectCullingOctree=function(t,e,i,n,r,a){var s=0,o=0,l=e._quenes,h=e._dynamicBatchManager;for(s=0,o=l.length;s<o;s++){var u=l[s];u&&u._clearRenderElements()}var c=at._staticBatchManagers;for(s=0,o=c.length;s<o;s++)c[s]._clearRenderElements();for(h._clearRenderElements(),e._cullingRenders.length=0,e.treeRoot.cullingObjects(t,!0,0,i.transform.position,a),s=0,o=c.length;s<o;s++)c[s]._addToRenderQueue(e,n,r,a);h._finishCombineDynamicBatch(e),h._addToRenderQueue(e,n,r,a)},t.renderObjectCullingNoBoundFrustum=function(t,e,i,n,r){var a=0,s=0,o=0,l=0,h=t._quenes,u=t._dynamicBatchManager,c=t._cullingRenders;for(a=0,s=h.length;a<s;a++){var d=h[a];d&&d._clearRenderElements()}var _=at._staticBatchManagers;for(a=0,s=_.length;a<s;a++)_[a]._clearRenderElements();u._clearRenderElements();var f=e.transform.position;for(a=0,s=t._cullingRendersLength;a<s;a++){var m=c[a];if(V.isVisible(m._owner.layer.mask)&&m.enable){m._renderUpdate(r),m._distanceForSort=we.distance(m.boundingSphere.center,f)+m.sortingFudge;var p=m._renderElements;for(o=0,l=p.length;o<l;o++){var g=p[o],v=g._staticBatch;if(v&&v._material===g._material)v._addBatchRenderElement(g);else{var y=g.renderObj;y.triangleCount<10&&1===y._vertexBufferCount&&y._getIndexBuffer()&&g._material.renderQueue<2&&g._canDynamicBatch&&!m._owner.isStatic?u._addPrepareRenderElement(g):t.getRenderQueue(g._material.renderQueue)._addRenderElement(g)}}}}for(a=0,s=_.length;a<s;a++)_[a]._addToRenderQueue(t,i,n,r);u._finishCombineDynamicBatch(t),u._addToRenderQueue(t,i,n,r)},t}(),at=function(){function a(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}E(a,"laya.d3.graphics.StaticBatchManager");var t=a.prototype;return t._finishInit=function(){for(var t in this._staticBatches)this._staticBatches[t]._finishInit();this._initBatchRenderElements.length=0},t._initStaticBatchs=function(t){throw new Error("StaticBatchManager:must override this function.")},t._addInitBatchSprite=function(t){for(var e=t._render._renderElements,i=0,n=e.length;i<n;i++)this._initBatchRenderElements.push(e[i])},t._clearRenderElements=function(){for(var t in this._staticBatches)this._staticBatches[t]._clearRenderElements()},t._garbageCollection=function(t){var e=t._staticBatch,i=e._initBatchRenderElements,n=i.indexOf(t);i.splice(n,1),0===i.length&&(e.dispose(),delete this._staticBatches[e._key])},t._addToRenderQueue=function(t,e,i,n){for(var r in this._staticBatches){var a=this._staticBatches[r];0<a._batchRenderElements.length&&a._updateToRenderQueue(t,n)}},t.dispose=function(){this._staticBatches=null},a._addToStaticBatchQueue=function(t){t instanceof laya.d3.core.RenderableSprite3D&&t._addToInitStaticBatchManager();for(var e=0,i=t.numChildren;e<i;e++)a._addToStaticBatchQueue(t._childs[e])},a.combine=function(t,e){var i,n=0,r=0;if(e)for(n=0,r=e.length;n<r;n++){e[n]._addToInitStaticBatchManager()}else t&&a._addToStaticBatchQueue(t);for(n=0,r=a._staticBatchManagers.length;n<r;n++)(i=a._staticBatchManagers[n])._initStaticBatchs(t),i._finishInit()},a._staticBatchManagers=[],a}(),st=function(){function t(t,e,i){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=t,this._manager=e,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=i}E(t,"laya.d3.graphics.StaticBatch");var e=t.prototype;return S.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),e._binarySearch=function(t){for(var e=0,i=this._batchRenderElements.length-1,n=0;e<=i;)n=Math.floor((e+i)/2),this._compareBatchRenderElement(this._batchRenderElements[n],t)?i=n-1:e=n+1;return e},e._compareBatchRenderElement=function(t,e){throw new Error("StaticBatch:must override this function.")},e._getVertexDecLightMap=function(t){return t===qt.vertexDeclaration?zt.vertexDeclaration:t===Qt.vertexDeclaration?Yt.vertexDeclaration:t===Wt.vertexDeclaration?St.vertexDeclaration:t===ie.vertexDeclaration?null:t===vt.vertexDeclaration?yt.vertexDeclaration:t===te.vertexDeclaration?Jt.vertexDeclaration:t===Ht.vertexDeclaration?Xt.vertexDeclaration:t===$t.vertexDeclaration?jt.vertexDeclaration:t===Qt.vertexDeclaration?Yt.vertexDeclaration:t===Ut.vertexDeclaration?Et.vertexDeclaration:t===ie.vertexDeclaration?null:t===vt.vertexDeclaration?yt.vertexDeclaration:t===ee.vertexDeclaration?Kt.vertexDeclaration:t===Ht.vertexDeclaration?Xt.vertexDeclaration:t},e._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},e._addBatchRenderElement=function(t){this._batchRenderElements.splice(this._binarySearch(t),0,t)},e._updateToRenderQueue=function(t,e){this._combineRenderElementPoolIndex=0,this._getRenderElement(t.getRenderQueue(this._material.renderQueue)._renderElements,t,e)},e._getRenderElement=function(t,e,i){throw new Error("StaticBatch:must override this function.")},e._finishInit=function(){throw new Error("StaticBatch:must override this function.")},e._clearRenderElements=function(){this._batchRenderElements.length=0},e.dispose=function(){},e._getVertexBuffer=function(t){return void 0===t&&(t=0),null},e._getIndexBuffer=function(){return null},e._beforeRender=function(t){return!0},e._render=function(t){},e._getVertexBuffers=function(){return null},v(0,e,"_vertexBufferCount",function(){return 1}),v(0,e,"triangleCount",function(){return 0}),t.combine=function(t){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),at.combine(t)},t.maxBatchVertexCount=65535,t}(),ot=function(){function s(t,e){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++s._uniqueIDCounter,this._id>s.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",s.maxVertexDeclaration);this._shaderValues=new Ve,this._vertexElementsDic={},this._vertexStride=t,this._vertexElements=e;for(var i=0;i<e.length;i++){var n=e[i],r=n.elementUsage;this._vertexElementsDic[r]=n;var a=[s._getTypeSize(n.elementFormat)/4,5126,!1,this._vertexStride,n.offset];switch(this._shaderValues.setValue(r,a),r){case 1:this._addShaderDefine(Xr.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(Xr.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(Xr.SHADERDEFINE_UV1)}}}E(s,"laya.d3.graphics.VertexDeclaration");var t=s.prototype;return t._addShaderDefine=function(t){this._shaderDefineValue|=t},t._removeShaderDefine=function(t){this._shaderDefineValue&=~t},t.getVertexElements=function(){return this._vertexElements.slice()},t.getVertexElementByUsage=function(t){return this._vertexElementsDic[t]},t.unBinding=function(){},v(0,t,"shaderDefineValue",function(){return this._shaderDefineValue}),v(0,t,"id",function(){return this._id}),v(0,t,"vertexStride",function(){return this._vertexStride}),v(0,t,"shaderValues",function(){return this._shaderValues}),s._getTypeSize=function(t){switch(t){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},s.getVertexStride=function(t){for(var e=0,i=0;i<t.Length;i++){var n=t[i],r=n.offset+s._getTypeSize(n.elementFormat);e<r&&(e=r)}return e},s._maxVertexDeclarationBit=1e3,s._uniqueIDCounter=1,m(s,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),s}(),lt=function(){function t(t,e,i){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=t,this.elementFormat=e,this.elementUsage=i}return E(t,"laya.d3.graphics.VertexElement"),t}(),ht=(function(){function t(){}E(t,"laya.d3.graphics.VertexElementFormat"),t.Single="single",t.Vector2="vector2",t.Vector3="vector3",t.Vector4="vector4",t.Color="color",t.Byte4="byte4",t.Short2="short2",t.Short4="short4",t.NormalizedShort2="normalizedshort2",t.NormalizedShort4="normalizedshort4",t.HalfVector2="halfvector2",t.HalfVector4="halfvector4"}(),function(){function t(){}E(t,"laya.d3.graphics.VertexElementUsage"),t.POSITION0=0,t.COLOR0=1,t.TEXTURECOORDINATE0=2,t.NORMAL0=3,t.BINORMAL0=4,t.TANGENT0=5,t.BLENDINDICES0=6,t.BLENDWEIGHT0=7,t.DEPTH0=8,t.FOG0=9,t.POINTSIZE0=10,t.SAMPLE0=11,t.TESSELLATEFACTOR0=12,t.COLOR1=13,t.NEXTTEXTURECOORDINATE0=14,t.TEXTURECOORDINATE1=15,t.NEXTTEXTURECOORDINATE1=16,t.CORNERTEXTURECOORDINATE0=17,t.VELOCITY0=18,t.STARTCOLOR0=19,t.STARTSIZE=20,t.AGEADDSCALE0=21,t.STARTROTATION=22,t.ENDCOLOR0=23,t.STARTLIFETIME=24,t.TIME0=33,t.SHAPEPOSITIONSTARTLIFETIME=30,t.DIRECTIONTIME=32,t.SIZEROTATION0=27,t.RADIUS0=28,t.RADIAN0=29,t.STARTSPEED=31,t.RANDOM0=34,t.RANDOM1=35,t.SIMULATIONWORLDPOSTION=36,t.SIMULATIONWORLDROTATION=37,t.TEXTURECOORDINATE0X=38,t.TEXTURECOORDINATE0X1=39,t.TEXTURECOORDINATE0Y=40,t.OFFSETVECTOR=41}(),function(){function t(t,e,i){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=t,this._textureCoordinate0=e,this._time=i}E(t,"laya.d3.graphics.VertexGlitter");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate0}),v(0,e,"position",function(){return this._position}),v(0,e,"time",function(){return this._time}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(24,[new lt(0,"vector3",0),new lt(12,"vector2",2),new lt(20,"single",33)])}]),t}()),ut=function(){function t(t){this._position=null,this._position=t}E(t,"laya.d3.graphics.VertexPosition");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(12,[new lt(0,"vector3",0)])}]),t}(),ct=function(){function t(t,e){this._position=null,this._normal=null,this._position=t,this._normal=e}E(t,"laya.d3.graphics.VertexPositionNormal");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(24,[new lt(0,"vector3",0),new lt(12,"vector3",3)])}]),t}(),dt=function(){function t(t,e,i){this._position=null,this._normal=null,this._color=null,this._position=t,this._normal=e,this._color=i}E(t,"laya.d3.graphics.VertexPositionNormalColor");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(40,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1)])}]),t}(),_t=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._blendIndex=n,this._blendWeight=r}E(t,"laya.d3.graphics.VertexPositionNormalColorSkin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(72,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector4",7),new lt(56,"vector4",6)])}]),t}(),ft=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}E(t,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(88,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector4",7),new lt(56,"vector4",6),new lt(72,"vector4",5)])}]),t}(),mt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}E(t,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(84,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector4",7),new lt(56,"vector4",6),new lt(72,"vector3",5)])}]),t}(),pt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}E(t,"laya.d3.graphics.VertexPositionNormalColorSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(56,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector4",5)])}]),t}(),gt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}E(t,"laya.d3.graphics.VertexPositionNormalColorTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(52,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector3",5)])}]),t}(),vt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n}E(t,"laya.d3.graphics.VertexPositionNormalColorTexture");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(48,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2)])}]),t}(),yt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r}E(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(56,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector2",15)])}]),t}(),xt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._blendIndex=a,this._blendWeight=s}E(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(88,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector2",15),new lt(56,"vector4",7),new lt(72,"vector4",6)])}]),t}(),bt=function(){function t(t,e,i,n,r,a,s,o){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o}E(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(104,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector2",15),new lt(56,"vector4",7),new lt(72,"vector4",6),new lt(88,"vector4",5)])}]),t}(),Tt=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}E(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0SkinTangent=function(t,e,i,n,r,a,s,o){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,this._blendIndex=s,this._blendWeight=o},v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(100,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector2",15),new lt(56,"vector4",7),new lt(72,"vector4",6),new lt(88,"vector3",5)])}]),t}(),St=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a}E(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(72,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector2",15),new lt(56,"vector4",5)])}]),t}(),Et=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}E(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0Tangent=function(t,e,i,n,r,a){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a},v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(68,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector2",15),new lt(56,"vector3",5)])}]),t}(),Rt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._blendIndex=r,this._blendWeight=a}E(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(80,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector4",7),new lt(64,"vector4",6)])}]),t}(),Bt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}E(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(96,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector4",7),new lt(64,"vector4",6),new lt(80,"vector4",5)])}]),t}(),Gt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}E(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"color",function(){return this._color}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(92,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector4",7),new lt(64,"vector4",6),new lt(80,"vector3",5)])}]),t}(),Wt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}E(t,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(64,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector4",5)])}]),t}(),Ut=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}E(t,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"color",function(){return this._color}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(60,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",1),new lt(40,"vector2",2),new lt(48,"vector3",5)])}]),t}(),Zt=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}E(t,"laya.d3.graphics.VertexPositionNormalSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(40,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector4",5)])}]),t}(),kt=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}E(t,"laya.d3.graphics.VertexPositionNormalTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(36,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector3",5)])}]),t}(),Ht=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}E(t,"laya.d3.graphics.VertexPositionNormalTexture");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(32,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2)])}]),t}(),Xt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n}E(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(40,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector2",15)])}]),t}(),Yt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._blendIndex=r,this._blendWeight=a}E(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(72,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector2",15),new lt(40,"vector4",7),new lt(56,"vector4",6)])}]),t}(),zt=function(){function t(t,e,i,n,r,a,s){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s}E(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(88,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector2",15),new lt(40,"vector4",7),new lt(56,"vector4",6),new lt(72,"vector4",5)])}]),t}(),jt=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}E(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0SkinTangent=function(t,e,i,n,r,a,s){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=a,this._blendWeight=s},v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(84,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector2",15),new lt(40,"vector4",7),new lt(56,"vector4",6),new lt(72,"vector3",5)])}]),t}(),Jt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r}E(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(56,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector2",15),new lt(40,"vector4",5)])}]),t}(),Kt=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}E(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0Tangent=function(t,e,i,n,r){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r},v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(52,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector2",15),new lt(40,"vector3",5)])}]),t}(),Qt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._blendIndex=n,this._blendWeight=r}E(t,"laya.d3.graphics.VertexPositionNormalTextureSkin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(64,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector4",7),new lt(48,"vector4",6)])}]),t}(),qt=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}E(t,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(80,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector4",7),new lt(48,"vector4",6),new lt(64,"vector4",5)])}]),t}(),$t=function(){function t(t,e,i,n,r,a){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=a}E(t,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(76,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector4",7),new lt(48,"vector4",6),new lt(64,"vector3",5)])}]),t}(),te=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}E(t,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(48,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector4",5)])}]),t}(),ee=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}E(t,"laya.d3.graphics.VertexPositionNormalTextureTangent");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(44,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector3",5)])}]),t}(),ie=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}E(t,"laya.d3.graphics.VertexPositionNTBTexture");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(56,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector3",5),new lt(36,"vector3",4),new lt(48,"vector2",2)])}]),t}(),ne=function(){function t(t,e,i,n,r,a,s,o){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=a,i=i,this._blendIndex=s,this._blendWeight=o}E(t,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"tangent",function(){return this._tangent}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(0,e,"textureCoordinate1",function(){return this._textureCoordinate1}),v(0,e,"blendIndex",function(){return this._blendIndex}),v(0,e,"blendWeight",function(){return this._blendWeight}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(96,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector3",5),new lt(36,"vector3",4),new lt(48,"vector2",2),new lt(56,"vector2",15),new lt(64,"vector4",7),new lt(80,"vector4",6)])}]),t}(),re=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}E(t,"laya.d3.graphics.VertexPositionNTBTextureSkin");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"textureCoordinate",function(){return this._textureCoordinate}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(88,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector3",5),new lt(36,"vector3",4),new lt(48,"vector2",2),new lt(56,"vector4",7),new lt(72,"vector4",6)])}]),t}(),ae=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=t,this._normal=e,this._textureCoord0=i,this._textureCoord1=n}E(t,"laya.d3.graphics.VertexPositionTerrain");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"normal",function(){return this._normal}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoord0",function(){return this._textureCoord0}),v(0,e,"textureCoord1",function(){return this._textureCoord1}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(40,[new lt(0,"vector3",0),new lt(12,"vector3",3),new lt(24,"vector2",2),new lt(32,"vector2",15)])}]),t}(),se=function(){function t(t,e){this._position=null,this._textureCoordinate0=null,this._position=t,this._textureCoordinate0=e}E(t,"laya.d3.graphics.VertexPositionTexture0");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"position",function(){return this._position}),v(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(20,[new lt(0,"vector3",0),new lt(12,"vector2",2)])}]),t}(),oe=function(){function t(t,e,i,n,r,a,s,o,l,h,u,c,d,_){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=a,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=h,this._startSpeed=u,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=_}E(t,"laya.d3.graphics.VertexShurikenParticleBillboard");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),v(0,e,"random1",function(){return this._randoms1}),v(0,e,"startRotation2",function(){return this._startRotation2}),v(0,e,"positionStartLifeTime",function(){return this._positionStartLifeTime}),v(0,e,"velocity",function(){return this._velocity}),v(0,e,"random0",function(){return this._randoms0}),v(0,e,"startSize",function(){return this._startSize}),v(0,e,"startColor",function(){return this._startColor}),v(0,e,"startRotation0",function(){return this._startRotation0}),v(0,e,"startRotation1",function(){return this._startRotation1}),v(0,e,"startLifeTime",function(){return this._startLifeTime}),v(0,e,"time",function(){return this._time}),v(0,e,"startSpeed",function(){return this._startSpeed}),v(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(152,[new lt(0,"vector4",17),new lt(16,"vector4",30),new lt(32,"vector4",32),new lt(48,"vector4",19),new lt(64,"vector3",20),new lt(76,"vector3",22),new lt(88,"single",31),new lt(92,"vector4",34),new lt(108,"vector4",35),new lt(124,"vector3",36),new lt(136,"vector4",37)])}]),t}(),le=function(){function t(t,e,i,n,r,a,s,o,l,h,u,c,d,_){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=a,this._startRotation1=s,this._startRotation2=o,this._startLifeTime=l,this._time=h,this._startSpeed=u,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=_}E(t,"laya.d3.graphics.VertexShurikenParticleMesh");var e=t.prototype;return S.imps(e,{"laya.d3.graphics.IVertex":!0}),v(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),v(0,e,"velocity",function(){return this._velocity}),v(0,e,"position",function(){return this._positionStartLifeTime}),v(0,e,"random0",function(){return this._randoms0}),v(0,e,"startSize",function(){return this._startSize}),v(0,e,"startColor",function(){return this._startColor}),v(0,e,"startRotation0",function(){return this._startRotation0}),v(0,e,"startRotation1",function(){return this._startRotation1}),v(0,e,"random1",function(){return this._randoms1}),v(0,e,"startRotation2",function(){return this._startRotation2}),v(0,e,"startLifeTime",function(){return this._startLifeTime}),v(0,e,"time",function(){return this._time}),v(0,e,"startSpeed",function(){return this._startSpeed}),v(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),v(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),v(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),m(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new ot(172,[new lt(0,"vector3",0),new lt(12,"vector4",1),new lt(28,"vector2",2),new lt(36,"vector4",30),new lt(52,"vector4",32),new lt(68,"vector4",19),new lt(84,"vector3",20),new lt(96,"vector3",22),new lt(108,"single",31),new lt(112,"vector4",34),new lt(128,"vector4",35),new lt(144,"vector3",36),new lt(156,"vector4",37)])}]),t}(),he=function(){function y(t,e,i,n,r,a){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=i,this._materials=n,this._subMeshes=r,this._materialMap=a,this._version=e,this._onLoaded(t)}E(y,"laya.d3.loaders.LoadModelV01");var t=y.prototype;return t._onLoaded=function(t){this._readData=t,this.READ_BLOCK();for(var e=0;e<this._BLOCK.count;e++){var i=this._readData.getUint16(),n=this._strings[i],r=this["READ_"+n];if(null==r)throw new Error("model file err,no this function:"+i+" "+n);if(!r.call(this))break}return this._mesh},t.onError=function(){},t._readString=function(){return this._strings[this._readData.getUint16()]},t.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},t.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},t.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var t=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var e=0;e<this._STRINGS.size;e++)this._strings[e]=this._readData.readUTFString();return this._readData.pos=t,!0},t.READ_MATERIAL=function(){var t=this._readData.getUint16(),e=(this._readString(),this._readString());return this._materials[t]="null"!==e?kr.getRes(this._materialMap[e]):new va,!0},t.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var t,e=this._readData.__getBuffer(),i=0,n=this._readData.getUint32(),r=this._readData.getUint32(),a=(new Float32Array(e.slice(n+this._DATA.offset,n+this._DATA.offset+r)),this._readData.getUint32()),s=this._readData.getUint32(),o=new Float32Array(e.slice(a+this._DATA.offset,a+this._DATA.offset+s));for(this.mesh._inverseBindPoses=[],i=0,t=o.length;i<t;i+=16){var l=new ye(o[i+0],o[i+1],o[i+2],o[i+3],o[i+4],o[i+5],o[i+6],o[i+7],o[i+8],o[i+9],o[i+10],o[i+11],o[i+12],o[i+13],o[i+14],o[i+15]);this.mesh._inverseBindPoses.push(l)}break;default:throw new Error("LoadModel:unknown version.")}return!0},t.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var t=this._readString();this._shaderAttributes=t.match(y._attrReg);var e=this._readData.getUint32(),i=this._readData.getUint32(),n=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),r=this._readData.getUint32(),a=this._readData.getUint32(),s=this._readData.getUint32(),o=this._readData.__getBuffer(),l=new Me(this._mesh),h=this._getVertexDeclaration(),u=ws.create(h,r/h.vertexStride,35044,!0),c=n+this._DATA.offset,d=o.slice(c,c+r);u.setData(new Float32Array(d));for(var _=(l._vertexBuffer=u).vertexDeclaration.getVertexElements(),f=0;f<_.length;f++)l._bufferUsage[_[f].elementUsage]=u;var m=Rs.create("ushort",i/2,35044,!0),p=e+this._DATA.offset,g=o.slice(p,p+i);m.setData(new Uint16Array(g)),l._indexBuffer=m;var v=o.slice(a+this._DATA.offset,a+this._DATA.offset+s);return l._boneIndicesList[0]=new Uint8Array(v),this._subMeshes.push(l),!0},t.READ_DATAAREA=function(){return!1},t._getVertexDeclaration=function(){for(var t,e=!1,i=!1,n=!1,r=!1,a=!1,s=!1,o=!1,l=!1,h=!1,u=0;u<this._shaderAttributes.length;u+=8)switch(this._shaderAttributes[u]){case"POSITION":e=!0;break;case"NORMAL":i=!0;break;case"COLOR":n=!0;break;case"UV":r=!0;break;case"UV1":a=!0;break;case"BLENDWEIGHT":o=!0;break;case"BLENDINDICES":l=!0;break;case"TANGENT":s=!0;break;case"BINORMAL":h=!0}return e&&i&&n&&r&&a&&o&&l&&s?t=Tt.vertexDeclaration:e&&i&&n&&r&&a&&o&&l?t=xt.vertexDeclaration:e&&i&&r&&a&&o&&l&&s?t=jt.vertexDeclaration:e&&i&&r&&a&&o&&l?t=Yt.vertexDeclaration:e&&i&&n&&r&&o&&l&&s?t=Gt.vertexDeclaration:e&&i&&n&&r&&o&&l?t=Rt.vertexDeclaration:e&&i&&s&&h&&r&&o&&l?t=re.vertexDeclaration:e&&i&&r&&o&&l&&s?t=$t.vertexDeclaration:e&&i&&r&&o&&l?t=Qt.vertexDeclaration:e&&i&&n&&o&&l&&s?t=mt.vertexDeclaration:e&&i&&n&&o&&l?t=_t.vertexDeclaration:e&&i&&n&&r&&a&&s?t=Et.vertexDeclaration:e&&i&&n&&r&&a?t=yt.vertexDeclaration:e&&i&&r&&a&&s?t=Kt.vertexDeclaration:e&&i&&r&&a?t=Xt.vertexDeclaration:e&&i&&n&&r&&s?t=Ut.vertexDeclaration:e&&i&&r&&s&&h?t=ie.vertexDeclaration:e&&i&&n&&r?t=vt.vertexDeclaration:e&&i&&r&&s?t=ee.vertexDeclaration:e&&i&&r?t=Ht.vertexDeclaration:e&&i&&n&&s?t=gt.vertexDeclaration:e&&i&&n&&(t=dt.vertexDeclaration),t},v(0,t,"mesh",function(){return this._mesh}),y._attrReg=new RegExp("(\\w+)|([:,;])","g"),y}(),ue=function(){function S(){}return E(S,"laya.d3.loaders.LoadModelV02"),S.parse=function(t,e,i,n,r,a){S._mesh=i,S._materials=n,S._subMeshes=r,S._materialMap=a,S._version=e,S._readData=t,S.READ_DATA(),S.READ_BLOCK(),S.READ_STRINGS();for(var s=0,o=S._BLOCK.count;s<o;s++){S._readData.pos=S._BLOCK.blockStarts[s];var l=S._readData.getUint16(),h=S._strings[l],u=S["READ_"+h];if(null==u)throw new Error("model file err,no this function:"+l+" "+h);u.call()}S._strings.length=0,S._readData=null,S._version=null,S._mesh=null,S._materials=null,S._subMeshes=null,S._materialMap=null},S._readString=function(){return S._strings[S._readData.getUint16()]},S.READ_DATA=function(){S._DATA.offset=S._readData.getUint32(),S._DATA.size=S._readData.getUint32()},S.READ_BLOCK=function(){for(var t=S._BLOCK.count=S._readData.getUint16(),e=S._BLOCK.blockStarts=[],i=S._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(S._readData.getUint32()),i.push(S._readData.getUint32())},S.READ_STRINGS=function(){var t=S._readData.getUint32(),e=S._readData.getUint16(),i=S._readData.pos;S._readData.pos=t+S._DATA.offset;for(var n=0;n<e;n++)S._strings[n]=S._readData.readUTFString();S._readData.pos=i},S.READ_MATERIAL=function(){S._readString(),S._readString();var t=S._readString();return""!==t&&S._materials.push(kr.getRes(S._materialMap[t])),!0},S.READ_MESH=function(){S._readString();var t,e=S._readData.__getBuffer(),i=0,n=S._readData.getInt16(),r=S._DATA.offset;for(i=0;i<n;i++){var a=r+S._readData.getUint32(),s=S._readData.getUint32(),o=new Float32Array(e.slice(a,a+s)),l=S._readString().match(S._attrReg),h=S._getVertexDeclaration(l),u=ws.create(h,4*o.length/h.vertexStride,35044,!0);u.setData(o),S._mesh._vertexBuffers.push(u)}var c=r+S._readData.getUint32(),d=S._readData.getUint32(),_=new Uint16Array(e.slice(c,c+d)),f=Rs.create("ushort",d/2,35044,!0);f.setData(_),S._mesh._indexBuffer=f;var m=S._mesh._boneNames=[],p=S._readData.getUint16();for(m.length=p,i=0;i<p;i++)m[i]=S._strings[S._readData.getUint16()];var g=S._readData.getUint32(),v=S._readData.getUint32(),y=(new Float32Array(e.slice(r+g,r+g+v)),S._readData.getUint32()),x=S._readData.getUint32(),b=new Float32Array(e.slice(r+y,r+y+x));for(S._mesh._inverseBindPoses=[],i=0,t=b.length;i<t;i+=16){var T=new ye(b[i+0],b[i+1],b[i+2],b[i+3],b[i+4],b[i+5],b[i+6],b[i+7],b[i+8],b[i+9],b[i+10],b[i+11],b[i+12],b[i+13],b[i+14],b[i+15]);S._mesh._inverseBindPoses.push(T)}return S._mesh._skinnedDatas=new Float32Array(16*b.length),!0},S.READ_SUBMESH=function(){var t=S._readData.__getBuffer(),e=new Me(S._mesh),i=S._readData.getInt16(),n=S._readData.getUint32(),r=S._readData.getUint32();e._vertexBuffer=S._mesh._vertexBuffers[i],e._vertexStart=n,e._vertexCount=r;var a=S._readData.getUint32(),s=S._readData.getUint32(),o=S._mesh._indexBuffer;e._indexBuffer=o,e._indexStart=a,e._indexCount=s,e._indices=new Uint16Array(o.getData().buffer,2*a,s);var l=S._DATA.offset,h=e._subIndexBufferStart,u=e._subIndexBufferCount,c=e._boneIndicesList,d=S._readData.getUint16();h.length=d,u.length=d,c.length=d;for(var _=0;_<d;_++){h[_]=S._readData.getUint32(),u[_]=S._readData.getUint32();var f=S._readData.getUint32(),m=S._readData.getUint32();e._boneIndicesList[_]=new Uint8Array(t.slice(l+f,l+f+m))}return S._subMeshes.push(e),!0},S._getVertexDeclaration=function(t){for(var e,i=!1,n=!1,r=!1,a=!1,s=!1,o=!1,l=!1,h=!1,u=!1,c=0;c<t.length;c++)switch(t[c]){case"POSITION":i=!0;break;case"NORMAL":n=!0;break;case"COLOR":r=!0;break;case"UV":a=!0;break;case"UV1":s=!0;break;case"BLENDWEIGHT":l=!0;break;case"BLENDINDICES":h=!0;break;case"TANGENT":o=!0;break;case"BINORMAL":u=!0}return i&&n&&r&&a&&s&&l&&h&&o?e=Tt.vertexDeclaration:i&&n&&r&&a&&s&&l&&h?e=xt.vertexDeclaration:i&&n&&a&&s&&l&&h&&o?e=jt.vertexDeclaration:i&&n&&a&&s&&l&&h?e=Yt.vertexDeclaration:i&&n&&r&&a&&l&&h&&o?e=Gt.vertexDeclaration:i&&n&&r&&a&&l&&h?e=Rt.vertexDeclaration:i&&n&&a&&l&&h&&o?e=$t.vertexDeclaration:i&&n&&a&&l&&h?e=Qt.vertexDeclaration:i&&n&&r&&l&&h&&o?e=mt.vertexDeclaration:i&&n&&r&&l&&h?e=_t.vertexDeclaration:i&&n&&r&&a&&s&&o?e=Et.vertexDeclaration:i&&n&&r&&a&&s?e=yt.vertexDeclaration:i&&n&&a&&s&&o?e=Kt.vertexDeclaration:i&&n&&a&&s?e=Xt.vertexDeclaration:i&&n&&r&&a&&o?e=Ut.vertexDeclaration:i&&n&&a&&o&&u?e=ie.vertexDeclaration:i&&n&&r&&a?e=vt.vertexDeclaration:i&&n&&a&&o?e=ee.vertexDeclaration:i&&n&&a?e=Ht.vertexDeclaration:i&&n&&r&&o?e=gt.vertexDeclaration:i&&n&&r&&(e=dt.vertexDeclaration),e},S._attrReg=new RegExp("(\\w+)|([:,;])","g"),S._strings=[],S._readData=null,S._version=null,S._mesh=null,S._materials=null,S._subMeshes=null,S._materialMap=null,m(S,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),S}(),ce=function(){function b(){}return E(b,"laya.d3.loaders.LoadModelV03"),b.parse=function(t,e,i,n,r){b._mesh=i,b._subMeshes=n,b._materialMap=r,b._version=e,b._readData=t,b.READ_DATA(),b.READ_BLOCK(),b.READ_STRINGS();for(var a=0,s=b._BLOCK.count;a<s;a++){b._readData.pos=b._BLOCK.blockStarts[a];var o=b._readData.getUint16(),l=b._strings[o],h=b["READ_"+l];if(null==h)throw new Error("model file err,no this function:"+o+" "+l);h.call()}b._strings.length=0,b._readData=null,b._version=null,b._mesh=null,b._subMeshes=null,b._materialMap=null},b._readString=function(){return b._strings[b._readData.getUint16()]},b.READ_DATA=function(){b._DATA.offset=b._readData.getUint32(),b._DATA.size=b._readData.getUint32()},b.READ_BLOCK=function(){for(var t=b._BLOCK.count=b._readData.getUint16(),e=b._BLOCK.blockStarts=[],i=b._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(b._readData.getUint32()),i.push(b._readData.getUint32())},b.READ_STRINGS=function(){var t=b._readData.getUint32(),e=b._readData.getUint16(),i=b._readData.pos;b._readData.pos=t+b._DATA.offset;for(var n=0;n<e;n++)b._strings[n]=b._readData.readUTFString();b._readData.pos=i},b.READ_MESH=function(){b._readString();var t,e=b._readData.__getBuffer(),i=0,n=b._readData.getInt16(),r=b._DATA.offset;for(i=0;i<n;i++){var a,s=r+b._readData.getUint32(),o=b._readData.getUint32(),l=new Float32Array(e.slice(s,s+o)),h=b._readString();switch(b._version){case"LAYAMODEL:03":a=b._vertexDeclarationMap_Discard[h];break;case"LAYAMODEL:0301":a=b._vertexDeclarationMap[h];break;default:throw new Error("LoadModelV03: unknown version.")}if(!a)throw new Error("LoadModelV03: unknown vertexDeclaration.");var u=ws.create(a,4*l.length/a.vertexStride,35044,!0);u.setData(l),b._mesh._vertexBuffers.push(u)}var c=r+b._readData.getUint32(),d=b._readData.getUint32(),_=new Uint16Array(e.slice(c,c+d)),f=Rs.create("ushort",d/2,35044,!0);f.setData(_),b._mesh._indexBuffer=f;var m=b._mesh._boneNames=[],p=b._readData.getUint16();for(m.length=p,i=0;i<p;i++)m[i]=b._strings[b._readData.getUint16()];b._readData.pos+=8;var g=b._readData.getUint32(),v=b._readData.getUint32(),y=new Float32Array(e.slice(r+g,r+g+v));for(b._mesh._inverseBindPoses=[],i=0,t=y.length;i<t;i+=16){var x=new ye(y[i+0],y[i+1],y[i+2],y[i+3],y[i+4],y[i+5],y[i+6],y[i+7],y[i+8],y[i+9],y[i+10],y[i+11],y[i+12],y[i+13],y[i+14],y[i+15]);b._mesh._inverseBindPoses.push(x)}return b._mesh._skinnedDatas=new Float32Array(16*y.length),!0},b.READ_SUBMESH=function(){var t=b._readData.__getBuffer(),e=new Me(b._mesh),i=b._readData.getInt16(),n=b._readData.getUint32(),r=b._readData.getUint32();e._vertexBuffer=b._mesh._vertexBuffers[i],e._vertexStart=n,e._vertexCount=r;var a=b._readData.getUint32(),s=b._readData.getUint32(),o=b._mesh._indexBuffer;e._indexBuffer=o,e._indexStart=a,e._indexCount=s,e._indices=new Uint16Array(o.getData().buffer,2*a,s);var l=b._DATA.offset,h=e._subIndexBufferStart,u=e._subIndexBufferCount,c=e._boneIndicesList,d=b._readData.getUint16();h.length=d,u.length=d,c.length=d;for(var _=0;_<d;_++){h[_]=b._readData.getUint32(),u[_]=b._readData.getUint32();var f=b._readData.getUint32(),m=b._readData.getUint32();c[_]=new Uint8Array(t.slice(l+f,l+f+m))}return b._subMeshes.push(e),!0},b._strings=[],b._readData=null,b._version=null,b._mesh=null,b._subMeshes=null,b._materialMap=null,m(b,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":Tt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":xt.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":ne.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":jt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":Yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Gt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":Rt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$t.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":Qt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":mt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":_t.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":Et.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":yt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":Kt.vertexDeclaration,"POSITION,NORMAL,UV,UV1":Xt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":Ut.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":ie.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":vt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":ee.vertexDeclaration,"POSITION,NORMAL,UV":Ht.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":gt.vertexDeclaration,"POSITION,NORMAL,COLOR":dt.vertexDeclaration,"POSITION,NORMAL,TANGENT":kt.vertexDeclaration,"POSITION,NORMAL":ct.vertexDeclaration,"POSITION,UV":se.vertexDeclaration,POSITION:ut.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":bt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":xt.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":ne.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":zt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":Yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Bt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":Rt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":qt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":Qt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":ft.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":_t.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":St.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":yt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":Jt.vertexDeclaration,"POSITION,NORMAL,UV,UV1":Xt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":Wt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":ie.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":vt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":te.vertexDeclaration,"POSITION,NORMAL,UV":Ht.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":pt.vertexDeclaration,"POSITION,NORMAL,COLOR":dt.vertexDeclaration,"POSITION,NORMAL,TANGENT":Zt.vertexDeclaration,"POSITION,NORMAL":ct.vertexDeclaration,"POSITION,UV":se.vertexDeclaration,POSITION:ut.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),b}(),de=function(){function o(){}return E(o,"laya.d3.loaders.MeshReader"),o.read=function(t,e,i,n,r){var a=new yn(t);a.pos=0;var s=a.readUTFString();switch(s){case"LAYAMODEL:01":case"LAYASKINANI:01":o._readVersion01(a,s,e,i,n,r);break;case"LAYAMODEL:02":ue.parse(a,s,e,i,n,r);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":ce.parse(a,s,e,n,r);break;default:throw new Error("MeshReader: unknown mesh version.")}e._setSubMeshes(n)},o._readVersion01=function(t,e,i,n,r,a){new he(t,e,i,n,r,a)},o}(),_e=function(){function t(t,e){this.min=null,this.max=null,this.min=t,this.max=e}E(t,"laya.d3.math.BoundBox");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.getCorners=function(t){t.length=8;var e=this.min.elements,i=this.max.elements,n=e[0],r=e[1],a=e[2],s=i[0],o=i[1],l=i[2];t[0]=new we(n,o,l),t[1]=new we(s,o,l),t[2]=new we(s,r,l),t[3]=new we(n,r,l),t[4]=new we(n,o,a),t[5]=new we(s,o,a),t[6]=new we(s,r,a),t[7]=new we(n,r,a)},e.toDefault=function(){this.min.toDefault(),this.max.toDefault()},e.cloneTo=function(t){var e=t;this.min.cloneTo(e.min),this.max.cloneTo(e.max)},e.clone=function(){var t=new this.constructor(new we,new we);return this.cloneTo(t),t},t.createfromPoints=function(t,e){if(null==t)throw new Error("points");var i=e.min,n=e.max,r=i.elements;r[0]=Number.MAX_VALUE,r[1]=Number.MAX_VALUE,r[2]=Number.MAX_VALUE;var a=n.elements;a[0]=-Number.MAX_VALUE,a[1]=-Number.MAX_VALUE,a[2]=-Number.MAX_VALUE;for(var s=0,o=t.length;s<o;++s)we.min(i,t[s],i),we.max(n,t[s],n)},t.merge=function(t,e,i){we.min(t.min,e.min,i.min),we.max(t.max,e.max,i.max)},t}(),fe=function(){function h(t){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=t,this._near=new be(new we),this._far=new be(new we),this._left=new be(new we),this._right=new be(new we),this._top=new be(new we),this._bottom=new be(new we),h._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}E(h,"laya.d3.math.BoundFrustum");var t=h.prototype;return t.equalsBoundFrustum=function(t){return this._matrix.equalsOtherMatrix(t.matrix)},t.equalsObj=function(t){if(t instanceof laya.d3.math.BoundFrustum){var e=t;return this.equalsBoundFrustum(e)}return!1},t.getPlane=function(t){switch(t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},t.getCorners=function(t){h._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(t[0]),h._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(t[1]),h._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(t[2]),h._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(t[3]),h._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(t[4]),h._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(t[5]),h._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(t[6]),h._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(t[7])},t.containsPoint=function(t){for(var e=be.PlaneIntersectionType_Front,i=be.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=pe.intersectsPlaneAndPoint(this._near,t);break;case 1:i=pe.intersectsPlaneAndPoint(this._far,t);break;case 2:i=pe.intersectsPlaneAndPoint(this._left,t);break;case 3:i=pe.intersectsPlaneAndPoint(this._right,t);break;case 4:i=pe.intersectsPlaneAndPoint(this._top,t);break;case 5:i=pe.intersectsPlaneAndPoint(this._bottom,t)}switch(i){case be.PlaneIntersectionType_Back:return 0;case be.PlaneIntersectionType_Intersecting:e=be.PlaneIntersectionType_Intersecting}}switch(e){case be.PlaneIntersectionType_Intersecting:return 2;default:return 1}},t.containsBoundBox=function(t){for(var e,i=h._tempV30,n=h._tempV31,r=1,a=0;a<6;a++){if(e=this.getPlane(a),this._getBoxToPlanePVertexNVertex(t,e.normal,i,n),pe.intersectsPlaneAndPoint(e,i)===be.PlaneIntersectionType_Back)return 0;pe.intersectsPlaneAndPoint(e,n)===be.PlaneIntersectionType_Back&&(r=2)}return r},t.containsBoundSphere=function(t){for(var e=be.PlaneIntersectionType_Front,i=be.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=pe.intersectsPlaneAndSphere(this._near,t);break;case 1:i=pe.intersectsPlaneAndSphere(this._far,t);break;case 2:i=pe.intersectsPlaneAndSphere(this._left,t);break;case 3:i=pe.intersectsPlaneAndSphere(this._right,t);break;case 4:i=pe.intersectsPlaneAndSphere(this._top,t);break;case 5:i=pe.intersectsPlaneAndSphere(this._bottom,t)}switch(i){case be.PlaneIntersectionType_Back:return 0;case be.PlaneIntersectionType_Intersecting:e=be.PlaneIntersectionType_Intersecting}}switch(e){case be.PlaneIntersectionType_Intersecting:return 2;default:return 1}},t._getBoxToPlanePVertexNVertex=function(t,e,i,n){var r=t.min,a=r.elements,s=t.max,o=s.elements,l=e.elements,h=l[0],u=l[1],c=l[2];r.cloneTo(i);var d=i.elements;0<=h&&(d[0]=o[0]),0<=u&&(d[1]=o[1]),0<=c&&(d[2]=o[2]),s.cloneTo(n);var _=n.elements;0<=h&&(_[0]=a[0]),0<=u&&(_[1]=a[1]),0<=c&&(_[2]=a[2])},v(0,t,"top",function(){return this._top}),v(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t,h._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),v(0,t,"near",function(){return this._near}),v(0,t,"far",function(){return this._far}),v(0,t,"left",function(){return this._left}),v(0,t,"right",function(){return this._right}),v(0,t,"bottom",function(){return this._bottom}),h._getPlanesFromMatrix=function(t,e,i,n,r,a,s){var o=t.elements,l=o[0],h=o[1],u=o[2],c=o[3],d=o[4],_=o[5],f=o[6],m=o[7],p=o[8],g=o[9],v=o[10],y=o[11],x=o[12],b=o[13],T=o[14],S=o[15],E=e.normal.elements;E[0]=c+u,E[1]=m+f,E[2]=y+v,e.distance=S+T,e.normalize();var R=i.normal.elements;R[0]=c-u,R[1]=m-f,R[2]=y-v,i.distance=S-T,i.normalize();var w=n.normal.elements;w[0]=c+l,w[1]=m+d,w[2]=y+p,n.distance=S+x,n.normalize();var C=r.normal.elements;C[0]=c-l,C[1]=m-d,C[2]=y-p,r.distance=S-x,r.normalize();var I=a.normal.elements;I[0]=c-h,I[1]=m-_,I[2]=y-g,a.distance=S-b,a.normalize();var M=s.normal.elements;M[0]=c+h,M[1]=m+_,M[2]=y+g,s.distance=S+b,s.normalize()},h._get3PlaneInterPoint=function(t,e,i){var n=t.normal,r=e.normal,a=i.normal;we.cross(r,a,h._tempV30),we.cross(a,n,h._tempV31),we.cross(n,r,h._tempV32);var s=we.dot(n,h._tempV30),o=we.dot(r,h._tempV31),l=we.dot(a,h._tempV32);return we.scale(h._tempV30,-t.distance/s,h._tempV33),we.scale(h._tempV31,-e.distance/o,h._tempV34),we.scale(h._tempV32,-i.distance/l,h._tempV35),we.add(h._tempV33,h._tempV34,h._tempV36),we.add(h._tempV35,h._tempV36,h._tempV37),h._tempV37},m(h,["_tempV30",function(){return this._tempV30=new we},"_tempV31",function(){return this._tempV31=new we},"_tempV32",function(){return this._tempV32=new we},"_tempV33",function(){return this._tempV33=new we},"_tempV34",function(){return this._tempV34=new we},"_tempV35",function(){return this._tempV35=new we},"_tempV36",function(){return this._tempV36=new we},"_tempV37",function(){return this._tempV37=new we}]),h}(),me=function(){function u(t,e){this.center=null,this.radius=NaN,this.center=t,this.radius=e}E(u,"laya.d3.math.BoundSphere");var t=u.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.toDefault=function(){this.center.toDefault(),this.radius=0},t.intersectsRayDistance=function(t){return pe.intersectsRayAndSphereRD(t,this)},t.intersectsRayPoint=function(t,e){return pe.intersectsRayAndSphereRP(t,this,e)},t.cloneTo=function(t){var e=t;this.center.cloneTo(e.center),e.radius=this.radius},t.clone=function(){var t=new this.constructor(new we,new we);return this.cloneTo(t),t},u.createFromSubPoints=function(t,e,i,n){if(null==t)throw new Error("points");if(e<0||e>=t.length)throw new Error("start"+e+"Must be in the range [0, "+(t.length-1)+"]");if(i<0||e+i>t.length)throw new Error("count"+i+"Must be in the range <= "+t.length+"}");var r=e+i,a=u._tempVector3;a.elements[0]=0,a.elements[1]=0,a.elements[2]=0;for(var s=e;s<r;++s)we.add(t[s],a,a);var o=n.center;we.scale(a,1/i,o);var l=0;for(s=e;s<r;++s){var h=we.distanceSquared(o,t[s]);l<h&&(l=h)}n.radius=Math.sqrt(l)},u.createfromPoints=function(t,e){if(null==t)throw new Error("points");u.createFromSubPoints(t,0,t.length,e)},m(u,["_tempVector3",function(){return this._tempVector3=new we}]),u}(),pe=function(){function K(){}return E(K,"laya.d3.math.Collision"),K.distancePlaneToPoint=function(t,e){return we.dot(t.normal,e)-t.distance},K.distanceBoxToPoint=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],u=e.elements,c=u[0],d=u[1],_=u[2],f=0;return c<n&&(f+=(n-c)*(n-c)),o<c&&(f+=(o-c)*(o-c)),d<r&&(f+=(r-d)*(r-d)),l<d&&(f+=(l-d)*(l-d)),_<a&&(f+=(a-_)*(a-_)),h<_&&(f+=(h-_)*(h-_)),Math.sqrt(f)},K.distanceBoxToBox=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],u=e.min.elements,c=u[0],d=u[1],_=u[2],f=e.max.elements,m=f[0],p=f[1],g=f[2],v=0,y=NaN;return m<n?v+=(y=n-m)*y:o<c&&(v+=(y=c-o)*y),p<r?v+=(y=r-p)*y:l<d&&(v+=(y=d-l)*y),g<a?v+=(y=a-g)*y:h<_&&(v+=(y=_-h)*y),Math.sqrt(v)},K.distanceSphereToPoint=function(t,e){var i=Math.sqrt(we.distanceSquared(t.center,e));return i-=t.radius,Math.max(i,0)},K.distanceSphereToSphere=function(t,e){var i=Math.sqrt(we.distanceSquared(t.center,e.center));return i-=t.radius+e.radius,Math.max(i,0)},K.intersectsRayAndTriangleRD=function(t,e,i,n,r){var a=t.origin.elements,s=a[0],o=a[1],l=a[2],h=t.direction.elements,u=h[0],c=h[1],d=h[2],_=e.elements,f=_[0],m=_[1],p=_[2],g=i.elements,v=g[0],y=g[1],x=g[2],b=n.elements,T=b[0],S=b[1],E=b[2],R=K._tempV30.elements,w=R[0],C=R[1],I=R[2];w=v-f,C=y-m,I=x-p;var M=K._tempV31.elements,A=M[0],D=M[1],L=M[2];A=T-f,D=S-m,L=E-p;var V=K._tempV32.elements,N=V[0],P=V[1],F=V[2],O=w*(N=c*L-d*D)+C*(P=d*A-u*L)+I*(F=u*D-c*A);if(ge.isZero(O))return 0,!1;var B=1/O,G=K._tempV33.elements,W=G[0],U=G[1],Z=G[2],k=(W=s-f)*N+(U=o-m)*P+(Z=l-p)*F;if((k*=B)<0||1<k)return 0,!1;var H=K._tempV34.elements,X=H[0],Y=H[1],z=H[2],j=u*(X=U*I-Z*C)+c*(Y=Z*w-W*I)+d*(z=W*C-U*w);if((j*=B)<0||1<k+j)return 0,!1;var J=A*X+D*Y+L*z;return(J*=B)<0?(0,!1):(J,!0)},K.intersectsRayAndTriangleRP=function(t,e,i,n,r){return K.intersectsRayAndTriangleRD(t,e,i,n,NaN)?(we.scale(t.direction,NaN,K._tempV30),we.add(t.origin,K._tempV30,r),!0):(r=we.ZERO,!1)},K.intersectsRayAndPoint=function(t,e){we.subtract(t.origin,e,K._tempV30);var i=we.dot(K._tempV30,t.direction),n=we.dot(K._tempV30,K._tempV30)-ge.zeroTolerance;return!(0<n&&0<i)&&!(i*i-n<0)},K.intersectsRayAndRay=function(t,e,i){var n=t.origin,r=n.elements,a=r[0],s=r[1],o=r[2],l=t.direction,h=l.elements,u=h[0],c=h[1],d=h[2],_=e.origin,f=_.elements,m=f[0],p=f[1],g=f[2],v=e.direction,y=v.elements,x=y[0],b=y[1],T=y[2];we.cross(l,v,K._tempV30);var S=K._tempV30.elements,E=we.scalarLengthSquared(K._tempV30);if(ge.isZero(E)&&ge.nearEqual(m,a)&&ge.nearEqual(p,s)&&ge.nearEqual(g,o))return we.ZERO.cloneTo(i),!0;var R=m-a,w=p-s,C=g-o,I=x,M=b,A=T,D=S[0],L=S[1],V=S[2],N=(R*M*V+w*A*D+C*I*L-R*A*L-w*I*V-C*M*D)/E,P=(R*(M=c)*V+w*(A=d)*D+C*(I=u)*L-R*A*L-w*I*V-C*M*D)/E;we.scale(l,N,K._tempV30),we.scale(v,P,K._tempV31),we.add(n,K._tempV30,K._tempV32),we.add(_,K._tempV31,K._tempV33);var F=K._tempV32.elements,O=K._tempV33.elements;return ge.nearEqual(O[0],F[0])&&ge.nearEqual(O[1],F[1])&&ge.nearEqual(O[2],F[2])?(K._tempV32.cloneTo(i),!0):(we.ZERO.cloneTo(i),!1)},K.intersectsPlaneAndTriangle=function(t,e,i,n){var r=K.intersectsPlaneAndPoint(t,e),a=K.intersectsPlaneAndPoint(t,i),s=K.intersectsPlaneAndPoint(t,n);return r==be.PlaneIntersectionType_Front&&a==be.PlaneIntersectionType_Front&&s==be.PlaneIntersectionType_Front?be.PlaneIntersectionType_Front:r==be.PlaneIntersectionType_Back&&a==be.PlaneIntersectionType_Back&&s==be.PlaneIntersectionType_Back?be.PlaneIntersectionType_Back:be.PlaneIntersectionType_Intersecting},K.intersectsRayAndPlaneRD=function(t,e,i){var n=e.normal,r=we.dot(n,t.direction),a=NaN;if(ge.isZero(r))return a=0,!1;var s=we.dot(n,t.origin);return a=(-e.distance-s)/r,!((i.x=a)<0)||(i.x=0,!1)},K.intersectsRayAndPlaneRP=function(t,e,i){var n=new Re;return K.intersectsRayAndPlaneRD(t,e,n)?(we.scale(t.direction,n.x,K._tempV30),we.add(t.origin,K._tempV30,K._tempV31),K._tempV31.cloneTo(i),!0):(we.ZERO.cloneTo(i),!1)},K.intersectsRayAndBoxRD=function(t,e){var i=t.origin.elements,n=i[0],r=i[1],a=i[2],s=t.direction.elements,o=s[0],l=s[1],h=s[2],u=e.min.elements,c=u[0],d=u[1],_=u[2],f=e.max.elements,m=f[0],p=f[1],g=f[2],v=0,y=ge.MaxValue;if(ge.isZero(o)){if(n<c||m<n)return-1}else{var x=1/o,b=(c-n)*x,T=(m-n)*x;if(T<b){var S=b;b=T,T=S}if(v=Math.max(b,v),(y=Math.min(T,y))<v)return-1}if(ge.isZero(l)){if(r<d||p<r)return-1}else{var E=1/l,R=(d-r)*E,w=(p-r)*E;if(w<R){var C=R;R=w,w=C}if(v=Math.max(R,v),(y=Math.min(w,y))<v)return-1}if(ge.isZero(h)){if(a<_||g<a)return-1}else{var I=1/h,M=(_-a)*I,A=(g-a)*I;if(A<M){var D=M;M=A,A=D}if(v=Math.max(M,v),(y=Math.min(A,y))<v)return-1}return v},K.intersectsRayAndBoxRP=function(t,e,i){var n=K.intersectsRayAndBoxRD(t,e);return-1===n?we.ZERO.cloneTo(i):(we.scale(t.direction,n,K._tempV30),we.add(t.origin,K._tempV30,K._tempV31),K._tempV31.cloneTo(i)),n},K.intersectsRayAndSphereRD=function(t,e){var i=e.radius;we.subtract(t.origin,e.center,K._tempV30);var n=we.dot(K._tempV30,t.direction),r=we.dot(K._tempV30,K._tempV30)-i*i;if(0<r&&0<n)return-1;var a=n*n-r;if(a<0)return-1;var s=-n-Math.sqrt(a);return s<0&&(s=0),s},K.intersectsRayAndSphereRP=function(t,e,i){var n=K.intersectsRayAndSphereRD(t,e);return-1===n?we.ZERO.cloneTo(i):(we.scale(t.direction,n,K._tempV30),we.add(t.origin,K._tempV30,K._tempV31),K._tempV31.cloneTo(i)),n},K.intersectsSphereAndTriangle=function(t,e,i,n){var r=t.center,a=t.radius;return K.closestPointPointTriangle(r,e,i,n,K._tempV30),we.subtract(K._tempV30,r,K._tempV31),we.dot(K._tempV31,K._tempV31)<=a*a},K.intersectsPlaneAndPoint=function(t,e){var i=we.dot(t.normal,e)+t.distance;return 0<i?be.PlaneIntersectionType_Front:i<0?be.PlaneIntersectionType_Back:be.PlaneIntersectionType_Intersecting},K.intersectsPlaneAndPlane=function(t,e){we.cross(t.normal,e.normal,K._tempV30);var i=we.dot(K._tempV30,K._tempV30);return!ge.isZero(i)},K.intersectsPlaneAndPlaneRL=function(t,e,i){var n=t.normal,r=e.normal;we.cross(n,r,K._tempV34);var a=we.dot(K._tempV34,K._tempV34);return!ge.isZero(a)&&(we.scale(r,t.distance,K._tempV30),we.scale(n,e.distance,K._tempV31),we.subtract(K._tempV30,K._tempV31,K._tempV32),we.cross(K._tempV32,K._tempV34,K._tempV33),we.normalize(K._tempV34,K._tempV34),new Ee(K._tempV33,K._tempV34),!0)},K.intersectsPlaneAndBox=function(t,e){var i=t.distance,n=t.normal,r=n.elements,a=r[0],s=r[1],o=r[2],l=e.min.elements,h=l[0],u=l[1],c=l[2],d=e.max.elements,_=d[0],f=d[1],m=d[2];K._tempV30.elements[0]=0<a?h:_,K._tempV30.elements[1]=0<s?u:f,K._tempV30.elements[2]=0<o?c:m,K._tempV31.elements[0]=0<a?_:h,K._tempV31.elements[1]=0<s?f:u,K._tempV31.elements[2]=0<o?m:c;var p=we.dot(n,K._tempV30);return 0<p+i?be.PlaneIntersectionType_Front:(p=we.dot(n,K._tempV31))+i<0?be.PlaneIntersectionType_Back:be.PlaneIntersectionType_Intersecting},K.intersectsPlaneAndSphere=function(t,e){var i=e.radius,n=we.dot(t.normal,e.center)+t.distance;return i<n?be.PlaneIntersectionType_Front:n<-i?be.PlaneIntersectionType_Back:be.PlaneIntersectionType_Intersecting},K.intersectsBoxAndBox=function(t,e){var i=t.min.elements,n=t.max.elements,r=e.min.elements,a=e.max.elements;return!(i[0]>a[0]||r[0]>n[0])&&(!(i[1]>a[1]||r[1]>n[1])&&!(i[2]>a[2]||r[2]>n[2]))},K.intersectsBoxAndSphere=function(t,e){var i=e.center,n=e.radius;return we.Clamp(i,t.min,t.max,K._tempV30),we.distanceSquared(i,K._tempV30)<=n*n},K.intersectsSphereAndSphere=function(t,e){var i=t.radius+e.radius;return we.distanceSquared(t.center,e.center)<=i*i},K.boxContainsPoint=function(t,e){var i=t.min.elements,n=t.max.elements,r=e.elements;return i[0]<=r[0]&&n[0]>=r[0]&&i[1]<=r[1]&&n[1]>=r[1]&&i[2]<=r[2]&&n[2]>=r[2]?1:0},K.boxContainsBox=function(t,e){var i=t.min.elements,n=i[0],r=i[1],a=i[2],s=t.max.elements,o=s[0],l=s[1],h=s[2],u=e.min.elements,c=u[0],d=u[1],_=u[2],f=e.max.elements,m=f[0],p=f[1],g=f[2];return o<c||m<n?0:l<d||p<r?0:h<_||g<a?0:n<=c&&m<=m&&r<=d&&p<=l&&a<=_&&g<=h?1:2},K.boxContainsSphere=function(t,e){var i=t.min,n=i.elements,r=n[0],a=n[1],s=n[2],o=t.max,l=o.elements,h=l[0],u=l[1],c=l[2],d=e.center,_=d.elements,f=_[0],m=_[1],p=_[2],g=e.radius;return we.Clamp(d,i,o,K._tempV30),g*g<we.distanceSquared(d,K._tempV30)?0:r+g<=f&&f<=h-g&&g<h-r&&a+g<=m&&m<=u-g&&g<u-a&&s+g<=p&&p<=c-g&&g<c-s?1:2},K.sphereContainsPoint=function(t,e){return we.distanceSquared(e,t.center)<=t.radius*t.radius?1:0},K.sphereContainsTriangle=function(t,e,i,n){var r=K.sphereContainsPoint(t,e),a=K.sphereContainsPoint(t,i),s=K.sphereContainsPoint(t,n);return 1==r&&1==a&&1==s?1:K.intersectsSphereAndTriangle(t,e,i,n)?2:0},K.sphereContainsBox=function(t,e){var i=t.center.elements,n=i[0],r=i[1],a=i[2],s=t.radius,o=e.min.elements,l=o[0],h=o[1],u=o[2],c=e.max.elements,d=c[0],_=c[1],f=c[2],m=K._tempV30.elements;m[0],m[1],m[2];if(!K.intersectsBoxAndSphere(e,t))return 0;var p=s*s;return n-l,r-_,a-f,we.scalarLengthSquared(K._tempV30)>p?2:(n-d,r-_,a-f,we.scalarLengthSquared(K._tempV30)>p?2:(n-d,r-h,a-f,we.scalarLengthSquared(K._tempV30)>p?2:(n-l,r-h,a-f,we.scalarLengthSquared(K._tempV30)>p?2:(n-l,r-_,a-u,we.scalarLengthSquared(K._tempV30)>p?2:(n-d,r-_,a-u,we.scalarLengthSquared(K._tempV30)>p?2:(n-d,r-h,a-u,we.scalarLengthSquared(K._tempV30)>p?2:(n-l,r-h,a-u,we.scalarLengthSquared(K._tempV30)>p?2:1)))))))},K.sphereContainsSphere=function(t,e){var i=t.radius,n=e.radius,r=we.distance(t.center,e.center);return i+n<r?0:i-n<r?2:1},K.closestPointPointTriangle=function(t,e,i,n,r){we.subtract(i,e,K._tempV30),we.subtract(n,e,K._tempV31),we.subtract(t,e,K._tempV32),we.subtract(t,i,K._tempV33),we.subtract(t,n,K._tempV34);var a=we.dot(K._tempV30,K._tempV32),s=we.dot(K._tempV31,K._tempV32),o=we.dot(K._tempV30,K._tempV33),l=we.dot(K._tempV31,K._tempV33),h=we.dot(K._tempV30,K._tempV34),u=we.dot(K._tempV31,K._tempV34);if(a<=0&&s<=0)e.cloneTo(r);else if(0<=o&&l<=o)i.cloneTo(r);else{var c=a*l-o*s;if(c<=0&&0<=a&&o<=0){var d=a/(a-o);return we.scale(K._tempV30,d,r),void we.add(e,r,r)}if(0<=u&&h<=u)n.cloneTo(r);else{var _=h*s-a*u;if(_<=0&&0<=s&&u<=0){var f=s/(s-u);return we.scale(K._tempV31,f,r),void we.add(e,r,r)}var m=o*u-h*l;if(m<=0&&0<=l-o&&0<=h-u){var p=(l-o)/(l-o+(h-u));return we.subtract(n,i,r),we.scale(r,p,r),void we.add(i,r,r)}var g=1/(m+_+c),v=_*g,y=c*g;we.scale(K._tempV30,v,K._tempV35),we.scale(K._tempV31,y,K._tempV36),we.add(K._tempV35,K._tempV36,r),we.add(e,r,r)}}},K.closestPointPlanePoint=function(t,e,i){var n=t.normal,r=we.dot(n,e)-t.distance;we.scale(n,r,K._tempV30),we.subtract(e,K._tempV30,i)},K.closestPointBoxPoint=function(t,e,i){we.max(e,t.min,K._tempV30),we.min(K._tempV30,t.max,i)},K.closestPointSpherePoint=function(t,e,i){var n=t.center;we.subtract(e,n,i),we.normalize(i,i),we.scale(i,t.radius,i),we.add(i,n,i)},K.closestPointSphereSphere=function(t,e,i){var n=t.center;we.subtract(e.center,n,i),we.normalize(i,i),we.scale(i,t.radius,i),we.add(i,n,i)},m(K,["_tempV30",function(){return this._tempV30=new we},"_tempV31",function(){return this._tempV31=new we},"_tempV32",function(){return this._tempV32=new we},"_tempV33",function(){return this._tempV33=new we},"_tempV34",function(){return this._tempV34=new we},"_tempV35",function(){return this._tempV35=new we},"_tempV36",function(){return this._tempV36=new we}]),K}(),ge=(function(){function t(){}E(t,"laya.d3.math.ContainmentType"),t.Disjoint=0,t.Contains=1,t.Intersects=2}(),function(){function i(){}return E(i,"laya.d3.math.MathUtils3D"),i.isZero=function(t){return Math.abs(t)<i.zeroTolerance},i.nearEqual=function(t,e){return!!i.isZero(t-e)},i.fastInvSqrt=function(t){return i.isZero(t)?t:1/Math.sqrt(t)},m(i,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),i}()),ve=function(){function l(){var t=this.elements=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}E(l,"laya.d3.math.Matrix3x3");var t=l.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.determinant=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8];return e*(h*a-s*l)+i*(-h*r+s*o)+n*(l*r-a*o)},t.translate=function(t,e){var i=e.elements,n=this.elements,r=t.elements,a=n[0],s=n[1],o=n[2],l=n[3],h=n[4],u=n[5],c=n[6],d=n[7],_=n[8],f=r[0],m=r[1];i[0]=a,i[1]=s,i[2]=o,i[3]=l,i[4]=h,i[5]=u,i[6]=f*a+m*l+c,i[7]=f*s+m*h+d,i[8]=f*o+m*u+_},t.rotate=function(t,e){var i=e.elements,n=this.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],h=n[5],u=n[6],c=n[7],d=n[8],_=Math.sin(t),f=Math.cos(t);i[0]=f*r+_*o,i[1]=f*a+_*l,i[2]=f*s+_*h,i[3]=f*o-_*r,i[4]=f*l-_*a,i[5]=f*h-_*s,i[6]=u,i[7]=c,i[8]=d},t.scale=function(t,e){var i=e.elements,n=this.elements,r=t.elements,a=r[0],s=r[1];i[0]=a*n[0],i[1]=a*n[1],i[2]=a*n[2],i[3]=s*n[3],i[4]=s*n[4],i[5]=s*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8]},t.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],u=i[7],c=i[8],d=c*o-l*u,_=-c*s+l*h,f=u*s-o*h,m=n*d+r*_+a*f;m||(t=null),m=1/m,e[0]=d*m,e[1]=(-c*r+a*u)*m,e[2]=(l*r-a*o)*m,e[3]=_*m,e[4]=(c*n-a*h)*m,e[5]=(-l*n+a*s)*m,e[6]=f*m,e[7]=(-u*n+r*h)*m,e[8]=(o*n-r*s)*m},t.transpose=function(t){var e=t.elements,i=this.elements;if(t===this){var n=i[1],r=i[2],a=i[5];e[1]=i[3],e[2]=i[6],e[3]=n,e[5]=i[7],e[6]=r,e[7]=a}else e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8]},t.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<9;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},l.createFromTranslation=function(t,e){e.elements;var i=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=i[0],e[7]=i[1],e[8]=1},l.createFromRotation=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[0]=r,i[1]=n,i[2]=0,i[3]=-n,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1},l.createFromScaling=function(t,e){var i=e.elements,n=t.elements;i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1},l.createFromMatrix4x4=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},l.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],l=r[2],h=r[3],u=r[4],c=r[5],d=r[6],_=r[7],f=r[8],m=a[0],p=a[1],g=a[2],v=a[3],y=a[4],x=a[5],b=a[6],T=a[7],S=a[8];n[0]=m*s+p*h+g*d,n[1]=m*o+p*u+g*_,n[2]=m*l+p*c+g*f,n[3]=v*s+y*h+x*d,n[4]=v*o+y*u+x*_,n[5]=v*l+y*c+x*f,n[6]=b*s+T*h+S*d,n[7]=b*o+T*u+S*_,n[8]=b*l+T*c+S*f},l.lookAt=function(t,e,i,n){we.subtract(t,e,l._tempV30),we.normalize(l._tempV30,l._tempV30),we.cross(i,l._tempV30,l._tempV31),we.normalize(l._tempV31,l._tempV31),we.cross(l._tempV30,l._tempV31,l._tempV32);var r=l._tempV30.elements,a=l._tempV31.elements,s=l._tempV32.elements,o=n.elements;o[0]=a[0],o[3]=a[1],o[6]=a[2],o[1]=s[0],o[4]=s[1],o[7]=s[2],o[2]=r[0],o[5]=r[1],o[8]=r[2]},l.DEFAULT=new l,m(l,["_tempV30",function(){return this._tempV30=new we},"_tempV31",function(){return this._tempV31=new we},"_tempV32",function(){return this._tempV32=new we}]),l}(),ye=function(){function R(t,e,i,n,r,a,s,o,l,h,u,c,d,_,f,m){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===u&&(u=1),void 0===c&&(c=0),void 0===d&&(d=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===m&&(m=1);var p=this.elements=new Float32Array(16);p[0]=t,p[1]=e,p[2]=i,p[3]=n,p[4]=r,p[5]=a,p[6]=s,p[7]=o,p[8]=l,p[9]=h,p[10]=u,p[11]=c,p[12]=d,p[13]=_,p[14]=f,p[15]=m}E(R,"laya.d3.math.Matrix4x4");var t=R.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.getElementByRowColumn=function(t,e){if(t<0||3<t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||3<e)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*t+e]},t.setElementByRowColumn=function(t,e,i){if(t<0||3<t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||3<e)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*t+e]=i},t.equalsOtherMatrix=function(t){var e=this.elements,i=t.elements;return ge.nearEqual(e[0],i[0])&&ge.nearEqual(e[1],i[1])&&ge.nearEqual(e[2],i[2])&&ge.nearEqual(e[3],i[3])&&ge.nearEqual(e[4],i[4])&&ge.nearEqual(e[5],i[5])&&ge.nearEqual(e[6],i[6])&&ge.nearEqual(e[7],i[7])&&ge.nearEqual(e[8],i[8])&&ge.nearEqual(e[9],i[9])&&ge.nearEqual(e[10],i[10])&&ge.nearEqual(e[11],i[11])&&ge.nearEqual(e[12],i[12])&&ge.nearEqual(e[13],i[13])&&ge.nearEqual(e[14],i[14])&&ge.nearEqual(e[15],i[15])},t.decomposeTransRotScale=function(t,e,i){var n=R._tempMatrix4x4;return this.decomposeTransRotMatScale(t,n,i)?(Te.createFromMatrix4x4(n,e),!0):(e.identity(),!1)},t.decomposeTransRotMatScale=function(t,e,i){var n=this.elements,r=t.elements,a=e.elements,s=i.elements;r[0]=n[12],r[1]=n[13],r[2]=n[14];var o=n[0],l=n[1],h=n[2],u=n[4],c=n[5],d=n[6],_=n[8],f=n[9],m=n[10],p=s[0]=Math.sqrt(o*o+l*l+h*h),g=s[1]=Math.sqrt(u*u+c*c+d*d),v=s[2]=Math.sqrt(_*_+f*f+m*m);if(ge.isZero(p)||ge.isZero(g)||ge.isZero(v))return a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[11]=a[12]=a[13]=a[14]=0,a[0]=a[5]=a[10]=a[15]=1,!1;var y=R._tempVector0,x=y.elements;x[0]=_/v,x[1]=f/v,x[2]=m/v;var b=R._tempVector1,T=b.elements;T[0]=o/p,T[1]=l/p,T[2]=h/p;var S=R._tempVector2;we.cross(y,b,S);var E=R._tempVector1;return we.cross(S,y,E),a[3]=a[7]=a[11]=a[12]=a[13]=a[14]=0,a[15]=1,a[0]=E.x,a[1]=E.y,a[2]=E.z,a[4]=S.x,a[5]=S.y,a[6]=S.z,a[8]=y.x,a[9]=y.y,a[10]=y.z,a[0]*o+a[1]*l+a[2]*h<0&&(s[0]=-p),a[4]*u+a[5]*c+a[6]*d<0&&(s[1]=-g),a[8]*_+a[9]*f+a[10]*m<0&&(s[2]=-v),!0},t.decomposeYawPitchRoll=function(t){var e=t.elements,i=Math.asin(-this.elements[9]);e[1]=i,Math.cos(i)>ge.zeroTolerance?(e[2]=Math.atan2(this.elements[1],this.elements[5]),e[0]=Math.atan2(this.elements[8],this.elements[10])):(e[2]=Math.atan2(-this.elements[4],this.elements[0]),e[0]=0)},t.normalize=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=Math.sqrt(e*e+i*i+n*n);if(!r)return t[0]=0,t[1]=0,void(t[2]=0);1!=r&&(r=1/r,t[0]=e*r,t[1]=i*r,t[2]=n*r)},t.transpose=function(){var t,e;return e=(t=this.elements)[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},t.invert=function(t){var e=this.elements,i=t.elements,n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=e[9],_=e[10],f=e[11],m=e[12],p=e[13],g=e[14],v=e[15],y=n*l-r*o,x=n*h-a*o,b=n*u-s*o,T=r*h-a*l,S=r*u-s*l,E=a*u-s*h,R=c*p-d*m,w=c*g-_*m,C=c*v-f*m,I=d*g-_*p,M=d*v-f*p,A=_*v-f*g,D=y*A-x*M+b*I+T*C-S*w+E*R;0!==Math.abs(D)&&(D=1/D,i[0]=(l*A-h*M+u*I)*D,i[1]=(a*M-r*A-s*I)*D,i[2]=(p*E-g*S+v*T)*D,i[3]=(_*S-d*E-f*T)*D,i[4]=(h*C-o*A-u*w)*D,i[5]=(n*A-a*C+s*w)*D,i[6]=(g*b-m*E-v*x)*D,i[7]=(c*E-_*b+f*x)*D,i[8]=(o*M-l*C+u*R)*D,i[9]=(r*C-n*M-s*R)*D,i[10]=(m*S-p*b+v*y)*D,i[11]=(d*b-c*S-f*y)*D,i[12]=(l*w-o*I-h*R)*D,i[13]=(n*I-r*w+a*R)*D,i[14]=(p*x-m*T-g*y)*D,i[15]=(c*T-d*x+_*y)*D)},t.identity=function(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<16;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.getTranslationVector=function(t){var e=this.elements,i=t.elements;i[0]=e[12],i[1]=e[13],i[2]=e[14]},t.setTranslationVector=function(t){var e=this.elements,i=t.elements;e[12]=i[0],e[13]=i[1],e[14]=i[2]},t.getForward=function(t){var e=this.elements,i=t.elements;i[0]=-e[8],i[1]=-e[9],i[2]=-e[10]},t.setForward=function(t){var e=this.elements,i=t.elements;e[8]=-i[0],e[9]=-i[1],e[10]=-i[2]},R.createRotationX=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[2]=i[3]=i[4]=i[7]=i[8]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[15]=1,i[5]=i[10]=r,i[6]=n,i[9]=-n},R.createRotationY=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[3]=i[4]=i[6]=i[7]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[5]=i[15]=1,i[0]=i[10]=r,i[2]=-n,i[8]=n},R.createRotationZ=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[10]=i[15]=1,i[0]=i[5]=r,i[1]=n,i[4]=-n},R.createRotationYawPitchRoll=function(t,e,i,n){Te.createFromYawPitchRoll(t,e,i,R._tempQuaternion),R.createRotationQuaternion(R._tempQuaternion,n)},R.createRotationAxis=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=Math.cos(e),l=Math.sin(e),h=r*r,u=a*a,c=s*s,d=r*a,_=r*s,f=a*s,m=i.elements;m[3]=m[7]=m[11]=m[12]=m[13]=m[14]=0,m[15]=1,m[0]=h+o*(1-h),m[1]=d-o*d+l*s,m[2]=_-o*_-l*a,m[4]=d-o*d-l*s,m[5]=u+o*(1-u),m[6]=f-o*f+l*r,m[8]=_-o*_+l*a,m[9]=f-o*f-l*r,m[10]=c+o*(1-c)},R.createRotationQuaternion=function(t,e){var i=t.elements,n=e.elements,r=i[0],a=i[1],s=i[2],o=i[3],l=r*r,h=a*a,u=s*s,c=r*a,d=s*o,_=s*r,f=a*o,m=a*s,p=r*o;n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=1-2*(h+u),n[1]=2*(c+d),n[2]=2*(_-f),n[4]=2*(c-d),n[5]=1-2*(u+l),n[6]=2*(m+p),n[8]=2*(_+f),n[9]=2*(m-p),n[10]=1-2*(h+l)},R.createTranslate=function(t,e){var i=t.elements,n=e.elements;n[4]=n[8]=n[1]=n[9]=n[2]=n[6]=n[3]=n[7]=n[11]=0,n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},R.createScaling=function(t,e){var i=t.elements,n=e.elements;n[0]=i[0],n[5]=i[1],n[10]=i[2],n[1]=n[4]=n[8]=n[12]=n[9]=n[13]=n[2]=n[6]=n[14]=n[3]=n[7]=n[11]=0,n[15]=1},R.multiply=function(t,e,i){var n,r,a,s,o,l,h,u;if(r=i.elements,a=t.elements,r===(s=e.elements))for(s=new Float32Array(16),n=0;n<16;++n)s[n]=r[n];for(n=0;n<4;n++)o=a[n],l=a[n+4],h=a[n+8],u=a[n+12],r[n]=o*s[0]+l*s[1]+h*s[2]+u*s[3],r[n+4]=o*s[4]+l*s[5]+h*s[6]+u*s[7],r[n+8]=o*s[8]+l*s[9]+h*s[10]+u*s[11],r[n+12]=o*s[12]+l*s[13]+h*s[14]+u*s[15]},R.createFromQuaternion=function(t,e){var i=e.elements,n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=r+r,h=a+a,u=s+s,c=r*l,d=a*l,_=a*h,f=s*l,m=s*h,p=s*u,g=o*l,v=o*h,y=o*u;i[0]=1-_-p,i[1]=d+y,i[2]=f-v,i[3]=0,i[4]=d-y,i[5]=1-c-p,i[6]=m+g,i[7]=0,i[8]=f+v,i[9]=m-g,i[10]=1-c-_,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1},R.createAffineTransformation=function(t,e,i,n){var r=t.elements,a=e.elements,s=i.elements,o=n.elements,l=a[0],h=a[1],u=a[2],c=a[3],d=l+l,_=h+h,f=u+u,m=l*d,p=l*_,g=l*f,v=h*_,y=h*f,x=u*f,b=c*d,T=c*_,S=c*f,E=s[0],R=s[1],w=s[2];o[0]=(1-(v+x))*E,o[1]=(p+S)*E,o[2]=(g-T)*E,o[3]=0,o[4]=(p-S)*R,o[5]=(1-(m+x))*R,o[6]=(y+b)*R,o[7]=0,o[8]=(g+T)*w,o[9]=(y-b)*w,o[10]=(1-(m+v))*w,o[11]=0,o[12]=r[0],o[13]=r[1],o[14]=r[2],o[15]=1},R.createLookAt=function(t,e,i,n){var r=n.elements,a=R._tempVector0,s=R._tempVector1,o=R._tempVector2;we.subtract(t,e,o),we.normalize(o,o),we.cross(i,o,a),we.normalize(a,a),we.cross(o,a,s),n.identity(),r[0]=a.x,r[4]=a.y,r[8]=a.z,r[1]=s.x,r[5]=s.y,r[9]=s.z,r[2]=o.x,r[6]=o.y,r[10]=o.z,r[12]=-we.dot(a,t),r[13]=-we.dot(s,t),r[14]=-we.dot(o,t)},R.createPerspective=function(t,e,i,n,r){var a=r.elements,s=1/Math.tan(t/2),o=1/(i-n);a[0]=s/e,a[5]=s,a[10]=(n+i)*o,a[11]=-1,a[14]=2*n*i*o,a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[12]=a[13]=a[15]=0},R.createOrthoOffCenterRH=function(t,e,i,n,r,a,s){var o=s.elements,l=1/(t-e),h=1/(i-n),u=1/(r-a);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=0,o[15]=1,o[0]=-2*l,o[5]=-2*h,o[10]=2*u,o[12]=(t+e)*l,o[13]=(n+i)*h,o[14]=(a+r)*u},R.translation=function(t,e){var i=t.elements,n=e.elements;n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},m(R,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new R},"_tempVector0",function(){return this._tempVector0=new we},"_tempVector1",function(){return this._tempVector1=new we},"_tempVector2",function(){return this._tempVector2=new we},"_tempQuaternion",function(){return this._tempQuaternion=new Te},"DEFAULT",function(){return this.DEFAULT=new R},"ZERO",function(){return this.ZERO=new R(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),R}(),xe=function(){function y(t,e){this.extents=null,this.transformation=null,this.extents=t,this.transformation=e}E(y,"laya.d3.math.OrientedBoundBox");var t=y.prototype;return t.getCorners=function(t){var e=y._tempV30.elements,i=y._tempV31.elements,n=y._tempV32.elements,r=this.extents.elements;e[0]=r[0],e[1]=e[2]=0,i[1]=r[1],i[0]=i[2]=0,n[2]=r[2],n[0]=n[1]=0,we.TransformNormal(y._tempV30,this.transformation,y._tempV30),we.TransformNormal(y._tempV31,this.transformation,y._tempV31),we.TransformNormal(y._tempV32,this.transformation,y._tempV32);var a=y._tempV33;this.transformation.getTranslationVector(a),t.length=8,we.add(a,y._tempV30,y._tempV34),we.add(y._tempV34,y._tempV31,y._tempV34),we.add(y._tempV34,y._tempV32,t[0]),we.add(a,y._tempV30,y._tempV34),we.add(y._tempV34,y._tempV31,y._tempV34),we.subtract(y._tempV34,y._tempV32,t[1]),we.subtract(a,y._tempV30,y._tempV34),we.add(y._tempV34,y._tempV31,y._tempV34),we.subtract(y._tempV34,y._tempV32,t[2]),we.subtract(a,y._tempV30,y._tempV34),we.add(y._tempV34,y._tempV31,y._tempV34),we.add(y._tempV34,y._tempV32,t[3]),we.add(a,y._tempV30,y._tempV34),we.subtract(y._tempV34,y._tempV31,y._tempV34),we.add(y._tempV34,y._tempV32,t[4]),we.add(a,y._tempV30,y._tempV34),we.subtract(y._tempV34,y._tempV31,y._tempV34),we.subtract(y._tempV34,y._tempV32,t[5]),we.subtract(a,y._tempV30,y._tempV34),we.subtract(y._tempV34,y._tempV31,y._tempV34),we.subtract(y._tempV34,y._tempV32,t[6]),we.subtract(a,y._tempV30,y._tempV34),we.subtract(y._tempV34,y._tempV31,y._tempV34),we.add(y._tempV34,y._tempV32,t[7])},t.transform=function(t){ye.multiply(this.transformation,t,this.transformation)},t.scale=function(t){we.multiply(this.extents,t,this.extents)},t.translate=function(t){this.transformation.getTranslationVector(y._tempV30),we.add(y._tempV30,t,y._tempV31),this.transformation.setTranslationVector(y._tempV31)},t.Size=function(t){we.scale(this.extents,2,t)},t.getSize=function(t){var e=this.extents.elements;y._tempV30.x=e[0],y._tempV31.y=e[1],y._tempV32.z=e[2],we.TransformNormal(y._tempV30,this.transformation,y._tempV30),we.TransformNormal(y._tempV31,this.transformation,y._tempV31),we.TransformNormal(y._tempV31,this.transformation,y._tempV32);var i=t.elements;i[0]=we.scalarLength(y._tempV30),i[1]=we.scalarLength(y._tempV31),i[2]=we.scalarLength(y._tempV32)},t.getSizeSquared=function(t){var e=this.extents.elements;y._tempV30.x=e[0],y._tempV31.y=e[1],y._tempV32.z=e[2],we.TransformNormal(y._tempV30,this.transformation,y._tempV30),we.TransformNormal(y._tempV31,this.transformation,y._tempV31),we.TransformNormal(y._tempV31,this.transformation,y._tempV32);var i=t.elements;i[0]=we.scalarLengthSquared(y._tempV30),i[1]=we.scalarLengthSquared(y._tempV31),i[2]=we.scalarLengthSquared(y._tempV32)},t.getCenter=function(t){this.transformation.getTranslationVector(t)},t.containsPoint=function(t){var e=this.extents.elements,i=e[0],n=e[1],r=e[2];this.transformation.invert(y._tempM0),we.transformCoordinate(t,y._tempM0,y._tempV30);var a=y._tempV30.elements,s=Math.abs(a[0]),o=Math.abs(a[1]),l=Math.abs(a[2]);return ge.nearEqual(s,i)&&ge.nearEqual(o,n)&&ge.nearEqual(l,r)?2:s<i&&o<n&&l<r?1:0},t.containsPoints=function(t){var e=this.extents.elements,i=e[0],n=e[1],r=e[2];this.transformation.invert(y._tempM0);for(var a=!0,s=!1,o=0;o<t.length;o++){we.transformCoordinate(t[o],y._tempM0,y._tempV30);var l=y._tempV30.elements,h=Math.abs(l[0]),u=Math.abs(l[1]),c=Math.abs(l[2]);ge.nearEqual(h,i)&&ge.nearEqual(u,n)&&ge.nearEqual(c,r)&&(s=!0),h<i&&u<n&&c<r?s=!0:a=!1}return a?1:s?2:0},t.containsSphere=function(t,e){void 0===e&&(e=!1);var i=this.extents.elements,n=i[0],r=i[1],a=i[2],s=t.radius;this.transformation.invert(y._tempM0),we.transformCoordinate(t.center,y._tempM0,y._tempV30);var o=NaN;if(o=e?s:(we.scale(we.UnitX,s,y._tempV31),we.TransformNormal(y._tempV31,y._tempM0,y._tempV31),we.scalarLength(y._tempV31)),we.scale(this.extents,-1,y._tempV32),we.Clamp(y._tempV30,y._tempV32,this.extents,y._tempV33),o*o<we.distanceSquared(y._tempV30,y._tempV33))return 0;var l=y._tempV30.elements,h=l[0],u=l[1],c=l[2],d=y._tempV32.elements,_=d[0],f=d[1],m=d[2];return _+o<=h&&h<=n-o&&o<n-_&&f+o<=u&&u<=r-o&&o<r-f&&m+o<=c&&c<=a-o&&o<a-m?1:2},t.containsOrientedBoundBox=function(t){var e=0,i=0;t.getCorners(y._corners);var n=this.containsPoints(y._corners);if(0!=n)return n;var r=this.extents.elements;t.extents.cloneTo(y._tempV35);var a=y._tempV35.elements;y._getRows(this.transformation,y._rows1),y._getRows(t.transformation,y._rows2);var s=NaN;for(e=0;e<4;e++)for(i=0;i<4;i++)3==e||3==i?(y._tempM0.setElementByRowColumn(e,i,0),y._tempM1.setElementByRowColumn(e,i,0)):(s=we.dot(y._rows1[e],y._rows2[i]),y._tempM0.setElementByRowColumn(e,i,s),y._tempM1.setElementByRowColumn(e,i,Math.abs(s)));t.getCenter(y._tempV34),this.getCenter(y._tempV36),we.subtract(y._tempV34,y._tempV36,y._tempV30);var o=y._tempV31.elements;o[0]=we.dot(y._tempV30,y._rows1[0]),o[1]=we.dot(y._tempV30,y._rows1[1]),o[2]=we.dot(y._tempV30,y._rows1[2]);var l=y._tempV32.elements,h=y._tempV33.elements;for(e=0;e<3;e++)if(l[0]=y._tempM1.getElementByRowColumn(e,0),l[1]=y._tempM1.getElementByRowColumn(e,1),l[2]=y._tempM1.getElementByRowColumn(e,2),r[e]+we.dot(y._tempV35,y._tempV32)<Math.abs(o[e]))return 0;for(i=0;i<3;i++)if(l[0]=y._tempM1.getElementByRowColumn(0,i),l[1]=y._tempM1.getElementByRowColumn(1,i),l[2]=y._tempM1.getElementByRowColumn(2,i),h[0]=y._tempM0.getElementByRowColumn(0,i),h[1]=y._tempM0.getElementByRowColumn(1,i),h[2]=y._tempM0.getElementByRowColumn(2,i),we.dot(this.extents,y._tempV32)+a[i]<Math.abs(we.dot(y._tempV31,y._tempV33)))return 0;for(e=0;e<3;e++)for(i=0;i<3;i++){var u=(e+1)%3,c=(e+2)%3,d=(i+1)%3,_=(i+2)%3;if(r[u]*y._tempM1.getElementByRowColumn(c,i)+r[c]*y._tempM1.getElementByRowColumn(u,i)+(a[d]*y._tempM1.getElementByRowColumn(e,_)+a[_]*y._tempM1.getElementByRowColumn(e,d))<Math.abs(o[c]*y._tempM0.getElementByRowColumn(u,i)-o[u]*y._tempM0.getElementByRowColumn(c,i)))return 0}return 2},t.containsLine=function(t,e){y._corners[0]=t,y._corners[1]=e;var i=this.containsPoints(y._corners);if(0!=i)return i;var n=this.extents.elements,r=n[0],a=n[1],s=n[2];this.transformation.invert(y._tempM0),we.transformCoordinate(t,y._tempM0,y._tempV30),we.transformCoordinate(e,y._tempM0,y._tempV31),we.add(y._tempV30,y._tempV31,y._tempV32),we.scale(y._tempV32,.5,y._tempV32),we.subtract(y._tempV30,y._tempV32,y._tempV33);var o=y._tempV33.elements,l=o[0],h=o[1],u=o[2],c=y._tempV34.elements,d=c[0]=Math.abs(o[0]),_=c[1]=Math.abs(o[1]),f=c[2]=Math.abs(o[2]),m=y._tempV32.elements,p=m[0],g=m[1],v=m[2];return Math.abs(p)>r+d?0:Math.abs(g)>a+_?0:Math.abs(v)>s+f?0:Math.abs(g*u-v*h)>a*f+s*_?0:Math.abs(p*u-v*l)>r*f+s*d?0:Math.abs(p*h-g*l)>r*_+a*d?0:2},t.containsBoundBox=function(t){var e=0,i=0,n=t.min,r=t.max;t.getCorners(y._corners);var a=this.containsPoints(y._corners);if(0!=a)return a;we.subtract(r,n,y._tempV30),we.scale(y._tempV30,.5,y._tempV30),we.add(n,y._tempV30,y._tempV30),we.subtract(r,y._tempV30,y._tempV31);var s=this.extents.elements,o=y._tempV31.elements;y._getRows(this.transformation,y._rows1),this.transformation.invert(y._tempM0);for(e=0;e<3;e++)for(i=0;i<3;i++)y._tempM1.setElementByRowColumn(e,i,Math.abs(y._tempM0.getElementByRowColumn(e,i)));this.getCenter(y._tempV35),we.subtract(y._tempV30,y._tempV35,y._tempV32);var l=y._tempV31.elements;l[0]=we.dot(y._tempV32,y._rows1[0]),l[1]=we.dot(y._tempV32,y._rows1[1]),l[2]=we.dot(y._tempV32,y._rows1[2]);var h=y._tempV33.elements,u=y._tempV34.elements;for(e=0;e<3;e++)if(h[0]=y._tempM1.getElementByRowColumn(e,0),h[1]=y._tempM1.getElementByRowColumn(e,1),h[2]=y._tempM1.getElementByRowColumn(e,2),s[e]+we.dot(y._tempV31,y._tempV33)<Math.abs(l[e]))return 0;for(i=0;i<3;i++)if(h[0]=y._tempM1.getElementByRowColumn(0,i),h[1]=y._tempM1.getElementByRowColumn(1,i),h[2]=y._tempM1.getElementByRowColumn(2,i),u[0]=y._tempM0.getElementByRowColumn(0,i),u[1]=y._tempM0.getElementByRowColumn(1,i),u[2]=y._tempM0.getElementByRowColumn(2,i),we.dot(this.extents,y._tempV33)+o[i]<Math.abs(we.dot(y._tempV31,y._tempV34)))return 0;for(e=0;e<3;e++)for(i=0;i<3;i++){var c=(e+1)%3,d=(e+2)%3,_=(i+1)%3,f=(i+2)%3;if(s[c]*y._tempM1.getElementByRowColumn(d,i)+s[d]*y._tempM1.getElementByRowColumn(c,i)+(o[_]*y._tempM1.getElementByRowColumn(e,f)+o[f]*y._tempM1.getElementByRowColumn(e,_))<Math.abs(l[d]*y._tempM0.getElementByRowColumn(c,i)-l[c]*y._tempM0.getElementByRowColumn(d,i)))return 0}return 2},t.intersectsRay=function(t,e){we.scale(this.extents,-1,y._tempV30),this.transformation.invert(y._tempM0),we.TransformNormal(t.direction,y._tempM0,y._ray.direction),we.transformCoordinate(t.origin,y._tempM0,y._ray.origin),y._boxBound1.min=y._tempV30,y._boxBound1.max=this.extents;var i=pe.intersectsRayAndBoxRP(y._ray,y._boxBound1,e);return-1!==i&&we.transformCoordinate(e,this.transformation,e),i},t._getLocalCorners=function(t){t.length=8;var e=this.extents.elements;y._tempV30.x=e[0],y._tempV31.y=e[1],y._tempV32.z=e[2],we.add(y._tempV30,y._tempV31,y._tempV33),we.add(y._tempV33,y._tempV32,t[0]),we.add(y._tempV30,y._tempV31,y._tempV33),we.subtract(y._tempV33,y._tempV32,t[1]),we.subtract(y._tempV31,y._tempV30,y._tempV33),we.subtract(y._tempV33,y._tempV30,t[2]),we.subtract(y._tempV31,y._tempV30,y._tempV33),we.add(y._tempV33,y._tempV32,t[3]),we.subtract(y._tempV30,y._tempV31,y._tempV33),we.add(y._tempV33,y._tempV32,t[4]),we.subtract(y._tempV30,y._tempV31,y._tempV33),we.subtract(y._tempV33,y._tempV32,t[5]),we.scale(t[0],-1,t[6]),we.subtract(y._tempV32,y._tempV30,y._tempV33),we.subtract(y._tempV33,y._tempV31,t[7])},t.equals=function(t){return this.extents==t.extents&&this.transformation==t.transformation},t.cloneTo=function(t){var e=t;this.extents.cloneTo(e.extents),this.transformation.cloneTo(e.transformation)},y.createByBoundBox=function(t,e){var i=t.min,n=t.max;we.subtract(n,i,y._tempV30),we.scale(y._tempV30,.5,y._tempV30),we.add(i,y._tempV30,y._tempV31),we.subtract(n,y._tempV31,y._tempV32),ye.translation(y._tempV31,y._tempM0);var r=y._tempV32.clone(),a=y._tempM0.clone();e.extents=r,e.transformation=a},y.createByMinAndMaxVertex=function(t,e){return we.subtract(e,t,y._tempV30),we.scale(y._tempV30,.5,y._tempV30),we.add(t,y._tempV30,y._tempV31),we.subtract(e,y._tempV31,y._tempV32),ye.translation(y._tempV31,y._tempM0),new y(y._tempV32,y._tempM0)},y._getRows=function(t,e){e.length=3;var i=t.elements,n=e[0].elements;n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=e[1].elements;r[0]=i[4],r[1]=i[5],r[2]=i[6];var a=e[2].elements;a[0]=i[8],a[1]=i[9],a[2]=i[10]},y.getObbtoObbMatrix4x4=function(t,e,i,n){var r=t.transformation,a=e.transformation;if(i){y._getRows(r,y._rows1),y._getRows(a,y._rows2);for(var s=0;s<3;s++)for(var o=0;o<3;o++)n.setElementByRowColumn(s,o,we.dot(y._rows2[s],y._rows1[o]));e.getCenter(y._tempV30),t.getCenter(y._tempV31),we.subtract(y._tempV30,y._tempV31,y._tempV32);var l=n.elements;l[12]=we.dot(y._tempV32,y._rows1[0]),l[13]=we.dot(y._tempV32,y._rows1[1]),l[14]=we.dot(y._tempV32,y._rows1[2]),l[15]=1}else r.invert(y._tempM0),ye.multiply(a,y._tempM0,n)},y.merge=function(t,e,i){var n=t.extents,r=t.transformation;y.getObbtoObbMatrix4x4(t,e,i,y._tempM0),e._getLocalCorners(y._corners),we.transformCoordinate(y._corners[0],y._tempM0,y._corners[0]),we.transformCoordinate(y._corners[1],y._tempM0,y._corners[1]),we.transformCoordinate(y._corners[2],y._tempM0,y._corners[2]),we.transformCoordinate(y._corners[3],y._tempM0,y._corners[3]),we.transformCoordinate(y._corners[4],y._tempM0,y._corners[4]),we.transformCoordinate(y._corners[5],y._tempM0,y._corners[5]),we.transformCoordinate(y._corners[6],y._tempM0,y._corners[6]),we.transformCoordinate(y._corners[7],y._tempM0,y._corners[7]),we.scale(n,-1,y._boxBound1.min),n.cloneTo(y._boxBound1.max),_e.createfromPoints(y._corners,y._boxBound2),_e.merge(y._boxBound2,y._boxBound1,y._boxBound3);var a=y._boxBound3.min,s=y._boxBound3.max;we.subtract(s,a,y._tempV30),we.scale(y._tempV30,.5,y._tempV30),we.add(a,y._tempV30,y._tempV32),we.subtract(s,y._tempV32,n),we.transformCoordinate(y._tempV32,r,y._tempV33)},m(y,["_tempV30",function(){return this._tempV30=new we},"_tempV31",function(){return this._tempV31=new we},"_tempV32",function(){return this._tempV32=new we},"_tempV33",function(){return this._tempV33=new we},"_tempV34",function(){return this._tempV34=new we},"_tempV35",function(){return this._tempV35=new we},"_tempV36",function(){return this._tempV36=new we},"_tempM0",function(){return this._tempM0=new ye},"_tempM1",function(){return this._tempM1=new ye},"_corners",function(){return this._corners=[new we,new we,new we,new we,new we,new we,new we,new we]},"_rows1",function(){return this._rows1=[new we,new we,new we]},"_rows2",function(){return this._rows2=[new we,new we,new we]},"_ray",function(){return this._ray=new Ee(new we,new we)},"_boxBound1",function(){return this._boxBound1=new _e(new we,new we)},"_boxBound2",function(){return this._boxBound2=new _e(new we,new we)},"_boxBound3",function(){return this._boxBound3=new _e(new we,new we)}]),y}(),be=function(){function b(t,e){this.normal=null,this.distance=NaN,void 0===e&&(e=0),this.normal=t,this.distance=e}return E(b,"laya.d3.math.Plane"),b.prototype.normalize=function(){var t=this.normal.elements,e=t[0],i=t[1],n=t[2],r=1/Math.sqrt(e*e+i*i+n*n);t[0]=e*r,t[1]=i*r,t[2]=n*r,this.distance*=r},b.createPlaneBy3P=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=r[0]-n[0],o=r[1]-n[1],l=r[2]-n[2],h=a[0]-n[0],u=a[1]-n[1],c=a[2]-n[2],d=o*c-l*u,_=l*h-s*c,f=s*u-o*h,m=1/Math.sqrt(d*d+_*_+f*f),p=d*m,g=_*m,v=f*m,y=b._TEMPVec3.elements;y[0]=p,y[1]=g,y[2]=v;var x=-(p*n[0]+g*n[1]+v*n[2]);return new b(b._TEMPVec3,x)},b.PlaneIntersectionType_Back=0,b.PlaneIntersectionType_Front=1,b.PlaneIntersectionType_Intersecting=2,m(b,["_TEMPVec3",function(){return this._TEMPVec3=new we}]),b}(),Te=function(){function r(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.elements[0]=t,this.elements[1]=e,this.elements[2]=i,this.elements[3]=n}E(r,"laya.d3.math.Quaternion");var t=r.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.scaling=function(t,e){var i=e.elements,n=this.elements;i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t,i[3]=n[3]*t},t.normalize=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=n*n+r*r+a*a+s*s;0<o&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=s*o)},t.length=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},t.rotateX=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h+o*l,i[1]=a*h+s*l,i[2]=s*h-a*l,i[3]=o*h-r*l},t.rotateY=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h-s*l,i[1]=a*h+o*l,i[2]=s*h+r*l,i[3]=o*h-a*l},t.rotateZ=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],a=n[1],s=n[2],o=n[3],l=Math.sin(t),h=Math.cos(t);i[0]=r*h+a*l,i[1]=a*h-r*l,i[2]=s*h+o*l,i[3]=o*h-s*l},t.getYawPitchRoll=function(t){we.transformQuat(we.ForwardRH,this,r.TEMPVector31),we.transformQuat(we.Up,this,r.TEMPVector32);var e=r.TEMPVector32.elements;r.angleTo(we.ZERO,r.TEMPVector31,r.TEMPVector33);var i=r.TEMPVector33.elements;i[0]==Math.PI/2?(i[1]=r.arcTanAngle(e[2],e[0]),i[2]=0):i[0]==-Math.PI/2?(i[1]=r.arcTanAngle(-e[2],-e[0]),i[2]=0):(ye.createRotationY(-i[1],r.TEMPMatrix0),ye.createRotationX(-i[0],r.TEMPMatrix1),we.transformCoordinate(r.TEMPVector32,r.TEMPMatrix0,r.TEMPVector32),we.transformCoordinate(r.TEMPVector32,r.TEMPMatrix1,r.TEMPVector32),i[2]=r.arcTanAngle(e[1],-e[0])),i[1]<=-Math.PI&&(i[1]=Math.PI),i[2]<=-Math.PI&&(i[2]=Math.PI),i[1]>=Math.PI&&i[2]>=Math.PI&&(i[1]=0,i[2]=0,i[0]=Math.PI-i[0]);var n=t.elements;n[0]=i[1],n[1]=i[0],n[2]=i[2]},t.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=n*n+r*r+a*a+s*s,l=o?1/o:0;e[0]=-n*l,e[1]=-r*l,e[2]=-a*l,e[3]=s*l},t.identity=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=1},t.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<4;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.equals=function(t){var e=this.elements,i=t.elements;return ge.nearEqual(e[0],i[0])&&ge.nearEqual(e[1],i[1])&&ge.nearEqual(e[2],i[2])&&ge.nearEqual(e[3],i[3])},t.lengthSquared=function(){var t=this.elements[0],e=this.elements[1],i=this.elements[2],n=this.elements[3];return t*t+e*e+i*i+n*n},v(0,t,"x",function(){return this.elements[0]}),v(0,t,"y",function(){return this.elements[1]}),v(0,t,"z",function(){return this.elements[2]}),v(0,t,"w",function(){return this.elements[3]}),r.createFromYawPitchRoll=function(t,e,i,n){var r=.5*i,a=.5*e,s=.5*t,o=Math.sin(r),l=Math.cos(r),h=Math.sin(a),u=Math.cos(a),c=Math.sin(s),d=Math.cos(s),_=n.elements;_[0]=d*h*l+c*u*o,_[1]=c*u*l-d*h*o,_[2]=d*u*o-c*h*l,_[3]=d*u*l+c*h*o},r.multiply=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=n[0],o=n[1],l=n[2],h=n[3],u=r[0],c=r[1],d=r[2],_=r[3],f=o*d-l*c,m=l*u-s*d,p=s*c-o*u,g=s*u+o*c+l*d;a[0]=s*_+u*h+f,a[1]=o*_+c*h+m,a[2]=l*_+d*h+p,a[3]=h*_-g},r.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},r.angleTo=function(t,e,i){we.subtract(e,t,r.TEMPVector30),we.normalize(r.TEMPVector30,r.TEMPVector30),i.elements[0]=Math.asin(r.TEMPVector30.y),i.elements[1]=r.arcTanAngle(-r.TEMPVector30.z,-r.TEMPVector30.x)},r.createFromAxisAngle=function(t,e,i){var n=i.elements,r=t.elements;e*=.5;var a=Math.sin(e);n[0]=a*r[0],n[1]=a*r[1],n[2]=a*r[2],n[3]=Math.cos(e)},r.createFromMatrix3x3=function(t,e){var i,n=e.elements,r=t.elements,a=r[0]+r[4]+r[8];if(0<a)i=Math.sqrt(a+1),n[3]=.5*i,i=.5/i,n[0]=(r[5]-r[7])*i,n[1]=(r[6]-r[2])*i,n[2]=(r[1]-r[3])*i;else{var s=0;r[4]>r[0]&&(s=1),r[8]>r[3*s+s]&&(s=2);var o=(s+1)%3,l=(s+2)%3;i=Math.sqrt(r[3*s+s]-r[3*o+o]-r[3*l+l]+1),n[s]=.5*i,i=.5/i,n[3]=(r[3*o+l]-r[3*l+o])*i,n[o]=(r[3*o+s]+r[3*s+o])*i,n[l]=(r[3*l+s]+r[3*s+l])*i}},r.createFromMatrix4x4=function(t,e){var i,n,r=t.elements,a=e.elements,s=r[0]+r[5]+r[10];0<s?(i=Math.sqrt(s+1),a[3]=.5*i,i=.5/i,a[0]=(r[6]-r[9])*i,a[1]=(r[8]-r[2])*i,a[2]=(r[1]-r[4])*i):r[0]>=r[5]&&r[0]>=r[10]?(n=.5/(i=Math.sqrt(1+r[0]-r[5]-r[10])),a[0]=.5*i,a[1]=(r[1]+r[4])*n,a[2]=(r[2]+r[8])*n,a[3]=(r[6]-r[9])*n):r[5]>r[10]?(n=.5/(i=Math.sqrt(1+r[5]-r[0]-r[10])),a[0]=(r[4]+r[1])*n,a[1]=.5*i,a[2]=(r[9]+r[6])*n,a[3]=(r[8]-r[2])*n):(n=.5/(i=Math.sqrt(1+r[10]-r[0]-r[5])),a[0]=(r[8]+r[2])*n,a[1]=(r[9]+r[6])*n,a[2]=.5*i,a[3]=(r[1]-r[4])*n)},r.slerp=function(t,e,i,n){var r,a,s,o,l,h=t.elements,u=e.elements,c=n.elements,d=h[0],_=h[1],f=h[2],m=h[3],p=u[0],g=u[1],v=u[2],y=u[3];return(a=d*p+_*g+f*v+m*y)<0&&(a=-a,p=-p,g=-g,v=-v,y=-y),l=1e-6<1-a?(r=Math.acos(a),s=Math.sin(r),o=Math.sin((1-i)*r)/s,Math.sin(i*r)/s):(o=1-i,i),c[0]=o*d+l*p,c[1]=o*_+l*g,c[2]=o*f+l*v,c[3]=o*m+l*y,c},r.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2],u=a[3];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h),r[3]=u+i*(s[3]-u)},r.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3]},r.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},r.rotationLookAt=function(t,e,i){r.lookAt(we.ZERO,t,e,i)},r.lookAt=function(t,e,i,n){ve.lookAt(t,e,i,r._tempMatrix3x3),r.rotationMatrix(r._tempMatrix3x3,n)},r.invert=function(t,e){var i=t.elements,n=e.elements,r=t.lengthSquared();ge.isZero(r)||(r=1/r,n[0]=-i[0]*r,n[1]=-i[1]*r,n[2]=-i[2]*r,n[3]=i[3]*r)},r.rotationMatrix=function(t,e){var i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],u=i[7],c=i[8],d=e.elements,_=NaN,f=NaN,m=n+o+c;0<m?(_=Math.sqrt(m+1),d[3]=.5*_,_=.5/_,d[0]=(l-u)*_,d[1]=(h-a)*_,d[2]=(r-s)*_):d[3]=o<=n&&c<=n?(f=.5/(_=Math.sqrt(1+n-o-c)),d[0]=.5*_,d[1]=(r+s)*f,d[2]=(a+h)*f,(l-u)*f):c<o?(f=.5/(_=Math.sqrt(1+o-n-c)),d[0]=(s+r)*f,d[1]=.5*_,d[2]=(u+l)*f,(h-a)*f):(f=.5/(_=Math.sqrt(1+c-n-o)),d[0]=(h+a)*f,d[1]=(u+l)*f,d[2]=.5*_,(r-s)*f)},r.DEFAULT=new r,m(r,["TEMPVector30",function(){return this.TEMPVector30=new we},"TEMPVector31",function(){return this.TEMPVector31=new we},"TEMPVector32",function(){return this.TEMPVector32=new we},"TEMPVector33",function(){return this.TEMPVector33=new we},"TEMPMatrix0",function(){return this.TEMPMatrix0=new ye},"TEMPMatrix1",function(){return this.TEMPMatrix1=new ye},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new ve},"NAN",function(){return this.NAN=new r(NaN,NaN,NaN,NaN)}]),r}(),Se=function(){function t(t){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}E(t,"laya.d3.math.Rand");var e=t.prototype;return e.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},e.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},e.getSignedFloat=function(){return 2*this.getFloat()-1},v(0,e,"seed",function(){return this.seeds[0]},function(t){this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),t.getFloatFromInt=function(t){return 1/8388607*(8388607&t)},t.getByteFromInt=function(t){return(8388607&t)>>>15},t}(),Ee=function(){function t(t,e){this.origin=null,this.direction=null,this.origin=t,this.direction=e}return E(t,"laya.d3.math.Ray"),t}(),Re=function(){function t(t,e){this.elements=new Float32Array(2),void 0===t&&(t=0),void 0===e&&(e=0);var i=this.elements;i[0]=t,i[1]=e}E(t,"laya.d3.math.Vector2");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),v(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e},m(t,["ZERO",function(){return this.ZERO=new t(0,0)},"ONE",function(){return this.ONE=new t(1,1)}]),t}(),we=function(){function u(t,e,i){this.elements=new Float32Array(3),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this.elements;n[0]=t,n[1]=e,n[2]=i}E(u,"laya.d3.math.Vector3");var t=u.prototype;return S.imps(t,{"laya.d3.core.IClone":!0}),t.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2]},t.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},v(0,t,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),v(0,t,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),v(0,t,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),u.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2];return r*r+a*a+s*s},u.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2];return Math.sqrt(r*r+a*a+s*s)},u.min=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2])},u.max=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2])},u.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements,s=r[0],o=r[1],l=r[2],h=a[0],u=a[1],c=a[2],d=a[3],_=d*s+u*l-c*o,f=d*o+c*s-h*l,m=d*l+h*o-u*s,p=-h*s-u*o-c*l;n[0]=_*d+p*-h+f*-c-m*-u,n[1]=f*d+p*-u+m*-h-_*-c,n[2]=m*d+p*-c+_*-u-f*-h},u.scalarLength=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return Math.sqrt(i*i+n*n+r*r)},u.scalarLengthSquared=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return i*i+n*n+r*r},u.normalize=function(t,e){var i=t.elements,n=e.elements,r=i[0],a=i[1],s=i[2],o=r*r+a*a+s*s;0<o&&(o=1/Math.sqrt(o),n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o)},u.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2]},u.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e},u.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h)},u.transformV3ToV3=function(t,e,i){var n=u._tempVector4;u.transformV3ToV4(t,e,n);var r=n.elements,a=i.elements;a[0]=r[0],a[1]=r[1],a[2]=r[2]},u.transformV3ToV4=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=i.elements;l[0]=r*o[0]+a*o[4]+s*o[8]+o[12],l[1]=r*o[1]+a*o[5]+s*o[9]+o[13],l[2]=r*o[2]+a*o[6]+s*o[10]+o[14],l[3]=r*o[3]+a*o[7]+s*o[11]+o[15]},u.TransformNormal=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=e.elements,l=i.elements;l[0]=r*o[0]+a*o[4]+s*o[8],l[1]=r*o[1]+a*o[5]+s*o[9],l[2]=r*o[2]+a*o[6]+s*o[10]},u.transformCoordinate=function(t,e,i){var n=u._tempVector4.elements,r=t.elements,a=r[0],s=r[1],o=r[2],l=e.elements;n[0]=a*l[0]+s*l[4]+o*l[8]+l[12],n[1]=a*l[1]+s*l[5]+o*l[9]+l[13],n[2]=a*l[2]+s*l[6]+o*l[10]+l[14],n[3]=1/(a*l[3]+s*l[7]+o*l[11]+l[15]);var h=i.elements;h[0]=n[0]*n[3],h[1]=n[1]*n[3],h[2]=n[2]*n[3]},u.Clamp=function(t,e,i,n){var r=t.elements,a=r[0],s=r[1],o=r[2],l=e.elements,h=l[0],u=l[1],c=l[2],d=i.elements,_=d[0],f=d[1],m=d[2],p=n.elements;a=(a=_<a?_:a)<h?h:a,s=(s=f<s?f:s)<u?u:s,o=(o=m<o?m:o)<c?c:o,p[0]=a,p[1]=s,p[2]=o},u.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2]},u.subtract=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2]},u.cross=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements,s=n[0],o=n[1],l=n[2],h=r[0],u=r[1],c=r[2];a[0]=o*c-l*u,a[1]=l*h-s*c,a[2]=s*u-o*h},u.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]},u.equals=function(t,e){var i=t.elements,n=e.elements;return ge.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&ge.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&ge.nearEqual(Math.abs(i[2]),Math.abs(n[2]))},u.ZERO=new u(0,0,0),u.ONE=new u(1,1,1),u.NegativeUnitX=new u(-1,0,0),u.UnitX=new u(1,0,0),u.UnitY=new u(0,1,0),u.UnitZ=new u(0,0,1),u.ForwardRH=new u(0,0,-1),u.ForwardLH=new u(0,0,1),u.Up=new u(0,1,0),u.NAN=new u(NaN,NaN,NaN),m(u,["_tempVector4",function(){return this._tempVector4=new Ce}]),u}(),Ce=function(){function t(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var r=this.elements;r[0]=t,r[1]=e,r[2]=i,r[3]=n}E(t,"laya.d3.math.Vector4");var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},v(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),v(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),v(0,e,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),v(0,e,"w",function(){return this.elements[3]},function(t){this.elements[3]=t}),t.lerp=function(t,e,i,n){var r=n.elements,a=t.elements,s=e.elements,o=a[0],l=a[1],h=a[2],u=a[3];r[0]=o+i*(s[0]-o),r[1]=l+i*(s[1]-l),r[2]=h+i*(s[2]-h),r[3]=u+i*(s[3]-u)},t.transformByM4x4=function(t,e,i){var n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=e.elements,h=i.elements;h[0]=r*l[0]+a*l[4]+s*l[8]+o*l[12],h[1]=r*l[1]+a*l[5]+s*l[9]+o*l[13],h[2]=r*l[2]+a*l[6]+s*l[10]+o*l[14],h[3]=r*l[3]+a*l[7]+s*l[11]+o*l[15]},t.equals=function(t,e){var i=t.elements,n=e.elements;return ge.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&ge.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&ge.nearEqual(Math.abs(i[2]),Math.abs(n[2]))&&ge.nearEqual(Math.abs(i[3]),Math.abs(n[3]))},t.normalize=function(t,e){var i=t.elements,n=e.elements,r=t.length();0<r&&(n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=i[3]*r)},t.add=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3]},t.subtract=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3]},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2],n[3]=r[3]*a[3]},t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n[3]=r[3]*e},t.Clamp=function(t,e,i,n){var r=t.elements,a=r[0],s=r[1],o=r[2],l=r[3],h=e.elements,u=h[0],c=h[1],d=h[2],_=h[3],f=i.elements,m=f[0],p=f[1],g=f[2],v=f[3],y=n.elements;a=(a=m<a?m:a)<u?u:a,s=(s=p<s?p:s)<c?c:s,o=(o=g<o?g:o)<d?d:o,l=(l=v<l?v:l)<_?_:l,y[0]=a,y[1]=s,y[2]=o,y[3]=l},t.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return r*r+a*a+s*s+o*o},t.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],a=i[1]-n[1],s=i[2]-n[2],o=i[3]-n[3];return Math.sqrt(r*r+a*a+s*s+o*o)},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},t.min=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2]),n[3]=Math.min(r[3],a[3])},t.max=function(t,e,i){var n=i.elements,r=t.elements,a=e.elements;n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2]),n[3]=Math.max(r[3],a[3])},m(t,["ZERO",function(){return this.ZERO=new t},"ONE",function(){return this.ONE=new t(1,1,1,1)},"UnitX",function(){return this.UnitX=new t(1,0,0,0)},"UnitY",function(){return this.UnitY=new t(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new t(0,0,1,0)},"UnitW",function(){return this.UnitW=new t(0,0,0,1)}]),t}(),Ie=function(){function a(t,e,i,n){this.minDepth=0,this.maxDepth=1,this.x=t,this.y=e,this.width=i,this.height=n}E(a,"laya.d3.math.Viewport");var t=a.prototype;return t.project=function(t,e,i){we.transformV3ToV3(t,e,i);var n=t.elements,r=e.elements,a=i.elements,s=n[0]*r[3]+n[1]*r[7]+n[2]*r[11]+r[15];1!==s&&(a[0]=a[0]/s,a[1]=a[1]/s,a[2]=a[2]/s),a[0]=.5*(a[0]+1)*this.width+this.x,a[1]=.5*(1-a[1])*this.height+this.y,a[2]=a[2]*(this.maxDepth-this.minDepth)+this.minDepth},t.unprojectFromMat=function(t,e,i){var n=t.elements,r=e.elements,a=i.elements;a[0]=(n[0]-this.x)/this.width*2-1,a[1]=-((n[1]-this.y)/this.height*2-1);var s=(this.maxDepth-this.minDepth)/2;a[2]=(n[2]-this.minDepth-s)/s;var o=a[0]*r[3]+a[1]*r[7]+a[2]*r[11]+r[15];we.transformV3ToV3(i,e,i),1!==o&&(a[0]=a[0]/o,a[1]=a[1]/o,a[2]=a[2]/o)},t.unprojectFromWVP=function(t,e,i,n,r){ye.multiply(e,i,a._tempMatrix4x4),n&&ye.multiply(a._tempMatrix4x4,n,a._tempMatrix4x4),a._tempMatrix4x4.invert(a._tempMatrix4x4),this.unprojectFromMat(t,a._tempMatrix4x4,r)},m(a,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new ye}]),a}(),Me=(function(){function t(){this._alphaBlending=1,this._colorIntensity=1,this._shaderValue=new Ve}E(t,"laya.d3.resource.models.Sky");var e=t.prototype;e._setEnvironmentDiffuse=function(){this._environmentDiffuse.loaded?this.__ownerCamera._shaderValues.setValue(7,this._environmentDiffuse):this._environmentDiffuse.on("loaded",this,this._environmentDiffuseLoaded)},e._setEnvironmentSpecular=function(){if(this._environmentSpecular.loaded){var t=this._environmentSpecular.simLodInfo;t&&t instanceof Float32Array&&this.__ownerCamera._shaderValues.setValue(9,t),this.__ownerCamera._shaderValues.setValue(8,this._environmentSpecular)}else this._environmentSpecular.on("loaded",this,this._environmentSpecularLoaded)},e._environmentDiffuseLoaded=function(){this.__ownerCamera._shaderValues.setValue(7,this._environmentDiffuse)},e._environmentSpecularLoaded=function(){var t=this._environmentSpecular.simLodInfo;t&&t instanceof Float32Array&&this.__ownerCamera._shaderValues.setValue(9,t),this.__ownerCamera._shaderValues.setValue(8,this._environmentSpecular)},e._render=function(t){},e.destroy=function(){this.__ownerCamera=null},v(0,e,"_ownerCamera",null,function(t){this.__ownerCamera=t,this._environmentDiffuse&&this._setEnvironmentDiffuse(),this._environmentSpecular&&this._setEnvironmentSpecular()}),v(0,e,"alphaBlending",function(){return this._alphaBlending},function(t){this._alphaBlending=t,this._alphaBlending<0&&(this._alphaBlending=0),1<this._alphaBlending&&(this._alphaBlending=1)}),v(0,e,"envDiffuseSHBlue",null,function(t){this.__ownerCamera._shaderValues.setValue(12,t)}),v(0,e,"colorIntensity",function(){return this._colorIntensity},function(t){this._colorIntensity=t,this._colorIntensity<0&&(this._colorIntensity=0)}),v(0,e,"envDiffuseSHGreen",null,function(t){this.__ownerCamera._shaderValues.setValue(11,t)}),v(0,e,"envDiffuseSHRed",null,function(t){this.__ownerCamera._shaderValues.setValue(10,t)}),v(0,e,"environmentDiffuse",function(){return this._environmentDiffuse},function(t){t.minFifter=9728,this._environmentDiffuse=t,this.__ownerCamera&&this._setEnvironmentDiffuse()}),v(0,e,"environmentSpecular",function(){return this._environmentSpecular},function(t){this._environmentSpecular=t,this.__ownerCamera&&this._setEnvironmentSpecular()}),t.MVPMATRIX=0,t.INTENSITY=1,t.ALPHABLENDING=2,t.DIFFUSETEXTURE=3}(),function(){function I(t){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=t,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}E(I,"laya.d3.resource.models.SubMesh");var t=I.prototype;return S.imps(t,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),t._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},t._getIndexBuffer=function(){return this._indexBuffer},t._getStaticBatchBakedVertexs=function(t,e){var i,n,r=this._vertexBuffer,a=r.vertexDeclaration,s=a.getVertexElementByUsage(0).offset/4,o=a.getVertexElementByUsage(3).offset/4,l=e.meshRender.lightmapScaleOffset,h=0,u=0,c=0,d=0,_=0,f=0;if(l)if(n=a.getVertexElementByUsage(15))c=a.vertexStride/4,i=0<this._vertexCount?r.getData().slice(this._vertexStart*c,(this._vertexStart+this._vertexCount)*c):r.getData().slice(),d=n.offset/4;else{c=(f=a.vertexStride/4)+2,i=this._vertexCount?new Float32Array(this._vertexCount*(r.vertexDeclaration.vertexStride/4+2)):new Float32Array(r.vertexCount*(r.vertexDeclaration.vertexStride/4+2)),d=(_=a.getVertexElementByUsage(2).offset/4)+2;var m=r.getData();for(h=0,u=m.length/f;h<u;h++){var p=0;p=0<this._vertexCount?(this._vertexStart+h)*f:h*f;var g=h*c,v=0;for(v=0;v<d;v++)i[g+v]=m[p+v];for(v=d;v<f;v++)i[g+v+2]=m[p+v]}}else c=a.vertexStride/4,i=this._vertexCount?r.getData().slice(this._vertexStart*c,(this._vertexStart+this._vertexCount)*c):r.getData().slice();if(t){var y=t.worldMatrix,x=I._tempMatrix4x40;y.invert(x);var b=I._tempMatrix4x41,T=e.transform.worldMatrix;ye.multiply(x,T,b)}else b=e.transform.worldMatrix;var S=I._tempQuaternion0;for(b.decomposeTransRotScale(I._tempVector30,S,I._tempVector31),h=0,u=i.length/c;h<u;h++){var E=h*c+s,R=h*c+o;if(ke.transformVector3ArrayToVector3ArrayCoordinate(i,E,b,i,E),ke.transformVector3ArrayByQuat(i,R,S,i,R),l){var w=h*c+d;if(n)ke.transformLightingMapTexcoordByUV1Array(i,w,l,i,w);else{var C=h*f+_;ke.transformLightingMapTexcoordByUV0Array(m,C,l,i,w)}}}return i},t._getVertexBuffers=function(){return null},t._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},t._render=function(t){var e,i=0,n=t.renderElement;if(1<this._indexCount){var r=this._boneIndicesList.length;if(1<r){for(var a=0;a<r;a++)(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[a]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),mr.mainContext.drawElements(4,this._subIndexBufferCount[a],5123,2*this._subIndexBufferStart[a]);Cn.drawCall+=r}else(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[0]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),mr.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),Cn.drawCall++;i=this._indexCount}else i=this._indexBuffer.indexCount,(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[0]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),mr.mainContext.drawElements(4,i,5123,0),Cn.drawCall++;Cn.trianglesFaces+=i/3},t.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},t.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},v(0,t,"_vertexBufferCount",function(){return 1}),v(0,t,"triangleCount",function(){return this._indexBuffer.indexCount/3}),m(I,["_tempVector30",function(){return this._tempVector30=new we},"_tempVector31",function(){return this._tempVector31=new we},"_tempQuaternion0",function(){return this._tempQuaternion0=new Te},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new ye},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new ye}]),I}()),Ae=function(){var v,i;function y(t,e,i,n,r){var a=this;function s(t){var e=[],i=new v(e);return a._compileToTree(i,t.split("\n"),0,e,r),i}var o=vn.now();this._VS=s(e),this._PS=s(i),this._nameMap=n,2<vn.now()-o&&console.log("ShaderCompile use time:"+(vn.now()-o)+"  size:"+e.length+"/"+i.length)}E(y,"laya.webgl.utils.ShaderCompile");var t=y.prototype;return t._compileToTree=function(t,e,i,n,r){var a,s,o,l,h,u,c,d=0,_=0,f=0,m=0;for(_=i;_<e.length;_++)if(!((o=e[_]).length<1)&&0!==(d=o.indexOf("//"))){if(0<=d&&(o=o.substr(0,d)),a=c||new v(n),c=null,a.text=o,a.noCompile=!0,0<=(d=o.indexOf("#"))){for(l="#",m=d+1,f=o.length;m<f;m++){var p=o.charAt(m);if(" "===p||"\t"===p||"?"===p)break;l+=p}switch(a.name=l){case"#ifdef":case"#ifndef":if(a.src=o,a.noCompile=null!=o.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+o.substr(d+a.name.length)+"}"):(u=o.replace(/^\s*/,"").split(/\s+/),a.setCondition(u[1],"#ifdef"===l?1:2),a.text="//"+a.text),a.setParent(t),t=a,r)for(u=o.substr(m).split(y._splitToWordExps3),m=0;m<u.length;m++)(o=u[m]).length&&(r[o]=!0);continue;case"#if":if(a.src=o,a.noCompile=!0,a.setParent(t),t=a,r)for(u=o.substr(m).split(y._splitToWordExps3),m=0;m<u.length;m++)(o=u[m]).length&&"defined"!=o&&(r[o]=!0);continue;case"#else":a.src=o,s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.condition=s.condition,a.conditionType=1==s.conditionType?2:1,a.text="//"+a.text+" "+s.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":u=y.splitToWords(o,null);var g=y.includes[u[1]];if(!g)throw"ShaderCompile error no this include file:"+u[1];if((d=u[0].indexOf("?"))<0){a.setParent(t),o=g.getWith("with"==u[2]?u[3]:null),this._compileToTree(a,o.split("\n"),0,n,r),a.text="";continue}a.setCondition(u[0].substr(d+1),1),a.text=g.getWith("with"==u[2]?u[3]:null);break;case"#import":h=(u=y.splitToWords(o,null))[1],n.push({node:a,file:y.includes[h],ofs:a.text.length});continue}}else{if((s=t.childs[t.childs.length-1])&&!s.name){0<n.length&&y.splitToWords(o,s),c=a,s.text+="\n"+o;continue}0<n.length&&y.splitToWords(o,a)}a.setParent(t)}},t.createShader=function(t,e,i){var n={},r="";if(t)for(var a in t)r+="#define "+a+"\n",n[a]=!0;var s=this._VS.toscript(n,[]),o=this._PS.toscript(n,[]);return(i||ks.create)(r+s.join("\n"),r+o.join("\n"),e,this._nameMap)},y._parseOne=function(t,e,i,n,r,a){var s={type:y.shaderParamsMap[i[n+1]],name:i[n+2],size:isNaN(parseInt(i[n+3]))?1:parseInt(i[n+3])};return a&&("attribute"==r?t.push(s):e.push(s)),":"==i[n+3]&&(s.type=i[n+4],n+=2),n+=2},y.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(y.includes[t])throw new Error("add shader include file err, has add:"+t);y.includes[t]=new i(e)},y.preGetParams=function(t,e){var i=[t,e],n={},r=[],a=[],s={},o=[];n.attributes=r,n.uniforms=a,n.defines=s;for(var l=0,h=0,u=0;u<2;u++){i[u]=i[u].replace(y._removeAnnotation,"");var c,d=i[u].match(y._reg);for(l=0,h=d.length;l<h;l++){var _=d[l];if("attribute"==_||"uniform"==_)l=y._parseOne(r,a,d,l,_,!0);else{if("#define"==_){o[_=d[++l]]=1;continue}if("#ifdef"==_){s[c=d[++l]]=s[c]||[];for(l++;l<h;l++)if("attribute"==(_=d[l])||"uniform"==_)l=y._parseOne(r,a,d,l,_,o[c]);else if("#else"==_)for(l++;l<h;l++)if("attribute"==(_=d[l])||"uniform"==_)l=y._parseOne(r,a,d,l,_,!o[c]);else if("#endif"==_)break}}}}return n},y.splitToWords=function(t,e){for(var i,n,r=[],a=-1,s=0,o=t.length;s<o;s++)if(i=t.charAt(s),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=a&&1<s-a&&(n=t.substr(a,s-a),r.push(n)),'"'==i||"'"==i){var l=t.indexOf(i,s+1);if(l<0)throw"Sharder err:"+t;r.push(t.substr(s+1,l-s-1)),s=l,a=-1;continue}"("==i&&e&&0<r.length&&(n=r[r.length-1]+";","vec4;main;".indexOf(n)<0&&(e.useFuns+=n)),a=-1}else a<0&&(a=s);return a<o&&1<o-a&&(n=t.substr(a,o-a),r.push(n)),r},y.IFDEF_NO=0,y.IFDEF_YES=1,y.IFDEF_ELSE=2,y.IFDEF_PARENT=3,y._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),y._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),y._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),y.includes={},m(y,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),y.__init$=function(){v=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}E(i,"");var t=i.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(n,r,a){if(this.childs.length<1&&!this.text)return r;r.length;if(this.condition){var t=!!this.condition.call(n);if(2===this.conditionType&&(t=!t),!t)return r}if(this.text&&r.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(n,r,a)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,s=this.includefiles.length;i<s;i++)this.includefiles[i].curUseID!=a&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=a,r[0]=e+r[0]);return r},i.__id=1,i}(),i=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,n=0;!((e=t.indexOf("#begin",e))<0);){for(n=e+5;!((n=t.indexOf("#end",n))<0)&&"i"===t.charAt(n+4);)n+=5;if(n<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var r=y.splitToWords(t.substr(e,i-e),null);"code"==r[1]?this.codes[r[2]]=t.substr(i+1,n-i-1):"function"==r[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[r[3]]=t.substr(i+1,n-i-1),this.funnames+=r[3]+";"),e=n+1}}E(t,"");var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}()},y}(),De=function(){function t(t){this.defineCounter=0,this.defines=null,this.defines=t?(this.defineCounter=t.defineCounter,t.defines.slice()):(this.defineCounter=0,[])}return E(t,"laya.d3.shader.ShaderDefines"),t.prototype.registerDefine=function(t){var e=Math.pow(2,this.defineCounter++);return this.defines[e]=t,e},t}(),Le=function(){function t(){}return E(t,"laya.d3.shader.ShaderInit3D"),t.__init__=function(){var t,e;Xr._globalRegDefine("HIGHPRECISION",Xr.SHADERDEFINE_HIGHPRECISION),Xr._globalRegDefine("FOG",Xr.SHADERDEFINE_FOG),Xr._globalRegDefine("DIRECTIONLIGHT",Xr.SHADERDEFINE_DIRECTIONLIGHT),Xr._globalRegDefine("POINTLIGHT",Xr.SHADERDEFINE_POINTLIGHT),Xr._globalRegDefine("SPOTLIGHT",Xr.SHADERDEFINE_SPOTLIGHT),Xr._globalRegDefine("UV",Xr.SHADERDEFINE_UV0),Xr._globalRegDefine("COLOR",Xr.SHADERDEFINE_COLOR),Xr._globalRegDefine("UV1",Xr.SHADERDEFINE_UV1),Xr._globalRegDefine("CASTSHADOW",Ne.SHADERDEFINE_CAST_SHADOW),Xr._globalRegDefine("SHADOWMAP_PSSM1",Ne.SHADERDEFINE_SHADOW_PSSM1),Xr._globalRegDefine("SHADOWMAP_PSSM2",Ne.SHADERDEFINE_SHADOW_PSSM2),Xr._globalRegDefine("SHADOWMAP_PSSM3",Ne.SHADERDEFINE_SHADOW_PSSM3),Xr._globalRegDefine("SHADOWMAP_PCF_NO",Ne.SHADERDEFINE_SHADOW_PCF_NO),Xr._globalRegDefine("SHADOWMAP_PCF1",Ne.SHADERDEFINE_SHADOW_PCF1),Xr._globalRegDefine("SHADOWMAP_PCF2",Ne.SHADERDEFINE_SHADOW_PCF2),Xr._globalRegDefine("SHADOWMAP_PCF3",Ne.SHADERDEFINE_SHADOW_PCF3),Xr._globalRegDefine("DEPTHFOG",Xr.SAHDERDEFINE_DEPTHFOG),Us.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),Us.addInclude("Lighting.glsl","\nstruct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nstruct PointLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tfloat Range;\n};\n\nstruct SpotLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tvec3 Direction;\n\tfloat Spot;\n\tfloat Range;\n};\n\n// U3D中使用衰减纹理,此函数模拟并非正确\n//float U3DAttenuation(in vec3 L,in float invLightRadius)\n//{\n//\tfloat fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\n//\tfRatio *= fRatio;\n//\treturn 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\n//} \n\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\nfloat BasicAttenuation(in vec3 L,in float invLightRadius)\n{\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius)); \t\n\treturn attenuation * attenuation;\n} \n\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread\t\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius)\n{\n\tfloat attenuationFactor = 30.0;\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\n\tattenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\n\t// Second we move down the function therewith it reaches zero at abscissa 1:\n\tattenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\n\tattenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\n\t// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\n\tattenuation /= 1.0 - attenuationFactor;\n\treturn attenuation;\n} \n\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor)\n{\n    mediump vec3 h = normalize(viewDir-lightVec);\n    lowp float ln = max (0.0, dot (-lightVec,normal));\n    float nh = max (0.0, dot (h,normal));\n\tdiffuseColor=lightColor * ln;\n\tspecularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\n}\n\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec=normalize(light.Direction);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec,diffuseColor,specularColor);\n}\n\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec/length(lightVec),diffuseColor,specularColor);\n\tfloat attenuate = BasicAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor)\n{\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tvec3 normalLightVec=lightVec/length(lightVec);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,normalLightVec,diffuseColor,specularColor);\n\tfloat spot = pow(max(dot(normalLightVec, normalize(light.Direction)), 0.0), light.Spot);\n\tfloat attenuate = spot*BasicAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal)\n{\n\tvec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\n\t\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tmat3 TBN = mat3(T, B, N);\n\t\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\n"),Us.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),Us.addInclude("WaveFunction.glsl","\nuniform vec2 u_WaveInfoD[20];\nuniform vec4 u_WaveInfo[20];\n\nuniform float TEXWAVE_UV_SCALE ;//= 20.0; //每texwidth像素代表的实际距离\n/**\n\t这里的计算都是\n*/\n\n/**\n* 计算一个波形\n*  开始计算的时候都按照z向上，最后输出的时候，颠倒一下。\n* @param tm {float} 毫秒\n*/\nvoid calcGerstnerWave(float curtm, vec3 pos, float deep, vec2 uvpos, out vec3 opos, out vec3 B, out vec3 T, out vec3 N, out float foamS){\n\tfloat tm = curtm/1000.;\n\topos = pos;\n\tvec3 wpos=vec3(0.);\t\t//累加的位置\n\tN=vec3(0.,0.,0.);\t//输出的法线初始化一下\n\tT=vec3(0.,0.,0.);\n\tB=vec3(0.,0.,0.);\n\tvec2 cD ;//= D;\n\t//float deepAtt = max(0.,min(deep,1.0));\n\t//A*=deepAtt; //TODO\n\t\n\tfor( int i=0; i<4; i++){\n\t\tcD = u_WaveInfoD[i];//vec2(wi.winfo[0],wi.winfo[1]);// wi.vDir;\n\t\tfloat Q = u_WaveInfo[i].x;//wi.QorK;\n\t\tfloat A = u_WaveInfo[i].y;//wi.A;\n\t\tfloat W = u_WaveInfo[i].z;//wi.omega;\n\t\tfloat P = u_WaveInfo[i].w;//wi.phi;\n\t\tfloat dop = dot(cD,uvpos);\n\t\tfloat c = cos(dop*W - tm*P);//TODO 优化\n\t\tfloat s = sin(dop*W - tm*P);\n\t\tfloat AWs = A*W*s;\n\t\tfloat AWc = A*W*c;\n\t\tfloat _QxyAWs = -Q*cD.x*cD.y*AWs;\n\t\t\n\t\twpos += vec3(Q*A*cD.x*c,\n\t\t\t\t\tQ*A*cD.y*c,\n\t\t\t\t\tA*s);\n\t\tN += vec3(-cD.x*AWc,\n\t\t\t\t-cD.y*AWc,\n\t\t\t\tQ*AWs);//记得最后1-\n\t\tT += vec3(_QxyAWs,\n\t\t\t\tQ*cD.y*cD.y*AWs,//记得1-\n\t\t\t\tcD.y*AWc\n\t\t\t);\n\t\tB += vec3(Q*cD.x*cD.x*AWs,//记得1-\n\t\t\t\t_QxyAWs,\n\t\t\t\tcD.x*AWc\n\t\t\t);\n\t\t//float v1 = exp(-tan((dop*W - tm*P)/2.+1.07));//除2，+pi/2 这样正好能对齐\n#ifdef USE_FOAM\t\t\n\t\tfloat v1 = 0.5-sin((dop*W - tm*P)/1.+2.0)/2.;\n\t\tfoamS += pow(v1,9.)/4.;\n#endif\n\t}\n\tT.y=1.-T.y; B.x=1.-B.x;N.z=1.-N.z;\n\topos += vec3(wpos.x,wpos.z*min(deep/10.,1.),wpos.y);\n\t//y和z交换一下。现在根据uv计算的位置，所以直接交换yz就行。其他情况下有问题么\n\tT.xyz=T.xzy;\n\tB.xyz=B.xzy;\n\tN.xyz=N.xzy;\n}\n\n\nvoid calcWave(float curtm, vec2 uv, out vec3 B, out vec3 T, out vec3 N){\n\tfloat tm = curtm/1000.;\n\tN=vec3(0.,0.,0.);\t//输出的法线初始化一下\n\tvec2 uvpos = uv*TEXWAVE_UV_SCALE; //TODO 这个范围是什么 就是1？\n\tuvpos.y*=-1.;\n\tvec2 cD;// = D;\n\tconst int NumWaves = 4;\n\tfloat scale = 1./float(NumWaves);\n\tfor( int i=0; i<NumWaves; i++){\n\t\tcD = u_WaveInfoD[i];//vec2(wi.winfo[0],wi.winfo[1]);// wi.vDir;\n\t\tfloat k = 1.5;//u_WaveInfo[i].x;//wi.QorK; TODO  不知道为什么，这个取u_WaveInfo[i].x，在mi3w上就会闪。测试发现实际值也传过来了，就是1.5\n\t\tfloat A = u_WaveInfo[i].y;//wi.A;\n\t\tfloat W = u_WaveInfo[i].z;//wi.omega;\n\t\tfloat P = u_WaveInfo[i].w;//wi.phi;\n\t\t\n\t\tfloat dop = dot(cD,uvpos);\n\t\tfloat c = cos(dop*W - tm*P);//TODO 优化\n\t\tfloat s = sin(dop*W - tm*P);\n\t\t/*\n\t\tfloat AWs = A*W*s;\n\t\tfloat AWc = A*W*c;\n\t\tfloat _QxyAWs = -Q*cD.x*cD.y*AWs;\n\t\t\n\t\tN += vec3(-cD.x*AWc,\n\t\t\t\t-cD.y*AWc,\n\t\t\t\tQ*AWs);//记得最后1-\n\t\t*/\n\t\tfloat kWAc = scale*c;//k*W*A*c;  为了提高精度，这里只保留sin，cos部分，实际使用的时候再乘回来。\n\t\t//float kWAc = k*W*A*c;  \n\t\tN += vec3(\n\t\t\t-kWAc*cD.x*pow((s+1.)/2.,k-1.),\n\t\t\t-kWAc*cD.y*pow((s+1.)/2.,k-1.),\n\t\t\t1.\n\t\t);\n\t}\n\t//N.z=1.-N.z;\n\t//y和z交换一下。现在根据uv计算的位置，所以直接交换yz就行。其他情况下有问题么\n\tN.xyz=N.xzy;\n}\n"),Us.addInclude("BRDF.glsl","vec4 LayaAirBRDF(in vec3 diffuseColor, in vec3 specularColor, in float oneMinusReflectivity, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n\tvec3 halfDir = SafeNormalize(viewDir - lightDir);\n\t\n\tfloat nv = abs(dot(normal, viewDir));\n\t\n\tfloat nl = clamp(dot(normal,   -lightDir),  0.0, 1.0);\n\tfloat nh = clamp(dot(normal,     halfDir),  0.0, 1.0);\n\tfloat lv = clamp(dot(lightDir,   viewDir),  0.0, 1.0);\n\tfloat lh = clamp(dot(lightDir,  -halfDir),  0.0, 1.0);\n\t\n\tfloat diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\t\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\t\n\t//#if UNITY_BRDF_GGX\n\tfloat V = SmithJointGGXVisibilityTerm(nl, nv, roughness);\n\tfloat D = GGXTerm(nh, roughness);\n\t\n\tfloat specularTerm = V * D * PI;\n\t\n\tspecularTerm = sqrt(max(0.0001, specularTerm));\n\tspecularTerm = max(0.0, specularTerm * nl);\n\t\n\tvec4 color;\n\tcolor.rgb = diffuseColor * (gi + lightColor * diffuseTerm) + specularTerm * lightColor * FresnelTerm (specularColor, lh);\n\t\n\tcolor.a = 1.0;\n\treturn color;\n}"),Us.addInclude("PBRUtils.glsl","struct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nvec3 UnpackScaleNormal(in vec2 uv0)\n{\n\t#ifdef NORMALTEXTURE\n\t\tvec3 normalT;\n\t\tvec4 normalMapSample = texture2D(u_NormalTexture, uv0);\n\t\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\t\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\t\tnormalT.xy *= u_normalScale;\n\t\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\t\t\n\t\tvec3 T = normalize(v_Tangent);\n\t\tvec3 B = normalize(v_Binormal);\n\t\tvec3 N = normalize(v_Normal);\n\t\tmat3 TBN = mat3(T, B, N);\n\t\t\n\t\tvec3 bumpedNormal = TBN * normalize(normalT);\n\t\treturn bumpedNormal;\n\t#else\n\t\treturn normalize(v_Normal);\n\t#endif\n}\n\nvec4 DielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\n\nfloat PI = 3.14159265359;\n\nvec3 FresnelTerm (in vec3 F0, in float cosA)\n{\n\treturn F0 + (vec3(1.0) - F0) * pow(1.0 - cosA, 5.0);\n}\n\nfloat PerceptualRoughnessToRoughness(in float perceptualRoughness)\n{\n\treturn perceptualRoughness * perceptualRoughness;\n}\n\nfloat PerceptualRoughnessToSpecularPower(in float perceptualRoughness)\n{\n\tfloat m = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat sq = max(0.0001, m * m);\n\tfloat n = (2.0 / sq) - 2.0;\n\tn = max(n, 0.0001);\n\treturn n;\n}\n\nfloat RoughnessToPerceptualRoughness(in float roughness)\n{\n\treturn sqrt(roughness);\n}\n\nfloat SmoothnessToRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness) * (1.0 - smoothness);\n}\n\nfloat SmoothnessToPerceptualRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness);\n}\n\nvec3 SafeNormalize(in vec3 inVec)\n{\n\tfloat dp3 = max(0.001,dot(inVec,inVec));\n\treturn inVec * (1.0 / sqrt(dp3));\n}\n\nfloat DisneyDiffuse(in float NdotV, in float NdotL, in float LdotH, in float perceptualRoughness)\n{\n\tfloat fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n\tfloat lightScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotL,5.0));\n\tfloat viewScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotV,5.0));\n\n\treturn lightScatter * viewScatter;\n}\n\nfloat SmithJointGGXVisibilityTerm (float NdotL, float NdotV, float roughness)\n{\n\tfloat a = roughness;\n\tfloat lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n\tfloat lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\n\treturn 0.5 / (lambdaV + lambdaL + 0.00001);\n}\n\nfloat GGXTerm (float NdotH, float roughness)\n{\n\tfloat a2 = roughness * roughness;\n\tfloat d = (NdotH * a2 - NdotH) * NdotH + 1.0;\n\treturn 0.31830988618 * a2 / (d * d + 0.0000001);\n}\n\nfloat OneMinusReflectivityFromMetallic(in float metallic)\n{\n\tfloat oneMinusDielectricSpec = DielectricSpecularColor.a;\n\treturn oneMinusDielectricSpec - metallic * oneMinusDielectricSpec;\n}\n\nfloat SpecularStrength(vec3 specular)\n{\n    //(SHADER_TARGET < 30)return specular.r; \n    return max (max (specular.r, specular.g), specular.b);\n}\n\nvec3 DiffuseAndSpecularFromMetallic(in vec3 diffuseColor, in float metallic, out vec3 specularColor, out float oneMinusReflectivity)\n{\n\tspecularColor = mix(DielectricSpecularColor.rgb, diffuseColor, metallic);\n\toneMinusReflectivity = OneMinusReflectivityFromMetallic(metallic);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec3 EnergyConservationBetweenDiffuseAndSpecular(in vec3 diffuseColor, in vec3 specularColor, out float oneMinusReflectivity)\n{\n\toneMinusReflectivity = 1.0 - SpecularStrength(specularColor);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec4 Occlusion(in vec2 uv0){\n\t#ifdef OCCLUSIONTEXTURE\n\t\tvec4 occlusionTextureColor = texture2D(u_OcclusionTexture, uv0);\n\t\tfloat occ = occlusionTextureColor.g;\n\t\tfloat oneMinusT = 1.0 - u_occlusionStrength;\n\t\tfloat lerpOneTo = oneMinusT + occ * u_occlusionStrength;\n\t\treturn occlusionTextureColor * lerpOneTo;\n\t#else\n\t\treturn vec4(1.0);\n\t#endif\n}\n\nvec2 ParallaxOffset(in vec3 viewDir){\n\t#ifdef PARALLAXTEXTURE\n\t\tfloat h = texture2D(u_ParallaxTexture, v_Texcoord0).g;\n\t\th = h * u_parallaxScale - u_parallaxScale / 2.0;\n\t\tvec3 v = viewDir;\n\t\tv.z += 0.42;\n\t\tvec2 offset = h * (v.xy / v.z);\n\t\treturn v_Texcoord0 + offset;\n\t#else\n\t\treturn v_Texcoord0;\n\t#endif\n}\n\n"),Us.addInclude("PBRStandardLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRStandardLight(in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 specularColor;\n\tdiffuseColor = DiffuseAndSpecularFromMetallic (diffuseColor, metallic, specularColor, oneMinusReflectivity);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\treturn color;\n}\n\nvec4 PBRStandardDiectionLight (in vec3 diffuseColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in vec3 gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRStandardLight(diffuseColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec2 MetallicGloss(in float diffuseTextureAlpha, in vec2 uv0)\n{\n\tvec2 mg;\n\t\n\t#ifdef METALLICGLOSSTEXTURE\n\t\tvec4 metallicGlossTextureColor = texture2D(u_MetallicGlossTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tmg.r = metallicGlossTextureColor.r;\n\t\t\tmg.g = diffuseTextureAlpha;\n\t\t#else\n\t\t    mg = metallicGlossTextureColor.ra;\n\t\t#endif\n\t\tmg.g *= u_smoothnessScale;\n\t#else\n\t\tmg.r = u_metallic;\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tmg.g = diffuseTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tmg.g = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n\treturn mg;\n}\n\n'),Us.addInclude("PBRSpecularLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRSpecularLight(in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in vec3 gi)\n{\n\tfloat oneMinusReflectivity;\n\tdiffuseColor = EnergyConservationBetweenDiffuseAndSpecular (diffuseColor, specularColor, oneMinusReflectivity);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\treturn color;\n}\n\nvec4 PBRSpecularDiectionLight (in vec3 diffuseColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in vec3 gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRSpecularLight(diffuseColor, specularColor, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec4 SpecularGloss(float diffuseTextureAlpha, in vec2 uv0)\n{\n    vec4 sg;\n\t\n\t#ifdef SPECULARTEXTURE\n\t\tvec4 specularTextureColor = texture2D(u_SpecularTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tsg.rgb = specularTextureColor.rgb;\n\t\t\tsg.a = diffuseTextureAlpha;\n\t\t#else\n\t\t\tsg = specularTextureColor;\n\t\t#endif\n\t\tsg.a *= u_smoothnessScale;\n\t#else\n\t\tsg.rgb = u_SpecularColor.rgb;\n\t\t#ifdef SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA\n\t\t\tsg.a = diffuseTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tsg.a = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n    return sg;\n}\n\n');var i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_ReflectTexture:[5,1],u_AlphaTestValue:[0,1],u_DiffuseColor:[6,1],u_MaterialSpecular:[8,1],u_Shininess:[9,1],u_MaterialReflect:[10,1],u_TilingOffset:[11,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Color":[4,4],"u_DirectionLight.Direction":[3,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Color":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Color":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]},r=Us.nameKey.add("BLINNPHONG");t='attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldMat;\n\t\t#ifdef BONE\n\t\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\t#else\n\t\t\tworldMat=mat3(u_WorldMat);\n\t\t#endif  \n\t\tv_Normal=worldMat*a_Normal;//TODO:法线可以用"魔法"矩阵\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=worldMat*a_Tangent0.xyz;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t\t#ifdef BONE\n\t\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t\t#else\n\t\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\tv_Texcoord0=a_Texcoord0;\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0+v_Texcoord0.y);\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#ifdef COLOR\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}',e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_ViewDir; \n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform vec3 u_MaterialReflect;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#ifdef COLOR\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular= vec3(0.0);\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef SPOTLIGHT\n\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t\n\tvec3 finalDiffuse;\n\t#ifdef LIGHTMAP\n\t\tfinalDiffuse=texture2D(u_LightMap, v_LightMapUV).rgb*2.0;\n\t\t//float exponent = texture2D(u_LightMap, v_LightMapUV).a;\n\t\t//finalDiffuse = texture2D(u_LightMap, v_LightMapUV).rgb;\n\t\t//float ratio = pow(2.0, exponent * 255.0 - (128.0 + 8.0));\n\t\t//finalDiffuse = finalDiffuse * 255.0 * ratio;\t\n\t\t//finalDiffuse = sqrt(finalDiffuse);\n\t#else\n\t\tfinalDiffuse=vec3(0.0);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tfinalDiffuse+=diffuse;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse)*shadowValue,mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(u_AmbientColor + finalDiffuse),mainColor.a);\n\t#endif\n\t\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\n\n\t#ifdef REFLECTMAP\n\t\tvec3 incident = -viewDir;\n\t\tvec3 reflectionVector = reflect(incident,normal);\n\t\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\t\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t  main_normal();\n\t#endif  \n}\n\n';var a=Xr.add(r,t,e,i,n);rs.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),rs.SHADERDEFINE_NORMALMAP=a.registerMaterialDefine("NORMALMAP"),rs.SHADERDEFINE_SPECULARMAP=a.registerMaterialDefine("SPECULARMAP"),rs.SHADERDEFINE_REFLECTMAP=a.registerMaterialDefine("REFLECTMAP"),rs.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),rs.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var s=Us.nameKey.add("SIMPLE");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",e='#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',a=Xr.add(s,t,e,i,n),us.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),us.SHADERDEFINE_NORMALMAP=a.registerMaterialDefine("NORMALMAP"),us.SHADERDEFINE_SPECULARMAP=a.registerMaterialDefine("SPECULARMAP"),us.SHADERDEFINE_EMISSIVEMAP=a.registerMaterialDefine("EMISSIVEMAP"),us.SHADERDEFINE_AMBIENTMAP=a.registerMaterialDefine("AMBIENTMAP"),us.SHADERDEFINE_REFLECTMAP=a.registerMaterialDefine("REFLECTMAP"),us.SHADERDEFINE_UVTRANSFORM=a.registerMaterialDefine("UVTRANSFORM"),us.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),us.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),i={a_Position:0,a_Color:1},n={u_MvpMatrix:[1,2]};var o=Us.nameKey.add("LINE");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  v_Color=a_Color;\n}",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n  gl_FragColor=v_Color; \n}\n\n",Xr.add(o,t,e,i,n),i={a_position:0,a_normal:3,tangent:5,binormal:4,uv:2,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_lodRect:[9,3],irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],u_aoObjPos:[14,1],texBaseColor:[1,1],texNormal:[2,1],texPbrInfo:[3,1],texPrefilterdEnv:[8,3],texHSNoise:[15,1],texPrefilterDiff:[7,3],u_AlphaTestValue:[0,1],texBRDFLUT:[4,1],u_UVAniAge:[5,1],u_roughness:[6,1],u_metaless:[7,1],u_UVMatrix:[8,1],u_UVAge:[9,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var l=Us.nameKey.add("PBR");t="\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n#ifdef HAS_TANGENT\nattribute vec3 tangent;\nattribute vec3 binormal;\n#endif\nattribute vec2 uv;\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\n\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\nvoid main() {\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tgl_Position = mvp*skinTransform*vec4(a_position,1.);\n\tmat4 modelMat = modelMatrix*skinTransform;\n#else\n\tgl_Position = mvp*vec4(a_position,1.);\n\tmat4 modelMat = modelMatrix;\n#endif\t\n\tvWorldPos = modelMat*vec4(a_position,1.);\n\n#ifdef CASTSHADOW \n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tvUv = uv;\n\t#endif\t\n#else\n    vUv = uv;\n\tvWorldNorm = normalize((modelMat*vec4(a_normal,0.0)).xyz);\n\t#ifdef HAS_TANGENT\n\tvWorldTangent = normalize((modelMat*vec4(tangent,0.0)).xyz);\n\tvWorldBinormal = normalize((modelMat*vec4(binormal,0.0)).xyz);\n\t#endif\n    \n    vViewDir = (vWorldPos.xyz-cameraPosition);//这个不能normalize。否则无法线性差值了\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.z;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vWorldPos;\n\t#endif\n#endif\t\n#endif\n}\n",e='//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\n#ifdef HAS_TANGENT\nvarying vec3 vWorldTangent;\nvarying vec3 vWorldBinormal;\n#endif\nvarying vec3 vViewDir;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n//预计算的贴图\nuniform sampler2D texPrefilterdEnv;\nuniform sampler2D texBRDFLUT;\nuniform sampler2D texPrefilterDiff;\n#ifdef HAS_PBRINFO\nuniform sampler2D texPbrInfo;   //Ao, Roughness, Metallic\n#endif\nuniform float u_hdrexposure;\nuniform float u_AlphaTestValue;\n\nuniform float u_roughness;\nuniform float u_metaless;\nconst float maxlv = 7.;\t//现在只支持512分辨率的环境贴图\nconst int nmaxlv = 9;//\n\t\t\t\t\t\t\t\nuniform mat4 irrad_mat_red;\nuniform mat4 irrad_mat_green;\nuniform mat4 irrad_mat_blue;\t\t\t\t\t\t\t\n\nvec3 speccontrib = vec3(0.);\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\nvec4 tex2dLod(sampler2D tex, float u, float v, float lod){\n\tvec2 uv = vec2(u,v);\n\tuv+=mod(gl_FragCoord.xy-vec2(0.5),2.0)*vec2(128.,0.);\n\treturn texture2D(tex,uv,lod-16.);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn texture2D(tex,vec2(envu,envv));\n}\n\nvec4 texPanoramaLod(sampler2D tex, const in vec3 dir, float lod){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn tex2dLod(tex,envu,envv,lod);\n}\n\n/*\n    计算sh光照。\n    使用level=2，所以需要9个系数。\n    https://cseweb.ucsd.edu/~ravir/papers/envmap/envmap.pdf\n*/\nfloat environment_exposure = 1.0;\nvec3 diff_sh9(vec3 dir){\n\tvec4 shDir = vec4(dir.x,-dir.z,dir.y,1.0);\n  return max(vec3(0.0), vec3(\n\tdot(shDir, irrad_mat_red * shDir),\n\tdot(shDir, irrad_mat_green * shDir),\n\tdot(shDir, irrad_mat_blue * shDir)\n\t)) * environment_exposure;\t\n}\n\n#ifdef HAS_TANGENT\nvec3 applyNormalTex( vec3 norm, vec3 surf_norm ) {\n    vec3 mapN = norm * 2.0 - 1.0;\n    //mapN.xy = normalScale * mapN.xy;\n    mat3 tsn = mat3( vWorldTangent, vWorldBinormal, surf_norm );\n    return normalize( tsn * mapN );\n}\n#endif\n\nvec4 pbrlight(vec3 normal, float rough, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n\tbasecolor.rgb = pow(basecolor.rgb,vec3(2.2));\n\tfloat metaless = 1.0; \t\n\tconst float ismetalinfov = (128./255.);\n\tif(basecolor.a>=ismetalinfov){//这时候表示金属度\n\t\tmetaless = (basecolor.a-ismetalinfov)*2.;\n\t\tbasecolor.a = 1.0;\n\t}else{\n\t\tmetaless = 0.;\n\t\tbasecolor.a = basecolor.a*2.0;\n\t}\n\t#ifdef FIX_METALESS\n\tmetaless = u_metaless;\n\t#endif\n\t#ifdef HAS_PBRINFO\t\n\tvec4 pbrinfo = texture2D(texPbrInfo, vUv);\n\tmetaless = pbrinfo.b;\n\trough = pbrinfo.g;\n\t#endif\n    const vec3 nonmetalF0 =vec3(0.02);\n    vec3 F0 =  mix(nonmetalF0, basecolor.rgb, metaless);\n\t\n    vec4 PrefilteredColor = texPanoramaLod(texPrefilterdEnv, R, rough*maxlv);\n    PrefilteredColor.rgb = _RGBEToRGB(PrefilteredColor);\n    vec4 EnvBRDF = texture2D(texBRDFLUT,vec2(rough , NoV));//TODO lod\n    vec2 rg = _RGBAToU16(EnvBRDF);    \n    speccontrib = (F0* rg.x + saturate( 50.0 * PrefilteredColor.g ) * rg.y);\n\tvec3 color_spec = PrefilteredColor.rgb*speccontrib;\n\t\n\tvec3 color_diff=diff_sh9(normal);\n\tvec3 outc =  color_diff*mix(basecolor.rgb,vec3(0.),metaless)*(vec3(1.0)-speccontrib)+color_spec;\n\t#ifdef HAS_PBRINFO\n\toutc*=pbrinfo.r;\n\t#endif\n\treturn vec4(outc, basecolor.a);\n}\n\nvec3 oldlight(vec4 normal, float NoV, vec3 R){\n    vec4 basecolor = texture2D(texBaseColor,vUv);\n\tconst vec3 lightdir=normalize(vec3(1.,1.,0.));\n\tconst vec3 spcecol = vec3(1.,0.8,0.8);\n\tconst vec3 amb = vec3(0.5);\n\tvec3 diffv =  (vec3(saturate(dot(lightdir,normal.xyz)))+amb);\n\t//vec3 spec = spcecol* pow(saturate(dot(R,lightdir)),(1.-pbrinfo.g)*5.);\n\treturn diffv*basecolor.rgb;//+spec;\n}\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\nvarying float v_posViewZ;\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main() {\n#ifdef CASTSHADOW\n\tgl_FragColor=packDepth(gl_FragCoord.w);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(texBaseColor,vUv).w;\n\t\tif( alpha < u_AlphaTestValue ){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n#else\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,vWorldPos.xyz,v_posViewZ,0.0001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.0001);\n\t\t#endif\n\t#endif\t\n\t\n    vec3 normal =  normalize(vWorldNorm);\n\tvec4 normtex = texture2D( texNormal, vUv );\n\t#ifdef HAS_TANGENT\t\n\tnormal = applyNormalTex(normtex.xyz, normal);\n\t#endif\n    vec3 view   = -normalize(vViewDir);\n    float NoV = saturate(dot( view, normal ));\n    vec3 R = 2. * NoV * normal - view;\n\tfloat roughness = normtex.a;\n\t#ifdef FIX_ROUGHNESS\n\troughness = u_roughness;\n\t#endif\n\t\n\tvec4 pbrl = pbrlight(normal,roughness,NoV,R)*u_hdrexposure;\n    gl_FragColor.rgb =  pow(pbrl.rgb,vec3(0.45455));\n\t//gl_FragColor.rgb = oldlight(normtex,NoV,R);\n\t#ifdef RECEIVESHADOW\n\tgl_FragColor.rgb *= max(shadowValue,0.7);\n\t#endif\n\t\n    gl_FragColor.a = pbrl.a;\n\n#endif\n}\n',a=Xr.add(l,t,e,i,n),os.SHADERDEFINE_FIX_METALESS=a.registerMaterialDefine("FIX_METALESS"),os.SHADERDEFINE_FIX_ROUGHNESS=a.registerMaterialDefine("FIX_ROUGHNESS"),os.SHADERDEFINE_HAS_TANGENT=a.registerMaterialDefine("HAS_TANGENT"),os.SHADERDEFINE_HAS_PBRINFO=a.registerMaterialDefine("HAS_PBRINFO"),os.SHADERDEFINE_USE_GROUNDTRUTH=a.registerMaterialDefine("USE_GROUNDTRUTH"),os.SHADERDEFINE_TEST_CLIPZ=a.registerMaterialDefine("CLIPZ"),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_EmissionColor:[8,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_MetallicGlossTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_metallic:[9,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[17,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var h=Us.nameKey.add("PBRStandard");t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tmat4 skinTransform = mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\tv_PositionWorld = (u_WorldMat * position).xyz;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t\tworldMat = mat3(u_WorldMat);\n\t\tv_PositionWorld = (u_WorldMat * a_Position).xyz;\n\t#endif\n\t\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n\tv_Texcoord0 = a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n\tv_ViewDir = u_CameraPos - v_PositionWorld;\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\n\n#ifdef DIFFUSETEXTURE\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef METALLICGLOSSTEXTURE\n\tuniform sampler2D u_MetallicGlossTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRStandardLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec2 mg;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n\t\tvec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n\t\tmg = MetallicGloss(diffuseTextureColor.a, uv0);\n\t#else\n\t\tvec4 diffuseColor = u_DiffuseColor;\n\t\tmg = MetallicGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(diffuseColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tgl_FragColor = diffuseColor;\n\t\n\tvec3 normal = UnpackScaleNormal(uv0);\n  \n\tvec3 gi = (u_AmbientColor * Occlusion(uv0)).rgb;\n  \n\tvec4 color = PBRStandardDiectionLight(diffuseColor.rgb, mg.r, mg.g, normal, viewDir, u_DirectionLight, gi);\n\t\n\tcolor.a = diffuseColor.a;\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',a=Xr.add(h,t,e,i,n),hs.SHADERDEFINE_DIFFUSETEXTURE=a.registerMaterialDefine("DIFFUSETEXTURE"),hs.SHADERDEFINE_METALLICGLOSSTEXTURE=a.registerMaterialDefine("METALLICGLOSSTEXTURE"),hs.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=a.registerMaterialDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),hs.SHADERDEFINE_NORMALTEXTURE=a.registerMaterialDefine("NORMALTEXTURE"),hs.SHADERDEFINE_PARALLAXTEXTURE=a.registerMaterialDefine("PARALLAXTEXTURE"),hs.SHADERDEFINE_OCCLUSIONTEXTURE=a.registerMaterialDefine("OCCLUSIONTEXTURE"),hs.SHADERDEFINE_EMISSION=a.registerMaterialDefine("EMISSION"),hs.SHADERDEFINE_EMISSIONTEXTURE=a.registerMaterialDefine("EMISSIONTEXTURE"),hs.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),i={a_Position:0,a_Normal:3,a_Tangent0:5,a_Texcoord0:2,a_BoneWeights:7,a_BoneIndices:6},n={u_Bones:[0,0],u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_AlphaTestValue:[0,1],u_DiffuseColor:[7,1],u_SpecularColor:[8,1],u_EmissionColor:[9,1],u_DiffuseTexture:[1,1],u_NormalTexture:[3,1],u_ParallaxTexture:[4,1],u_SpecularTexture:[2,1],u_OcclusionTexture:[5,1],u_EmissionTexture:[6,1],u_smoothness:[10,1],u_smoothnessScale:[11,1],u_occlusionStrength:[13,1],u_normalScale:[14,1],u_parallaxScale:[15,1],u_TilingOffset:[17,1],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Color":[4,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var u=Us.nameKey.add("PBRSpecular");t="attribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform=mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tmat4 skinTransform = mat4(0.0);\n\t\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position = skinTransform * a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t\tv_PositionWorld = (u_WorldMat * position).xyz;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t\tworldMat = mat3(u_WorldMat);\n\t\tv_PositionWorld = (u_WorldMat * a_Position).xyz;\n\t#endif\n\t\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n  \n\tv_Texcoord0 = a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t#endif\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,1.0 + v_Texcoord0.y);\n  \n\tv_ViewDir = u_CameraPos - v_PositionWorld;\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\n\nuniform vec4 u_AmbientColor;\nuniform vec4 u_DiffuseColor;\nuniform vec4 u_SpecularColor;\n\n#ifdef DIFFUSETEXTURE\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n#ifdef SPECULARTEXTURE\n\tuniform sampler2D u_SpecularTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\n#include "PBRSpecularLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nuniform DirectionLight u_DirectionLight;\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec4 sg;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 diffuseTextureColor = texture2D(u_DiffuseTexture, uv0);\n\t\tvec4 diffuseColor = diffuseTextureColor * u_DiffuseColor;\n\t\tsg = SpecularGloss(diffuseTextureColor.a, uv0);\n\t#else\n\t\tvec4 diffuseColor = u_DiffuseColor;\n\t\tsg = SpecularGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(diffuseColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\tvec3 normal = UnpackScaleNormal(uv0);\n\t\n\tvec3 gi = (u_AmbientColor * Occlusion(uv0)).rgb;\n\t\n\t//float a = (sg.r+sg.g+sg.b) / 3.0;\n  \n\tvec4 color = PBRSpecularDiectionLight(diffuseColor.rgb, sg.rgb, sg.a, normal,viewDir, u_DirectionLight, gi);\n\t\n\tcolor.a = diffuseColor.a;\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',a=Xr.add(u,t,e,i,n),ls.SHADERDEFINE_DIFFUSETEXTURE=a.registerMaterialDefine("DIFFUSETEXTURE"),ls.SHADERDEFINE_SPECULARTEXTURE=a.registerMaterialDefine("SPECULARTEXTURE"),ls.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=a.registerMaterialDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),ls.SHADERDEFINE_NORMALTEXTURE=a.registerMaterialDefine("NORMALTEXTURE"),ls.SHADERDEFINE_PARALLAXTEXTURE=a.registerMaterialDefine("PARALLAXTEXTURE"),ls.SHADERDEFINE_OCCLUSIONTEXTURE=a.registerMaterialDefine("OCCLUSIONTEXTURE"),ls.SHADERDEFINE_EMISSION=a.registerMaterialDefine("EMISSION"),ls.SHADERDEFINE_EMISSIONTEXTURE=a.registerMaterialDefine("EMISSIONTEXTURE"),ls.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),i={a_position:0,a_normal:3,uv:2},n={irrad_mat_red:[10,3],irrad_mat_green:[11,3],irrad_mat_blue:[12,3],u_hdrexposure:[13,3],texBaseColor:[1,1],texNormal:[2,1],texSky:[11,1],texUnderWater:[3,1],texPrefilterdEnv:[8,3],texPrefilterDiff:[7,3],texWaterDisp:[4,1],texWaveDetail:[9,1],texDeepColor:[10,1],texWaterInfo:[16,1],texFoam:[17,1],GEOWAVE_UV_SCALE:[18,1],modelMatrix:[0,2],mvp:[1,2],cameraPosition:[0,3],u_curTm:[8,1],u_scrsize:[15,1],u_WaveInfoD:[13,1],u_WaveInfo:[12,1],u_WaveMainDir:[14,1],u_DeepScale:[20,1],u_SeaColor:[19,1],u_View:[1,3],u_Project:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4]};var c=Us.nameKey.add("Water");t='\nuniform mat4 modelMatrix;\n//uniform mat4 modelViewMatrix;\n//uniform mat4 projectionMatrix;\nuniform mat4 u_View;\nuniform mat4 u_Project;\nuniform mat4 mvp;\n//uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\nuniform float u_curTm;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 uv;\n//uniform sampler2D texWaterDisp;\n#ifdef USE_VERTEX_DEEPINFO\n#else\nuniform sampler2D texWaterInfo;\nvarying vec4 vWaterInfo;\nuniform float u_DeepScale;//texWaterInfo.r*vDeepScale\n#endif\nuniform float u_WaveMainDir;\t//主波方向\nuniform float GEOWAVE_UV_SCALE ;//= 100.0;\n\n\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTan;\nvarying vec3 vWorldBin;\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying vec3 vLightDir;\nvarying vec3 vViewDir;\nvarying vec3 vDisp;\nvarying float fDeep;\nvarying mat2 matUVTrans;\nvarying float fFoam;\n\nconst float PI = 3.14159265358979323846264;\n\n#include "WaveFunction.glsl"\n\nvec2 getPosFromUV(vec2 uv){\n\treturn uv*50.;\n}\n\nvoid main() {\n\tvec3 pos = a_position;\n    vUv = uv;\n\t\n\t//vDisp = texture2D(texWaterDisp,uv).rgb;\n\t//vec3 disp = vDisp;\n\t\n\t//TODO 这里有个潜规则。\n\tfloat tt = pos.y; pos.y=pos.z; pos.z=-tt;\n\t\n\t#ifdef USE_VERTEX_DEEPINFO\n\tfDeep = -pos.y;\n\tpos.y=0.0;\n\t#else\n\tvWaterInfo = texture2D(texWaterInfo,uv);\n\tfDeep = vWaterInfo.r*u_DeepScale;\n\t#endif\n\t\n\t\n\t//计算波形\n\tmat4 modelMat = modelMatrix;\n\tvec3 opos, T,B,N;\n\tfloat foams=0.;\n\tvec2 uvpos = uv*GEOWAVE_UV_SCALE+vec2(modelMat[3][0],0.);//TODO 如果有旋转缩放怎么办\n\tcalcGerstnerWave(u_curTm, pos,fDeep, uvpos,opos,B,T,N,foams);\n\tfFoam = foams;\n\tgl_Position = mvp*vec4(opos,1.);\n\tvWorldPos = modelMat*vec4(opos,1.);\n\n\tvWorldNorm = normalize((modelMatrix*vec4(N,0.0)).xyz);\n\tvWorldTan = normalize((modelMatrix*vec4(T,0.0)).xyz);\n\tvWorldBin = normalize((modelMatrix*vec4(B,0.0)).xyz);\n    vViewDir = vWorldPos.xyz-cameraPosition; //这个不能取normalize，否则会引入非线性\n\t\n\tfloat s = sin(u_WaveMainDir);\n\tfloat c = cos(u_WaveMainDir);\n\tmatUVTrans = mat2(c,-s,s,c);\n}\n',e="//#version 300 es\n\nprecision highp float;\nprecision lowp int;\n\nconst float PI = 3.14159265358979323846264;\nconst float _2PI = 6.2831853071796;\nvarying vec2 vUv;\nvarying vec3 vWorldNorm;\nvarying vec3 vWorldTan;\nvarying vec3 vWorldBin;\nvarying vec3 vViewDir;//入射。pos-cam\nvarying vec4 vViewPos;\nvarying vec4 vWorldPos;\nvarying float fDeep;\nvarying mat2 matUVTrans;\n#ifdef USE_VERTEX_DEEPINFO\n#else\nvarying vec4 vWaterInfo;\n#endif\nmat3 matTBNOff;//\n\n//\nuniform sampler2D texBaseColor;\nuniform sampler2D texNormal;\n#ifdef CUBE_ENV\nuniform samplerCube texSky;\n#else\nuniform sampler2D texSky;\n#endif\nuniform sampler2D texUnderWater;\nuniform sampler2D texWaveDetail;\n//uniform sampler2D texDeepColor;\nuniform sampler2D texFoam;\nvarying float fFoam;\nuniform float u_curTm;\nuniform vec2 u_scrsize;\nuniform vec3 u_SeaColor;//\n\nconst int NumTexWaves=4;\nconst float Amp_over_L = 0.01;\n//const vec3 SEA_COLOR1 = vec3(0.0292,0.672,0.7467);//大洋\n//const vec3 SEA_COLOR2 = vec3(0,0.927,0.43);//近海\n\nconst float _maxu8 = 255.0;\nconst float _maxu16 = 65535.0;\nconst float _shift8 = 256.0;    //平移的话是*256而不是255\nvec2 _RGBAToU16(const in vec4 rgba){\n    return vec2((rgba.r*_maxu8+rgba.g*_maxu8*_shift8)/_maxu16, (rgba.b*_maxu8+rgba.a*_maxu8*_shift8)/_maxu16);\n}\nvec3 _RGBEToRGB( const in vec4 rgba ){\n    float f = pow(2.0, rgba.w * 255.0 - (128.0 + 8.0));\n    return rgba.rgb * (255.0 * f);\n}\n\nfloat saturate(float v){\n    return min(max(v,0.),1.);\n}\n\n/*\n\t各种 ToneMap\n*/\n//Reinhard\nvec3 ReinhardToneMapping(vec3 color, float adapted_lum) {\n    const float MIDDLE_GREY = 1.;\n    color *= MIDDLE_GREY / adapted_lum;\n    return color / (1.0 + color);\n}\n\n//CE2\nvec3 CEToneMapping(vec3 color, float adapted_lum){\n    return 1. - exp(-adapted_lum * color);\n}\n\n//UC2\nvec3 F1(vec3 x){\n\tconst float A = 0.22;\n\tconst float B = 0.30;\n\tconst float C = 0.10;\n\tconst float D = 0.20;\n\tconst float E = 0.01;\n\tconst float F = 0.30;\n \n\treturn ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F;\n}\n\nvec3 Uncharted2ToneMapping(vec3 color, float adapted_lum){\n\tconst vec3 WHITE = vec3(11.2);\n\treturn F1(1.6 * adapted_lum * color) / F1(WHITE);\n}\n\n//ACES\nvec3 ACESToneMapping(vec3 color, float adapted_lum){\n\tconst float A = 2.51;\n\tconst float B = 0.03;\n\tconst float C = 2.43;\n\tconst float D = 0.59;\n\tconst float E = 0.14;\n\n\tcolor *= adapted_lum;\n\treturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\n\n/*\n* 对一个全景图进行采样。假设x轴指向中心。\n*/\nvec4 texPanorama(sampler2D tex, const in vec3 dir){\n\tfloat envu = atan(dir.z,dir.x)/_2PI+0.5; \t\n\tfloat envv = acos(dir.y)/PI;//(1.0-dir.y)/2.0;\n\treturn texture2D(tex,vec2(envu,envv));\n}\n\n/*\n\t与位于0点的测试棒的相交测试交点\n\t这个是瞎写的，只是为了测试\n*/\nbool hitClydiner(vec3 pos, vec3 dir, out vec3 hitpos, out vec3 hitnormal){\n\tconst float r = 0.5;\n\tfloat a = dir.x*dir.x+dir.z*dir.z;\n\tfloat b = 2.*dir.x*pos.x+2.*dir.z*pos.z;\n\tfloat c = pos.x*pos.x+pos.z*pos.z-r*r;\n\tfloat d = b*b-4.*a*c;\n\tif(d>=0.0){\n\t\tfloat t = (-b+sqrt(d))/2./a;\n\t\tt =min(t, (-b-sqrt(d))/2./a);\n\t\thitpos = pos+dir*t;\n\t\treturn true;\n\t}\n\t/*\n\tvec3 v1 = normalize(cross(dir,vec3(0.,1.,0.)));//公垂线\n\tfloat dist = dot(pos,v1);//最短距离\n\tif(abs(dist)<r){\n\t\treturn true;\n\t}\n\t*/\n\treturn false;\n}\n\n///* 根据散射公式来计算某个方向的颜色 *///\n//\nfloat phase_function(float costheta, float g, float g2){\n\treturn 1.5*( (1.0-g2) / (2.0+g2) ) * (1.0+costheta*costheta) / pow(1.0+g2-2.0*g*costheta, 1.5);\t\n}\n\nconst float _density = .2;\nconst vec3 _vLightDir=vec3(0.,-1.,0.);//必须是规格化的\nconst int _SAMPLENUM = 20;\nconst float _K1 = 1.0;\nconst float _g = -0.93;\n//\nvec3 calcScatter(vec3 start, vec3 dir, vec3 end){\n\tfloat len = length(end-start);\n\tfloat costheta = dot(dir,_vLightDir);\n\tfloat g2 = _g*_g;\n\tfloat K = _K1*len*_density*phase_function(costheta,_g,g2);\n\t//用分段的方式来积分\n\tfloat dlen = len/float(_SAMPLENUM);//距离平分\n\tfloat ddeep = (start.y-end.y)/float(_SAMPLENUM);//深度平分\n\tfloat sum=0.;\n\tfor( int i=0; i<_SAMPLENUM; i++){\n\t\tfloat fi = float(i);\n\t\tfloat v1 = exp(-_density*(dlen+ddeep)*fi);//TODO 应该可以用分析法计算出来\n\t\tsum += v1;\n\t}\n\treturn vec3(K*sum);\n}\n///* 根据散射公式来计算某个方向的亮度  END *///\n\nconst float cDeep = -2.;\t//假设水的深度\nvec3 getShuiDiColor(vec3 pos, vec3 dir, vec3 normal){\n\t//一个无限大的水底，黑白格纹理。纹理长度为1米\n\tfloat t = ( cDeep-pos.y )/dir.y;\n\tif(t<0.) return vec3(1.,0.,0.);//TEST\n\tbool bhit = false;\n\tvec3 hitpos;\n\tvec3 hitcolor;\n\tvec3 hn;\n\tif(hitClydiner(pos,dir,hitpos,hn) && hitpos.y>cDeep && hitpos.y<pos.y){\n\t\tbhit=true;\n\t\thitcolor = vec3(.8,.8,.8);\n\n\t}else\n\t{\n\t\thitpos = pos+dir*t;\n\t\tvec3 hp = floor(hitpos);\n\t\tfloat a = mod((hp.x+hp.z),2.);\n\t\thitcolor = (a<.9)?vec3(0.,0.,0.):vec3(1.,1.,1.);\n\t\t//hitcolor = texture2D(texUnderWater,hitpos.xz/10.).rgb;\n\t}\n\t\n\tfloat l = length(hitpos-pos);\n\t//return texture2D(texDeepColor,vec2(min(max(l/400.,0.),1.),0.5)).rgb;\n\t//return SEA_COLOR1*calcScatter(pos,dir,hitpos);\n\tfloat left = pow(0.8,l);//假设透过率为80%，则到达水底的时候的光强。\n\treturn mix(hitcolor,u_SeaColor,1.-left);\n}\n\n/*\n\tview已经normalize了\n*/\nvec3 getRefractColor(vec3 view,vec3 normal){\n\tvec3 T = refract(-view, normal, 0.7);\n\treturn getShuiDiColor(vWorldPos.xyz,T,normal); \n}\n\nvec4 calcWaterC(vec3 view, vec3 normal, float von, vec3 R, float rough){\n\t/*\n\t只有浪顶的法线向下，也就是波形形成了交叠的时候，才会这样，所以要通过参数控制避免出现这种情况，而不是在这里保护。\n\tif(dot(R,vec3(0.,1.,0.))<0.){\n\t\tR = -R;\n\t}\n\t*/\n\t//vec3 refr = getRefractColor(-view,normal);\n#ifdef USE_REFR_TEX\t\n\tvec3 refr = texture2D(texUnderWater, gl_FragCoord.xy/u_scrsize+normal.xz/8.).rgb;\n#else\n\tvec3 refr = u_SeaColor;\n#endif\n\tfloat F0=0.02;\n\t//菲涅尔，越大反射越强\n\tfloat f =  F0+(1.0-F0)*exp2((-5.55473*von-6.98316)*von);\n\t//float f = F0+(1.0-F0)*pow(1.-von,5.);\n\t//能看到水底的程度。反射剩余的*水中的衰减\n\t//float a = (1.-f)*(1.-deepk);\n#ifdef CUBE_ENV\n\tvec4 reflc = textureCube(texSky,R);\n#else\n\tvec4 reflc = texPanorama(texSky, R);\n#endif\n#ifdef HDR_ENV\n\tvec3 refl = _RGBEToRGB(reflc)*f;\n#else\n\tvec3 refl = reflc.rgb*f;\n#endif\n\t//return vec4(refl*(1.-rough),1.);\n\t\n\t//vec3 refl = reflc.rgb*f;\n\tvec3 final = mix(refr, u_SeaColor, min(fDeep/10.,1.))+refl*(max(0.,1.-rough));\n#ifdef HDR_ENV\n\tfinal = ACESToneMapping(final,1.);//TODO 这个要uniform传入\n#endif\n\treturn vec4(final,f);\n}\n\nvoid main() {\n    vec3 normal =  normalize(vWorldNorm);\n\t//如果uv=1为100米，希望每个细节纹理表示20米的小波形，则uv缩放是 100/20。细节纹理内部也要用这个值，即pos=uv*20\n\tvec2 ruv = matUVTrans*vUv;\n\tvec3 detailNorm = texture2D(texWaveDetail,fract(ruv*5.)).rgb*2.-vec3(1.);//TODO uv怎么算\n\tfloat texNormScale = 2.*PI*float(NumTexWaves)*Amp_over_L*2.5;\n\tdetailNorm *= vec3(texNormScale,1.,texNormScale);\n\t//旋转\n\t//细节纹理来自rendertarget，因此需要颠倒z\n\t\n\tmatTBNOff = mat3(matUVTrans[0][0],0.,matUVTrans[1][0],\n\t0.,1.,0.,\n\tmatUVTrans[0][1],0.,matUVTrans[1][1]\n\t);\n\t\n\t/*\n\tmatTBNOff = mat3(0.,0.,1.,\n\t0.,1.,0.,\n\t-1.,0.,0.\n\t);\n\t*/\n\n    mat3 tsn = mat3( vWorldBin, normal, vWorldTan);\t\n    //normal = normalize(tsn * matTBNOff * detailNorm);\n\tnormal = normalize(tsn * detailNorm); //这个应该更正确。因为本身方向就是根据uv算的，如果是静态图片才需要转换。\n\t//vec4 normtex = texture2D( texNormal, vUv );\n    vec3 view   = -normalize(vViewDir);//view 是指向camera的\n    float NoV = saturate(dot( view, normal ));\n    //vec3 R = 2. * NoV * normal - view;\n\t\n#ifdef USE_FOAM\t\n\tvec4 foamc = (texture2D(texFoam,vUv*50.)+texture2D(texFoam,vUv*20.))/2.;\n\tfloat nearcoast = 1.-min(fDeep/10.,1.);// 1.-vWaterInfo.r;\n\tfloat foams = (nearcoast/4.+fFoam)*2.*nearcoast;\n#else\n\tfloat foams =0.;\n#endif\n\t\n\tvec3 R = reflect(-view,normal);\n\tvec4 wc = calcWaterC(view, normal,NoV,R, foams);\n\n\tgl_FragColor.rgb = wc.rgb;//normalize(detailNorm).rrr;//((normal)+vec3(0.0))/1.;//normalize(normal).rgb;//texture2D(texWaveDetail,vUv).rgb;// fracColor * texture2D(texUnderWater, vUv*20.0).rgb;// vec3(1.0);//pbrl.rgb;\n    gl_FragColor.a = 1.0;//wc.a;\n#ifdef USE_FOAM\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb,vec3(1.),foamc.a*foams);\n\tgl_FragColor.a = foamc.r;\n#endif\n\t//if(mod(vUv.x*100.,1.0)<0.02 || mod(vUv.y*100.,1.0)<0.02) gl_FragColor.rgb=vec3(0.5,.5,.5);\n\t//gl_FragColor.rgb = detailNorm;\n}\n",a=Xr.add(c,t,e,i,n),ds.SHADERDEFINE_CUBE_ENV=a.registerMaterialDefine("CUBE_ENV"),ds.SHADERDEFINE_HDR_ENV=a.registerMaterialDefine("HDR_ENV"),ds.SHADERDEFINE_SHOW_NORMAL=a.registerMaterialDefine("SHOW_NORMAL"),ds.SHADERDEFINE_USEVERTEXHEIGHT=a.registerMaterialDefine("USE_VERTEX_DEEPINFO"),ds.SHADERDEFINE_USE_FOAM=a.registerMaterialDefine("USE_FOAM"),ds.SHADERDEFINE_USE_REFRACT_TEX=a.registerMaterialDefine("USE_REFR_TEX"),i={a_CornerTextureCoordinate:17,a_MeshPosition:0,a_MeshColor:1,a_MeshTextureCoordinate:2,a_ShapePositionStartLifeTime:30,a_DirectionTime:32,a_StartColor:19,a_EndColor:23,a_StartSize:20,a_StartRotation0:22,a_StartSpeed:31,a_Random0:34,a_Random1:35,a_SimulationWorldPostion:36,a_SimulationWorldRotation:37},n={u_Tintcolor:[2,1],u_TilingOffset:[3,1],u_texture:[1,1],u_WorldPosition:[0,2],u_WorldRotation:[1,2],u_PositionScale:[4,2],u_SizeScale:[5,2],u_ScalingMode:[6,2],u_Gravity:[7,2],u_ThreeDStartRotation:[8,2],u_StretchedBillboardLengthScale:[9,2],u_StretchedBillboardSpeedScale:[10,2],u_SimulationSpace:[11,2],u_CurrentTime:[12,2],u_ColorOverLifeGradientAlphas:[22,2],u_ColorOverLifeGradientColors:[23,2],u_MaxColorOverLifeGradientAlphas:[24,2],u_MaxColorOverLifeGradientColors:[25,2],u_VOLVelocityConst:[13,2],u_VOLVelocityGradientX:[14,2],u_VOLVelocityGradientY:[15,2],u_VOLVelocityGradientZ:[16,2],u_VOLVelocityConstMax:[17,2],u_VOLVelocityGradientMaxX:[18,2],u_VOLVelocityGradientMaxY:[19,2],u_VOLVelocityGradientMaxZ:[20,2],u_VOLSpaceType:[21,2],u_SOLSizeGradient:[26,2],u_SOLSizeGradientX:[27,2],u_SOLSizeGradientY:[28,2],u_SOLSizeGradientZ:[29,2],u_SOLSizeGradientMax:[30,2],u_SOLSizeGradientMaxX:[31,2],u_SOLSizeGradientMaxY:[32,2],u_SOLSizeGradientMaxZ:[33,2],u_ROLAngularVelocityConst:[34,2],u_ROLAngularVelocityConstSeprarate:[35,2],u_ROLAngularVelocityGradient:[36,2],u_ROLAngularVelocityGradientX:[37,2],u_ROLAngularVelocityGradientY:[38,2],u_ROLAngularVelocityGradientZ:[39,2],u_ROLAngularVelocityGradientW:[40,2],u_ROLAngularVelocityConstMax:[41,2],u_ROLAngularVelocityConstMaxSeprarate:[42,2],u_ROLAngularVelocityGradientMax:[43,2],u_ROLAngularVelocityGradientMaxX:[44,2],u_ROLAngularVelocityGradientMaxY:[45,2],u_ROLAngularVelocityGradientMaxZ:[46,2],u_ROLAngularVelocityGradientMaxW:[47,2],u_TSACycles:[48,2],u_TSASubUVLength:[49,2],u_TSAGradientUVs:[50,2],u_TSAMaxGradientUVs:[51,2],u_CameraPosition:[0,3],u_CameraDirection:[5,3],u_CameraUp:[6,3],u_View:[1,3],u_Projection:[2,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4]};var d=Us.nameKey.add("PARTICLESHURIKEN");t="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying float v_Discard;\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPosition;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientW[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t   finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0){ \n\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t#endif \n\tvec3 gravityVelocity=u_Gravity*age;\n\t\n\tvec4 worldRotation;\n\tif(u_SimulationSpace==0)\n\t\tworldRotation=a_SimulationWorldRotation;\n\telse\n\t\tworldRotation=u_WorldRotation;\n\t\n\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n   \n   \n   #ifdef SPHERHBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        vec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n        vec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t    corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\tfloat c = cos(rot);\n\t\t\t\tfloat s = sin(rot);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#endif\n   #endif\n   \n   #ifdef STRETCHEDBILLBOARD\n\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\tvec3 velocity;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t    if(u_VOLSpaceType==0)\n\t\t  velocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t    else\n\t\t  velocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n    #else\n\t    velocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n    #endif\t\n\t\tvec3 cameraUpVector = normalize(velocity);\n\t\tvec3 direction = normalize(center-u_CameraPosition);\n        vec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\n\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\n\t    vec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\n\t    const mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t    corner=rotaionZHalfPI*corner;\n\t    corner.y=corner.y-abs(corner.y);\n\t\t\n\t    float speed=length(velocity);//TODO:\n\t    center +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef HORIZONTALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t    const vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef VERTICALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef RENDERMODE_MESH\n\t    vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,-computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,a_StartRotation0.z), age,normalizedAge);\n\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t#endif\t\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t#else\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t}\n\t\t#endif\n\t\tv_MeshColor=a_MeshColor;\n   #endif\n   \n    gl_Position=u_Projection*u_View*vec4(center,1.0);\n    v_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t#ifdef DIFFUSEMAP\n\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t#endif\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t#endif\n\t\t\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y)*u_TilingOffset.xy+vec2(u_TilingOffset.z,-u_TilingOffset.w);//需要特殊处理\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y);//需要特殊处理\n\t\t#endif\n\t#endif\n    v_Discard=0.0;\n\t  \n\t#ifdef FOG\n\t\tv_PositionWorld=center;\n\t#endif\n   }\n   else\n\t{\n\t\tv_Discard=1.0;\n\t}\n}\n\n",e="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying float v_Discard;\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n\tuniform vec3 u_CameraPosition;\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\tif(v_Discard!=0.0)\n\t\t\tdiscard;\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\tvec3 toEye=u_CameraPosition-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t\t\n\t\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}",a=Xr.add(d,t,e,i,n),_s.SHADERDEFINE_DIFFUSEMAP=a.registerMaterialDefine("DIFFUSEMAP"),_s.SHADERDEFINE_TINTCOLOR=a.registerMaterialDefine("TINTCOLOR"),_s.SHADERDEFINE_ADDTIVEFOG=a.registerMaterialDefine("ADDTIVEFOG"),_s.SHADERDEFINE_TILINGOFFSET=a.registerMaterialDefine("TILINGOFFSET"),Fo.SHADERDEFINE_RENDERMODE_BILLBOARD=a.registerSpriteDefine("SPHERHBILLBOARD"),Fo.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=a.registerSpriteDefine("STRETCHEDBILLBOARD"),Fo.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=a.registerSpriteDefine("HORIZONTALBILLBOARD"),Fo.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=a.registerSpriteDefine("VERTICALBILLBOARD"),Fo.SHADERDEFINE_COLOROVERLIFETIME=a.registerSpriteDefine("COLOROVERLIFETIME"),Fo.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=a.registerSpriteDefine("RANDOMCOLOROVERLIFETIME"),Fo.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=a.registerSpriteDefine("VELOCITYOVERLIFETIMECONSTANT"),Fo.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=a.registerSpriteDefine("VELOCITYOVERLIFETIMECURVE"),Fo.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=a.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),Fo.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=a.registerSpriteDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),Fo.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=a.registerSpriteDefine("TEXTURESHEETANIMATIONCURVE"),Fo.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=a.registerSpriteDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),Fo.SHADERDEFINE_ROTATIONOVERLIFETIME=a.registerSpriteDefine("ROTATIONOVERLIFETIME"),Fo.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=a.registerSpriteDefine("ROTATIONOVERLIFETIMESEPERATE"),Fo.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=a.registerSpriteDefine("ROTATIONOVERLIFETIMECONSTANT"),Fo.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=a.registerSpriteDefine("ROTATIONOVERLIFETIMECURVE"),Fo.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=a.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCONSTANTS"),Fo.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=a.registerSpriteDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),Fo.SHADERDEFINE_SIZEOVERLIFETIMECURVE=a.registerSpriteDefine("SIZEOVERLIFETIMECURVE"),Fo.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=a.registerSpriteDefine("SIZEOVERLIFETIMECURVESEPERATE"),Fo.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=a.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVES"),Fo.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=a.registerSpriteDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),Fo.SHADERDEFINE_RENDERMODE_MESH=a.registerSpriteDefine("RENDERMODE_MESH"),Fo.SHADERDEFINE_SHAPE=a.registerSpriteDefine("SHAPE"),i={a_Position:0,a_Texcoord0:2,a_Time:33},n={u_Texture:[1,1],u_Albedo:[2,1],u_Color:[3,1],u_CurrentTime:[2,2],u_Duration:[3,2],u_MvpMatrix:[1,2]};var _=Us.nameKey.add("GLITTER");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nattribute float a_Time;\n\nuniform mat4 u_MvpMatrix;\nuniform  float u_CurrentTime;\nuniform  vec4 u_Color;\nuniform float u_Duration;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  \n  float age = u_CurrentTime-a_Time;\n  float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   \n  v_Texcoord=a_Texcoord0;\n  \n  v_Color=u_Color;\n  v_Color.a*=1.0-normalizedAge;\n}\n",e="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform vec4 u_Albedo;\nuniform sampler2D u_Texture;\n\nvarying vec2 v_Texcoord;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\t\n  gl_FragColor=texture2D(u_Texture, v_Texcoord)*v_Color;\n  gl_FragColor=gl_FragColor*u_Albedo;\n}\n\n",a=Xr.add(_,t,e,i,n),i={a_Position:0},n={u_Intensity:[1,1],u_AlphaBlending:[2,1],u_CubeTexture:[3,1],u_MvpMatrix:[4,3]};var f=Us.nameKey.add("SkyBox");t="attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nvarying vec3 v_Texcoord;\n\n\nvoid main()\n{\n  gl_Position = (u_MvpMatrix*a_Position).xyww;\n  v_Texcoord=a_Position.xyz;\n}\n",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Intensity;\nuniform float u_AlphaBlending;\nuniform samplerCube u_CubeTexture;\n\nvarying vec3 v_Texcoord;\n\n\nvoid main()\n{\t\n  gl_FragColor=vec4(textureCube(u_CubeTexture, v_Texcoord).rgb*u_Intensity,u_AlphaBlending);\n}\n\n",Xr.add(f,t,e,i,n),i={a_Position:0,a_Texcoord0:2},n={u_Intensity:[1,1],u_AlphaBlending:[2,1],u_texture:[3,1],u_MvpMatrix:[4,3]};var m=Us.nameKey.add("SkyDome");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\nuniform mat4 u_MvpMatrix;\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\n  gl_Position = (u_MvpMatrix*a_Position).xyww;\n  v_Texcoord = a_Texcoord0;\n}\n",e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform float u_Intensity;\nuniform float u_AlphaBlending;\nuniform sampler2D u_texture;\n\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\t\n  gl_FragColor=vec4(texture2D(u_texture, v_Texcoord).rgb*u_Intensity,u_AlphaBlending);\n}\n\n",Xr.add(m,t,e,i,n),i={a_Position:0,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_NormalTexture:[1,1],u_DiffuseTexture1:[2,1],u_DiffuseTexture2:[3,1],u_DiffuseTexture3:[4,1],u_DiffuseTexture4:[5,1],u_DiffuseScale1:[6,1],u_DiffuseScale2:[7,1],u_DiffuseScale3:[8,1],u_DiffuseScale4:[9,1],u_MaterialDiffuse:[11,1],u_MaterialAmbient:[10,1],u_MaterialSpecular:[12,1],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var p=Us.nameKey.add("Terrain");t="attribute vec4 a_Position;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nattribute vec2 a_Texcoord0;\nattribute vec2 a_Texcoord1;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\nuniform mat4 u_MvpMatrix;\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n\tv_Texcoord0=a_Texcoord0;\n\tv_Texcoord1=a_Texcoord1;\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tv_Normal=a_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n#endif\n\n#ifdef LIGHTMAP\n\t//这个地方使用a_Normal 并不是真的代表normal，其实凑巧法线图的uv正好是符合 light_Map的UV\n\tv_LightMapUV=vec2(a_Normal.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Normal.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1\n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n\n}",e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialDiffuse;\n\tuniform vec4 u_MaterialSpecular;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tuniform vec3 u_MaterialAmbient;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\nuniform sampler2D u_NormalTexture;\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform vec2 u_DiffuseScale1;\nuniform vec2 u_DiffuseScale2;\nuniform vec2 u_DiffuseScale3;\nuniform vec2 u_DiffuseScale4;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n#ifdef DETAIL_NUM1\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz;\n#endif\n#ifdef DETAIL_NUM2\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-splatAlpha.r) + color2.xyz * splatAlpha.r;\n#endif\n#ifdef DETAIL_NUM3\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g)) + color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g;\n#endif\n#ifdef DETAIL_NUM4\n\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord1/u_DiffuseScale1);\n\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord1/u_DiffuseScale2);\n\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord1/u_DiffuseScale3);\n\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord1/u_DiffuseScale4);\n\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\tgl_FragColor.xyz = color1.xyz * (1.0-(splatAlpha.r+splatAlpha.g+splatAlpha.b))+ color2.xyz * splatAlpha.r + color3.xyz * splatAlpha.g + color4.xyz * splatAlpha.b;\n#endif\n\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = texture2D(u_NormalTexture,v_Normal.xy).xyz;\n\tnormal = normal*2.0 - vec3(1.0);\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t\t#endif\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n';var g=Xr.add(p,t,e,i,n);cs.SHADERDEFINE_DETAIL_NUM1=g.registerMaterialDefine("DETAIL_NUM1"),cs.SHADERDEFINE_DETAIL_NUM2=g.registerMaterialDefine("DETAIL_NUM2"),cs.SHADERDEFINE_DETAIL_NUM4=g.registerMaterialDefine("DETAIL_NUM4"),cs.SHADERDEFINE_DETAIL_NUM3=g.registerMaterialDefine("DETAIL_NUM3"),i={a_Position:0,a_Normal:3,a_Texcoord0:2},n={u_MvpMatrix:[1,2],u_WorldMat:[0,2],u_CameraPos:[0,3],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_SplatAlphaTexture:[0,1],u_DiffuseTexture1:[1,1],u_DiffuseTexture2:[2,1],u_DiffuseTexture3:[3,1],u_DiffuseTexture4:[4,1],u_DiffuseTexture5:[5,1],u_DiffuseScaleOffset1:[6,1],u_DiffuseScaleOffset2:[7,1],u_DiffuseScaleOffset3:[8,1],u_DiffuseScaleOffset4:[9,1],u_DiffuseScaleOffset5:[10,1],u_MaterialAlbedo:[14,1],u_MaterialDiffuse:[12,1],u_MaterialAmbient:[11,1],u_MaterialSpecular:[13,1],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var v=Us.nameKey.add("ExtendTerrain");t="attribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform vec4 u_LightmapScaleOffset;\n#endif\n\n#ifdef RECEIVESHADOW\n\tvarying float v_posViewZ;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n#endif\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n  \n\tv_Texcoord0 = a_Texcoord0;\n  \n\t#ifdef LIGHTMAP\n\t\tv_LightMapUV = vec2(a_Texcoord0.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,(a_Texcoord0.y-1.0)*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_Normal = a_Normal;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}",e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tuniform vec3 u_MaterialDiffuse;\n\tuniform vec4 u_MaterialSpecular;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\nuniform sampler2D u_SplatAlphaTexture;\n\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform sampler2D u_DiffuseTexture5;\n\nuniform vec4 u_DiffuseScaleOffset1;\nuniform vec4 u_DiffuseScaleOffset2;\nuniform vec4 u_DiffuseScaleOffset3;\nuniform vec4 u_DiffuseScaleOffset4;\nuniform vec4 u_DiffuseScaleOffset5;\n\nvarying vec2 v_Texcoord0;\n\nuniform vec3 u_MaterialAmbient;\nuniform vec4 u_MaterialAlbedo;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n\t#ifdef ExtendTerrain_DETAIL_NUM1\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r;\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM2\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM3\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM4\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM5\n\t\tvec4 splatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tvec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\n\t#endif\n\t\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = v_Normal;\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t#else\n\t\t#if defined(RECEIVESHADOW)\t\t\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t\t//vec3 tColor= u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue + mix(vec3(0.15,0.15,0.15),vec3(0.0),shadowValue);\n\t\t\t//gl_FragColor.rgb*=tColor;\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient + texture2D(u_LightMap, v_LightMapUV).rgb);\n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_MaterialAlbedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor = vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular * shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular, gl_FragColor.a);\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n\n\n\n\n';var y=Xr.add(v,t,e,i,n);y.addSpriteDefines(ao.shaderDefines),y.addMaterialDefines(as.shaderDefines),i={a_Position:0,a_OffsetVector:41,a_Texcoord0X:38,a_Texcoord0Y:40,a_BirthTime:33},n={u_MvpMatrix:[1,2],u_VMatrix:[1,3],u_PMatrix:[2,3],u_TilingOffset:[3,1],u_MainTexture:[1,1],u_MainColor:[2,1],u_CurTime:[3,2],u_LifeTime:[4,2],u_WidthCurve:[5,2],u_WidthCurveKeyLength:[6,2],u_GradientColorkey:[7,2],u_GradientAlphakey:[8,2]};var x=Us.nameKey.add("Trail");t="attribute vec3 a_Position;\nattribute vec3 a_OffsetVector;\nattribute vec4 a_Color;\nattribute float a_Texcoord0X;\nattribute float a_Texcoord0Y;\nattribute float a_BirthTime;\n\nuniform mat4 u_VMatrix;\nuniform mat4 u_PMatrix;\n\nuniform vec4 u_TilingOffset;\n\nuniform float u_CurTime;\nuniform float u_LifeTime;\nuniform vec4 u_WidthCurve[10];\nuniform int u_WidthCurveKeyLength;\n\nuniform vec4 u_GradientColorkey[10];\nuniform vec2 u_GradientAlphakey[10];\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\n{\n\tfloat t2 = t * t;\n\tfloat t3 = t2 * t;\n\tfloat a = 2.0 * t3 - 3.0 * t2 + 1.0;\n\tfloat b = t3 - 2.0 * t2 + t;\n\tfloat c = t3 - t2;\n\tfloat d = -2.0 * t3 + 3.0 * t2;\n\treturn a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\n}\n\nfloat getCurWidth(in float normalizeTime)\n{\n\tif(normalizeTime == 0.0){\n\t\treturn u_WidthCurve[0].w;\n\t}\n\telse if(normalizeTime >= 1.0){\n\t\treturn u_WidthCurve[u_WidthCurveKeyLength - 1].w;\n\t}\n\telse{\n\t\tfor(int i = 0; i < 10; i ++ )\n\t\t{\n\t\t\tif(normalizeTime == u_WidthCurve[i].x)\n\t\t\t{\n\t\t\t\treturn u_WidthCurve[i].w;\n\t\t\t}\n\t\t\t\n\t\t\tvec4 lastFrame = u_WidthCurve[i];\n\t\t\tvec4 nextFrame = u_WidthCurve[i + 1];\n\t\t\tif(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\n\t\t\t{\n\t\t\t\tfloat duration = nextFrame.x - lastFrame.x;\n\t\t\t\tfloat t = (normalizeTime - lastFrame.x) / duration;\n\t\t\t\tfloat outTangent = lastFrame.z;\n\t\t\t\tfloat inTangent = nextFrame.y;\n\t\t\t\tfloat value1 = lastFrame.w;\n\t\t\t\tfloat value2 = nextFrame.w;\n\t\t\t\treturn hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\n\t\t\t}\n\t\t}\t\n\t}\n}\t\n\nvec4 getColorFromGradientByBlend(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tfloat colorKey = gradientColor.w;\n\t\tif(colorKey >= normalizeTime)\n\t\t{\n\t\t\tvec4 lastGradientColor = gradientColors[i-1];\n\t\t\tfloat lastColorKey = lastGradientColor.w;\n\t\t\tfloat age = (normalizeTime - lastColorKey) / (colorKey - lastColorKey);\n\t\t\tcolor.rgb = mix(gradientColors[i-1].xyz, gradientColor.xyz, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tfloat alphaKey = gradientAlpha.y;\n\t\tif(alphaKey >= normalizeTime)\n\t\t{\n\t\t\tvec2 lastGradientAlpha = gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey = lastGradientAlpha.y;\n\t\t\tfloat age = (normalizeTime - lastAlphaKey) / (alphaKey - lastAlphaKey);\n\t\t\tcolor.a = mix(lastGradientAlpha.x, gradientAlpha.x, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvec4 getColorFromGradientByFixed(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tif(gradientColor.w >= normalizeTime)\n\t\t{\n\t\t\tcolor.rgb = gradientColor.xyz;\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tif(gradientAlpha.y >= normalizeTime)\n\t\t{\n\t\t\tcolor.a = gradientAlpha.x;\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvoid main()\n{\n\tfloat normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\n\t\n\tgl_Position = u_PMatrix * u_VMatrix * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0 = (vec2(a_Texcoord0X, a_Texcoord0Y) * u_TilingOffset.xy) + u_TilingOffset.zw;\n\t#else\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\n\t#endif\n\t\n\t#ifdef GRADIENTMODE_BLEND\n\t\tv_Color = getColorFromGradientByBlend(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#else\n\t\tv_Color = getColorFromGradientByFixed(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#endif\n}\n\n\n\n",e="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTexture;\nuniform vec4 u_MainColor;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nvoid main()\n{\t\n\tvec4 color = 2.0 * u_MainColor * v_Color;\n\t#ifdef DIFFUSETEXTURE\n\t\tvec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\n\t\tcolor *= mainTextureColor;\n\t#endif\n\tgl_FragColor = color;\n}\n\n";var b=Xr.add(x,t,e,i,n);gs.SHADERDEFINE_DIFFUSETEXTURE=b.registerMaterialDefine("DIFFUSETEXTURE"),gs.SHADERDEFINE_TILINGOFFSET=b.registerSpriteDefine("TILINGOFFSET"),Go.SHADERDEFINE_GRADIENTMODE_BLEND=b.registerSpriteDefine("GRADIENTMODE_BLEND")},t}(),Ve=function(){function t(){this._data=null,this._data=[]}E(t,"laya.d3.shader.ValusArray");var e=t.prototype;return e.setValue=function(t,e){this._data[t]=e},v(0,e,"data",function(){return this._data}),t}(),Ne=function(){function g(){this._currentPSSM=-1,this._numberOfPSSM=3,this._maxDistance=200,this._ratioOfDistance=1/this._numberOfPSSM,this._statesDirty=!0,this._lightCulling=null,this._renderTarget=null,this._lightVPMatrix=null,this._lightCameras=null,this._shadowQuenes=null,this._shadowMapTextureSize=1024,this._scene=null,this._PCFType=0,this._shaderValueLightVP=null,this._shaderValueVPs=null,this._spiltDistance=new Array(4),this._globalParallelLightDir=new we(0,-1,0),this._boundingSphere=new Array(4),this._boundingBox=new Array(4),this._frustumPos=new Array(16),this._uniformDistance=new Array(4),this._logDistance=new Array(4),this._dimension=new Array(4),this._tempLookAt3=new we,this._tempLookAt4=new Ce,this._tempValue=new Ce,this._tempPos=new we,this._tempLightUp=new we,this._tempMin=new Ce,this._tempMax=new Ce,this._tempMatrix44=new ye,this._splitFrustumCulling=new fe(ye.DEFAULT),this._tempScaleMatrix44=new ye,this._shadowPCFOffset=new Re(1/1024,1/1024),this._shaderValueDistance=new Ce;var t=0;for(t=0;t<this._spiltDistance.length;t++)this._spiltDistance[t]=0;for(t=0;t<this._dimension.length;t++)this._dimension[t]=new Re;for(t=0;t<this._frustumPos.length;t++)this._frustumPos[t]=new we;for(t=0;t<this._boundingBox.length;t++)this._boundingBox[t]=new _e(new we,new we);for(t=0;t<this._boundingSphere.length;t++)this._boundingSphere[t]=new me(new we,0);ye.createScaling(new we(.5,.5,1),this._tempScaleMatrix44),this._tempScaleMatrix44.elements[12]=.5,this._tempScaleMatrix44.elements[13]=.5}E(g,"laya.d3.shadowMap.ParallelSplitShadowMap");var t=g.prototype;return t.setInfo=function(t,e,i,n,r,a){3<r&&(this._numberOfPSSM=3),this._scene=t,this._maxDistance=e,this.PSSMNum=r,this._globalParallelLightDir=i,this._ratioOfDistance=1/this._numberOfPSSM;for(var s=0;s<this._spiltDistance.length;s++)this._spiltDistance[s]=0;this._shadowMapTextureSize=n,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this.setPCFType(a),this._statesDirty=!0},t.setPCFType=function(t){switch(this._PCFType=t,this._PCFType){case 0:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 1:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 2:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3);break;case 3:this._scene.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),this._scene.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2)}},t.getPCFType=function(){return this._PCFType},t.setFarDistance=function(t){this._maxDistance!=t&&(this._maxDistance=t,this._statesDirty=!0)},t.getFarDistance=function(){return this._maxDistance},t._setGlobalParallelLightDir=function(t){this._globalParallelLightDir=t},t.getGlobalParallelLightDir=function(){return this._globalParallelLightDir},t.getCurrentPSSM=function(){return this._currentPSSM},t.getLightCamera=function(t){return this._lightCameras[t]},t._beginSampler=function(t,e){if(t<0||t>this._numberOfPSSM)throw new Error("ParallelSplitShadowMap: beginSample invalid index");this._currentPSSM=t,this._update(e)},t.endSampler=function(t){this._currentPSSM=-1},t._calcAllLightCameraInfo=function(t){if(1===this._numberOfPSSM)this._beginSampler(0,t),this.endSampler(t);else for(var e=0,i=this._numberOfPSSM+1;e<i;e++)this._beginSampler(e,t),this.endSampler(t)},t._recalculate=function(t,e,i){this._calcSplitDistance(t),this._calcBoundingBox(e,i),this._rebuildRenderInfo()},t._update=function(t){var e=t.nearPlane,i=t.fieldOfView,n=t.aspectRatio;(this._statesDirty||this.lastNearPlane!==e||this.lastFieldOfView!==i||this.lastAspectRatio!==n)&&(this._recalculate(e,i,n),this._uploadShaderValue(),this._statesDirty=!1,this.lastNearPlane=e,this.lastFieldOfView=i,this.lastAspectRatio=n),this._calcLightViewProject(t)},t._uploadShaderValue=function(){var t=this._scene;switch(this._numberOfPSSM){case 1:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3);break;case 2:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3);break;case 3:t.addShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),t.removeShaderDefine(laya.d3.shadowMap.ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2)}var e=t._shaderValues;switch(e.setValue(15,this._shaderValueDistance.elements),e.setValue(16,this._shaderValueLightVP),e.setValue(17,this._shadowPCFOffset.elements),this._numberOfPSSM){case 3:e.setValue(18,this.getRenderTarget(1)),e.setValue(19,this.getRenderTarget(2)),e.setValue(20,this.getRenderTarget(3));break;case 2:e.setValue(18,this.getRenderTarget(1)),e.setValue(19,this.getRenderTarget(2));break;case 1:e.setValue(18,this.getRenderTarget(1))}},t._calcSplitDistance=function(t){var e=this._maxDistance,i=1/this._numberOfPSSM,n=0;for(n=0;n<=this._numberOfPSSM;n++)this._uniformDistance[n]=t+(e-t)*n*i;var r=e/t;for(n=0;n<=this._numberOfPSSM;n++){var a=Math.pow(r,n*i);this._logDistance[n]=t*a}for(n=0;n<=this._numberOfPSSM;n++)this._spiltDistance[n]=this._uniformDistance[n]*this._ratioOfDistance+this._logDistance[n]*(1-this._ratioOfDistance);this._shaderValueDistance.x=this._spiltDistance[1],this._shaderValueDistance.y=this._spiltDistance[2],this._shaderValueDistance.z=this._spiltDistance[3],this._shaderValueDistance.w=this._spiltDistance[4]},t._calcBoundingBox=function(t,e){var i,n,r,a,s=3.1415926*t/180,o=Math.tan(s/2),l=NaN,h=NaN,u=NaN,c=0;for(c=0;c<=this._numberOfPSSM;c++){h=(l=(u=this._spiltDistance[c])*o)*e;var d=this._frustumPos[4*c+0].elements;d[0]=-h,d[1]=-l,d[2]=-u,(d=this._frustumPos[4*c+1].elements)[0]=h,d[1]=-l,d[2]=-u,(d=this._frustumPos[4*c+2].elements)[0]=-h,d[1]=l,d[2]=-u,(d=this._frustumPos[4*c+3].elements)[0]=h,d[1]=l,d[2]=-u,(d=this._dimension[c].elements)[0]=h,d[1]=l}for(c=1;c<=this._numberOfPSSM;c++)i=this._dimension[c].elements,(n=this._boundingBox[c].min.elements)[0]=-i[0],n[1]=-i[1],n[2]=-this._spiltDistance[c],(r=this._boundingBox[c].max.elements)[0]=i[0],r[1]=i[1],r[2]=-this._spiltDistance[c-1],(a=this._boundingSphere[c].center.elements)[0]=.5*(n[0]+r[0]),a[1]=.5*(n[1]+r[1]),a[2]=.5*(n[2]+r[2]),this._boundingSphere[c].radius=.5*Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2));n=this._boundingBox[0].min.elements,i=this._dimension[this._numberOfPSSM].elements,n[0]=-i[0],n[1]=-i[1],n[2]=-this._spiltDistance[this._numberOfPSSM],(r=this._boundingBox[0].max.elements)[0]=i[0],r[1]=i[1],r[2]=-this._spiltDistance[0],(a=this._boundingSphere[0].center.elements)[0]=.5*(n[0]+r[0]),a[1]=.5*(n[1]+r[1]),a[2]=.5*(n[2]+r[2]),this._boundingSphere[0].radius=.5*Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2))},t.calcSplitFrustum=function(t){0<this._currentPSSM?ye.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[this._currentPSSM-1],this._spiltDistance[this._currentPSSM],this._tempMatrix44):ye.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[0],this._spiltDistance[this._numberOfPSSM],this._tempMatrix44),ye.multiply(this._tempMatrix44,t.viewMatrix,this._tempMatrix44),this._splitFrustumCulling.matrix=this._tempMatrix44},t._rebuildRenderInfo=function(){var t=this._numberOfPSSM+1,e=0;if(null==this._renderTarget)for(this._renderTarget=R(t),this._renderTarget[0]=null,e=1;e<t;e++)this._renderTarget[e]=new Fs(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728);else if(this._renderTarget.length!=t)for(this.disposeAllRenderTarget(),this._renderTarget.length=t,this._renderTarget[0]=null,e=1;e<t;e++)this._renderTarget[e]=new Fs(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728);else for(e=1;e<t;e++)null!=this._renderTarget[e]&&this._renderTarget[e].width==this._shadowMapTextureSize&&this._renderTarget[e].height==this._shadowMapTextureSize||(null!=this._renderTarget[e]&&this._renderTarget[e].destroy(),this._renderTarget[e]=new Fs(this._shadowMapTextureSize,this._shadowMapTextureSize,6408,5121,33189,!1,!1,9728,9728));if(null==this._lightCulling||this._lightCulling.length!=t)for(this._lightCulling?this._lightCulling.length=t:this._lightCulling=R(t),e=0;e<this._lightCulling.length;e++)this._lightCulling[e]=new fe(ye.DEFAULT);if(null==this._lightVPMatrix||this._lightVPMatrix.length!=t)for(this._lightVPMatrix?this._lightVPMatrix.length=t:this._lightVPMatrix=R(t),e=0;e<this._lightVPMatrix.length;e++)this._lightVPMatrix[e]=new ye;if(null==this._lightCameras||this._lightCameras.length!=t)for(this._lightCameras?this._lightCameras.length=t:this._lightCameras=R(t),e=0;e<this._lightCameras.length;e++)this._lightCameras[e]=new Do,this._lightCameras[e].name="lightCamera"+e;if(null==this._shadowQuenes||this._shadowQuenes.length!=this._numberOfPSSM)for(this._shadowQuenes?this._shadowQuenes.length=this._numberOfPSSM:this._shadowQuenes=R(this._numberOfPSSM),e=0;e<this._shadowQuenes.length;e++)this._shadowQuenes[e]=new Y(this._scene);if(null==this._shaderValueVPs||this._shaderValueVPs.length!=t)for(this._shaderValueVPs?this._shaderValueVPs.length=t:this._shaderValueVPs=R(t),this._shaderValueLightVP=new Float32Array(16*t),e=0;e<t;e++)this._shaderValueVPs[e]=new Float32Array(this._shaderValueLightVP.buffer,64*e)},t._calcLightViewProject=function(t){var e=this._boundingSphere[this._currentPSSM],i=t.transform.worldMatrix;e.radius;e.center.cloneTo(this._tempLookAt3),we.transformV3ToV4(this._tempLookAt3,i,this._tempLookAt4);var n=this._tempLookAt3.elements,r=this._tempLookAt4.elements;n[0]=r[0],n[1]=r[1],n[2]=r[2];var a=this._tempLightUp.elements,s=t.forward.elements;a[0]=s[0],a[1]=1,a[2]=s[2],we.normalize(this._tempLightUp,this._tempLightUp),we.scale(this._globalParallelLightDir,4*e.radius,this._tempPos),we.subtract(this._tempLookAt3,this._tempPos,this._tempPos);var o=this._lightCameras[this._currentPSSM];o.transform.position=this._tempPos,o.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1);var l=this._tempMax.elements,h=this._tempMin.elements;l[0]=l[1]=l[2]=-1e5,l[3]=1,h[0]=h[1]=h[2]=1e5,h[3]=1,ye.multiply(o.viewMatrix,i,this._tempMatrix44);var u=this._tempValue.elements,c=[];c.length=8,this._boundingBox[this._currentPSSM].getCorners(c);for(var d=0;d<8;d++){var _=c[d].elements;u[0]=_[0],u[1]=_[1],u[2]=_[2],u[3]=1,Ce.transformByM4x4(this._tempValue,this._tempMatrix44,this._tempValue),h[0]=u[0]<h[0]?u[0]:h[0],h[1]=u[1]<h[1]?u[1]:h[1],h[2]=u[2]<h[2]?u[2]:h[2],l[0]=u[0]>l[0]?u[0]:l[0],l[1]=u[1]>l[1]?u[1]:l[1],l[2]=u[2]>l[2]?u[2]:l[2]}Ce.add(this._tempMax,this._tempMin,this._tempValue),u[0]*=.5,u[1]*=.5,u[2]*=.5,u[3]=1,Ce.transformByM4x4(this._tempValue,o.transform.worldMatrix,this._tempValue);var f=Math.abs(-this._tempMax.z),m=f>this._maxDistance?f:this._maxDistance;we.scale(this._globalParallelLightDir,m,this._tempPos);var p=this._tempPos.elements;p[0]=u[0]-p[0],p[1]=u[1]-p[1],p[2]=u[2]-p[2],o.transform.position=this._tempPos,o.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1),ye.createOrthoOffCenterRH(h[0],l[0],h[1],l[1],1,m+.5*(l[2]-h[2]),o.projectionMatrix),o.projectionViewMatrix.cloneTo(this._lightVPMatrix[this._currentPSSM]),this._lightCulling[this._currentPSSM].matrix=this._lightVPMatrix[this._currentPSSM],g.multiplyMatrixOutFloat32Array(this._tempScaleMatrix44,this._lightVPMatrix[this._currentPSSM],this._shaderValueVPs[this._currentPSSM])},t.getLightFrustumCulling=function(t){return this._lightCulling[t]},t.getSplitFrustumCulling=function(){return this._splitFrustumCulling},t.getSplitDistance=function(t){return this._spiltDistance[t]},t.setShadowMapTextureSize=function(t){t!==this._shadowMapTextureSize&&(this._shadowMapTextureSize=t,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this._statesDirty=!0)},t.getShadowMapTextureSize=function(){return this._shadowMapTextureSize},t.beginRenderTarget=function(t){this._renderTarget[t].start()},t.endRenderTarget=function(t){this._renderTarget[t].end()},t.getRenderTarget=function(t){return this._renderTarget[t]},t.disposeAllRenderTarget=function(){for(var t=0,e=this._numberOfPSSM+1;t<e;t++)this._renderTarget[t]&&(this._renderTarget[t].destroy(),this._renderTarget[t]=null)},v(0,t,"PSSMNum",function(){return this._numberOfPSSM},function(t){t=(t=0<t?t:1)<=3?t:3,this._numberOfPSSM!=t&&(this._numberOfPSSM=t,this._ratioOfDistance=1/this._numberOfPSSM,this._statesDirty=!0)}),g.multiplyMatrixOutFloat32Array=function(t,e,i){var n,r,a,s,o,l,h;for(r=t.elements,a=e.elements,n=0;n<4;n++)s=r[n],o=r[n+4],l=r[n+8],h=r[n+12],i[n]=s*a[0]+o*a[1]+l*a[2]+h*a[3],i[n+4]=s*a[4]+o*a[5]+l*a[6]+h*a[7],i[n+8]=s*a[8]+o*a[9]+l*a[10]+h*a[11],i[n+12]=s*a[12]+o*a[13]+l*a[14]+h*a[15]},g.SHADERDEFINE_RECEIVE_SHADOW=1,g.SHADERDEFINE_CAST_SHADOW=512,g.SHADERDEFINE_SHADOW_PSSM1=1024,g.SHADERDEFINE_SHADOW_PSSM2=2048,g.SHADERDEFINE_SHADOW_PSSM3=4096,g.SHADERDEFINE_SHADOW_PCF_NO=8192,g.SHADERDEFINE_SHADOW_PCF1=16384,g.SHADERDEFINE_SHADOW_PCF2=32768,g.SHADERDEFINE_SHADOW_PCF3=65536,g.MAX_PSSM_COUNT=3,g}(),Pe=function(){function T(){this._boundingSphere=null,this._boundingBox=null,this._sizeOfY=null,this._currentLODLevel=0,this._lastDistanceToEye=NaN,this._originalBoundingSphere=null,this._originalBoundingBox=null,this._originalBoundingBoxCorners=null,this._bUseStrip=!1,this._gridSize=NaN,this._beginGridX=0,this._beginGridZ=0,this._LODError=null,T.__init__(),this._currentLODLevel=0}E(T,"laya.d3.terrain.TerrainLeaf");var t=T.prototype;return t.calcVertextNorml=function(t,e,i,n,r,a){var s=0,o=0;o=-1*T.getHeightFromTerrainHeightData(t-1,e-1,i,n,r),o+=-1*T.getHeightFromTerrainHeightData(t-1,e,i,n,r),o+=-1*T.getHeightFromTerrainHeightData(t-1,e+1,i,n,r),o+=1*T.getHeightFromTerrainHeightData(t+1,e-1,i,n,r),o+=1*T.getHeightFromTerrainHeightData(t+1,e,i,n,r),o+=1*T.getHeightFromTerrainHeightData(t+1,e+1,i,n,r),s=-1*T.getHeightFromTerrainHeightData(t-1,e-1,i,n,r),s+=-1*T.getHeightFromTerrainHeightData(t,e-1,i,n,r),s+=-1*T.getHeightFromTerrainHeightData(t+1,e-1,i,n,r),s+=1*T.getHeightFromTerrainHeightData(t-1,e+1,i,n,r),s+=1*T.getHeightFromTerrainHeightData(t,e+1,i,n,r),s+=1*T.getHeightFromTerrainHeightData(t+1,e+1,i,n,r),a.x=-o,a.y=6,a.z=-s,we.normalize(a,a)},t.calcVertextNormlUV=function(t,e,i,n,r){r.x=t/i,r.y=e/n,r.z=e/n},t.calcVertextBuffer=function(t,e,i,n,r,a,s,o,l,h,u,c){if(1==c&&!T.__ADAPT_MATRIX__){T.__ADAPT_MATRIX__=new ye;var d=new ye;ye.createRotationY(Math.PI,T.__ADAPT_MATRIX__),ye.createTranslate(new we(0,0,(u-1)*r),d),ye.multiply(d,T.__ADAPT_MATRIX__,T.__ADAPT_MATRIX__),T.__ADAPT_MATRIX_INV__=new ye,T.__ADAPT_MATRIX__.invert(T.__ADAPT_MATRIX_INV__)}this._gridSize=r,this._beginGridX=t*T.CHUNK_GRID_NUM+i,this._beginGridZ=e*T.CHUNK_GRID_NUM+n;for(var _=s*o,f=2147483647,m=-2147483648,p=new we,g=0,v=T.LEAF_GRID_NUM+1;g<v;g++)for(var y=0,x=T.LEAF_GRID_NUM+1;y<x;y++)T.__VECTOR3__.x=(this._beginGridX+y)*this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+g)*this._gridSize,T.__VECTOR3__.y=l[(this._beginGridZ+g)*h+(this._beginGridX+y)],f=T.__VECTOR3__.y<f?T.__VECTOR3__.y:f,m=T.__VECTOR3__.y>m?T.__VECTOR3__.y:m,T.__ADAPT_MATRIX__&&we.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[_]=T.__VECTOR3__.x,a[++_]=T.__VECTOR3__.y,a[++_]=T.__VECTOR3__.z,_++,this.calcVertextNormlUV(this._beginGridX+y,this._beginGridZ+g,h,u,p),a[_]=p.x,a[++_]=p.y,a[++_]=p.z,a[++_]=(i+y)/T.CHUNK_GRID_NUM,a[++_]=(n+g)/T.CHUNK_GRID_NUM,a[++_]=this._beginGridX+y,a[++_]=this._beginGridZ+g,_++;this._sizeOfY=new Re(f-1,m+1),this.calcLODErrors(l,h,u),this.calcOriginalBoudingBoxAndSphere()},t.calcSkirtVertextBuffer=function(t,e,i,n,r,a,s,o,l,h,u){this._gridSize=r,this._beginGridX=t*T.CHUNK_GRID_NUM+i,this._beginGridZ=e*T.CHUNK_GRID_NUM+n;var c=s*o,d=0,_=0,f=T.LEAF_GRID_NUM+1,m=new we,p=0,g=0;for(d=0;d<2;d++)for(_=0;_<f;_++)T.__VECTOR3__.x=(this._beginGridX+_)*this._gridSize,T.__VECTOR3__.y=1==d?l[this._beginGridZ*h+(this._beginGridX+_)]:-this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+0)*this._gridSize,T.__ADAPT_MATRIX__&&we.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[c]=T.__VECTOR3__.x,a[++c]=T.__VECTOR3__.y,a[++c]=T.__VECTOR3__.z,c++,p=0==d?this._beginGridZ-1:this._beginGridZ,this.calcVertextNormlUV(this._beginGridX+_,p,h,u,m),a[c]=m.x,a[++c]=m.y,a[++c]=m.z,a[++c]=(i+_)/T.CHUNK_GRID_NUM,a[++c]=(n+0)/T.CHUNK_GRID_NUM,a[++c]=this._beginGridX+_,a[++c]=p,c++;for(d=0;d<2;d++)for(_=0;_<f;_++)T.__VECTOR3__.x=(this._beginGridX+_)*this._gridSize,T.__VECTOR3__.y=0==d?l[(this._beginGridZ+T.LEAF_GRID_NUM)*h+(this._beginGridX+_)]:-this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+T.LEAF_GRID_NUM)*this._gridSize,T.__ADAPT_MATRIX__&&we.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[c]=T.__VECTOR3__.x,a[++c]=T.__VECTOR3__.y,a[++c]=T.__VECTOR3__.z,c++,p=0==d?this._beginGridZ+T.LEAF_GRID_NUM:this._beginGridZ+T.LEAF_GRID_NUM+1,this.calcVertextNormlUV(this._beginGridX+_,p,h,u,m),a[c]=m.x,a[++c]=m.y,a[++c]=m.z,a[++c]=(i+_)/T.CHUNK_GRID_NUM,a[++c]=(n+T.LEAF_GRID_NUM)/T.CHUNK_GRID_NUM,a[++c]=this._beginGridX+_,a[++c]=p,c++;for(d=0;d<2;d++)for(_=0;_<f;_++)T.__VECTOR3__.x=(this._beginGridX+0)*this._gridSize,T.__VECTOR3__.y=0==d?l[(this._beginGridZ+_)*h+(this._beginGridX+0)]:-this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+_)*this._gridSize,T.__ADAPT_MATRIX__&&we.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[c]=T.__VECTOR3__.x,a[++c]=T.__VECTOR3__.y,a[++c]=T.__VECTOR3__.z,c++,g=0==d?this._beginGridX:this._beginGridX-1,this.calcVertextNormlUV(g,this._beginGridZ+_,h,u,m),a[c]=m.x,a[++c]=m.y,a[++c]=m.z,a[++c]=(i+0)/T.CHUNK_GRID_NUM,a[++c]=(n+_)/T.CHUNK_GRID_NUM,a[++c]=g,a[++c]=this._beginGridZ+_,c++;for(d=0;d<2;d++)for(_=0;_<f;_++)T.__VECTOR3__.x=(this._beginGridX+T.LEAF_GRID_NUM)*this._gridSize,T.__VECTOR3__.y=1==d?l[(this._beginGridZ+_)*h+(this._beginGridX+T.LEAF_GRID_NUM)]:-this._gridSize,T.__VECTOR3__.z=(this._beginGridZ+_)*this._gridSize,T.__ADAPT_MATRIX__&&we.transformV3ToV3(T.__VECTOR3__,T.__ADAPT_MATRIX__,T.__VECTOR3__),a[c]=T.__VECTOR3__.x,a[++c]=T.__VECTOR3__.y,a[++c]=T.__VECTOR3__.z,c++,g=0==d?this._beginGridX+T.LEAF_GRID_NUM+1:this._beginGridX+T.LEAF_GRID_NUM,this.calcVertextNormlUV(g,this._beginGridZ+_,h,u,m),a[c]=m.x,a[++c]=m.y,a[++c]=m.z,a[++c]=(i+T.LEAF_GRID_NUM)/T.CHUNK_GRID_NUM,a[++c]=(n+_)/T.CHUNK_GRID_NUM,a[++c]=g,a[++c]=this._beginGridZ+_,c++},t.calcOriginalBoudingBoxAndSphere=function(){var t=new we(this._beginGridX*this._gridSize,this._sizeOfY.x,this._beginGridZ*this._gridSize),e=new we((this._beginGridX+T.LEAF_GRID_NUM)*this._gridSize,this._sizeOfY.y,(this._beginGridZ+T.LEAF_GRID_NUM)*this._gridSize);T.__ADAPT_MATRIX__&&(we.transformV3ToV3(t,T.__ADAPT_MATRIX__,t),we.transformV3ToV3(e,T.__ADAPT_MATRIX__,e)),this._originalBoundingBox=new _e(t,e);var i=new we;we.subtract(e,t,i),we.scale(i,.5,i);var n=new we;we.add(t,i,n),this._originalBoundingSphere=new me(n,we.scalarLength(i)),this._originalBoundingBoxCorners=R(8,null),this._originalBoundingBox.getCorners(this._originalBoundingBoxCorners),this._boundingBox=new _e(new we(-.5,-.5,-.5),new we(.5,.5,.5)),this._boundingSphere=new me(new we(0,0,0),1)},t.calcLeafBoudingBox=function(t){for(var e=0;e<8;e++)we.transformCoordinate(this._originalBoundingBoxCorners[e],t,Cr._tempBoundBoxCorners[e]);_e.createfromPoints(Cr._tempBoundBoxCorners,this._boundingBox)},t.calcLeafBoudingSphere=function(t,e){we.transformCoordinate(this._originalBoundingSphere.center,t,this._boundingSphere.center),this._boundingSphere.radius=this._originalBoundingSphere.radius*e},t.calcLODErrors=function(t,e,i){this._LODError=new Float32Array(T._maxLODLevel+1);for(var n=1,r=0,a=T._maxLODLevel+1;r<a;r++){for(var s=0,o=0,l=T.LEAF_GRID_NUM;o<l;o+=n)for(var h=0,u=T.LEAF_GRID_NUM;h<u;h+=n)for(var c=t[(this._beginGridZ+o)*e+(this._beginGridX+h)],d=t[(this._beginGridZ+o)*e+(this._beginGridX+h)+n],_=t[(this._beginGridZ+o+n)*e+(this._beginGridX+h)],f=t[(this._beginGridZ+o+n)*e+(this._beginGridX+h)+n],m=0;m<n;m++)for(var p=m/n,g=0;g<n;g++){var v=g/n,y=t[(this._beginGridZ+o+m)*e+(this._beginGridX+h)+g],x=v+p<=1?c+(d-c)*v+(_-c)*p:f+(_-f)*(1-v)+(d-f)*(1-p),b=Math.abs(x-y);s=Math.max(s,b)}n*=2,this._LODError[r]=s}},t.determineLod=function(t,e,i,n){var r=we.distance(t,this._boundingSphere.center),a=T._maxLODLevel;if(!n){if(this._lastDistanceToEye==r)return this._currentLODLevel;this._lastDistanceToEye>r&&(a=this._currentLODLevel)}for(var s=a;1<=s;s--)if(co.LOD_DISTANCE_FACTOR*this._LODError[s]/r*e<i){this._currentLODLevel=s;break}return this._lastDistanceToEye=r,this._currentLODLevel},T.__init__=function(){if(!T._bInit){var t=T.CHUNK_GRID_NUM/T.LEAF_GRID_NUM*(T.CHUNK_GRID_NUM/T.LEAF_GRID_NUM);T._planeLODIndex=R(t);var e=0,i=0,n=0,r=0,a=0,s=0,o=null,l=null;for(e=0;e<t;e++)T._planeLODIndex[e]=new Array(T._maxLODLevel+1);for(e=0,r=T._maxLODLevel+1;e<r;e++)T._planeLODIndex[0][e]=T.calcPlaneLODIndex(e);for(e=1;e<t;e++)for(s=e*T.LEAF_PLANE_VERTEXT_COUNT,i=0,a=T._maxLODLevel+1;i<a;i++){for(o=T._planeLODIndex[0][i],l=new Uint16Array(o.length),n=0;n<o.length;n++)l[n]=o[n]+s;T._planeLODIndex[e][i]=l}for(T._skirtLODIndex=R(t),e=0;e<t;e++)T._skirtLODIndex[e]=new Array(T._maxLODLevel+1);for(e=0,r=T._maxLODLevel+1;e<r;e++)T._skirtLODIndex[0][e]=T.calcSkirtLODIndex(e);for(e=1;e<t;e++)for(s=e*T.LEAF_SKIRT_VERTEXT_COUNT,i=0,a=T._maxLODLevel+1;i<a;i++){for(o=T._skirtLODIndex[0][i],l=new Uint16Array(o.length),n=0;n<o.length;n++)l[n]=o[n]+s;T._skirtLODIndex[e][i]=l}T._bInit=!0}},T.getPlaneLODIndex=function(t,e){return T._planeLODIndex[t][e]},T.getSkirtLODIndex=function(t,e){return T._skirtLODIndex[t][e]},T.calcPlaneLODIndex=function(t){T._maxLODLevel<t&&(t=T._maxLODLevel);var e=T.LEAF_GRID_NUM+1,i=0,n=null,r=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,t);n=new Uint16Array(r*r*6);for(var a=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/r,s=0;s<T.LEAF_GRID_NUM;s+=a)for(var o=0;o<T.LEAF_GRID_NUM;o+=a)n[i]=(s+a)*e+o,n[++i]=s*e+o,n[++i]=s*e+o+a,n[++i]=s*e+o+a,n[++i]=(s+a)*e+o+a,n[++i]=(s+a)*e+o,i++;return n},T.calcSkirtLODIndex=function(t){T._maxLODLevel<t&&(t=T._maxLODLevel);var e=T.CHUNK_GRID_NUM/T.LEAF_GRID_NUM*(T.CHUNK_GRID_NUM/T.LEAF_GRID_NUM)*T.LEAF_PLANE_VERTEXT_COUNT,i=T.LEAF_GRID_NUM+1,n=0,r=null,a=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,t);r=new Uint16Array(4*a*6);for(var s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/a,o=0;o<4;o++){for(var l=0;l<T.LEAF_GRID_NUM;l+=s)r[n]=e+i+l,r[++n]=e+l,r[++n]=e+l+s,r[++n]=e+l+s,r[++n]=e+i+l+s,r[++n]=e+i+l,n++;e+=2*i}return r},T.getHeightFromTerrainHeightData=function(t,e,i,n,r){return i[(e=r<=(e=e<0?0:e)?r-1:e)*n+(t=n<=(t=t<0?0:t)?n-1:t)]},T.CHUNK_GRID_NUM=64,T.LEAF_GRID_NUM=32,T.__ADAPT_MATRIX__=null,T.__ADAPT_MATRIX_INV__=null,T._planeLODIndex=null,T._skirtLODIndex=null,T._bInit=!1,m(T,["LEAF_PLANE_VERTEXT_COUNT",function(){return this.LEAF_PLANE_VERTEXT_COUNT=(T.LEAF_GRID_NUM+1)*(T.LEAF_GRID_NUM+1)},"LEAF_SKIRT_VERTEXT_COUNT",function(){return this.LEAF_SKIRT_VERTEXT_COUNT=2*(T.LEAF_GRID_NUM+1)*4},"LEAF_VERTEXT_COUNT",function(){return this.LEAF_VERTEXT_COUNT=T.LEAF_PLANE_VERTEXT_COUNT+T.LEAF_SKIRT_VERTEXT_COUNT},"LEAF_PLANE_MAX_INDEX_COUNT",function(){return this.LEAF_PLANE_MAX_INDEX_COUNT=T.LEAF_GRID_NUM*T.LEAF_GRID_NUM*6},"LEAF_SKIRT_MAX_INDEX_COUNT",function(){return this.LEAF_SKIRT_MAX_INDEX_COUNT=4*T.LEAF_GRID_NUM*6},"LEAF_MAX_INDEX_COUNT",function(){return this.LEAF_MAX_INDEX_COUNT=T.LEAF_PLANE_MAX_INDEX_COUNT+T.LEAF_SKIRT_MAX_INDEX_COUNT},"__VECTOR3__",function(){return this.__VECTOR3__=new we},"_maxLODLevel",function(){return this._maxLODLevel=Math.log2(T.LEAF_GRID_NUM)}]),T}(),Fe=function(){function t(){this.alphaMap=null,this.detailID=null,this.normalMap=null}return E(t,"laya.d3.terrain.unit.ChunkInfo"),t}(),Oe=function(){function t(){this.diffuseTexture=null,this.normalTexture=null,this.scale=null,this.offset=null}return E(t,"laya.d3.terrain.unit.DetailTextureInfo"),t}(),Be=function(){function t(){this.ambientColor=null,this.diffuseColor=null,this.specularColor=null}return E(t,"laya.d3.terrain.unit.MaterialInfo"),t}(),Ge=function(){function d(){}return E(d,"laya.d3.utils.Physics"),d.__init__=function(){d._layerCollsionMatrix.length=31;for(var t=0;t<31;t++){var e=[],i=31-t;e.length=i;for(var n=0;n<i;n++)e[n]=n===i-1;d._layerCollsionMatrix[t]=e}},d.setLayerCollision=function(t,e,i){d._layerCollsionMatrix[t.number][30-e.number]=i},d.getLayerCollision=function(t,e){return d._layerCollsionMatrix[t.number][30-e.number]},d.setColliderCollision=function(t,e,i){i?(delete t._ignoreCollisonMap[e.id],delete e._ignoreCollisonMap[t.id]):(t._ignoreCollisonMap[e.id]=e)._ignoreCollisonMap[t.id]=t},d.getIColliderCollision=function(t,e){return!!t._ignoreCollisonMap[e.id]},d.rayCast=function(t,e,i,n){void 0===i&&(i=179e306),void 0===n&&(n=0),d._outHitAllInfo.length=0;for(var r=V.getLayerByNumber(n)._colliders,a=0,s=r.length;a<s;a++){var o=r[a];if(o.enable&&(o.raycast(t,d._outHitInfo,i),-1!==d._outHitInfo.distance&&d._outHitInfo.distance<=i)){var l=new Ue;d._outHitInfo.cloneTo(l),d._outHitAllInfo.push(l)}}if(0==d._outHitAllInfo.length)return e.sprite3D=null,void(e.distance=-1);for(var h=Number.MAX_VALUE,u=0,c=0;c<d._outHitAllInfo.length;c++)d._outHitAllInfo[c].distance<h&&(h=d._outHitAllInfo[c].distance,u=c);d._outHitAllInfo[u].cloneTo(e)},d.rayCastAll=function(t,e,i,n){void 0===i&&(i=179e306),void 0===n&&(n=0),e.length=0;for(var r=V.getLayerByNumber(n)._colliders,a=0,s=r.length;a<s;a++){var o=r[a];if(o.enable&&(d._outHitInfo.distance=-1,d._outHitInfo.sprite3D=null,o.raycast(t,d._outHitInfo,i),-1!==d._outHitInfo.distance&&d._outHitInfo.distance<=i)){var l=new Ue;d._outHitInfo.cloneTo(l),e.push(l)}}},d._outHitAllInfo=[],d._layerCollsionMatrix=[],m(d,["_outHitInfo",function(){return this._outHitInfo=new Ue},"collisionManager",function(){return this.collisionManager=new xr},"gravity",function(){return this.gravity=new we(0,-9.81,0)}]),d}(),We=function(){function z(){}return E(z,"laya.d3.utils.Picker"),z.calculateCursorRay=function(t,e,i,n,r,a){var s=t.elements[0],o=t.elements[1],l=z._tempVector30,h=l.elements;h[0]=s,h[1]=o,h[2]=e.minDepth;var u=z._tempVector31,c=u.elements;c[0]=s,c[1]=o,c[2]=e.maxDepth;var d=a.origin,_=z._tempVector32;e.unprojectFromWVP(l,i,n,r,d),e.unprojectFromWVP(u,i,n,r,_);var f=a.direction.elements;f[0]=_.x-d.x,f[1]=_.y-d.y,f[2]=_.z-d.z,we.normalize(a.direction,a.direction)},z.rayIntersectsPositionsAndIndices=function(t,e,i,n,r){for(var a=i.vertexStride/4,s=i.getVertexElementByUsage(0).offset/4,o=Number.MAX_VALUE,l=-1,h=-1,u=-1,c=0;c<n.length;c+=3){var d=z._tempVector35,_=d.elements,f=n[c]*a,m=f+s;_[0]=e[m],_[1]=e[m+1],_[2]=e[m+2];var p=z._tempVector36,g=p.elements,v=n[c+1]*a,y=v+s;g[0]=e[y],g[1]=e[y+1],g[2]=e[y+2];var x=z._tempVector37,b=x.elements,T=n[c+2]*a,S=T+s;b[0]=e[S],b[1]=e[S+1],b[2]=e[S+2];var E=laya.d3.utils.Picker.rayIntersectsTriangle(t,d,p,x);!isNaN(E)&&E<o&&(o=E,l=f,h=v,u=T)}if(o===Number.MAX_VALUE)return r.position.toDefault(),r.distance=Number.MAX_VALUE,r.trianglePositions[0].toDefault(),r.trianglePositions[1].toDefault(),r.trianglePositions[2].toDefault(),r.triangleNormals[0].toDefault(),r.triangleNormals[1].toDefault(),r.triangleNormals[2].toDefault(),!1;r.distance=o,we.scale(t.direction,o,r.position),we.add(t.origin,r.position,r.position);var R=r.trianglePositions,w=R[0],C=R[1],I=R[2],M=w.elements,A=C.elements,D=I.elements,L=l+s;M[0]=e[L],M[1]=e[L+1],M[2]=e[L+2];var V=h+s;A[0]=e[V],A[1]=e[V+1],A[2]=e[V+2];var N=u+s;D[0]=e[N],D[1]=e[N+1],D[2]=e[N+2];var P=i.getVertexElementByUsage(3);if(P){var F=P.offset/4,O=r.triangleNormals,B=O[0],G=O[1],W=O[2],U=B.elements,Z=G.elements,k=W.elements,H=l+F;U[0]=e[H],U[1]=e[H+1],U[2]=e[H+2];var X=h+F;Z[0]=e[X],Z[1]=e[X+1],Z[2]=e[X+2];var Y=u+F;k[0]=e[Y],k[1]=e[Y+1],k[2]=e[Y+2]}return!0},z.rayIntersectsTriangle=function(t,e,i,n){var r=z._tempVector30,a=z._tempVector31;we.subtract(i,e,r),we.subtract(n,e,a);var s,o=z._tempVector32;if(we.cross(t.direction,a,o),(s=we.dot(r,o))>-Number.MIN_VALUE&&s<Number.MIN_VALUE)return Number.NaN;var l,h=1/s,u=z._tempVector33;if(we.subtract(t.origin,e,u),l=we.dot(u,o),(l*=h)<0||1<l)return Number.NaN;var c,d,_=z._tempVector34;return we.cross(u,r,_),c=we.dot(t.direction,_),(c*=h)<0||1<l+c?Number.NaN:(d=we.dot(a,_),(d*=h)<0?Number.NaN:d)},m(z,["_tempVector30",function(){return this._tempVector30=new we},"_tempVector31",function(){return this._tempVector31=new we},"_tempVector32",function(){return this._tempVector32=new we},"_tempVector33",function(){return this._tempVector33=new we},"_tempVector34",function(){return this._tempVector34=new we},"_tempVector35",function(){return this._tempVector35=new we},"_tempVector36",function(){return this._tempVector36=new we},"_tempVector37",function(){return this._tempVector37=new we}]),z}(),Ue=function(){function t(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new we,new we,new we],this.trianglePositions.length=3,this.triangleNormals=[new we,new we,new we],this.triangleNormals.length=3,this.position=new we}return E(t,"laya.d3.utils.RaycastHit"),t.prototype.cloneTo=function(t){t.distance=this.distance,this.trianglePositions[0].cloneTo(t.trianglePositions[0]),this.trianglePositions[1].cloneTo(t.trianglePositions[1]),this.trianglePositions[2].cloneTo(t.trianglePositions[2]),this.triangleNormals[0].cloneTo(t.triangleNormals[0]),this.triangleNormals[1].cloneTo(t.triangleNormals[1]),this.triangleNormals[2].cloneTo(t.triangleNormals[2]),this.position.cloneTo(t.position),t.sprite3D=this.sprite3D},t}(),Ze=function(){function t(t,e){this._width=0,this._height=0,this._width=t,this._height=e}E(t,"laya.d3.utils.Size");var e=t.prototype;return v(0,e,"width",function(){return-1===this._width?z.clientWidth:this._width}),v(0,e,"height",function(){return-1===this._height?z.clientHeight:this._height}),v(1,t,"fullScreen",function(){return new t(-1,-1)}),t}(),ke=function(){function L(){}return E(L,"laya.d3.utils.Utils3D"),L._rotationTransformScaleSkinAnimation=function(t,e,i,n,r,a,s,o,l,h,u,c){var d,_,f,m,p,g=L._tempArray16_0,v=L._tempArray16_1,y=L._tempArray16_2,x=n+n,b=r+r,T=a+a,S=n*x,E=r*x,R=r*b,w=a*x,C=a*b,I=a*T,M=s*x,A=s*b,D=s*T;for(g[15]=1,g[0]=1-R-I,g[1]=E+D,g[2]=w-A,g[4]=E-D,g[5]=1-S-I,g[6]=C+M,g[8]=w+A,g[9]=C-M,g[10]=1-S-R,v[15]=1,v[0]=o,v[5]=l,v[10]=h,d=0;d<4;d++)_=g[d],f=g[d+4],m=g[d+8],p=g[d+12],y[d]=_,y[d+4]=f,y[d+8]=m,y[d+12]=_*t+f*e+m*i+p;for(d=0;d<4;d++)_=y[d],f=y[d+4],m=y[d+8],p=y[d+12],u[d+c]=_*v[0]+f*v[1]+m*v[2]+p*v[3],u[d+c+4]=_*v[4]+f*v[5]+m*v[6]+p*v[7],u[d+c+8]=_*v[8]+f*v[9]+m*v[10]+p*v[11],u[d+c+12]=_*v[12]+f*v[13]+m*v[14]+p*v[15]},L._createNodeByJson=function(t,e,i,n){if(!i)switch(e.type){case"Sprite3D":i=new ys;break;case"MeshSprite3D":i=new Vo;break;case"SkinnedMeshSprite3D":i=new Bo;break;case"ShuriKenParticle3D":i=new Fo;break;case"TrailSprite3D":i=new Go;break;case"Terrain":i=new co;break;case"Camera":i=new Do;break;case"DirectionLight":i=new Lo;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var r=e.props;if(r)for(var a in r)i[a]=r[a];var s=e.customProps;s&&(i instanceof laya.d3.core.Sprite3D?(i._parseBaseCustomProps(s),i._parseCustomProps(t,n,s,e),i._parseCustomComponent(t,n,e.components)):i._parseCustomProps(t,n,s,e));var o=e.child;if(o)for(var l=0,h=o.length;l<h;l++){var u=L._createNodeByJson(t,o[l],null,n);i.addChild(u)}return i},L._computeBoneAndAnimationDatasByBindPoseMatrxix=function(t,e,i,n,r,a){var s,o,l=0,h=0,u=t.length;for(s=0;s<u;l+=t[s].keyframeWidth,h+=16,s++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[l+0],e[l+1],e[l+2],e[l+3],e[l+4],e[l+5],e[l+6],e[l+7],e[l+8],e[l+9],n,h),0!=s&&(o=16*t[s].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,o,n,h,n,h));var c=i.length;for(s=0;s<c;s++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,16*a[s],i[s],r,16*s)},L._computeAnimationDatasByArrayAndMatrixFast=function(t,e,i,n){for(var r=0,a=t.length;r<a;r++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,16*n[r],t[r],i,16*r)},L._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(t,e,i,n,r){var a,s,o=0,l=0,h=t.length;for(a=0;a<h;o+=t[a].keyframeWidth,l+=16,a++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[o+7],e[o+8],e[o+9],e[o+3],e[o+4],e[o+5],e[o+6],e[o+0],e[o+1],e[o+2],n,l),0!=a&&(s=16*t[a].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,s,n,l,n,l));var u=i.length;for(a=0;a<u;a++){var c=16*a;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,c,i[a],r,c)}},L._computeAnimationDatasByArrayAndMatrixFastOld=function(t,e,i){for(var n=t.length,r=0;r<n;r++){var a=16*r;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,a,t[r],i,a)}},L._computeRootAnimationData=function(t,e,i){for(var n=0,r=0,a=0,s=t.length;n<s;r+=t[n].keyframeWidth,a+=16,n++)laya.d3.utils.Utils3D.createAffineTransformationArray(e[r+0],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],i,a)},L.transformVector3ArrayByQuat=function(t,e,i,n,r){var a=i.elements,s=t[e],o=t[e+1],l=t[e+2],h=a[0],u=a[1],c=a[2],d=a[3],_=d*s+u*l-c*o,f=d*o+c*s-h*l,m=d*l+h*o-u*s,p=-h*s-u*o-c*l;n[r]=_*d+p*-h+f*-c-m*-u,n[r+1]=f*d+p*-u+m*-h-_*-c,n[r+2]=m*d+p*-c+_*-u-f*-h},L.mulMatrixByArray=function(t,e,i,n,r,a){var s,o,l,h,u;if(r===i){for(i=L._tempArray16_3,s=0;s<16;++s)i[s]=r[a+s];n=0}for(s=0;s<4;s++)o=t[e+s],l=t[e+s+4],h=t[e+s+8],u=t[e+s+12],r[a+s]=o*i[n+0]+l*i[n+1]+h*i[n+2]+u*i[n+3],r[a+s+4]=o*i[n+4]+l*i[n+5]+h*i[n+6]+u*i[n+7],r[a+s+8]=o*i[n+8]+l*i[n+9]+h*i[n+10]+u*i[n+11],r[a+s+12]=o*i[n+12]+l*i[n+13]+h*i[n+14]+u*i[n+15]},L.mulMatrixByArrayFast=function(t,e,i,n,r,a){var s,o,l,h,u;for(s=0;s<4;s++)o=t[e+s],l=t[e+s+4],h=t[e+s+8],u=t[e+s+12],r[a+s]=o*i[n+0]+l*i[n+1]+h*i[n+2]+u*i[n+3],r[a+s+4]=o*i[n+4]+l*i[n+5]+h*i[n+6]+u*i[n+7],r[a+s+8]=o*i[n+8]+l*i[n+9]+h*i[n+10]+u*i[n+11],r[a+s+12]=o*i[n+12]+l*i[n+13]+h*i[n+14]+u*i[n+15]},L.mulMatrixByArrayAndMatrixFast=function(t,e,i,n,r){var a,s,o,l,h,u=i.elements,c=u[0],d=u[1],_=u[2],f=u[3],m=u[4],p=u[5],g=u[6],v=u[7],y=u[8],x=u[9],b=u[10],T=u[11],S=u[12],E=u[13],R=u[14],w=u[15],C=e,I=e+4,M=e+8,A=e+12,D=r,L=r+4,V=r+8,N=r+12;for(a=0;a<4;a++)s=t[C+a],o=t[I+a],l=t[M+a],h=t[A+a],n[D+a]=s*c+o*d+l*_+h*f,n[L+a]=s*m+o*p+l*g+h*v,n[V+a]=s*y+o*x+l*b+h*T,n[N+a]=s*S+o*E+l*R+h*w},L.createAffineTransformationArray=function(t,e,i,n,r,a,s,o,l,h,u,c){var d=n+n,_=r+r,f=a+a,m=n*d,p=n*_,g=n*f,v=r*_,y=r*f,x=a*f,b=s*d,T=s*_,S=s*f;u[c+0]=(1-(v+x))*o,u[c+1]=(p+S)*o,u[c+2]=(g-T)*o,u[c+3]=0,u[c+4]=(p-S)*l,u[c+5]=(1-(m+x))*l,u[c+6]=(y+b)*l,u[c+7]=0,u[c+8]=(g+T)*h,u[c+9]=(y-b)*h,u[c+10]=(1-(m+v))*h,u[c+11]=0,u[c+12]=t,u[c+13]=e,u[c+14]=i,u[c+15]=1},L.transformVector3ArrayToVector3ArrayCoordinate=function(t,e,i,n,r){var a=L._tempArray4_0,s=t[e+0],o=t[e+1],l=t[e+2],h=i.elements;a[0]=s*h[0]+o*h[4]+l*h[8]+h[12],a[1]=s*h[1]+o*h[5]+l*h[9]+h[13],a[2]=s*h[2]+o*h[6]+l*h[10]+h[14],a[3]=1/(s*h[3]+o*h[7]+l*h[11]+h[15]),n[r+0]=a[0]*a[3],n[r+1]=a[1]*a[3],n[r+2]=a[2]*a[3]},L.transformLightingMapTexcoordByUV0Array=function(t,e,i,n,r){var a=i.elements;n[r+0]=t[e+0]*a[0]+a[2],n[r+1]=(t[e+1]-1)*a[1]+a[3]},L.transformLightingMapTexcoordByUV1Array=function(t,e,i,n,r){var a=i.elements;n[r+0]=t[e+0]*a[0]+a[2],n[r+1]=1+t[e+1]*a[1]+a[3]},L.getURLVerion=function(t){var e=t.indexOf("?");return 0<=e?t.substr(e):null},L._quaternionCreateFromYawPitchRollArray=function(t,e,i,n){var r=.5*i,a=.5*e,s=.5*t,o=Math.sin(r),l=Math.cos(r),h=Math.sin(a),u=Math.cos(a),c=Math.sin(s),d=Math.cos(s);n[0]=d*h*l+c*u*o,n[1]=c*u*l-d*h*o,n[2]=d*u*o-c*h*l,n[3]=d*u*l+c*h*o},L._createAffineTransformationArray=function(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=e[3],l=r+r,h=a+a,u=s+s,c=r*l,d=r*h,_=r*u,f=a*h,m=a*u,p=s*u,g=o*l,v=o*h,y=o*u,x=i[0],b=i[1],T=i[2];n[0]=(1-(f+p))*x,n[1]=(d+y)*x,n[2]=(_-v)*x,n[3]=0,n[4]=(d-y)*b,n[5]=(1-(c+p))*b,n[6]=(m+g)*b,n[7]=0,n[8]=(_+v)*T,n[9]=(m-g)*T,n[10]=(1-(c+f))*T,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1},L._mulMatrixArray=function(t,e,i,n){var r,a,s,o,l,h=e.elements,u=h[0],c=h[1],d=h[2],_=h[3],f=h[4],m=h[5],p=h[6],g=h[7],v=h[8],y=h[9],x=h[10],b=h[11],T=h[12],S=h[13],E=h[14],R=h[15],w=n,C=n+4,I=n+8,M=n+12;for(r=0;r<4;r++)a=t[r],s=t[r+4],o=t[r+8],l=t[r+12],i[w+r]=a*u+s*c+o*d+l*_,i[C+r]=a*f+s*m+o*p+l*g,i[I+r]=a*v+s*y+o*x+l*b,i[M+r]=a*T+s*S+o*E+l*R},L.getYawPitchRoll=function(t,e){L.transformQuat(we.ForwardRH,t,Te.TEMPVector31),L.transformQuat(we.Up,t,Te.TEMPVector32);var i=Te.TEMPVector32.elements;L.angleTo(we.ZERO,Te.TEMPVector31,Te.TEMPVector33);var n=Te.TEMPVector33.elements;n[0]==Math.PI/2?(n[1]=L.arcTanAngle(i[2],i[0]),n[2]=0):n[0]==-Math.PI/2?(n[1]=L.arcTanAngle(-i[2],-i[0]),n[2]=0):(ye.createRotationY(-n[1],Te.TEMPMatrix0),ye.createRotationX(-n[0],Te.TEMPMatrix1),we.transformCoordinate(Te.TEMPVector32,Te.TEMPMatrix0,Te.TEMPVector32),we.transformCoordinate(Te.TEMPVector32,Te.TEMPMatrix1,Te.TEMPVector32),n[2]=L.arcTanAngle(i[1],-i[0])),n[1]<=-Math.PI&&(n[1]=Math.PI),n[2]<=-Math.PI&&(n[2]=Math.PI),n[1]>=Math.PI&&n[2]>=Math.PI&&(n[1]=0,n[2]=0,n[0]=Math.PI-n[0]),e[0]=n[1],e[1]=n[0],e[2]=n[2]},L.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},L.angleTo=function(t,e,i){we.subtract(e,t,Te.TEMPVector30),we.normalize(Te.TEMPVector30,Te.TEMPVector30),i.elements[0]=Math.asin(Te.TEMPVector30.y),i.elements[1]=L.arcTanAngle(-Te.TEMPVector30.z,-Te.TEMPVector30.x)},L.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,a=e,s=r[0],o=r[1],l=r[2],h=a[0],u=a[1],c=a[2],d=a[3],_=d*s+u*l-c*o,f=d*o+c*s-h*l,m=d*l+h*o-u*s,p=-h*s-u*o-c*l;n[0]=_*d+p*-h+f*-c-m*-u,n[1]=f*d+p*-u+m*-h-_*-c,n[2]=m*d+p*-c+_*-u-f*-h},L.quaterionNormalize=function(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],s=i*i+n*n+r*r+a*a;0<s&&(s=1/Math.sqrt(s),e[0]=i*s,e[1]=n*s,e[2]=r*s,e[3]=a*s)},L.matrix4x4MultiplyFFF=function(t,e,i){var n,r,a,s,o;if(i===e)for(e=new Float32Array(16),n=0;n<16;++n)e[n]=i[n];for(n=0;n<4;n++)r=t[n],a=t[n+4],s=t[n+8],o=t[n+12],i[n]=r*e[0]+a*e[1]+s*e[2]+o*e[3],i[n+4]=r*e[4]+a*e[5]+s*e[6]+o*e[7],i[n+8]=r*e[8]+a*e[9]+s*e[10]+o*e[11],i[n+12]=r*e[12]+a*e[13]+s*e[14]+o*e[15]},L.matrix4x4MultiplyMFM=function(t,e,i){L.matrix4x4MultiplyFFF(t.elements,e,i.elements)},m(L,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new we},"_tempVector3_1",function(){return this._tempVector3_1=new we},"_tempVector3_2",function(){return this._tempVector3_2=new we},"_tempVector3_3",function(){return this._tempVector3_3=new we},"_tempVector3_4",function(){return this._tempVector3_4=new we},"_tempVector3_5",function(){return this._tempVector3_5=new we},"_tempVector3_6",function(){return this._tempVector3_6=new we},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),L}(),He=function(){function e(){}return E(e,"laya.debug.data.Base64AtlasManager"),e.replaceRes=function(t){e.base64.replaceRes(t)},m(e,["dataO",function(){return this.dataO={"comp/button1.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAABRCAYAAAApS3MNAAABSUlEQVR4Xu3a0QmFMADFUJ1JXM0h3moPZ6qg4AoNeLqAIenFn65jjLE40w2sQkxvcAMI0eggRKSDEEJUDEQ4/COEiBiIYFiEEBEDEQyLECJiIIJhEUJEDEQwLEKIiIEIhkUIETEQwbAIISIGIhgWIUTEQATDIoSIGIhgWIQQEQMRDIsQImIggnEvYvv9IzjfxDiP/XlgJsTcCyDEXP/v14UQImIggmERQkQMRDAsQoiIgQiGRQgRMRDBsAghIgYiGBYhRMRABMMihIgYiGBYhBARAxEMixAiYiCCYRFCRAxEMCxCiIiBCMa7iAjPpzG8fY3kF0KIiIEIhkUIETEQwbAIISIGIhgWIUTEQATDIoSIGIhgWIQQEQMRDIsQImIggmERQkQMRDAsQoiIgQiGRQgRMRDBsAghIgYiGBYhRMRABMMihIgYiGBcGJiOHTRZjZAAAAAASUVORK5CYII=","comp/line2.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAAG0lEQVQYV2NkoDJgpLJ5DIxtra3/qWko1V0IAJvgApS1libIAAAAAElFTkSuQmCC","view/create.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAkCAYAAAC9itu8AAAAdElEQVQ4T2NkwAIWLFjwH5t4QkICIyM2CXQxmAHka/j///9mXDYxMjL6YtgwBDUg+w8crIT8MBQ0oEca55JvWNPS9xgu4tISzADyNfz///8MnrRkgmHDENSALWng9fRQ0DA40xLecglbWhpqGoZCMUNKUQkANAHAJVkE5XwAAAAASUVORK5CYII=","view/rendertime.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAkCAYAAAC9itu8AAABeUlEQVQ4T+2Uv0tCURSAvyNdcwiXBlsaaomWFgeHlqAtCPsDJHwIiUtDSxERtErtmQ6CjkHo4FpDBQ0tbVFR0BYE0eQvOnFF7T17QlOTd3m88873OD8+rtA9uVzOBIPBlIisAwvd8B1QajQahXQ63bIx6QHFYrEEJHrv7qeqZhzHOfYA+Xw+Yow5B+YHoGwymdxW1QAQEFWNAk8i8uEDuZM3gUcLZIEJYNcNqWrVcZyd7p9t8jLwYIFTYBx47UHlcjmcSCQ+B5JtpU0LnAFj3br7kE+yTalb4BCYczVqoT3AjteW4T73FlgFNgY+1IGQz4hPLGCAI2DGbweu2Auw1Vmcqk4C+8DsEOgZOBCR9/6mVdU2vgIsAdOuIVwANRFpezatuahpTYVSop1m+y6pasm8NQqSvvW61KwslkSHuCRkgvErr0taiUXaal1Sr0siWRO/9HfpF+RN9nfpB/qqmrXrv7mktVhYVm5GLo1cct9LI5e8d84/3UvfAgdlKH0EO7MAAAAASUVORK5CYII=","view/cache.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAkCAYAAABSSLCCAAAAcElEQVQ4T2NcsGDB/4SEBEYGBgYGYtmMxCpENhhsA6mA8f///5tHNTEwkBcQpIYcSD15kUtWigi51vR/jVYdOGUQy2YkViGywWSnvTOkhiAonkY1gZIRqSEHTntkRe4g10RWQIyWe5Bgo2O5R7dkBADztyP+yFzirAAAAABJRU5ErkJggg==","comp/clip_selectBox.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAoCAYAAAAIeF9DAAAAsElEQVRoQ+3ZQQ0AMQzEwAuqEgh/Sj2pKObhIrBsrfLonHPu12MMTEGYFg+kIFaPgmA9ClIQzQDG0w0pCGYAw2khBcEMYDgtpCCYAQynhRQEM4DhtJCCYAYwnBZSEMwAhtNCCoIZwHBmd/tTh6IUBIrx/tRbiFWkIFaPFoL1KEhBNAMYTzekIJgBDKeFFAQzgOG0kIJgBjCcFlIQzACG00IKghnAcFpIQTADGE4LwYL8U/BE1dCJ3PsAAAAASUVORK5CYII=","comp/label.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAASCAYAAACQCxruAAAAmElEQVRoQ+3aMQqAQBBDUef+hx4Zq1mrbPnhWylECHmghVZ397OOqqp97TlugdNzgEXFIaaFuwROt0LmBEay5aXb920+FjIpMJItLy1wvhUyKTCSLS8tcL4VMikwki0vLXC+FTIpMJItLy1wvhUyKTCSLS89wPP1Qeh8M0zy+84gMMbruqjA15OxbtjAu7mPa5bj0fb/A8cLgD4n/wQKNiIAAAAASUVORK5CYII=","comp/clip_tree_arrow.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAQCAYAAAArij59AAAAwUlEQVQoU5WRPRKCMBCFWUt6vYQeB06RUDpoBbFDa7yDwm30FGi9dHnOMiQDBgvT5c3b7+0PRVEUlVV9A3NmzL6T//SRfMz5CgCdtVafjlmzaHAigAbM2tE8YVo1pf0yvABoc9D3wACgBbMKIgD4qqDJsqqlMV8VGL5n/88geCJKlijSMBXFZUNx/CSi9WwX1r7R99thzKKqkxXRbMUWSE2u2sEwHsxHCbrMVSq6N4xRD9HAvJstylEkarhurlqnfQC58YP5+CvQNwAAAABJRU5ErkJggg==","view/bg_panel.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAMUlEQVRYR+3QQREAAAjDMGZk/l2CDD6pgl7SduexGCBAgAABAgQIECBAgAABAgS+BQ4oyStBhXcy5AAAAABJRU5ErkJggg==","view/bg_top.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAMUlEQVRYR+3QQREAAAjDMKZp/rWBDD6pgl7SduexGCBAgAABAgQIECBAgAABAgS+BQ6WyDMhXMLeQgAAAABJRU5ErkJggg==","view/clickselect.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAqCAYAAACDdWrxAAACfElEQVRIS8WVO2iTYRSGn5OWqpMOurg0VRBdVVCsg7GgDjpZECyirl4GEYfSgBlaB5VSpApdxCJIoeKgg7dKC21ALahIiyiKKUjxAiI4qCH1lRP/hPhfAnHpGZPv+c4573nP95ukO/xHmINmtq8RtswsPiipB/gAPAFem5nCbcSWKukIsD84/A2YBh4DL8ysWLkk0qOkDcD5GLF+Ac+Ap35ZHGjAdWB5gtJvgZFYVSWdBHaFwBlg1Mw8K0ngFiAbAm+a2XBij/6HpBbgBrAEmAVeAZ1AFU40QDCWrcBZL0/S4Vq4HtgB7DWzU5XyauDBMhhWz70ryVVdb2ZuhGpI2g1MODjfiMFrxZk3s9WNwJ6snHFxQUlXgXfAPeC5mf2O2Y5oqZLcMceCw1+AseCSSTP7mSiOpM3A7RixfvgYgAd+WUQcSSnfPWBlgtIvgf5YVSVdBA6GQF/mS2bmWcvbERmHJF+payFw0MzO1TWApKXBViwL3h5/Pk4AVTjRAMFY9njJXl6wLccrcD3wAHDUzBwuRw18JtbkbkFJruomM7sf2o4u4Jals/mFRgxeFcfBQm97UyOwM+WMiwums/k3QnMps+HWpuLIRC5TCrcRW2pbT35MRiY4XDRsVmiU5uJQIZfxb0k5Ij229eQPySJ287MLGO8Rd1M0XY6AO3LjzYVSy3fAH+VICL4a6o9VtTWbnzbYGKI+IrtQ6Ns2EFuq/5jOTnWD9f4DikeFvvbqhyg2Yzo3voJSy2fAjfEJMYPRQQ2caAAfC7AW2WkvrzU79dCwnRW4Hjgg6JrrbV9VKbkKw1Csyd2Ca7on1y2krHOub3t16//2n79SarbsH7BKtfejoCjmAAAAAElFTkSuQmCC","view/resize.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAqCAYAAACDdWrxAAABeUlEQVRIS+2UvUpdURCFvxXRKJpIEBURsVAIiiBoaaGCjY2VLyH4MBaCPoWlnQlpI6SxsQmkURQL5eK/6JK57iuRnMPZtxAkuOFUhzWz96xvjcg8tluAT5LOQqJMHba/AgPAD0nOEtruAOaB6Lon6U+ucAoYTLe7Bb5XCm1/BCaAXqAVOAHyOkYn27PA5/TGWmXHxvBeT2i7TVIM4MUp7ZhGPlY3V/pVKUxEjAIjyac74LIAjK70PwCoyfYXYDJwyqDoHtiRdFOfql0naBgIrILF/ZIi1yH6h1XbYXCPpKOq7s34GEX7JB00m445YBzYlPSQ1dF2N7CaWN2W9DNXuJxAj1uGVeuVQtvh32LyuR34DexWCv+CfAXoBzYkHb8Boe1OSRcFkBdfNY18IQiUtFUpTJjNAPEFHVfAaQFyjZ3zNBzbQ8BSWkZViEbk1uIpjXR8AKbT7jwEvpVUqEk6L0pHLN5hSWWxeq7XjI/v6Sgz0vZ7Ov7DdDwCkcb1m86tSukAAAAASUVORK5CYII=","view/clickanalyse.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAqCAYAAACDdWrxAAAC7UlEQVRIS5WWT2hUZxTFfyfGFolkoUVKrHQiEaX+IfgHa54UQzUqpWYhLbQU6ULNwgYXuog6yiiTgK2LgtAu6yqbFkpRBEURQzJEBN200NqKkxoDLnQhFUrizJU7vje8SSbzZr7FwDy+c75z7z3nfU80uMxMDin9JC0zewvYAHwIrAH65wWaWQuwOdy8CVgUHnBd0sUKoJktBbYC24B1QHMVNeck3ZWZrYhtXpUg/3/gS0kzDnT2/cDqpFqBUUnnK5pjZutDgo01Tr0g6XbVrprZypBgO9AUU/EK+ErSyzLQzC5XkTkCfBR7fl/Smeh/qasOlPRp9DAkOgp8H5P9o6SriUAnMrOzgNdswNeSntcL9IYNAQ8kHYuXU5Y6u8ZIupldAO5I+nkOsNb8wjk/ljTZKFCSvMbSMrPSiOpNx9uAz3UP4IbfWSsdrcDH4eZuYHF46LCk47PT8S6wG9gbJmRhlfoPSLrhJvdERJs7E+S73dZKmnagsx8JB50UEHdY3+x0dIUEO2qcekTSr/OlY21I4N5dEJMwA6yX9CKejqkqGn8DemPPb0v6YrZXpyS1xYbsRD3AtZjsk5IuJQKdyMyGAa/ZnbNR0tN6gd6wXwAP8SfV0jGnxki6mV1xyf4ubdTkPue/Jf3TEJCMNZFRMQLtyNwqvaTrSkdHZry1MFM8bLLPgY5U8/SyeYHvncotb5b1A/t8c2QGg3sT2WBLBbD95PiGogr9Ej0Gbap8r4ZJ5kR+MPhW7WdGd5npEFaa15IE+YWW5uklf2S6/1N7OnfasG+Ad5KiAfyVzwYfVDQnlc71YTaA8Ntrvtq/y2eDgapdTZ0a60UMhjdvmcCgWDClJge7npSBqfRYYY5M6U/M/NqO1mQ+G7xf4VUH5rNBOXtviLQfzH0afizop0fZroOJQCdKpcfyUKrZFhTpfDgU/F4nMNcH9gPwLJ8Nls3xarUaI+mp9NhTg5GJbPBZQyb3OReayP17rutmHPga1PpCOk+zrlEAAAAASUVORK5CYII=","view/res.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAoCAYAAAD6xArmAAADwUlEQVRIS+3WT2gcdRQH8O/b2SwNC7l4MAEPvbilUkoPOUmLjSDrZn4hxYKH/kGwyB4tQogiu/N+GymyoWguhVBQKKkHQTHsW9fUQwqKp4AgtMXkInhILl4CkoTdmSe/6XZp2pntLli8uMedt9/3mze/33yW8Jw+9Jxy0TeYmV8FcFVVTxPRiwA6AP5U1TvZbHapUqn8nrawxGBVJWvtNVWdJ6K05h1V/dhaW08KT/wRM1sAVQCRqn5JRLdyudw9Iora7faJKIrKqnrBNSWiahAEC0+GHwpm5utEdD+KopsuBMDbzPxt0oqstRdV9Za7lslkzlar1Z8erzsUHATBJhG93C34fmJi4ly5XG6nzTEIgjoRzanqkrX2amowM98F8Fq3wK34PWb+Ii14cXExv7e3V6hWq78+axQrANwt/kVEl5j5h0G2IzMfUdWCtfa3R/VPzvhTAG8AOM/MfwwYehTANwB+ZOYPE4ODIDhJRJvMvD9IqLW2GEXRbSJ6AcBtZr6UGPzoS2Y+lc/nt+bm5v5Oa2CtvaKqywC8bs06M7+eGszMn7nTBqDOzPNpwcvLyyPb29vfAZh2Naq6Za0tpAbXarUzURS53eGKL1trv0oKZ+a3AHytqplMJlOOoui4tfaDvqOw1lZUtabubBOtqOqN0dHRB/v7++62XwHwDoB33dkAUGPmoO92e/yitXZeVT8BkE1acbdpPQiCj4hIBw52hQsLC8c6nc77AN4E8FK3yQ4R/Qzgc2b+Je0ZDPU+fjiZp1eXFD5U8CB7u+/DGybgXxnFMA3/m1GISGwegNMAeuYBuON53lKpVBrePBG5RkTuSPc1b2ZmZnDzRKRnHoDYvIODg3u5XM69/E8AKAO40G1aNcb0N6/ZbF5X1fsAbjpInXnGmETzGo3GRdew+0DPGmPSzRORTQA988bHx89NTk6mmtdoNGLziGjJ9/1085rN5l1VPWSeMSbVvLW1tXwYhoXp6en+5olIbB6A2Dzf9wcyb319/cju7m5hdnY22TwRic3zPO98qVQayLxWq3U0DMPYPGNMsnmrq6snx8bGNqempgYyT0SKzjoAsXnGmP7mNZvNU9lsdqtYLKaaJyJXABwyzxiTbp6IxOYRUd33/VTzNjY2RnZ2dnrmAdgyxqSbJyJnAMTmEdFl3/cTzROR2DzHk6qWiei4Maa/eSJScZY99FRXPM+7MTIy8iAMQ6/dbsfmEVHPPGPM4OaJiBtDqnmuqfuL4Pv+8Oa1Wq1jYRg+ZR6A2DxjzP/mPRupfwAf56Q4urCh6QAAAABJRU5ErkJggg==","view/tab_panel.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAABICAYAAADyMAW8AAAAcUlEQVRYR+3WsQ3AMAhE0TCMeyTvP1tShRQo7lxYegxA8fUPLuac97VhwuKXKhTlFxRQ9GPDClawYvGEDwxIZu7pFRZXr4ACinY1ghWsYMX/NxWQr22edyvGGHt6hcV1NqGAon8QVrCCFYteISDnBuQB3xJuQcDkEngAAAAASUVORK5CYII=","view/btn_close.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAqCAYAAACz+XvQAAACmUlEQVRIS7WWS0/bUBCFz7mJmyZxENm06mNVoVZC7LqGn9FNqy55/BSWSEhs2/4uuqFVoA150JLKJvGdaiIH2TfXNoKQpeP5PHPO3GMTK/5xxTwsAUWkBeBZ+qAByb/Zh4pIA8CL9NqY5Dj7vw9YA/ABwDsAfwB8ITnUIhF5CuATgNcAfgH4RnJSCkwLl6AA/lXBtLZQQxFxoTr6q6LOFl2WmuJAtcY7ZuXIixsczfRyTlPfhpSN7BpwBeBtFdQLFJE2gI8AXi7GBBBl3Fdnv5L87XbpWxuFfQbw3NXM0dQLLdrDIH3ylGTiLLYB8CS9lpCc3tmU+xzL1Z9lEXl/n06KavjowCiK1uM4fqMd1Ov1s3a7fZntZjabtSeTiQYHgiC4aLVavZwpbofT6TQYDAaH1tod3bMwDHc7nc5PLZrNZmG/3z8WkS1jzGm32z1oNBqjUqD+6YM2m81xFWyeNkUaulAAlyKyWdTZbdqUmZKFakEVrLRDV7P5zY6m3rQp6tA1AMC5tXY7he51Op0fdwbGcdwdDodHWc2MMdcL9wGM1tbW9sMw/L6UNm6HChuNRifW2g1XM0dTL3TJZS1KkkTDFbVaLQqCIJcm6k0URRpxuvg39Xo9rtzDh5zt1Z/lXq+32rR5dKC1dt0YM08bAGd65BxN1ZB52ojIBcl82rgdWmsDkocAdgDoW22X5DxtSIZJkhyT3AJwCuCAZD5tfCP7oMaYcRVs/tAiDT1QHX2zqLPbtCkzxYFqjXfM3GKXAR3NtC6nqTccioAeA84BbCuU5B4Af9r4gCLSBXCU1UxErjPuj0Rk3xiznDYuMIWdANhwNXM09UKXXNai9LtQ9y4yxuS/XUijr9L0lXBDMp82j370HhJdWvsftiHJYFPSIqEAAAAASUVORK5CYII=","comp/combobox.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAABCCAYAAAA476rKAAACfElEQVR4Xu3bMYsTURQF4PMmExgIWkgEU5hskyJYxGYKY5VS7NzCylL8Bftj3NbKQjuxTBWbaUwhKdIYLCJotlACA5m8kQTZZZkkeN9dbuNJOXPPu/DN5ZHkMa7dbpfgx0TAEdvEedeE2HbWxDa0JjaxLQUMe3HPJrahQECrNE3RarUOJheLBbIsq9znZAdgJ0mC4XCIer1eSa/Xa4xGI+R5TuwA272RTqeDfr9fuTeZTDCfz/dmONkK/cFggGazebnCcrnEeDw+uCKxFdiNRmO3nURRBO/9bvtYrVbEVpgejXa7XfR6PUynU8xms6O1nGzlU3DO7fbu7V5dlsf/0yO2ElsSJ7ZES1lLbCWgJE5siZaylthKQEmc2BItZS2xlYCSOLElWspaYisBJXFiS7SUtcRWAkrixJZoKWuJrQSUxIkt0VLWElsJKIkTW6L1t5an6wFooRGerofKBeZ4uh4IFxrj6XqoXECOp+sBaJoIT9c1esIsT9eFYFbl/J5tJc13agyliU1sWwHDbtyziW0oYNiKk22JfXJ6xnfXjcDdFttnb43a/b9tovQ5iG30/IltBL1tQ2xiGwoYtuJkE9tQILBV/ugl4rh2MF1sPJJP59fuc7IDsTe37mHz8Bki+MoKHhFqn9+j9vs7sQN9K7G89xRx837levHzG5Lph8p1TrZK3iF//ApxdLVI4YFk/BpA9Uc5sVXYwObOCfyDJ3AoUcIh+vIRtYuve1clthJ7G8/7p4hv30Xx6weSybuDKxL7BrARxcjTF0iyN4AviH0Tpto1ONlaQUGe2AIsbSmxtYKCPLEFWNpSYmsFBXliC7C0pZfY2oWY/zeBP8uaLni/AFTVAAAAAElFTkSuQmCC","comp/textinput.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAAAWCAYAAACv8OArAAAAZElEQVRYR+3UQQkAMAwEwcZI/LtsoSL2NTGwMByZ3b3HJQIDO3H+EdidNezQGjbsUiBs+dmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4Ew9QBe0R29X9x+dwAAAABJRU5ErkJggg==","comp/vscroll.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAhCAYAAAA/F0BXAAAAOklEQVRIS2N8+OzVf2YWFgYmJiYGcgHjqCEYQTcaJpipaTRMRsOEmDJmNJ2MppPRdEJMCIymE2JCCQAYonwDuu2VMAAAAABJRU5ErkJggg==","comp/vscroll$down.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAzCAYAAABxCePHAAAC/klEQVRIS+2WS0wTURSG/zszBcrLFVvjio0LiAqRRDAmGpRodFE1MQQQkOKGqBujRo3ExLjB4MaKgDzUaGQhvoJGYwAjYoioERcuDGxYEIwPkBY6nWvObXuLnXZaSklYOIu5M/fxzZn/nvPPsInJKa5qGhRFQaIH+w8xSbcymtTd+gBFYXAdyjM9sf7ORxgGR0t5/j9jpkhq2t5B0xQwBrgqNsnJ9V0j4BzQdQNtNYXWkKz0NDiaXkBTFTCFoaWmCHVtQ+AGh+4z0HNiO2bmPNYQGiXQvkuPoaqqiIgi8Pl8eHBqtwlA86MKS6Cy8z1gjIFzjqcXHBEBlpBgRNuOd+HVlYqogJiQIChcg/BtW5k8SaSSkxPJ5PRPTttHfkI7kcghIpn8NYfp33NLXp+TnYG1OWvA3ox9499nPSjdkCsgHJxOIjc43VMrugL9dEUD4Oj/PA4CsUfDX/jOjbmisHTDCCzi4t4QgLDrQF+qTYOmqhgYGw9BvLpv0ZNjQwieaU9b7ZCDriFhSt3VBSZNartHA6aUJ7SK+jqO5n5pSp1HiqSw1e3Di0ypwBpiU1XsudwnTanraDEqrg2GmZLbGkJh2jQVZY29JlPqPe03JX/uxLE7Nk3DjjP3pCn1Ne7HrNsjdYoLQsmWYtNQ3NCBgeZKzLrn/foEoogbQgvSUmz4454P7VQikGhpHzGSZdVOUqqYTGli6gemZ9yJ+0lSTalk/TrxtQOYaBnESbTinokev4UG+p+9/xoyJQKQn8x7vf7JjEFZ1FJBBvuC12RINIdAwtkIQuksnxgHhKBUZ6scQtLSNyiWJpav47z9STjbjfJ8k5iVN0eEs911bhZjUTWpbR+RztZ6uFBERNCq1rfS2e43lFhDsjPscDS9lM7W4dyCquuvpbM9PFkq0iHm7mSl2yP+bj05uxdeXZe5FHOL6Xdr17nQ79bziwew4NXFqwUTMiaEtKBPwtZjnRi8WgXPglfqsyQITc60pwpAeNpH1GRZtRM0pWVVcTJM6S+dYaRsIf025wAAAABJRU5ErkJggg==","comp/vscroll$bar.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAA/CAYAAAAGyyO8AAABYElEQVRYR+2Wv0sDMRTH30tarCg6dRWnQnFT6OiqoP+tk+Cig+AiHayDiNSlg+jgD47K1US+Lwm5s4o/mkElN1xy73KfcF/efTi+Ht3Y0X1Btw8FffdoLy3QSnuZ+HhwZe+exrS13hGGJYsTWSszN0rJ1zHDDbJ0eDYkgHjv5Nxub3TIGEsTY/xDVq6NAN7MfW2u2aCG1nQ0GEZIOXmp7Pw5BPDF+VaGIGQfbM6k0ng5kw8/wF/eJzP5JInZkjg2CSS8zk6vCys7Wb8r5qqsncAP+pdR1Lu9rvgVT4uYg+3F+PCtAzjzu/taKdKKBSS2/wkEMBg/Q+rB50zqzZb7ZPoD/GeZ1HySxGxJHJsEEl5nc22VmCFalpFJTjLKNUtFxlDfP72IogYAP8PPZekWM5OqjErFWpjjbxprABJRA/JYjOOOX4Bgo6bWGYKsfMg5k+lmy5n8uUxm8kkSs6Vw7Cstibc9Fv5vWQAAAABJRU5ErkJggg==","comp/vscroll$up.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAzCAYAAABxCePHAAADF0lEQVRIS92WTUhUURTHz31vPv0KKmkXrtxUGNomkCANLdCUpEatJFuIClIEFRl9kGH0BYWQElLpotGKEJXAtKQooYUFpi1axLQZMCyyZJqv926cM2/uTM288emoUHfx3v16v3fuuef+72Hume/c7/cBAwaLKWaLBZjLPc0Zk0CSJGBs4SDOObDP7i9ckuXkIbLJRJDFFrJk2SGNvZNwy7ExoZEJLWnqfQ+4SlUFaHNs0gXpQhq6x0GWGe0Y7oCicGivyYsLigup7XgFJlkCJjFwNm2HqrZR4CqHoKLC3fr8GFAMpPLqEJhMoZjpay6Bnx4vpKfYoLx1kCwKBlXoOV78BygGsudCH1nwtNVBgHBBUFFzL1n0+Gx5YghOxhINiAbFG1uZODESxf+bJShKrulv8HUusp1G/IBz1qTZIGvdamBjU584Aopzs+lbDhwfFFgc2/imLq0fazgAHF5MumBtuh3YwJsPfGdeNqgY1qqqfcSprRLgr7rWZzWbwCTL8HLKFYEEgkrUn+eHIDzNbltBSG33O+jcnxNZmrYcw5Yc7hoXotRenRPyz0IgBzrGYkTp9qEtxiEV10eEKD08Wgh7bzwTonSvIV/soK5jd53rE6I0eGY3/PL5wWYxQ+nFgShRKqK6LqTwhJNEafRKNQHCcWK3WmDHqR5NlMoSQzAWUV+9vkBMsKXYLCSbs3Oe+SGqqupGrIL3h3YclifYkjo7yZ7izIzUUGrhnvXAzA+PURkR8xCwPnMVsCUVpW0bsiCUKOH9S0980JvaLJSQUTal9Q+9/RgRJQSgnvgCgdBkxkCKektSpC9cR0HCOQgiZUMI3njijwYg+COzLP9rkLr7E3Dn4Gbhp7BPDC+n0TkhlK2zJpccuSBIfVdsutVdt9U4pLbjtVC2B0cKYN/N50LZHh0rFGGguztV14aFsvWfLiVhSrVboaSlXyjbk/NlBNKFVLT0k7INX3KAx+sXfkBlKzjpJItGLlcmhmSkptAB83h9MTuCICxBRUkMwUmY5+uFPY7LmJ7GW05SZycsSos9xUsmSr8BfgGeWI6+BgEAAAAASUVORK5CYII=","comp/button.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE0AAABFCAYAAAAPWmvdAAABA0lEQVR4Xu3ZMRGDUBRFwXwfKSgxFhfRgAbUxEakkCEO3qmX+p9m5w7NW9v7cz18I4EFbeT1fwxtbgYtmEGDVgRC458GLQiExNKgBYGQWBq0IBASS4MWBEJiadCCQEgsDVoQCImlQQsCIbE0aEEgJJZW0Pbj64Q3hFvQhmL3CQ8atLlAKCwNWhAIiaVBCwIhsTRoQSAklgYtCITE0qAFgZBYGrQgEBJLgxYEQmJp0IJASCwNWhAIiaUVtOfrdMIbwi1oQ7H7hAcN2lwgFJYGLQiExNKgBYGQWBq0IBASS4MWBEJiadCCQEgsDVoQCImlQQsCIbE0aEEgJJYGLQiExNIC2g/MxaMp6CSauwAAAABJRU5ErkJggg==","view/bg_tool.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAMklEQVRYR+3QQREAAAjDMCYG/DsEGXxSBb2ke7YeiwECBAgQIECAAAECBAgQIEDgW+AAAeIuAVS/mngAAAAASUVORK5CYII=","comp/minBtn.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAA8CAYAAAB1odqiAAAArUlEQVRYR+3X0QmAMAwE0GQN19B9nM193CmiIH7ZXOAoRc/fpjl8jVDdOj/eOc8USBcXqUjLAtDQRMSOdHb3JatTYCZUXodIy10bGxTI1Lx6/YA0Ima6W2tKFcjmdpGKtCow7NBAdxozy+804Gfx/cDqbLzWDzs0ekNY4B9nOMEehMKTVIEEyKeFSKmc18+MppRtipJuYPCa1SkwEyqvo6Tlxm8bFEijvBt9n/QA/fOPydLHcUIAAAAASUVORK5CYII=","view/zoom_out.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAoCAYAAAD6xArmAAACy0lEQVRIS92WQU8TQRTH/28oQkj0CL0QOMAJQkz4DkS6A+GA+A00Hrhj0uy8NiTwEdBPAOrB0Fnq3U8g6gkOSjxUjpCQCu08M5u2qaVAt7YmOqfNZPa3b9/+Z35L6NOgPnHx98Gbm5sTlUplA0AGQBpACcBBKpXazmaz3+5607YVM/MjEXlNRPdbASJyTkRrzPz+Nvg1MDNPAvgI4AGA10qpvHPuSCk17ZwLAazV4HPM/PUmeDvwSwBPAbxl5sf+RmYWZo7XMvOehwPYYebnScAnAMaVUrNhGH5pBefz+Rnn3GcAJ8w8kQT8E8A9AEMA/HXrqM9fMrO/bjvataJvFdd7/IaZfS9/67ExZpeIngB4xczPklQ8KSKHPmoispdKpXKjo6PHp6enU5VKxXhoV6moVXhnjpVS5wDOwjD81K7qG7e033lXV1cviMjvvDEAP0TkYHBwcKtarT4UkXcALolo1RhTaIV3dVYYY9aIyOfZDw9fMcYUm+FdgWvtYgCmBisrpRbCMPxQh3cNbgM3zJzvCdhDcrncuojMA8gy8/eegTvO8U0Lk87/UY9ve9h/BI6iyJ+1GyLScB4RHQDYDoKgO+dFURSfFQCuOQ9A7LwgCJI5r1gsTlar1YbznHP5crl8NDw8PK2Uip3n4QMDA3OLi4udO89a23Ce1jp2nrVWtNbxh7bWxs4jop0gCDp3XhRFJyIy7pybXV5ejp3XDN7f359RSsXO01p37jxrbey8i4uLoZGRkWvOa5q/1Fp37rx+VtxwntY6dl5zK6Io2hWR2Hla686dV0vFoY+aP8xFJJdOp49LpdIUEZkaNHkqfIWd5JiIzkXkLAiCZM7zO09EYueJyBgRxc4joi0ADeeJyOrS0lJvnBdFkf8xbDhPKbWSyWR647xCocC+53XnAVjQWvfGeS1wo7XunfOstesA5pVS2Uwm8w877xeHf444cscwYAAAAABJRU5ErkJggg==","view/refresh2.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAA/CAYAAAAPIIPGAAAEIElEQVRYR+2XTUhjVxTH/+fGpBrGT/xoBQdFFMMQLNLNbLooLbaFzqKMUhCSZwsuhGG6KCNd6DuRLgqzmGVxUd8LUrpoYWZTKO1yNi2F1oVtceEHflSLqNEav8bklPuqgsl75sUPSsucTQj33v895+R/7y+XcA1B16CJ/6GoYRiDItKfzWZjExMTv5/XtoLlx2Kxm0qp1wH0AHgTwC4RfWRZ1mdewp6ig4ODN9Lp9CMieh+AchH41Lbtj92EXUUHBgaCh4eH3wJ4zSObGSLqtSzrZ9+ihmF8CODR8YIflFL3MplMNxF9IiJWIBC4Pz4+/ldR5RuG8QuAlwGsAWi3bTsVj8dvAWhOJpPfFPK2a/mGYewDeAHAV7Zt9+aK9PX1VYRCoVcApNxa4CX6J4B6AE9t2341V9QwjO8AvAFg27btytxxL9EvAbynJxNRj2VZX58sjMfjd4joyT9D9NiyrHf9iup+/gggBCALQPfxVwARAO8cWywD4LZt2z/5EtWT+vv774rIBIBSlx/mmT5dyWTyC9+WOpkYi8XalVIPRKQbwItEpHv9PRE9tCzrt6IsVcgyhcYLnv1CAkWXfxFBxzEXXXipq+8imz7P9CJdO3+N754y86A+vYFAIDY8PHw58DHzTQB54DNNs3jwMfONY6R4go+Z/YNvbGwsuLKyci74APQys3/wMfMZ8InIPaVUt4g44AuHw/eHhoaKAx8znwEfM6dGR0dviUizaZoXA59pmvtE5ICPmfPAx8wVABzwubXA1VLM7IBPRJ4mEok88DHzKfiY2R/4mPkUfCLSk0gkTsHHzHdE5Immnog8TiQS/sDHzK7gE5EIEZ2CTyl1e2RkxD/4TNO8S0Su4BORZ0qpftM0iwefaZrtAB4QkQM+AA74ADxk5ufgc78CfV99xdy61yMajUbfAvA5gJeKycZj7gqADygajf5xRYIn+6xoUbmCDM9I/LuidXV1qK2txdzcHPb39ZPAOwpmGgqFUFFRgerqauczm81iaWkJa2v64eLhU6+eKqXQ1NTkZOcWq6urWF5edh1zzZSI0NbWhvLyctdFBwcHmJ2dxe7urn/R+vp6J0sd6XQaCwsLqKysRGNjI9bX17G4uIhMRr8jiig/EokgHA7j6OgIU1NTjkBZWRl0f7e2tgo60LX8rq4u/UjC5uamU2ZuBAIBZ1O9mVsLXEU7OztRUlKCnZ0dTE9P54nqfmsnaNHJycm8cVfRlpYW1NTUOJN1pjrjk6iqqkJra6vzNZVKYWZmxp+oLq2jo8NpgQ7dx729PZSWlkKL6hARpwr9Q+aGp/m12Zubm6H9mhtacH5+HhsbG/4tdTJTZ9bQ0OD0LxgMOm7Y3t6GNv55R7XgMS3oH5cJ/y3Rq775V3X5bx8zSv8DuWzoa2vgb5tumbHGlerDAAAAAElFTkSuQmCC","view/settings2.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAA/CAYAAAAPIIPGAAAD2ElEQVRYR+1Xz08bRxT+ZjAGYQoH4rS9IBJBQJEsUC8VKNdQtamUE0fLayqhKHeOaGbFkT8gFVLZtXzk1qqKSs4NUg8RXCIQVoOQ2jRFHHCwBRj2VW+zttY/14BXVaPOyR7NfPN9771536xACEOEgImPDHRhYaHv/Pz8kEMVjUbjq6urxVZhayo/lUo9chzndTabfWMYxkMAGx7QrG3bL5LJ5B0p5f1MJvNz7QENQdPp9LdE9CMAZrcHYAaoxJ8AvARwD8AtAI9t2/7JD9wQdH5+/q7jOLzx04DqeCelnFlbW/s9EJQXGIbxq8eQ//4mhPieiJjlEwBf8qQQYtOyLFZRNeqYJpPJWCQSeUBEzz3JrwqFwvT6+vo575ybm4vGYrFNAF8AICnlbKlU2sxms4Uych2oYRh5AJ9UFggxb1mW5aeSTqfTRLTmm3tv2/bAVUCfWpb1zA9qGAaHwD/XGjQU+WVGHU0Ug4ZSUjXFnwMwXVP8nP1RAPG2i5/Z+q9pKpWaFUL8wvNE9FUmk9m48jWtLWavofztNZTb124oN2neH1mTvmoo/pcfHDGtdZ9nLbw4rrW+nvGZpvlISvl6aWnpjWmaD4nINT4hxKxS6sXy8vIdx3HuK6XaMz6ttWt8QohDInKNTwjhJtWzlJdCiHtEdEtK+VgpFWx8Wuu7RMQbWxofEb0TQsxordszPq11Q+MjoidCCNf4AGxqrYONb2VlJVYsFh84jvPck/yKW5/W2jU+rXWUwdj4OBQcYzbCxcXF5sanlMoLIaqMTylVZXymaVYZHxG9N02zufE1AH2qlKoyPqUUh6AyFwgaivzyVehoorxkdL6k/MUPIEdE0/7i5zcUGx8Rxdsufmbrv6ZKqSrjM01z48rXtLbFeA3FNT4At6/dUIJ7V/MV/6HOn0gkvgbwA4DPbyLZ2/sWwHcikUj82SHAMqe3DMrv+I6Ofw9USonJyUlXzfb2NhzHaamsKdPBwUGcnp7i7OwMAwMDGBsbc4H29vaQz+fR09OD3t5eHB8f1x3QEJQBR0dHcXFx4QL39/dXbTw5OXEBI5EIcrlcHXBDUGYxPj6O7u7uljJLpRJ2d3ddNf7RVD6DlhkWCgUcHrof0YjH44jFYu5vnt/Z2QmWz0lhsHIMi8Wiu/HDF6T7mMDExAT6+vjR8iHGHA5/8uqYTk1Noaurq3L6/v4+jo6OqtgMDQ1hZGSkMnd5eYmtra3K/0DQg4ODivTyLg7B8PBw+6ChyC8f39FEMWgoJRVK8TPbjl/T2mruWEO5SYMNo/P/xaDfeB712U3YeXv/ALDwD+TbY8Dbd9BBAAAAAElFTkSuQmCC","view/setting.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAkCAYAAAC9itu8AAACAklEQVQ4T5XUS4iOcRTH8c9xCeVeiiiXhSJRJFIusRO2lEtZKFlgY6GxZDUrk2TFwii22JJLlERRLKRQJmXBkHIb8+hM/2d6ememed93957n93v+55zf9/mHll9VVTNxopTPR8T3piTyT1VVs7AL9zEd+4roOn5gK25HxLfacAjL8A8TWw6ta28jorc2LMLhIu7Ds2Jah4XlRVci4mNUVTUDadiLFF/G5GL4iyOYjxsYMnQ1BDfxujk0VmJPecFAO4bV2Nk05Bqzz3Za6ut86JJDx2vN4Hbj3hjBbcOt4eCaQZXUj5daT4pGoNFimI1zpdYVEf2jsTQX+5MX5NaOFdFFJHzJ2bWI+FJv6SRWYACTWliqa68ioqc2LMWpwtJ7PCymzVhSWOqOiHeZdPachqNIcXdBJV/2B6cLa5cwZLjQYOkqnuNsOeEM1uJgE43xDBsaH9QQfJ21VNBoHfpBaWHLiKGLoeO1ZnAHkpcxgkvOeoeDa0FjTnNLEfF1PJamYkcR3YmIX6OxNA35Kb7BFKwvoqf4jeV4GRE/azQ2Yh4GMaGFpbr2OSKe1Ibse1MRJ84fimkxMqc0Pc55MrjsOYvZRoofNW6/vPUSwEQ+2+tPQ14h9fX4Ap+aQ2MB1pQTB9sx5K24qmnorKWCRvtDF0PHa+0suBaW0ry91O5mus3n/wHmQwUTIH+tVgAAAABJRU5ErkJggg==","view/refresh.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAkCAYAAAC9itu8AAACiElEQVQ4T4WVS4iPYRTGf4/7/X6XcivXcktEUhTKQkqyYCOKjWyUhezFThbIlJ3LYrIRkoWGUhhhTMko4zJujYRpxgxHj9737/P3zfh239c57/uc5/zO+UQ3T0QsBRYCtZI+5jBVx0fEcGA6MA+YCXQCVyXddWwlISL6ARuARcXvhQPrJF3/nRARvYHtwLRuFLYCFyW15ITl6XTHvwIuJzlrgHrgiqSOiqSI2ANMAL4BxyW1R8RYYKSkp8Vb8w2HgD7AE0kXSozoD0wC2nPCAWAw0CyppiRhBzAD6MgJW4D5KdDFNeSkiJgFbEvONeYE698N2K0ArPsDMAZwguN+AmeKfZgLbAb6llj7A7gk6eFfnY6I0cDKpNc1tQFNwG1JvvFPp0sKXQ2sAGokveuJpVHAHGBJ4ul76vLNapbs9dYk6R8oU7driyztA2Z3w5L1n5LUnBPWptMd/xw4l+RscsHAeeNSZMloTAG+AIcltUXERPdB0qMylk4klu5LOlni2ABgqm3Oko4BQ4Fnko6WJOxPzlXg2wV4hv2czuOYhmsBsDf1rD7fYP0HkyyzZN0twHjACZmlI0WWFgM7e2DprKQ71SyNA9YDBnFYcq0RuOZ5/h9LdsVS6yV97YmlgYDn2X3wjUa7QdKLapY8015ePrWMJVtembhewLI0YWU4eZvck/Q525pXo4M/AY+TLMP40u+SuooseVjsitm/IakzItz5QcXhKSZsBCyrpdjlwuZwfSO8mLOkdYAHqFXSrRKWvErtXFdOcJcnp0AX96ZwuldQ5uxtTrD+VUmWWXqfujwk8eQ4f68rsuRG+d/gZVb9eIk9kPS6miXvIv91rNc12TXPc5MkTyO/AFhJCujHqZlCAAAAAElFTkSuQmCC","comp/checkbox.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAqCAYAAACDdWrxAAABbUlEQVRIS+2TP0gCURzHv88GRYsrExyOo5cEQVEtWdQQpE4N0R+HxmirXXCrKYigqMF2IRqCQByaLJqNIFpyUIzu4rIwpExODy88ITD/cJ603Rsf7/OGz+/zI5TSEAE20cZRgBMySKni8XrbwICrWAwG2ESZIadFS53J0R25brCyHZNud1vbcRuPV7fDAOu9GXJatNSZHN2R6wb/PfJCrxOZCR8Gbk6hWc6Xg8PrcgBETMIVPdIGSjYG/NoOSHcfkLqDK3qsBSRIrgRAuBF1quUPEUPhYGMwb2dhywrqQ3F0Dt++jSokJMBdhmDO52pB2WwFP7OK8rgH9os99IgppNf3QWwMFP4RNHKALrmoflIj53l6CaWpRcBkgiIkYHl6gDTrh5JJg57v/kJ1YOUixw7jfWELxMpAKUmAXAR7tg3LZ7am3IbjKDBOvPiDqkUmcoj+9H1d7k3nmHdweBubB70ON9wRzQH8pVVQb+Q/zZAEfpwDCU4AAAAASUVORK5CYII=","comp/btn_close.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAA8CAYAAAB1odqiAAAE6UlEQVRYR+3Y30+bVRgH8G/T0t/0Jy0USrIsC0E2GMKAVYcRpmSbEzIGZhqyxCxeceGVF3pjvJl/wYyJWZYY4hZBFnBuBBUW2ewYAxlsSMiyLKH8aEt/0vZtSxvM+562We15C6jlxr53zfO8z+ec5z2nOTmCk598tY19fAQs+Hlvz76QX1zpAwd+1NMNXzieU1QtFeKbvn4CXvqgC95wLKegRirC1e8GCPjh+53wMnRwedkG54aLG4yhSI/ycnPawHaKJ5M1MhGuXR8k4MX3OnjBx3NPcLX3DPfepSu3odfrYC4r5X7bVlbhcrnT4kdrjlA7xYLffj9EwJ6udnhCW9TEJ08XUgWTqE6n5XLdbk9G7MjhKmodrbwAfQPDBLxw7h1ecH3dDq/Xm1GYrZqceXIgGo0GJSXFvOCNmz8RsLv9NNyhKO+icTqc8Pl8acDLyWyr1Wo1DEYDbw2dXIz+4TsE7DzbBneQH2SruDZc8Pv9GSiLqVQq6Iv0WVe5TiHG4K1RAnaceguuYCTrCx63G4FAgAoqlUpodbqs7+sVEgyN/ELAs20t2Ajwgz6vF6FgMGtL5QoF1BoNL1qklODW6DgBT518gxcM+P1gQqFdLRqZXA6lSkVFWXDk198I2NZyAs7NMDXR7XRmYBKZjMuNMEzmljHQF46hUIrR8XsEbG228IJ+T/rGFkskkMoVHBgOBRGNRNI2vkpL/5YsODZhJeCbJ47D4WeoM4wyDLai5PsWiCUQJ2aXTN4pnswzqmS4e+8BAZstDbxg1qW3hyALTlinCPh6Uz1C0Rg2w/S/tz3UpaYWSgsgF4twf3IagvOXr297PR5YGuv+bd2s71sfzkCj1ULQe+3u9vraGlg0lw+LlZhMEIzUNu7vmYYFmz/9LJeTS9We+PIymaGl6wLizo2cokJDEawDNxLg+W7EHTkGjUWw/tBPwOMdnYg7nNQZep4/Q2B9jYspS0zQHjyUlrdTPJksNBrwYGiQgE3vtiNup4O2SSuOzk5y7z2ubYKyuBiaAwe5394XzxGw29Pi5iYLdeDCYgMmfxxOgKfPIG53UBNt049SBVNo4g864HRmxMz1x3hAIybv3CZg49ttiK/bqYneFRuCLldGYTY5OfPkQBR6PTRl6cfIVEtLivHw51ECNrS2Ir62zrtKfWtrCHo8acDLyWyrFVot1CYTbw2hqQRTY2MJsLk5K8hW8TkcCPp8GSiHqdVQG41ZtxUHTkwQ8NhrFsRXyUrke3wuF0L+TSooVxVCrc9+iBKWmvDodysB65saEFtZ5cX8Hi+YQDBrS2VKBVRa/jONqKwU05NTBKyrexWxlRUquOnfBBNidrVoZHIZClWF1DqisjLMzPxBwNraasRsdHDD6c7ApDIJVzTMRDJiRQb6EUNkLsPs7DwBa6qrELPZqCNzu/1pG1siEUOhkHK5wWAYkUg0La7T0U9tIrMZc/MLBKw+XImtZTrIMBFEouQkIBEXQJaYXXJ0O8WTeQXlZsw/XSRg1SsVvGDWpbuHIAsu/LlEwMrKCsQDAcQ93j2U2H2qUKuBUKnE4uISBF9f/Hj7wJwVhyordl/hH2Q+W1zCixoLOdNUj98Ei+byYbH5lnPkmJhL6O+18/c0/1m38/c0qVbm72nYVuTvadgu5O9pUtsif0+Tv6dhF8P/657mLz4NfQVdLmZiAAAAAElFTkSuQmCC","comp/textarea.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAAAXCAYAAABkrDOOAAAA4klEQVRoQ+3ZvQrCMBiF4e9rU+sPOErRqxDRe/KG9Fp0EAc3VzuIg1ML4uDmlkaaquDenMUTyJoDD+8W3ZyKlaoshSeogHOy1m1euOmoI1EU+auqQUf/8XHnnBzLp3jsWdaVJEnEGEPsADXU2Ifro8Gej/uSpqnHruvmaVegqirZX+4N9mIy8Nh13XEct7vE18RaK7vzjdiIFoiNUH5vEJvYQAHgFMsmNlAAOMWyiQ0UAE6xbGIDBYBTLJvYQAHgFMsmNlAAOMWyiQ0UAE79lM2fmrDy358a/q6Hhf68ng175QueKdEXxUGVVwAAAABJRU5ErkJggg==","view/re.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAoCAYAAAD6xArmAAACpklEQVRIS+WWPUgcQRiG3+8O70QEUwTB1EJgsTGdRRrhOMjOtEtSRbBIBMFKuCtkZleES2uRQoWQJggKKW7Of7GyTRvBLkVShhS73OXMfWGOU85Es7uXs0m2XeZh+OZ95xnCHX10R1ykBvu+P5fP59+VSqVvf9pUarBS6jWAR0Q0rbWOboP3BCaiOQAHAKTW+vtN8L8BW96W4zjPPM/78Ss8FlypVEYajYbHzALAJIAHALJdoDWl1Esi4m74rWBmpiAI5pk5AHAvJj0VrXU5Fmyhvu+/AfA8YRxfaa1LsWDf92eZeSMJlJnXtdYvEo1Ca30G4GEH/ImI1lqt1nE+nz9vNBrLnVTY39uO4zxNdHgrKytjzWbzs13FzKfDw8PFxcXF8HL3Nscd8BEAN3HcgiCYbLVaHyyIiGaUUm+7R9JzQZRSo0T0BUCGmRd831/tBttK53K5zXK5/DV1pZVSG0Q0C2BXa/0kySEmKojWeoiZD4hoKpvNTiwtLX1MC7+1IFrrQWZeJaJxx3EKN5186lF0LwiC4DEz31dKvU+z69i7Ig0stnm9wv4zsDGm7bxCodBf5xlj2s5j5mkpZf+c1wHPEdFBGIbS87z+OO8S3EnAVhRFvTnv8PBwpF6ve0QkiGiSmX9znuu66ZxXq9XmAcQ6j5krUspkzqvVaqmcJ4SId54xxl6ZiZwHYN113WTOq1arZ0R05TwAa5lM5rher5/ncrllAPYl1HZeFEXJnLe3tzd2cXHRdh6A04GBgWKxWLxyXlcqjqIochPHbWdn58p5AGaEENec13NB9vf3R5vNZtt5RLTguu4159lKA9gUQqR3njHGHpx9tOxKKfvnvGq1OmQrC2AKwIQQon/OOzk5GQzD0I5hPIqi/jvPGNN2npTyH3feTzoJOzgswwlqAAAAAElFTkSuQmCC","view/search.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAqCAYAAABcOxDuAAABX0lEQVRIS+3VsUrEQBAG4H9HiDZiJQg+gJVaiKAoWClYXWeZ7D6CtbWFr5Ai2ayQxkLQRgsLGwtBUQsRC6sDCxHxEIvIZSRwxRGSu83pNUe23c0H+89kR2AISwzBxAiinuctCSH2AawD+AFwRkR7QRC85CO0ur5SaoOZzwGM54A3IlrJw1aolPIewEJJUY+01jvde31RKeUMgNceXdLSWk9VQl3XnSWiZhnKzF9RFE1WQrPDUsonAHNFsBDiJAzDRmXUdd1tIjoFMJaDW0KI1TAMH61RpdQ0Mx8z8zMzHxLRAYBlAG0Al2ma7hpjHqxbqgNeAJgHcKW1XutEMeE4Ttv3/axXC1dh9XPgbZqmW8aYd9t3ohCVUt4BWARwkyTJZhzHH7Zgdq4MvQbw7ThOw/f9zypgKVoVsS7UX+C+v+kgeI0Oklrvb0Yw03rwlZW8Hnz14OvqjXrw1e/pPyfwCww91CttlMG7AAAAAElFTkSuQmCC","view/save.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAoCAYAAAD6xArmAAAA1klEQVRIS+2VzQ3DIAyFwxwdoMMAA/VQ8ZByyEBhmA7QOVxxKLIaOcIoSZUfrlifHw/wM91Ky6zE7SZgANTaDEDhzYJ5odSMC7nA5U7+b4X2dVQr3ic4hHCTlMcY33xPZUUGcwBvdEJwjcfGGIQQ4rd2qenWA3hyAUuABwCP31NtN+i1v02qP4DicRybM885J2ceB/NCyUupfuLxBS4WbmKF9rNUv4p9gq21d0l5SunF91RWZDAH8EYnBNd4nDPPWitnXst0I6Leez+feVowEQ3e+wNk3ge7C/Qp3GfwkgAAAABJRU5ErkJggg=="}},"base64",function(){return this.base64=new je(e.dataO)}]),e}(),Xe=(function(){function h(){this.tShowObj=null,this.preValueO={},this.div=null,this.debug_view=null,this.height=300,this.clickedHandler=null,this.fromMe=!1,this._treeDataList=null,this._init()}E(h,"laya.debug.DebugPanel");var t=h.prototype;t.removeNoDisplayKeys=function(t){var e=0;for(e=t.length-1;0<=e;e--)h.noDisplayKeys[t[e]]&&t.splice(e,1)},t.updateShowKeys=function(){h.tObjKeys.length=0,this.tShowObj&&(h.tObjKeys=$e.getObjectDisplayAbleKeys(this.tShowObj,h.tObjKeys),this.tShowObj==S.stage&&this.removeNoDisplayKeys(h.tObjKeys),h.tObjKeys.sort($i.sortSmallFirst))},t._init=function(){var i=this;this.div=vn.document.createElement("div"),vn.document.body.appendChild(this.div),this.clickedHandler=new C(this,this.onClickSelected),this.debug_view=vn.window.layaair_debug_view,this.debug_view.initLayaAirDebugView(this.div),this.debug_view.tree.attachEvent("onSelect",function(t){var e;(e=i.getDataByID(t,i._treeDataList[0])).target&&(Xe.showDisBound(e.target),i.showTargetInfo(e.target))}),this.debug_view.setValueChangeHandler(function(t,e){i.onValueChange(t,e)}),this.debug_view.onRefresh(function(){h.I.setRoot(S.stage)}),this.debug_view.onInspectElement(function(){ti.I.beginClickSelect(i.clickedHandler)}),this.debug_view.onLogInfo(function(){console.log(i.tShowObj)}),this.debug_view.onPrintEnabledNodeChain(function(){Xe.traceDisMouseEnable(i.tShowObj)}),this.debug_view.onPrintSizeChain(function(){Xe.traceDisSizeChain(i.tShowObj)}),this.debug_view.onToggleVisibility(function(t){i.tShowObj&&(i.tShowObj.visible=i.debug_view.getVisibility())}),this.debug_view.onToggleDebugBorder(function(t){i.tShowObj&&_i.showDisplayBorder(i.tShowObj,i.debug_view.getShowDebugBorder())}),this.debug_view.onToggleShowCurrentCache(function(t){Qe.showRecacheSprite=i.debug_view.getShowCurrentCache()}),this.debug_view.onToggleShowAllCache(function(t){Qe.showCacheSprite=i.debug_view.getShowAllCache()}),this.debug_view.onToggleShowAtlas(function(t){console.log("toggle show atlas:",i.debug_view.getShowAtlas()),i.debug_view.getShowAtlas()?ze.getInstance().start():ze.getInstance().end()}),gi.showToBody(this.div,0,0),S.stage.on("resize",this,this.adptPos),this.adptPos()},t.onClickSelected=function(t){this._treeDataList&&(this.debug_view.tree.selectItem(pi.getObjID(t)),this.debug_view.bounceUpInspectButton())},t.updateLoop=function(){this.tShowObj&&this.showTargetInfo(this.tShowObj)},t.onSelectItem=function(t){var e;e=t.target,this.showTargetInfo(e)},t.onValueChange=function(t,e){var i;("number"==t.type&&(e=h.mParseFloat(e)),"boolean"==t.type&&(e="true"==e.toString()),this.tShowObj)&&(i=t.key,this.preValueO[i]=this.tShowObj[i]=e)},t.showTargetInfo=function(t){if(t){this.debug_view.setVisibility(t.visible),this.debug_view.setShowDebugBorder(_i.isDisplayShowBorder(t));var e,i,n,r=0;if(e=h.tObjKeys.length,this.tShowObj==t)for(r=0;r<e;r++)i=h.tObjKeys[r],this.preValueO[i]!=t[i]&&this.debug_view.changeValueByLabel(i,t[i]);else this.tShowObj=t,this.updateShowKeys(),n=h.getObjectData(t),this.debug_view.setContents(n);for(r=0;r<e;r++)i=h.tObjKeys[r],this.preValueO[i]=t[i]}},t.adptPos=function(){this.fromMe||(this.fromMe=!0,gi.setPos(this.div,0,vn.clientHeight-this.height),this.debug_view.resize(vn.clientWidth,this.height),h.overlay||S.stage.setScreenSize(vn.clientWidth*vn.pixelRatio,(vn.clientHeight-this.height)*vn.pixelRatio),this.fromMe=!1)},t.setRoot=function(t){var e,i;e=h.getSpriteTreeArr(t),this._treeDataList=[e],(i={id:0}).item=[e],this.debug_view.setTree(i),S.timer.loop(500,this,this.updateLoop)},t.getDataByID=function(t,e){if(!e)return null;if(t==e.id)return e;var i;if(!(i=e.item))return null;var n,r,a=0;for(n=i.length,a=0;a<n;a++)if(r=this.getDataByID(t,i[a]))return r;return null},t.getDataByTarget=function(t,e){if(!e)return null;if(t==e.target)return e;var i;if(!(i=e.item))return null;var n,r,a=0;for(n=i.length,a=0;a<n;a++)if(r=this.getDataByTarget(t,i[a]))return r;return null},h.init=function(t,e){void 0===t&&(t=!0),void 0===e&&(e="#ffffff"),h.I||(h.overlay=!t,Ye.init(),Xe.initBasicFunctions(),ci.init(),_i.init(),(h.I=new h).setRoot(S.stage),Qe.showRecacheSprite=!1,e&&(h.I.div.style.background=e))},h.getSpriteTreeArr=function(t){var e,i;(e={}).text=""+$e.getNodeClassAndName(t),e.target=t,pi.idObj(t),e.id=pi.getObjID(t);var n,r,a=0;for(n=(i=t._childs).length,r=[],e.item=r,a=0;a<n;a++)r.push(h.getSpriteTreeArr(i[a]));return e},h.getObjectData=function(t){var e,i,n,r,a,s;e=[];var o,l=0;for(o=(s=h.tObjKeys).length,l=0;l<o;l++)a=typeof(r=t[n=s[l]]),"_"!=n.charAt(0)&&h.displayTypes[a]&&((i={}).key=n,i.value=r,i.type=a,e.push(i));return e},h.mParseFloat=function(t){var e;return e=parseFloat(t),isNaN(e)?0:e},h.I=null,h.overlay=!1,h.ChildrenSign="item",h.LabelSign="text",h.tObjKeys=[],m(h,["displayTypes",function(){return this.displayTypes={boolean:!0,number:!0,string:!0}},"displayKeys",function(){return this.displayKeys=[["x","number"],["y","number"],["width","number"],["width","number"],["width","number"],["width","number"],["width","number"],["width","number"],["width","number"],["width","number"],["width","number"]]},"noDisplayKeys",function(){return this.noDisplayKeys={desginWidth:!0,desginHeight:!0}}])}(),function(){function s(){}return E(s,"laya.debug.DebugTool"),v(1,s,"target",function(){return s._target},function(t){s._target=t}),v(1,s,"isThisShow",function(){return!1}),v(1,s,"showStatu",null,function(t){t?Cn.show():(Cn.hide(),s.clearDebugLayer())}),v(1,s,"showBound",function(){return s._showBound},function(t){(s._showBound=t)||s.clearDebugLayer()}),s.getMenuShowEvent=function(){return vn.onMobile?"doubleclick":"rightclick"},s.init=function(t,e,i,n,r){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===r&&(r=!1),(s.enableCacheAnalyse=t)&&ci.init(),n&&_i.init(),(s.enableNodeCreateAnalyse=i)&&ui.I.hookClass(Tr),e&&Xa.init(),Qe.showCacheSprite=r,Ms.init(),s.initBasicFunctions()},s.initBasicFunctions=function(){li.initMe(),s.debugLayer||(Is.init(),(s.debugLayer=Is.I.graphicLayer).mouseEnabled=!1,s.debugLayer.mouseThrough=!0,s.showStatu=!0,S.stage.on("keydown",null,s.keyHandler),s.cmdToTypeO[1]="IMAGE",s.cmdToTypeO[2]="ALPHA",s.cmdToTypeO[4]="TRANSFORM",s.cmdToTypeO[16]="CANVAS",s.cmdToTypeO[512]="GRAPHICS",s.cmdToTypeO[1024]="CUSTOM",s.cmdToTypeO[2048]="CHILDS",ri.export())},s.dTrace=function(t){null!=s._traceFun&&s._traceFun(t),console.log(t)},s.keyHandler=function(t){var e;if(e=String.fromCharCode(t.keyCode),t.altKey){switch(t.keyCode){case 38:s.showParent();break;case 40:s.showChild();break;case 37:s.showBrother(s.target,1);break;case 39:s.showBrother(s.target,-1)}s.dealCMDKey(e)}},s.dealCMDKey=function(t){switch(t){case"上":s.showParent();break;case"下":s.showChild();break;case"左":s.showBrother(s.target,1);break;case"右":s.showBrother(s.target,-1);break;case"B":s.showAllBrother();break;case"C":s.showAllChild();break;case"E":s.traceDisMouseEnable();break;case"S":s.traceDisSizeChain();break;case"D":oi.downDis(s.target);break;case"U":oi.upDis(s.target);break;case"N":s.getNodeInfo();break;case"M":s.showAllUnderMosue();break;case"I":break;case"O":el.I.show();break;case"L":si.I.switchType();break;case"Q":s.showNodeInfo();break;case"F":s.showToolPanel();break;case"P":s.showToolFilter();break;case"V":s.selectNodeUnderMouse();break;case"A":qo.I.target&&yi.analyseNode(qo.I.target);break;case"K":Fi.traceStage();break;case"T":s.switchNodeTree();break;case"R":rl.I.show();break;case"X":$l.I.fresh();break;case"mCMD":s.traceCMD();break;case"allCMD":s.traceCMDR()}},s.switchNodeTree=function(){Ls.I.switchShow("Tree")},s.analyseMouseHit=function(){s.target&&yi.analyseNode(s.target)},s.selectNodeUnderMouse=function(){li.instance.selectDisUnderMouse(),s.showDisBound()},s.showToolPanel=function(){Ls.I.switchShow("Find")},s.showToolFilter=function(){Ls.I.switchShow("Filter")},s.showNodeInfo=function(){Ms.I.isWorkState?Ms.I.recoverNodes():Ms.I.showDisInfo(s.target)},s.switchDisController=function(){si.I.target?si.I.target=null:s.target&&(si.I.target=s.target)},s.showParent=function(t){if(t||(t=s.target),!t)return console.log("no targetAvalible"),null;s.target=t.parent,s.autoWork()},s.showChild=function(t){if(t||(t=s.target),!t)return console.log("no targetAvalible"),null;0<t.numChildren&&(s.target=t.getChildAt(0),s.autoWork())},s.showAllChild=function(t){if(t||(t=s.target),!t)return console.log("no targetAvalible"),null;s.selectedNodes=oi.getAllChild(t),s.showSelected()},s.showAllUnderMosue=function(){s.selectedNodes=oi.getObjectsUnderGlobalPoint(S.stage),s.showSelected()},s.showParentChain=function(t){if(t){var e;for(s.selectedNodes=[],e=t.parent;e;)s.selectedNodes.push(e),e=e.parent;s.showSelected()}},s.showAllBrother=function(t){if(t||(t=s.target),!t)return console.log("no targetAvalible"),null;t.parent&&(s.selectedNodes=oi.getAllChild(t.parent),s.showSelected())},s.showBrother=function(t,e){if(void 0===e&&(e=1),t||(t=s.target),!t)return console.log("no targetAvalible"),null;var i;if(i=t.parent){var n=0;n=i.getChildIndex(t),(n+=e)<0&&(n+=i.numChildren),n>=i.numChildren&&(n-=i.numChildren),s.target=i.getChildAt(n),s.autoWork()}},s.clearDebugLayer=function(){s.debugLayer.graphics&&s.debugLayer.graphics.clear()},s.showSelected=function(){if(s.autoShowSelected&&s.selectedNodes&&!(s.selectedNodes.length<1)){console.log("selected:",s.selectedNodes);var t,e=0;for(t=s.selectedNodes.length,s.clearDebugLayer(),e=0;e<t;e++)s.showDisBound(s.selectedNodes[e],!1)}},s.getClassCreateInfo=function(t){return Ci.getRunInfo(t)},s.autoWork=function(){s.isThisShow&&(s.showBound&&s.showDisBound(),s.autoTraceSpriteInfo&&s.target&&Mi.traceSpriteInfo(s.target,s.autoTraceBounds,s.autoTraceSize,s.autoTraceTree),s.target&&(s.autoTraceCMD&&s.traceCMD(),s.autoTraceCMDR&&s.traceCMDR(),s.autoTraceEnable&&s.traceDisMouseEnable(s.target)))},s.traceDisMouseEnable=function(t){if(console.log("----------------traceDisMouseEnable--------------------"),t||(t=s.target),!t)return console.log("no targetAvalible"),null;var e;for(e=[],s.selectedNodes=[];t;)e.push($e.getNodeClassAndName(t)+": mouseEnabled:"+t.mouseEnabled+" hitFirst:"+t.hitTestPrior),s.selectedNodes.push(t),t=t.parent;return console.log(e.join("\n")),s.showSelected(),e.join("\n")},s.traceDisSizeChain=function(t){if(console.log("---------------------traceDisSizeChain-------------------"),t||(t=s.target),!t)return console.log("no targetAvalible"),null;var e;for(s.selectedNodes=[],e=[];t;)e.push($e.getNodeClassAndName(t)+": x:"+t.x+" y:"+t.y+" w:"+t.width+" h:"+t.height+" scaleX:"+t.scaleX+" scaleY:"+t.scaleY),s.selectedNodes.push(t),t=t.parent;return console.log(e.join("\n")),s.showSelected(),e.join("\n")},s.showDisBound=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i="#ff0000"),t||(t=s.target),!t)return console.log("no targetAvalible"),null;var n;e&&s.clearDebugLayer(),!(n=t._getBoundPointsM(!0))||n.length<1||(n=qi.pListToPointList(n,!0),Li.walkArr(n,t.localToGlobal,t),n=qi.pointListToPlist(n),s._disBoundRec=nn._getWrapRec(n,s._disBoundRec),s.debugLayer.graphics.drawRect(s._disBoundRec.x,s._disBoundRec.y,s._disBoundRec.width,s._disBoundRec.height,null,i),Is.I.setTop())},s.showDisBoundToSprite=function(t,e,i,n){var r;void 0===i&&(i="#ff0000"),void 0===n&&(n=1),!(r=t._getBoundPointsM(!0))||r.length<1||(r=qi.pListToPointList(r,!0),Li.walkArr(r,t.localToGlobal,t),r=qi.pointListToPlist(r),s._disBoundRec=nn._getWrapRec(r,s._disBoundRec),e.graphics.drawRect(s._disBoundRec.x,s._disBoundRec.y,s._disBoundRec.width,s._disBoundRec.height,null,i,n))},s.getNodeInfo=function(){return s.counter.reset(),Li.walkTarget(S.stage,s.addNodeInfo),console.log("node info:"),s.counter.traceSelf(),s.counter.data},s.findByClass=function(t){return s._classList=[],s._tFindClass=t,Li.walkTarget(S.stage,s.addClassNode),s.selectedNodes=s._classList,s.showSelected(),s._classList},s.addClassNode=function(t){t.constructor.name==s._tFindClass&&s._classList.push(t)},s.traceCMD=function(t){if(t||(t=s.target),!t)return console.log("no targetAvalible"),null;var e;for(console.log("self CMDs:"),console.log(t.graphics.cmds),e=cn.renders[t._renderType],console.log("renderSprite:",e),s._rSpList.length=0;e&&0<e._sign;)s._rSpList.push(s.cmdToTypeO[e._sign]),e=e._next;return console.log("fun:",s._rSpList.join(",")),s.counter.reset(),s.addCMDs(t.graphics.cmds),s.counter.traceSelf(),s.counter.data},s.addCMDs=function(t){Li.walkArr(t,s.addCMD)},s.addCMD=function(t){s.counter.add(t.callee)},s.traceCMDR=function(t){return t||(t=s.target),t?(s.counter.reset(),Li.walkTarget(t,s.getCMdCount),console.log("cmds include children"),s.counter.traceSelf(),s.counter.data):(console.log("no targetAvalible"),0)},s.getCMdCount=function(t){return t&&t instanceof laya.display.Sprite&&t.graphics.cmds?(s.addCMDs(t.graphics.cmds),t.graphics.cmds.length):0},s.addNodeInfo=function(t){var e;e=t.constructor.name,s.counter.add(e)},s.find=function(t,e){var i;return void 0===e&&(e=!0),i=s.findTarget(S.stage,t),(s.selectedNodes=i)&&(s.target=s.selectedNodes[0]),e&&s.showSelected(),i},s.findByName=function(t){return s.nameFilter.name=t,s.find(s.nameFilter)},s.findNameStartWith=function(t){return s.nameFilter.name=s.getStartWithFun(t),s.find(s.nameFilter)},s.findNameHas=function(t,e){return void 0===e&&(e=!0),s.nameFilter.name=s.getHasFun(t),s.find(s.nameFilter,e)},s.getStartWithFun=function(e){return function(t){return!!t&&0==t.indexOf(e)}},s.getHasFun=function(e){return function(t){return!!t&&0<=t.indexOf(e)}},s.findTarget=function(t,e){var i=[];s.isFit(t,e)&&i.push(t);var n,r,a=0;for(n=t.numChildren,a=0;a<n;a++)(r=t.getChildAt(a))instanceof laya.display.Sprite&&(i=i.concat(s.findTarget(r,e)));return i},s.findClassHas=function(t,e){var i=[];0<=$e.getClassName(t).indexOf(e)&&i.push(t);var n,r,a=0;for(n=t.numChildren,a=0;a<n;a++)(r=t.getChildAt(a))instanceof laya.display.Sprite&&(i=i.concat(s.findClassHas(r,e)));return i},s.isFit=function(t,e){if(!t)return!1;if(!e)return!0;if("function"==typeof e)return e(t);var i;for(i in e)if("function"==typeof e[i]){if(!e[i](t[i]))return!1}else if(t[i]!=e[i])return!1;return!0},s.log=function(t){var e,i=arguments;e=hi.getArgArr(i),null!=s._logFun&&s._logFun(e.join(" "))},s.enableCacheAnalyse=!1,s.enableNodeCreateAnalyse=!0,s._traceFun=null,s.debugLayer=null,s._target=null,s.selectedNodes=[],s.autoShowSelected=!0,s._showBound=!0,s._disBoundRec=null,s.autoTraceEnable=!1,s.autoTraceBounds=!1,s.autoTraceSize=!1,s.autoTraceTree=!0,s.autoTraceCMD=!0,s.autoTraceCMDR=!1,s.autoTraceSpriteInfo=!0,s._classList=null,s._tFindClass=null,s._rSpList=[],s._logFun=null,m(s,["text",function(){return this.text=new Cn},"cmdToTypeO",function(){return this.cmdToTypeO={}},"counter",function(){return this.counter=new ii},"nameFilter",function(){return this.nameFilter={name:"name"}}]),s}()),Ye=function(){function e(){}return E(e,"laya.debug.divui.DivScripts"),e.init=function(){var t;t=Ke.decodeToByte(e.data).readUTFBytes(),S._runScript(t)},e.data="ZnVuY3Rpb24gZGh0bWx4RXZlbnQoZSx0LGkpe2UuYWRkRXZlbnRMaXN0ZW5lcj9lLmFkZEV2ZW50TGlzdGVuZXIodCxpLCExKTplLmF0dGFjaEV2ZW50JiZlLmF0dGFjaEV2ZW50KCJvbiIrdCxpKX1mdW5jdGlvbiBkaHRtbFhUcmVlT2JqZWN0KGUsdCxpLG4pe2lmKGRodG1seEV2ZW50LmluaXRUb3VjaCYmZGh0bWx4RXZlbnQuaW5pdFRvdWNoKCksX2lzSUUpdHJ5e2RvY3VtZW50LmV4ZWNDb21tYW5kKCJCYWNrZ3JvdW5kSW1hZ2VDYWNoZSIsITEsITApfWNhdGNoKG8pe30ib2JqZWN0IiE9dHlwZW9mIGU/dGhpcy5wYXJlbnRPYmplY3Q9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZSk6dGhpcy5wYXJlbnRPYmplY3Q9ZSx0aGlzLnBhcmVudE9iamVjdC5zdHlsZS5vdmVyZmxvdz0iaGlkZGVuIix0aGlzLl9pdGltX2RnPSEwLHRoaXMuZGxtdHI9IiwiLHRoaXMuZHJvcExvd2VyPSExLHRoaXMuZW5hYmxlSUVJbWFnZUZpeCghMCksdGhpcy54bWxzdGF0ZT0wLHRoaXMubXl0eXBlPSJ0cmVlIix0aGlzLnNtY2hlY2s9ITAsdGhpcy53aWR0aD10LHRoaXMuaGVpZ2h0PWksdGhpcy5yb290SWQ9bix0aGlzLmNoaWxkQ2FsYz1udWxsLHRoaXMuZGVmX2ltZ194PSIxOHB4Iix0aGlzLmRlZl9pbWdfeT0iMThweCIsdGhpcy5kZWZfbGluZV9pbWdfeD0iMThweCIsdGhpcy5kZWZfbGluZV9pbWdfeT0iMjRweCIsdGhpcy5fZHJhZ2dlZD1uZXcgQXJyYXksdGhpcy5fc2VsZWN0ZWQ9bmV3IEFycmF5LHRoaXMuc3R5bGVfcG9pbnRlcj0icG9pbnRlciIsdGhpcy5fYWltZ3M9ITAsdGhpcy5odG1sY0E9IiBbIix0aGlzLmh0bWxjQj0iXSIsdGhpcy5sV2luPXdpbmRvdyx0aGlzLmNNZW51PTAsdGhpcy5tbGl0ZW1zPTAsdGhpcy5pY29uVVJMPSIiLHRoaXMuZGFkbW9kZT0wLHRoaXMuc2xvd1BhcnNlPSExLHRoaXMuYXV0b1Njcm9sbD0hMCx0aGlzLmhmTW9kZT0wLHRoaXMubm9kZUN1dD1uZXcgQXJyYXksdGhpcy5YTUxzb3VyY2U9MCx0aGlzLlhNTGxvYWRpbmdXYXJuaW5nPTAsdGhpcy5faWRwdWxsPXt9LHRoaXMuX3B1bGxTaXplPTAsdGhpcy50cmVlTGluZXNPbj0hMCx0aGlzLnRzY2hlY2s9ITEsdGhpcy50aW1nZW49ITAsdGhpcy5kcGNweT0hMSx0aGlzLl9sZF9pZD1udWxsLHRoaXMuX2R5bkRlbGV0ZUJyYW5jaGVzPXt9LHRoaXMuX29pZV9vblhMRT1bXSx0aGlzLmltUGF0aD13aW5kb3cuZGh4X2dsb2JhbEltZ1BhdGh8fCIiLHRoaXMuY2hlY2tBcnJheT1uZXcgQXJyYXkoImljb25VbmNoZWNrQWxsLmdpZiIsImljb25DaGVja0FsbC5naWYiLCJpY29uQ2hlY2tHcmF5LmdpZiIsImljb25VbmNoZWNrRGlzLmdpZiIsImljb25DaGVja0Rpcy5naWYiLCJpY29uQ2hlY2tEaXMuZ2lmIiksdGhpcy5yYWRpb0FycmF5PW5ldyBBcnJheSgicmFkaW9fb2ZmLmdpZiIsInJhZGlvX29uLmdpZiIsInJhZGlvX29uLmdpZiIsInJhZGlvX29mZi5naWYiLCJyYWRpb19vbi5naWYiLCJyYWRpb19vbi5naWYiKSx0aGlzLmxpbmVBcnJheT1uZXcgQXJyYXkoImxpbmUyLmdpZiIsImxpbmUzLmdpZiIsImxpbmU0LmdpZiIsYmxhbmtfYmFzZTY0LGJsYW5rX2Jhc2U2NCwibGluZTEuZ2lmIiksdGhpcy5taW51c0FycmF5PW5ldyBBcnJheSgibWludXMyLmdpZiIsIm1pbnVzMy5naWYiLCJtaW51czQuZ2lmIiwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRWdBWUFKRUNBTEd2clo2ZG5mVDA5QUFBQUNINUJBRUFBQUlBTEFBQUFBQVNBQmdBQUFJY2xJK3B5KzBQbzV5MFdoc0NEV0IzbUdYZnd3SG1oYWJxeXJaVEFRQTciLCJtaW51czUuZ2lmIiksdGhpcy5wbHVzQXJyYXk9bmV3IEFycmF5KCJwbHVzMi5naWYiLCJwbHVzMy5naWYiLCJwbHVzNC5naWYiLCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhFZ0FZQUpFQ0FLR2duN0d2cmZUMDlBQUFBQ0g1QkFFQUFBSUFMQUFBQUFBU0FCZ0FBQUljbEkrcHkrMFBvNXkwVW5CRHlIc0NMUUZmT0U2ZGhhYnF5clpKQVFBNyIsInBsdXM1LmdpZiIpLHRoaXMuaW1hZ2VBcnJheT1uZXcgQXJyYXkoImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEVnQVNBS0VDQUplWGw3R3ZyZi8vLy8vLy95SDVCQUVLQUFJQUxBQUFBQUFTQUJJQUFBSXpsSStwQXUyOURBaTAxamlUWFJuTm0zVEhCNDVCYUoyZXVsQm94TENTL0s2d09OODBYcHQ2citCOUhrU2FJSVdFS1EwRkFEcz0iLCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhFZ0FTQUtFQ0FKZVhsN0d2cmYvLy8vLy8veUg1QkFFS0FBSUFMQUFBQUFBU0FCSUFBQUl6bEkrcHl3Y1BtM21oV2drQ3NqQk92VmtpbUVsRzlabENCbFhkKzJYampMS2c1R3FvZVpYcXZzT1FYSy9palVaVEtWVUZBRHM9IiwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRWdBU0FLRUNBSmVYbDdHdnJmLy8vLy8vL3lINUJBRUtBQUlBTEFBQUFBQVNBQklBQUFJd2xJK3B5d2NQbTNtaFdna0NzakJPdlZraW1FbEc5WmxDdVlJWTZUWXMrNmJtSERPNGlnZmREM0dOaGhlVjBWUUFBRHM9IiksdGhpcy5jdXRJbWc9bmV3IEFycmF5KDAsMCwwKSx0aGlzLmN1dEltYWdlPSJidXRfY3V0LmdpZiIsZGh4NC5fZXZlbnRhYmxlKHRoaXMpLHRoaXMuaHRtbE5vZGU9bmV3IGRodG1sWFRyZWVJdGVtT2JqZWN0KHRoaXMucm9vdElkLCIiLDAsdGhpcyksdGhpcy5odG1sTm9kZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uc3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5odG1sTm9kZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWU9ImhpZGRlblJvdyIsdGhpcy5hbGxUcmVlPXRoaXMuX2NyZWF0ZVNlbGYoKSx0aGlzLmFsbFRyZWUuYXBwZW5kQ2hpbGQodGhpcy5odG1sTm9kZS5odG1sTm9kZSksZGh0bWx4LiRjdXN0b21TY3JvbGwmJmRodG1seC5DdXN0b21TY3JvbGwuZW5hYmxlKHRoaXMpLF9pc0ZGJiYodGhpcy5hbGxUcmVlLmNoaWxkTm9kZXNbMF0ud2lkdGg9IjEwMCUiLHRoaXMuYWxsVHJlZS5jaGlsZE5vZGVzWzBdLnN0eWxlLm92ZXJmbG93PSJoaWRkZW4iKTt2YXIgcj10aGlzO2lmKHRoaXMuYWxsVHJlZS5vbnNlbGVjdHN0YXJ0PW5ldyBGdW5jdGlvbigicmV0dXJuIGZhbHNlOyIpLF9pc01hY09TJiYodGhpcy5hbGxUcmVlLm9uY29udGV4dG1lbnU9ZnVuY3Rpb24oZSl7cmV0dXJuIHIuX2RvQ29udENsaWNrKGV8fHdpbmRvdy5ldmVudCwhMCl9KSx0aGlzLmFsbFRyZWUub25tb3VzZWRvd249ZnVuY3Rpb24oZSl7cmV0dXJuIHIuX2RvQ29udENsaWNrKGV8fHdpbmRvdy5ldmVudCl9LHRoaXMuWE1MTG9hZGVyPXRoaXMuX3BhcnNlWE1MVHJlZSxfaXNJRSYmdGhpcy5wcmV2ZW50SUVDYXNoaW5nKCEwKSx0aGlzLnNlbGVjdGlvbkJhcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKSx0aGlzLnNlbGVjdGlvbkJhci5jbGFzc05hbWU9InNlbGVjdGlvbkJhciIsdGhpcy5zZWxlY3Rpb25CYXIuaW5uZXJIVE1MPSImbmJzcDsiLHRoaXMuc2VsZWN0aW9uQmFyLnN0eWxlLmRpc3BsYXk9Im5vbmUiLHRoaXMuYWxsVHJlZS5hcHBlbmRDaGlsZCh0aGlzLnNlbGVjdGlvbkJhciksd2luZG93LmFkZEV2ZW50TGlzdGVuZXImJndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ1bmxvYWQiLGZ1bmN0aW9uKCl7dHJ5e3IuZGVzdHJ1Y3RvcigpfWNhdGNoKGUpe319LCExKSx3aW5kb3cuYXR0YWNoRXZlbnQmJndpbmRvdy5hdHRhY2hFdmVudCgib251bmxvYWQiLGZ1bmN0aW9uKCl7dHJ5e3IuZGVzdHJ1Y3RvcigpfWNhdGNoKGUpe319KSx0aGlzLnNldEltYWdlc1BhdGg9dGhpcy5zZXRJbWFnZVBhdGgsdGhpcy5zZXRJY29uc1BhdGg9dGhpcy5zZXRJY29uUGF0aCx0aGlzLnNldFNraW4oIm1hdGVyaWFsIiksZGh0bWx4LmltYWdlX3BhdGgpe3ZhciBsPWRodG1seC5pbWFnZV9wYXRoLHM9dGhpcy5wYXJlbnRPYmplY3QuY2xhc3NOYW1lLm1hdGNoKC9kaHh0cmVlX2RoeF8oW2Etel9dKikvaSk7bnVsbCE9cyYmbnVsbCE9c1sxXSYmKGwrPSJkaHh0cmVlXyIrc1sxXSsiLyIpLHRoaXMuc2V0SW1hZ2VQYXRoKGwpfXJldHVybiB0aGlzfWZ1bmN0aW9uIGNPYmplY3QoKXtyZXR1cm4gdGhpc31mdW5jdGlvbiBkaHRtbFhUcmVlSXRlbU9iamVjdChlLHQsaSxuLG8scil7cmV0dXJuIHRoaXMuaHRtbE5vZGU9IiIsdGhpcy5hY29sb3I9IiIsdGhpcy5zY29sb3I9IiIsdGhpcy50cj0wLHRoaXMuY2hpbGRzQ291bnQ9MCx0aGlzLnRlbXBET01NPTAsdGhpcy50ZW1wRE9NVT0wLHRoaXMuZHJhZ1NwYW49MCx0aGlzLmRyYWdNb3ZlPTAsdGhpcy5zcGFuPTAsdGhpcy5jbG9zZWJsZT0xLHRoaXMuY2hpbGROb2Rlcz1uZXcgQXJyYXksdGhpcy51c2VyRGF0YT1uZXcgY09iamVjdCx0aGlzLmNoZWNrc3RhdGU9MCx0aGlzLnRyZWVOb2Q9bix0aGlzLmxhYmVsPXQsdGhpcy5wYXJlbnRPYmplY3Q9aSx0aGlzLmFjdGlvbkhhbmRsZXI9byx0aGlzLmltYWdlcz1uZXcgQXJyYXkobi5pbWFnZUFycmF5WzBdLG4uaW1hZ2VBcnJheVsxXSxuLmltYWdlQXJyYXlbMl0pLHRoaXMuaWQ9bi5fZ2xvYmFsSWRTdG9yYWdlQWRkKGUsdGhpcyksdGhpcy50cmVlTm9kLmNoZWNrQm94T2ZmP3RoaXMuaHRtbE5vZGU9dGhpcy50cmVlTm9kLl9jcmVhdGVJdGVtKDEsdGhpcyxyKTp0aGlzLmh0bWxOb2RlPXRoaXMudHJlZU5vZC5fY3JlYXRlSXRlbSgwLHRoaXMsciksdGhpcy5odG1sTm9kZS5vYmpCZWxvbmc9dGhpcyx0aGlzfWZ1bmN0aW9uIGpzb25Qb2ludGVyKGUsdCl7dGhpcy5kPWUsdGhpcy5kcD10fWZ1bmN0aW9uIGRoeF9pbml0X3RyZWVzKCl7Zm9yKHZhciBlPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJkaXYiKSx0PTA7dDxlLmxlbmd0aDt0KyspImRodG1seFRyZWUiPT1lW3RdLmNsYXNzTmFtZSYmZGh0bWxYVHJlZUZyb21IVE1MKGVbdF0pfXZhciBibGFua19iYXNlNjQ9ImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEVnQVNBSUFBQVAvLy8vLy8veUg1QkFVVUFBRUFMQUFBQUFBU0FCSUFBQUlQakkrcHkrMFBvNXkwMm91ejNwd1hBRHM9IjsidW5kZWZpbmVkIj09dHlwZW9mIHdpbmRvdy5kaHgmJih3aW5kb3cuZGh4PXdpbmRvdy5kaHg0PXt2ZXJzaW9uOiI1LjAiLHNraW46bnVsbCxsYXN0SWQ6MSxuZXdJZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxhc3RJZCsrfSx6aW06e2RhdGE6e30sc3RlcDo1LGZpcnN0OmZ1bmN0aW9uKCl7cmV0dXJuIDEwMH0sbGFzdDpmdW5jdGlvbigpe3ZhciBlPXRoaXMuZmlyc3QoKTtmb3IodmFyIHQgaW4gdGhpcy5kYXRhKWU9TWF0aC5tYXgoZSx0aGlzLmRhdGFbdF0pO3JldHVybiBlfSxyZXNlcnZlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmRhdGFbZV09dGhpcy5sYXN0KCkrdGhpcy5zdGVwLHRoaXMuZGF0YVtlXX0sY2xlYXI6ZnVuY3Rpb24oZSl7bnVsbCE9dGhpcy5kYXRhW2VdJiYodGhpcy5kYXRhW2VdPW51bGwsZGVsZXRlIHRoaXMuZGF0YVtlXSl9fSxzMmI6ZnVuY3Rpb24oZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlJiYoZT1lLnRvTG93ZXJDYXNlKCkpLDE9PWV8fDE9PWV8fCJ0cnVlIj09ZXx8IjEiPT1lfHwieWVzIj09ZXx8InkiPT1lfHwib24iPT1lfSxzMmo6ZnVuY3Rpb24ocyl7dmFyIG9iaj1udWxsO2RoeDQudGVtcD1udWxsO3RyeXtldmFsKCJkaHg0LnRlbXA9IitzKX1jYXRjaChlKXtkaHg0LnRlbXA9bnVsbH1yZXR1cm4gb2JqPWRoeDQudGVtcCxkaHg0LnRlbXA9bnVsbCxvYmp9LGFic0xlZnQ6ZnVuY3Rpb24oZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlJiYoZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChlKSksdGhpcy5nZXRPZmZzZXQoZSkubGVmdH0sYWJzVG9wOmZ1bmN0aW9uKGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZSYmKGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZSkpLHRoaXMuZ2V0T2Zmc2V0KGUpLnRvcH0sX2FPZnM6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTAsaT0wO2U7KXQrPXBhcnNlSW50KGUub2Zmc2V0VG9wKSxpKz1wYXJzZUludChlLm9mZnNldExlZnQpLGU9ZS5vZmZzZXRQYXJlbnQ7cmV0dXJue3RvcDp0LGxlZnQ6aX19LF9hT2ZzUmVjdDpmdW5jdGlvbihlKXt2YXIgdD1lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGk9ZG9jdW1lbnQuYm9keSxuPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxvPXdpbmRvdy5wYWdlWU9mZnNldHx8bi5zY3JvbGxUb3B8fGkuc2Nyb2xsVG9wLHI9d2luZG93LnBhZ2VYT2Zmc2V0fHxuLnNjcm9sbExlZnR8fGkuc2Nyb2xsTGVmdCxsPW4uY2xpZW50VG9wfHxpLmNsaWVudFRvcHx8MCxzPW4uY2xpZW50TGVmdHx8aS5jbGllbnRMZWZ0fHwwLGE9dC50b3Arby1sLGQ9dC5sZWZ0K3ItcztyZXR1cm57dG9wOk1hdGgucm91bmQoYSksbGVmdDpNYXRoLnJvdW5kKGQpfX0sZ2V0T2Zmc2V0OmZ1bmN0aW9uKGUpe3JldHVybiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdD90aGlzLl9hT2ZzUmVjdChlKTp0aGlzLl9hT2ZzKGUpfSxfaXNPYmo6ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGwhPWUmJiJvYmplY3QiPT10eXBlb2YgZSYmInVuZGVmaW5lZCI9PXR5cGVvZiBlLmxlbmd0aH0sX2NvcHlPYmo6ZnVuY3Rpb24oZSl7aWYodGhpcy5faXNPYmooZSkpe3ZhciB0PXt9O2Zvcih2YXIgaSBpbiBlKSJvYmplY3QiPT10eXBlb2YgZVtpXSYmbnVsbCE9ZVtpXT90W2ldPXRoaXMuX2NvcHlPYmooZVtpXSk6dFtpXT1lW2ldfWVsc2UgZm9yKHZhciB0PVtdLGk9MDtpPGUubGVuZ3RoO2krKykib2JqZWN0Ij09dHlwZW9mIGVbaV0mJm51bGwhPWVbaV0/dFtpXT10aGlzLl9jb3B5T2JqKGVbaV0pOnRbaV09ZVtpXTtyZXR1cm4gdH19LHdpbmRvdy5kaHg0LmlzSUU9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIik+PTB8fG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiVHJpZGVudCIpPj0wLHdpbmRvdy5kaHg0LmlzSUU2PW51bGw9PXdpbmRvdy5YTUxIdHRwUmVxdWVzdCYmbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIik+PTAsd2luZG93LmRoeDQuaXNJRTc9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIDcuMCIpPj0wJiZuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlRyaWRlbnQiKTwwLHdpbmRvdy5kaHg0LmlzSUU4PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiTVNJRSA4LjAiKT49MCYmbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJUcmlkZW50Iik+PTAsd2luZG93LmRoeDQuaXNJRTk9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIDkuMCIpPj0wJiZuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlRyaWRlbnQiKT49MCx3aW5kb3cuZGh4NC5pc0lFMTA9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIDEwLjAiKT49MCYmbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJUcmlkZW50Iik+PTAmJjEhPXdpbmRvdy5uYXZpZ2F0b3IucG9pbnRlckVuYWJsZWQsd2luZG93LmRoeDQuaXNJRTExPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiVHJpZGVudCIpPj0wJiYxPT13aW5kb3cubmF2aWdhdG9yLnBvaW50ZXJFbmFibGVkLHdpbmRvdy5kaHg0LmlzRWRnZT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkVkZ2UiKT49MCx3aW5kb3cuZGh4NC5pc09wZXJhPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiT3BlcmEiKT49MCx3aW5kb3cuZGh4NC5pc0Nocm9tZT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpPj0wJiYhd2luZG93LmRoeDQuaXNFZGdlLHdpbmRvdy5kaHg0LmlzS0hUTUw9KG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+PTB8fG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiS29ucXVlcm9yIik+PTApJiYhd2luZG93LmRoeDQuaXNFZGdlLHdpbmRvdy5kaHg0LmlzRkY9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJGaXJlZm94Iik+PTAsd2luZG93LmRoeDQuaXNJUGFkPW5hdmlnYXRvci51c2VyQWdlbnQuc2VhcmNoKC9pUGFkL2dpKT49MCx3aW5kb3cuZGh4NC5kbmQ9e2V2czp7fSxwX2VuOih3aW5kb3cuZGh4NC5pc0lFfHx3aW5kb3cuZGh4NC5pc0VkZ2UpJiYod2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZHx8d2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkKSxfbVRvdWNoOmZ1bmN0aW9uKGUpe3JldHVybiB3aW5kb3cuZGh4NC5pc0lFMTAmJmUucG9pbnRlclR5cGU9PWUuTVNQT0lOVEVSX1RZUEVfTU9VU0V8fHdpbmRvdy5kaHg0LmlzSUUxMSYmIm1vdXNlIj09ZS5wb2ludGVyVHlwZXx8d2luZG93LmRoeDQuaXNFZGdlJiYibW91c2UiPT1lLnBvaW50ZXJUeXBlfSxfdG91Y2hPbjpmdW5jdGlvbihlKXtudWxsPT1lJiYoZT1kb2N1bWVudC5ib2R5KSxlLnN0eWxlLnRvdWNoQWN0aW9uPWUuc3R5bGUubXNUb3VjaEFjdGlvbj0iIixlPW51bGx9LF90b3VjaE9mZjpmdW5jdGlvbihlKXtudWxsPT1lJiYoZT1kb2N1bWVudC5ib2R5KSxlLnN0eWxlLnRvdWNoQWN0aW9uPWUuc3R5bGUubXNUb3VjaEFjdGlvbj0ibm9uZSIsZT1udWxsfX0sMT09d2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZD93aW5kb3cuZGh4NC5kbmQuZXZzPXtzdGFydDoicG9pbnRlcmRvd24iLG1vdmU6InBvaW50ZXJtb3ZlIixlbmQ6InBvaW50ZXJ1cCJ9OjE9PXdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZD93aW5kb3cuZGh4NC5kbmQuZXZzPXtzdGFydDoiTVNQb2ludGVyRG93biIsbW92ZToiTVNQb2ludGVyTW92ZSIsZW5kOiJNU1BvaW50ZXJVcCJ9OiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93LmFkZEV2ZW50TGlzdGVuZXImJih3aW5kb3cuZGh4NC5kbmQuZXZzPXtzdGFydDoidG91Y2hzdGFydCIsbW92ZToidG91Y2htb3ZlIixlbmQ6InRvdWNoZW5kIn0pKSwidW5kZWZpbmVkIj09dHlwZW9mIHdpbmRvdy5kaHg0Ll9ldmVudGFibGUmJih3aW5kb3cuZGh4NC5fZXZlbnRhYmxlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuImNsZWFyIj09dD8oZS5kZXRhY2hBbGxFdmVudHMoKSxlLmRoeGV2cz1udWxsLGUuYXR0YWNoRXZlbnQ9bnVsbCxlLmRldGFjaEV2ZW50PW51bGwsZS5jaGVja0V2ZW50PW51bGwsZS5jYWxsRXZlbnQ9bnVsbCxlLmRldGFjaEFsbEV2ZW50cz1udWxsLHZvaWQoZT1udWxsKSk6KGUuZGh4ZXZzPXtkYXRhOnt9fSxlLmF0dGFjaEV2ZW50PWZ1bmN0aW9uKGUsdCl7ZT1TdHJpbmcoZSkudG9Mb3dlckNhc2UoKSx0aGlzLmRoeGV2cy5kYXRhW2VdfHwodGhpcy5kaHhldnMuZGF0YVtlXT17fSk7dmFyIGk9d2luZG93LmRoeDQubmV3SWQoKTtyZXR1cm4gdGhpcy5kaHhldnMuZGF0YVtlXVtpXT10LGl9LGUuZGV0YWNoRXZlbnQ9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0IGluIHRoaXMuZGh4ZXZzLmRhdGEpe3ZhciBpPTA7Zm9yKHZhciBuIGluIHRoaXMuZGh4ZXZzLmRhdGFbdF0pbj09ZT8odGhpcy5kaHhldnMuZGF0YVt0XVtuXT1udWxsLGRlbGV0ZSB0aGlzLmRoeGV2cy5kYXRhW3RdW25dKTppKys7MD09aSYmKHRoaXMuZGh4ZXZzLmRhdGFbdF09bnVsbCxkZWxldGUgdGhpcy5kaHhldnMuZGF0YVt0XSl9fSxlLmNoZWNrRXZlbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGU9U3RyaW5nKGUpLnRvTG93ZXJDYXNlKCksbnVsbCE9dGhpcy5kaHhldnMuZGF0YVtlXX0sZS5jYWxsRXZlbnQ9ZnVuY3Rpb24oZSx0KXtpZihlPVN0cmluZyhlKS50b0xvd2VyQ2FzZSgpLG51bGw9PXRoaXMuZGh4ZXZzLmRhdGFbZV0pcmV0dXJuITA7dmFyIGk9ITA7Zm9yKHZhciBuIGluIHRoaXMuZGh4ZXZzLmRhdGFbZV0paT10aGlzLmRoeGV2cy5kYXRhW2VdW25dLmFwcGx5KHRoaXMsdCkmJmk7cmV0dXJuIGl9LGUuZGV0YWNoQWxsRXZlbnRzPWZ1bmN0aW9uKCl7Zm9yKHZhciBlIGluIHRoaXMuZGh4ZXZzLmRhdGEpe2Zvcih2YXIgdCBpbiB0aGlzLmRoeGV2cy5kYXRhW2VdKXRoaXMuZGh4ZXZzLmRhdGFbZV1bdF09bnVsbCxkZWxldGUgdGhpcy5kaHhldnMuZGF0YVtlXVt0XTt0aGlzLmRoeGV2cy5kYXRhW2VdPW51bGwsZGVsZXRlIHRoaXMuZGh4ZXZzLmRhdGFbZV19fSx2b2lkKGU9bnVsbCkpfSxkaHg0Ll9ldmVudGFibGUoZGh4NCkpLCJ1bmRlZmluZWQiPT10eXBlb2Ygd2luZG93LmRodG1seCYmKHdpbmRvdy5kaHRtbHg9e2V4dGVuZDpmdW5jdGlvbihlLHQpe2Zvcih2YXIgaSBpbiB0KWVbaV18fChlW2ldPXRbaV0pO3JldHVybiBlfSxleHRlbmRfYXBpOmZ1bmN0aW9uKGUsdCxpKXt2YXIgbj13aW5kb3dbZV07biYmKHdpbmRvd1tlXT1mdW5jdGlvbihlKXtpZihlJiYib2JqZWN0Ij09dHlwZW9mIGUmJiFlLnRhZ05hbWUpe3ZhciBpPW4uYXBwbHkodGhpcyx0Ll9pbml0P3QuX2luaXQoZSk6YXJndW1lbnRzKTtmb3IodmFyIG8gaW4gZGh0bWx4KXRbb10mJnRoaXNbdFtvXV0oZGh0bWx4W29dKTtmb3IodmFyIG8gaW4gZSl0W29dP3RoaXNbdFtvXV0oZVtvXSk6MD09PW8uaW5kZXhPZigib24iKSYmdGhpcy5hdHRhY2hFdmVudChvLGVbb10pfWVsc2UgdmFyIGk9bi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIHQuX3BhdGNoJiZ0Ll9wYXRjaCh0aGlzKSxpfHx0aGlzfSx3aW5kb3dbZV0ucHJvdG90eXBlPW4ucHJvdG90eXBlLGkmJmRodG1seC5leHRlbmQod2luZG93W2VdLnByb3RvdHlwZSxpKSl9LHVybDpmdW5jdGlvbihlKXtyZXR1cm4tMSE9ZS5pbmRleE9mKCI/Iik/IiYiOiI/In19KSxfaXNGRj0hMSxfaXNJRT0hMSxfaXNPcGVyYT0hMSxfaXNLSFRNTD0hMSxfaXNNYWNPUz0hMSxfaXNDaHJvbWU9ITEsX0ZGcnY9ITEsX0tIVE1McnY9ITEsX09wZXJhUnY9ITEsLTEhPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiTWFjaW50b3NoIikmJihfaXNNYWNPUz0hMCksbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoImNocm9tZSIpPi0xJiYoX2lzQ2hyb21lPSEwKSwtMSE9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKXx8LTEhPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiS29ucXVlcm9yIik/KF9LSFRNTHJ2PXBhcnNlRmxvYXQobmF2aWdhdG9yLnVzZXJBZ2VudC5zdWJzdHIobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKSs3LDUpKSxfS0hUTUxydj41MjU/KF9pc0ZGPSEwLF9GRnJ2PTEuOSk6X2lzS0hUTUw9ITApOi0xIT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIk9wZXJhIik/KF9pc09wZXJhPSEwLF9PcGVyYVJ2PXBhcnNlRmxvYXQobmF2aWdhdG9yLnVzZXJBZ2VudC5zdWJzdHIobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJPcGVyYSIpKzYsMykpKTotMSE9bmF2aWdhdG9yLmFwcE5hbWUuaW5kZXhPZigiTWljcm9zb2Z0Iik/KF9pc0lFPSEwLCgtMSE9bmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZigiTVNJRSA4LjAiKXx8LTEhPW5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoIk1TSUUgOS4wIil8fC0xIT1uYXZpZ2F0b3IuYXBwVmVyc2lvbi5pbmRleE9mKCJNU0lFIDEwLjAiKXx8ZG9jdW1lbnQuZG9jdW1lbnRNb2RlPjcpJiYiQmFja0NvbXBhdCIhPWRvY3VtZW50LmNvbXBhdE1vZGUmJihfaXNJRT04KSk6Ik5ldHNjYXBlIj09bmF2aWdhdG9yLmFwcE5hbWUmJi0xIT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlRyaWRlbnQiKT9faXNJRT04OihfaXNGRj0hMCxfRkZydj1wYXJzZUZsb2F0KG5hdmlnYXRvci51c2VyQWdlbnQuc3BsaXQoInJ2OiIpWzFdKSksInVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3cuZGh0bWx4RXZlbnQsbnVsbD09ZGh0bWx4RXZlbnQudG91Y2hEZWxheSYmKGRodG1seEV2ZW50LnRvdWNoRGVsYXk9MmUzKSwidW5kZWZpbmVkIj09dHlwZW9mIGRodG1seEV2ZW50LmluaXRUb3VjaCYmKGRodG1seEV2ZW50LmluaXRUb3VjaD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtpZihpKXt2YXIgZT1kb2N1bWVudC5jcmVhdGVFdmVudCgiSFRNTEV2ZW50cyIpO2UuaW5pdEV2ZW50KCJkYmxjbGljayIsITAsITApLGkuZGlzcGF0Y2hFdmVudChlKSx0PWk9bnVsbH19dmFyIHQsaSxuLG87ZGh0bWx4RXZlbnQoZG9jdW1lbnQuYm9keSwidG91Y2hzdGFydCIsZnVuY3Rpb24ocil7aT1yLnRvdWNoZXNbMF0udGFyZ2V0LG49ci50b3VjaGVzWzBdLmNsaWVudFgsbz1yLnRvdWNoZXNbMF0uY2xpZW50WSx0PXdpbmRvdy5zZXRUaW1lb3V0KGUsZGh0bWx4RXZlbnQudG91Y2hEZWxheSl9KSxkaHRtbHhFdmVudChkb2N1bWVudC5ib2R5LCJ0b3VjaG1vdmUiLGZ1bmN0aW9uKGUpe3QmJihNYXRoLmFicyhlLnRvdWNoZXNbMF0uY2xpZW50WC1uKT41MHx8TWF0aC5hYnMoZS50b3VjaGVzWzBdLmNsaWVudFktbyk+NTApJiYod2luZG93LmNsZWFyVGltZW91dCh0KSx0PWk9ITEpfSksZGh0bWx4RXZlbnQoZG9jdW1lbnQuYm9keSwidG91Y2hlbmQiLGZ1bmN0aW9uKGUpe3QmJih3aW5kb3cuY2xlYXJUaW1lb3V0KHQpLHQ9aT0hMSl9KSxkaHRtbHhFdmVudC5pbml0VG91Y2g9ZnVuY3Rpb24oKXt9fSksZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2RvQ29udENsaWNrPWZ1bmN0aW9uKGUsdCl7aWYoIXQmJjIhPWUuYnV0dG9uKXJldHVybiB0aGlzLl9hY01lbnUmJih0aGlzLl9hY01lbnUuaGlkZUNvbnRleHRNZW51P3RoaXMuX2FjTWVudS5oaWRlQ29udGV4dE1lbnUoKTp0aGlzLmNNZW51Ll9jb250ZXh0RW5kKCkpLCEwO2Zvcih2YXIgaT1faXNJRT9lLnNyY0VsZW1lbnQ6ZS50YXJnZXQ7aSYmIkJPRFkiIT1pLnRhZ05hbWUmJiFpLnBhcmVudE9iamVjdDspaT1pLnBhcmVudE5vZGU7aWYoIWl8fCFpLnBhcmVudE9iamVjdClyZXR1cm4hMDt2YXIgbj1pLnBhcmVudE9iamVjdDtpZih0aGlzLmNhbGxFdmVudCgib25SaWdodENsaWNrIixbbi5pZCxlXSl8fCgoZS5zcmNFbGVtZW50fHxlLnRhcmdldCkub25jb250ZXh0bWVudT1mdW5jdGlvbihlKXtyZXR1cm4oZXx8ZXZlbnQpLmNhbmNlbEJ1YmJsZT0hMCwhMX0pLHRoaXMuX2FjTWVudT1uLmNNZW51fHx0aGlzLmNNZW51LHRoaXMuX2FjTWVudSl7aWYoIXRoaXMuY2FsbEV2ZW50KCJvbkJlZm9yZUNvbnRleHRNZW51Iixbbi5pZF0pKXJldHVybiEwO2lmKF9pc01hY09TfHwoKGUuc3JjRWxlbWVudHx8ZS50YXJnZXQpLm9uY29udGV4dG1lbnU9ZnVuY3Rpb24oZSl7cmV0dXJuKGV8fGV2ZW50KS5jYW5jZWxCdWJibGU9ITAsITF9KSx0aGlzLl9hY01lbnUuc2hvd0NvbnRleHRNZW51KXt2YXIgbz13aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LHI9d2luZG93LmRvY3VtZW50LmJvZHksbD1uZXcgQXJyYXkoby5zY3JvbGxMZWZ0fHxyLnNjcm9sbExlZnQsby5zY3JvbGxUb3B8fHIuc2Nyb2xsVG9wKTtpZihfaXNJRSl2YXIgcz1lLmNsaWVudFgrbFswXSxhPWUuY2xpZW50WStsWzFdO2Vsc2UgdmFyIHM9ZS5wYWdlWCxhPWUucGFnZVk7dGhpcy5fYWNNZW51LnNob3dDb250ZXh0TWVudShzLTEsYS0xKSx0aGlzLmNvbnRleHRJRD1uLmlkLGUuY2FuY2VsQnViYmxlPSEwLHRoaXMuX2FjTWVudS5fc2tpcF9oaWRlPSEwfWVsc2UgaS5jb250ZXh0TWVudUlkPW4uaWQsaS5jb250ZXh0TWVudT10aGlzLl9hY01lbnUsaS5hPXRoaXMuX2FjTWVudS5fY29udGV4dFN0YXJ0LGkuYShpLGUpLGkuYT1udWxsO3JldHVybiExfXJldHVybiEwfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5lbmFibGVJRUltYWdlRml4PWZ1bmN0aW9uKGUpe2U/KHRoaXMuX2dldEltZz1mdW5jdGlvbigpe3ZhciBlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpO3JldHVybiBlLmlubmVySFRNTD0iJm5ic3A7IixlLmNsYXNzTmFtZT0iZGh4X2JnX2ltZ19maXgiLGV9LHRoaXMuX3NldFNyYz1mdW5jdGlvbihlLHQpe2Uuc3R5bGUuYmFja2dyb3VuZEltYWdlPSJ1cmwoIit0KyIpIn0sdGhpcy5fZ2V0U3JjPWZ1bmN0aW9uKGUpe3ZhciB0PWUuc3R5bGUuYmFja2dyb3VuZEltYWdlO3JldHVybiB0LnN1YnN0cig0LHQubGVuZ3RoLTUpLnJlcGxhY2UoLyheIil8KCIkKS9nLCIiKX0pOih0aGlzLl9nZXRJbWc9ZnVuY3Rpb24oZSl7cmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZT09dGhpcy5yb290SWQ/ImRpdiI6ImltZyIpfSx0aGlzLl9zZXRTcmM9ZnVuY3Rpb24oZSx0KXtlLnNyYz10fSx0aGlzLl9nZXRTcmM9ZnVuY3Rpb24oZSl7cmV0dXJuIGUuc3JjfSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmRlc3RydWN0b3I9ZnVuY3Rpb24oKXtmb3IodmFyIGUgaW4gdGhpcy5faWRwdWxsKXt2YXIgdD10aGlzLl9pZHB1bGxbZV07dCYmKHQucGFyZW50T2JqZWN0PW51bGwsdC50cmVlTm9kPW51bGwsdC5jaGlsZE5vZGVzPW51bGwsdC5zcGFuPW51bGwsdC50ci5ub2RlbT1udWxsLHQudHI9bnVsbCx0Lmh0bWxOb2RlLm9iakJlbG9uZz1udWxsLHQuaHRtbE5vZGU9bnVsbCx0aGlzLl9pZHB1bGxbZV09bnVsbCl9dGhpcy5wYXJlbnRPYmplY3QuaW5uZXJIVE1MPSIiLHRoaXMuYWxsVHJlZS5vbnNlbGVjdHN0YXJ0PW51bGwsdGhpcy5hbGxUcmVlLm9uY29udGV4dG1lbnU9bnVsbCx0aGlzLmFsbFRyZWUub25tb3VzZWRvd249bnVsbDtmb3IodmFyIGUgaW4gdGhpcyl0aGlzW2VdPW51bGx9LGNPYmplY3QucHJvdG90eXBlPW5ldyBPYmplY3QsY09iamVjdC5wcm90b3R5cGUuY2xvbmU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7fXJldHVybiBlLnByb3RvdHlwZT10aGlzLG5ldyBlfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fZ2xvYmFsSWRTdG9yYWdlQWRkPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSwxLDEpPyhlPWUrIl8iKyhuZXcgRGF0ZSkudmFsdWVPZigpLHRoaXMuX2dsb2JhbElkU3RvcmFnZUFkZChlLHQpKToodGhpcy5faWRwdWxsW2VdPXQsdGhpcy5fcHVsbFNpemUrKyxlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2dsb2JhbElkU3RvcmFnZVN1Yj1mdW5jdGlvbihlKXt0aGlzLl9pZHB1bGxbZV0mJih0aGlzLl91bnNlbGVjdEl0ZW0odGhpcy5faWRwdWxsW2VdKSx0aGlzLl9pZHB1bGxbZV09bnVsbCx0aGlzLl9wdWxsU2l6ZS0tKSx0aGlzLl9sb2NrZXImJnRoaXMuX2xvY2tlcltlXSYmKHRoaXMuX2xvY2tlcltlXT0hMSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9nbG9iYWxJZFN0b3JhZ2VGaW5kPWZ1bmN0aW9uKGUsdCxpLG4pe3ZhciBvPXRoaXMuX2lkcHVsbFtlXTtpZihvKXtpZihvLnVuUGFyc2VkJiYhaSYmdGhpcy5yZVBhcnNlKG8sMCksdGhpcy5fc3JuZCYmIW8uaHRtbE5vZGUmJnRoaXMuX2J1aWxkU1JORChvLGkpLG4mJnRoaXMuX2Vkc2Jwc0EpZm9yKHZhciByPTA7cjx0aGlzLl9lZHNicHNBLmxlbmd0aDtyKyspaWYodGhpcy5fZWRzYnBzQVtyXVsyXT09ZSlyZXR1cm4gZGh4NC5jYWxsRXZlbnQoIm9uZ2V0SXRlbUVycm9yIixbIlJlcXVlc3RlZCBpdGVtIHN0aWxsIGluIHBhcnNpbmcgcHJvY2Vzcy4iLGVdKSxudWxsO3JldHVybiBvfXJldHVybiB0aGlzLnNsb3dQYXJzZSYmMCE9ZSYmIXQ/dGhpcy5wcmVQYXJzZShlKTpudWxsfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fZHJhd05ld1RyPWZ1bmN0aW9uKGUsdCl7dmFyIGk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHIiKSxuPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIiksbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpO3JldHVybiBuLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIgIikpLG8uY29sU3Bhbj0zLG8uYXBwZW5kQ2hpbGQoZSksaS5hcHBlbmRDaGlsZChuKSxpLmFwcGVuZENoaWxkKG8pLGl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnBhcnNlPWZ1bmN0aW9uKGUsdCxpKXtpZigic3RyaW5nIj09dHlwZW9mIHQmJihpPXQsdD1udWxsKSwianNvbiI9PT1pKXJldHVybiB0aGlzLl9sb2FkSlNPTk9iamVjdChlLHQpO2lmKCJjc3YiPT09aSlyZXR1cm4gdGhpcy5fbG9hZENTVlN0cmluZyhlLHQpO2lmKCJqc2FycmF5Ij09PWkpcmV0dXJuIHRoaXMuX2xvYWRKU0FycmF5KGUsdCk7dmFyIG49dGhpczt0aGlzLnBhcnNDb3VudHx8dGhpcy5jYWxsRXZlbnQoIm9uWExTIixbbixudWxsXSksdGhpcy54bWxzdGF0ZT0xLHRoaXMuWE1MTG9hZGVyKHtyZXNwb25zZVhNTDpkaHg0LmFqYXgucGFyc2UoZSl9LHQpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fYXR0YWNoQ2hpbGROb2RlPWZ1bmN0aW9uKGUsdCxpLG4sbyxyLGwscyxhLGQsaCl7ZCYmZC5wYXJlbnRPYmplY3QmJihlPWQucGFyZW50T2JqZWN0KSwwPT1lLlhNTGxvYWQmJnRoaXMuWE1Mc291cmNlJiYhdGhpcy5YTUxsb2FkaW5nV2FybmluZyYmKGUuWE1MbG9hZD0xLHRoaXMuX2xvYWREeW5YTUwoZS5pZCkpO3ZhciBjPWUuY2hpbGRzQ291bnQsdT1lLmNoaWxkTm9kZXM7aWYoaCYmaC50ci5wcmV2aW91c1NpYmxpbmcmJihoLnRyLnByZXZpb3VzU2libGluZy5wcmV2aW91c1NpYmxpbmc/ZD1oLnRyLnByZXZpb3VzU2libGluZy5ub2RlbTpzPXMucmVwbGFjZSgiVE9QIiwiIikrIixUT1AiKSxkKXt2YXIgcCxfO2ZvcihwPTA7Yz5wO3ArKylpZih1W3BdPT1kKXtmb3IoXz1jO18hPXA7Xy0tKXVbMStfXT11W19dO2JyZWFrfXArKyxjPXB9aWYocylmb3IodmFyIG09cy5zcGxpdCgiLCIpLGc9MDtnPG0ubGVuZ3RoO2crKylzd2l0Y2gobVtnXSl7Y2FzZSJUT1AiOmZvcihlLmNoaWxkc0NvdW50PjAmJihkPW5ldyBPYmplY3QsZC50cj1lLmNoaWxkTm9kZXNbMF0udHIucHJldmlvdXNTaWJsaW5nKSxlLl9oYXNfdG9wPSEwLHA9YztwPjA7cC0tKXVbcF09dVtwLTFdO2M9MH12YXIgZjsoZj10aGlzLl9pZHB1bGxbdF0pJiYtMT09Zi5zcGFufHwoZj11W2NdPW5ldyBkaHRtbFhUcmVlSXRlbU9iamVjdCh0LGksZSx0aGlzLG4sMSksdD11W2NdLmlkLGUuY2hpbGRzQ291bnQrKyksZi5odG1sTm9kZXx8KGYubGFiZWw9aSxmLmh0bWxOb2RlPXRoaXMuX2NyZWF0ZUl0ZW0odGhpcy5jaGVja0JveE9mZj8xOjAsZiksZi5odG1sTm9kZS5vYmpCZWxvbmc9ZiksbyYmKGYuaW1hZ2VzWzBdPW8pLHImJihmLmltYWdlc1sxXT1yKSxsJiYoZi5pbWFnZXNbMl09bCk7dmFyIGI9dGhpcy5fZHJhd05ld1RyKGYuaHRtbE5vZGUpO2lmKCh0aGlzLlhNTGxvYWRpbmdXYXJuaW5nfHx0aGlzLl9oQWRJKSYmKGYuaHRtbE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnN0eWxlLmRpc3BsYXk9Im5vbmUiKSxkJiZkLnRyJiZkLnRyLm5leHRTaWJsaW5nP2UuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5pbnNlcnRCZWZvcmUoYixkLnRyLm5leHRTaWJsaW5nKTp0aGlzLnBhcnNpbmdPbj09ZS5pZD90aGlzLnBhcnNlZEFycmF5W3RoaXMucGFyc2VkQXJyYXkubGVuZ3RoXT1iOmUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5hcHBlbmRDaGlsZChiKSxkJiYhZC5zcGFuJiYoZD1udWxsKSx0aGlzLlhNTHNvdXJjZSYmKGEmJjAhPWE/Zi5YTUxsb2FkPTA6Zi5YTUxsb2FkPTEpLGYudHI9YixiLm5vZGVtPWYsMD09ZS5pdGVtSWQmJihiLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lPSJoaWRkZW5Sb3ciKSwoZS5fcl9sb2dpY3x8dGhpcy5fZnJidHIpJiZ0aGlzLl9zZXRTcmMoZi5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLHRoaXMuaW1QYXRoK3RoaXMucmFkaW9BcnJheVswXSkscylmb3IodmFyIG09cy5zcGxpdCgiLCIpLGc9MDtnPG0ubGVuZ3RoO2crKylzd2l0Y2gobVtnXSl7Y2FzZSJTRUxFQ1QiOnRoaXMuc2VsZWN0SXRlbSh0LCExKTticmVhaztjYXNlIkNBTEwiOnRoaXMuc2VsZWN0SXRlbSh0LCEwKTticmVhaztjYXNlIkNISUxEIjpmLlhNTGxvYWQ9MDticmVhaztjYXNlIkNIRUNLRUQiOnRoaXMuWE1MbG9hZGluZ1dhcm5pbmc/dGhpcy5zZXRDaGVja0xpc3QrPXRoaXMuZGxtdHIrdDp0aGlzLnNldENoZWNrKHQsMSk7YnJlYWs7Y2FzZSJIQ0hFQ0tFRCI6dGhpcy5fc2V0Q2hlY2soZiwidW5zdXJlIik7YnJlYWs7Y2FzZSJPUEVOIjpmLm9wZW5NZT0xfWlmKCF0aGlzLlhNTGxvYWRpbmdXYXJuaW5nJiYodGhpcy5fZ2V0T3BlblN0YXRlKGUpPDAmJiF0aGlzLl9oQWRJJiZ0aGlzLm9wZW5JdGVtKGUuaWQpLGQmJih0aGlzLl9jb3JyZWN0UGx1cyhkKSx0aGlzLl9jb3JyZWN0TGluZShkKSksdGhpcy5fY29ycmVjdFBsdXMoZSksdGhpcy5fY29ycmVjdExpbmUoZSksdGhpcy5fY29ycmVjdFBsdXMoZiksZS5jaGlsZHNDb3VudD49MiYmKHRoaXMuX2NvcnJlY3RQbHVzKHVbZS5jaGlsZHNDb3VudC0yXSksdGhpcy5fY29ycmVjdExpbmUodVtlLmNoaWxkc0NvdW50LTJdKSksMiE9ZS5jaGlsZHNDb3VudCYmdGhpcy5fY29ycmVjdFBsdXModVswXSksdGhpcy50c2NoZWNrJiZ0aGlzLl9jb3JyZWN0Q2hlY2tTdGF0ZXMoZSksdGhpcy5fb25yYWRoKSlpZigxPT10aGlzLnhtbHN0YXRlKXt2YXIgdj10aGlzLm9uWExFO3RoaXMub25YTEU9ZnVuY3Rpb24oZSl7dGhpcy5fb25yYWRoKHQpLHYmJnYoZSl9fWVsc2UgdGhpcy5fb25yYWRoKHQpO3JldHVybiBmfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fcGFyc2VJdGVtPWZ1bmN0aW9uKGUsdCxpLG4pe3ZhciBvO2lmKHRoaXMuX3NybmQmJighdGhpcy5faWRwdWxsW289ZS5nZXQoImlkIildfHwhdGhpcy5faWRwdWxsW29dLnNwYW4pKXJldHVybiB2b2lkIHRoaXMuX2FkZEl0ZW1TUk5EKHQuaWQsbyxlKTt2YXIgcj1lLmdldF9hbGwoKTtpZigib2JqZWN0Ij09dHlwZW9mIHRoaXMud2FpdFVwZGF0ZVhNTCYmIXRoaXMud2FpdFVwZGF0ZVhNTFtyLmlkXSlyZXR1cm4gdm9pZCB0aGlzLl9wYXJzZShlLHIuaWQsMSk7bnVsbCE9PXIudGV4dCYmInVuZGVmaW5lZCIhPXR5cGVvZiByLnRleHR8fChyLnRleHQ9ZS5zdWIoIml0ZW10ZXh0Iiksci50ZXh0JiYoci50ZXh0PXIudGV4dC5jb250ZW50KCkpKTt2YXIgbD1bXTtpZihyLnNlbGVjdCYmbC5wdXNoKCJTRUxFQ1QiKSxyLnRvcCYmbC5wdXNoKCJUT1AiKSxyLmNhbGwmJih0aGlzLm5vZGVBc2tpbmdDYWxsPXIuaWQpLC0xPT1yLmNoZWNrZWQ/bC5wdXNoKCJIQ0hFQ0tFRCIpOnIuY2hlY2tlZCYmbC5wdXNoKCJDSEVDS0VEIiksci5vcGVuJiZsLnB1c2goIk9QRU4iKSx0aGlzLndhaXRVcGRhdGVYTUwpaWYodGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChyLmlkKSl2YXIgcz10aGlzLnVwZGF0ZUl0ZW0oci5pZCxyLnRleHQsci5pbTAsci5pbTEsci5pbTIsci5jaGVja2VkLHIuY2hpbGQpO2Vsc2V7MD09dGhpcy5ucGw/bC5wdXNoKCJUT1AiKTppPXQuY2hpbGROb2Rlc1t0aGlzLm5wbF07dmFyIHM9dGhpcy5fYXR0YWNoQ2hpbGROb2RlKHQsci5pZCxyLnRleHQsMCxyLmltMCxyLmltMSxyLmltMixsLmpvaW4oIiwiKSxyLmNoaWxkLDAsaSk7ci5pZD1zLmlkLGk9bnVsbH1lbHNlIHZhciBzPXRoaXMuX2F0dGFjaENoaWxkTm9kZSh0LHIuaWQsci50ZXh0LDAsci5pbTAsci5pbTEsci5pbTIsbC5qb2luKCIsIiksci5jaGlsZCxufHwwLGkpO2lmKHIudG9vbHRpcCYmKHMuc3Bhbi5wYXJlbnROb2RlLnBhcmVudE5vZGUudGl0bGU9ci50b29sdGlwKSxyLnN0eWxlJiYocy5zcGFuLnN0eWxlLmNzc1RleHQ/cy5zcGFuLnN0eWxlLmNzc1RleHQrPSI7IityLnN0eWxlOnMuc3Bhbi5zZXRBdHRyaWJ1dGUoInN0eWxlIixzLnNwYW4uZ2V0QXR0cmlidXRlKCJzdHlsZSIpKyI7ICIrci5zdHlsZSkpLHIucmFkaW8mJihzLl9yX2xvZ2ljPSEwKSxyLm5vY2hlY2tib3gpe3ZhciBhPXMuc3Bhbi5wYXJlbnROb2RlLnByZXZpb3VzU2libGluZy5wcmV2aW91c1NpYmxpbmc7YS5zdHlsZS5kaXNwbGF5PSJub25lIixzLm5vY2hlY2tib3g9ITB9ci5kaXNhYmxlZCYmKG51bGwhPXIuY2hlY2tlZCYmdGhpcy5fc2V0Q2hlY2socyxyLmNoZWNrZWQpLHRoaXMuZGlzYWJsZUNoZWNrYm94KHMsMSkpLHMuX2FjYz1yLmNoaWxkfHwwLHRoaXMucGFyc2VyRXh0ZW5zaW9uJiZ0aGlzLnBhcnNlckV4dGVuc2lvbi5fcGFyc2VFeHRlbnNpb24uY2FsbCh0aGlzLGUscix0P3QuaWQ6MCksdGhpcy5zZXRJdGVtQ29sb3IocyxyLmFDb2wsci5zQ29sKSwiMSI9PXIubG9ja2VkJiZ0aGlzLmxvY2tJdGVtKHMuaWQsITAsITApLChyLmltd2lkdGh8fHIuaW1oZWlnaHQpJiZ0aGlzLnNldEljb25TaXplKHIuaW13aWR0aCxyLmltaGVpZ2h0LHMpLCIwIiE9ci5jbG9zZWFibGUmJiIxIiE9ci5jbG9zZWFibGV8fHRoaXMuc2V0SXRlbUNsb3NlYWJsZShzLHIuY2xvc2VhYmxlKTt2YXIgZD0iIjtyLnRvcG9mZnNldCYmdGhpcy5zZXRJdGVtVG9wT2Zmc2V0KHMsci50b3BvZmZzZXQpLHRoaXMuc2xvd1BhcnNlJiYib2JqZWN0IiE9dHlwZW9mIHRoaXMud2FpdFVwZGF0ZVhNTD8oIXMuY2hpbGRzQ291bnQmJmUuc3ViX2V4aXN0cygiaXRlbSIpJiYocy51blBhcnNlZD1lLmNsb25lKCkpLGUuZWFjaCgidXNlcmRhdGEiLGZ1bmN0aW9uKGUpe3RoaXMuc2V0VXNlckRhdGEoci5pZCxlLmdldCgibmFtZSIpLGUuY29udGVudCgpKX0sdGhpcykpOmUuc3ViX2V4aXN0cygiaXRlbSIpJiYoZD10aGlzLl9wYXJzZShlLHIuaWQsMSkpLCIiIT1kJiYodGhpcy5ub2RlQXNraW5nQ2FsbD1kKSxlLmVhY2goInVzZXJkYXRhIixmdW5jdGlvbih0KXt0aGlzLnNldFVzZXJEYXRhKGUuZ2V0KCJpZCIpLHQuZ2V0KCJuYW1lIiksdC5jb250ZW50KCkpfSx0aGlzKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX3BhcnNlPWZ1bmN0aW9uKGUsdCxpLG4pe2lmKHRoaXMuX3NybmQmJiF0aGlzLnBhcmVudE9iamVjdC5vZmZzZXRIZWlnaHQpe3ZhciBvPXRoaXM7cmV0dXJuIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7by5fcGFyc2UoZSx0LGksbil9LDEwMCl9aWYoZS5leGlzdHMoKSl7aWYodGhpcy5za2lwTG9jaz0hMCwhdCl7dD1lLmdldCgiaWQiKSx0aGlzLl9keW5EZWxldGVCcmFuY2hlc1t0XSYmKHRoaXMuZGVsZXRlQ2hpbGRJdGVtcyh0KSx0aGlzLl9keW5EZWxldGVCcmFuY2hlc1t0XS0tLHRoaXMuX2R5bkRlbGV0ZUJyYW5jaGVzW3RdfHxkZWxldGUgdGhpcy5fZHluRGVsZXRlQnJhbmNoZXNbdF0pO3ZhciByPWUuZ2V0KCJkaHhfc2VjdXJpdHkiKTtyJiYoZGh0bWx4LnNlY3VyaXR5X2tleT1yKSxlLmdldCgicmFkaW8iKSYmKHRoaXMuaHRtbE5vZGUuX3JfbG9naWM9ITApLHRoaXMucGFyc2luZ09uPXQsdGhpcy5wYXJzZWRBcnJheT1uZXcgQXJyYXksdGhpcy5zZXRDaGVja0xpc3Q9IiIsdGhpcy5ub2RlQXNraW5nQ2FsbD0iIn12YXIgbD10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKHQpO2lmKCFsKXJldHVybiBkaHg0LmNhbGxFdmVudCgib25EYXRhU3RydWN0dXJlRXJyb3IiLFsiWE1MIHJlZmVycyB0byBub3QgZXhpc3RpbmcgcGFyZW50Il0pO2lmKHRoaXMucGFyc0NvdW50PXRoaXMucGFyc0NvdW50P3RoaXMucGFyc0NvdW50KzE6MSx0aGlzLlhNTGxvYWRpbmdXYXJuaW5nPTEsIWwuY2hpbGRzQ291bnR8fG58fHRoaXMuX2Vkc2Jwc3x8bC5faGFzX3RvcCl2YXIgcz0wO2Vsc2UgdmFyIHM9MDtpZih0aGlzLm5wbD0wLGUuZWFjaCgiaXRlbSIsZnVuY3Rpb24obixvKXtyZXR1cm4gbC5YTUxsb2FkPTEsdGhpcy5fcGFyc2VJdGVtKG4sbCwwLHMpLHRoaXMuX2Vkc2JwcyYmdGhpcy5ucGw9PXRoaXMuX2Vkc2Jwc0M/KHRoaXMuX2Rpc3RyaWJ1dGVkU3RhcnQoZSxvKzEsdCxpLGwuY2hpbGRzQ291bnQpLC0xKTp2b2lkIHRoaXMubnBsKyt9LHRoaXMsbiksIWkpe2lmKGUuZWFjaCgidXNlcmRhdGEiLGZ1bmN0aW9uKHQpe3RoaXMuc2V0VXNlckRhdGEoZS5nZXQoImlkIiksdC5nZXQoIm5hbWUiKSx0LmNvbnRlbnQoKSl9LHRoaXMpLGwuWE1MbG9hZD0xLHRoaXMud2FpdFVwZGF0ZVhNTCl7dGhpcy53YWl0VXBkYXRlWE1MPSExO2Zvcih2YXIgYT1sLmNoaWxkc0NvdW50LTE7YT49MDthLS0pbC5jaGlsZE5vZGVzW2FdLl9kbWFyayYmdGhpcy5kZWxldGVJdGVtKGwuY2hpbGROb2Rlc1thXS5pZCl9Zm9yKHZhciBhPSh0aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKHRoaXMucGFyc2luZ09uKSwwKTthPHRoaXMucGFyc2VkQXJyYXkubGVuZ3RoO2ErKylsLmh0bWxOb2RlLmNoaWxkTm9kZXNbMF0uYXBwZW5kQ2hpbGQodGhpcy5wYXJzZWRBcnJheVthXSk7dGhpcy5wYXJzZWRBcnJheT1bXSx0aGlzLmxhc3RMb2FkZWRYTUxJZD10LHRoaXMuWE1MbG9hZGluZ1dhcm5pbmc9MDtmb3IodmFyIGQ9dGhpcy5zZXRDaGVja0xpc3Quc3BsaXQodGhpcy5kbG10ciksaD0wO2g8ZC5sZW5ndGg7aCsrKWRbaF0mJnRoaXMuc2V0Q2hlY2soZFtoXSwxKTt0aGlzLlhNTHNvdXJjZSYmdGhpcy50c2NoZWNrJiZ0aGlzLnNtY2hlY2smJmwuaWQhPXRoaXMucm9vdElkJiYoMD09PWwuY2hlY2tzdGF0ZT90aGlzLl9zZXRTdWJDaGVja2VkKDAsbCk6MT09PWwuY2hlY2tzdGF0ZSYmdGhpcy5fc2V0U3ViQ2hlY2tlZCgxLGwpKSx0aGlzLl9yZWRyYXdGcm9tKHRoaXMsbnVsbCxuKSxlLmdldCgib3JkZXIiKSYmIm5vbmUiIT1lLmdldCgib3JkZXIiKSYmdGhpcy5fcmVvcmRlckJyYW5jaChsLGUuZ2V0KCJvcmRlciIpLCEwKSwiIiE9dGhpcy5ub2RlQXNraW5nQ2FsbCYmdGhpcy5jYWxsRXZlbnQoIm9uQ2xpY2siLFt0aGlzLm5vZGVBc2tpbmdDYWxsLHRoaXMuZ2V0U2VsZWN0ZWRJdGVtSWQoKV0pLHRoaXMuX2JyYW5jaFVwZGF0ZSYmdGhpcy5fYnJhbmNoVXBkYXRlTmV4dChlKX1pZigxPT10aGlzLnBhcnNDb3VudCl7aWYodGhpcy5wYXJzaW5nT249bnVsbCx0aGlzLl9zcm5kJiZsLmlkIT10aGlzLnJvb3RJZCYmKHRoaXMucHJlcGFyZVNSKGwuaWQpLHRoaXMuWE1Mc291cmNlJiZ0aGlzLm9wZW5JdGVtKGwuaWQpKSxlLnRocm91Z2goIml0ZW0iLCJvcGVuIixudWxsLGZ1bmN0aW9uKGUpe3RoaXMub3Blbkl0ZW0oZS5nZXQoImlkIikpfSx0aGlzKSwhdGhpcy5fZWRzYnBzfHwhdGhpcy5fZWRzYnBzQS5sZW5ndGgpe3ZhciBjPXRoaXM7d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtjLmNhbGxFdmVudCgib25YTEUiLFtjLHRdKX0sMSksdGhpcy54bWxzdGF0ZT0wfXRoaXMuc2tpcExvY2s9ITF9dGhpcy5wYXJzQ291bnQtLTt2YXIgYz10aGlzO3JldHVybiB0aGlzLl9lZHNicHMmJndpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy5fZGlzdHJpYnV0ZWRTdGVwKHQpfSx0aGlzLl9lZHNicHNEKSwhaSYmdGhpcy5vblhMRSYmdGhpcy5vblhMRSh0aGlzLHQpLHRoaXMubm9kZUFza2luZ0NhbGx9fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fcmVkcmF3RnJvbT1mdW5jdGlvbihlLHQsaSxuKXtpZih0KW89dDtlbHNle3ZhciBvPWUuX2dsb2JhbElkU3RvcmFnZUZpbmQoZS5sYXN0TG9hZGVkWE1MSWQpO2lmKGUubGFzdExvYWRlZFhNTElkPS0xLCFvKXJldHVybiAwfWZvcih2YXIgcj0wLGw9aT9pLTE6MDtsPG8uY2hpbGRzQ291bnQ7bCsrKWlmKHRoaXMuX2JyYW5jaFVwZGF0ZSYmMSE9dGhpcy5fZ2V0T3BlblN0YXRlKG8pfHx0JiYxIT1ufHwoby5jaGlsZE5vZGVzW2xdLmh0bWxOb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5zdHlsZS5kaXNwbGF5PSIiKSwxPT1vLmNoaWxkTm9kZXNbbF0ub3Blbk1lJiYodGhpcy5fb3Blbkl0ZW0oby5jaGlsZE5vZGVzW2xdKSxvLmNoaWxkTm9kZXNbbF0ub3Blbk1lPTApLGUuX3JlZHJhd0Zyb20oZSxvLmNoaWxkTm9kZXNbbF0pLG51bGwhPXRoaXMuY2hpbGRDYWxjKXtpZigoby5jaGlsZE5vZGVzW2xdLnVuUGFyc2VkfHwhby5jaGlsZE5vZGVzW2xdLlhNTGxvYWQmJnRoaXMuWE1Mc291cmNlKSYmKG8uY2hpbGROb2Rlc1tsXS5fYWNjP28uY2hpbGROb2Rlc1tsXS5zcGFuLmlubmVySFRNTD1vLmNoaWxkTm9kZXNbbF0ubGFiZWwrdGhpcy5odG1sY0Erby5jaGlsZE5vZGVzW2xdLl9hY2MrdGhpcy5odG1sY0I6by5jaGlsZE5vZGVzW2xdLnNwYW4uaW5uZXJIVE1MPW8uY2hpbGROb2Rlc1tsXS5sYWJlbCksby5jaGlsZE5vZGVzW2xdLmNoaWxkTm9kZXMubGVuZ3RoJiZ0aGlzLmNoaWxkQ2FsYyl7aWYoMT09dGhpcy5jaGlsZENhbGMmJihvLmNoaWxkTm9kZXNbbF0uc3Bhbi5pbm5lckhUTUw9by5jaGlsZE5vZGVzW2xdLmxhYmVsK3RoaXMuaHRtbGNBK28uY2hpbGROb2Rlc1tsXS5jaGlsZHNDb3VudCt0aGlzLmh0bWxjQiksMj09dGhpcy5jaGlsZENhbGMpe3ZhciBzPW8uY2hpbGROb2Rlc1tsXS5jaGlsZHNDb3VudC0oby5jaGlsZE5vZGVzW2xdLnB1cmVDaGlsZHN8fDApO3MmJihvLmNoaWxkTm9kZXNbbF0uc3Bhbi5pbm5lckhUTUw9by5jaGlsZE5vZGVzW2xdLmxhYmVsK3RoaXMuaHRtbGNBK3MrdGhpcy5odG1sY0IpLG8ucHVyZUNoaWxkcz9vLnB1cmVDaGlsZHMrKzpvLnB1cmVDaGlsZHM9MX1pZigzPT10aGlzLmNoaWxkQ2FsYyYmKG8uY2hpbGROb2Rlc1tsXS5zcGFuLmlubmVySFRNTD1vLmNoaWxkTm9kZXNbbF0ubGFiZWwrdGhpcy5odG1sY0Erby5jaGlsZE5vZGVzW2xdLl9hY2MrdGhpcy5odG1sY0IpLDQ9PXRoaXMuY2hpbGRDYWxjKXt2YXIgcz1vLmNoaWxkTm9kZXNbbF0uX2FjYztzJiYoby5jaGlsZE5vZGVzW2xdLnNwYW4uaW5uZXJIVE1MPW8uY2hpbGROb2Rlc1tsXS5sYWJlbCt0aGlzLmh0bWxjQStzK3RoaXMuaHRtbGNCKX19ZWxzZSA0PT10aGlzLmNoaWxkQ2FsYyYmcisrO3IrPW8uY2hpbGROb2Rlc1tsXS5fYWNjLDM9PXRoaXMuY2hpbGRDYWxjJiZyKyt9by51blBhcnNlZHx8IW8uWE1MbG9hZCYmdGhpcy5YTUxzb3VyY2V8fChvLl9hY2M9ciksZS5fY29ycmVjdExpbmUobyksZS5fY29ycmVjdFBsdXMobyksdGhpcy5jaGlsZENhbGMmJiF0JiZlLl9maXhDaGlsZENvdW50TGFiZWwobyl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9jcmVhdGVTZWxmPWZ1bmN0aW9uKCl7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7cmV0dXJuIGUuY2xhc3NOYW1lPSJjb250YWluZXJUYWJsZVN0eWxlIixlLnN0eWxlLndpZHRoPXRoaXMud2lkdGgsZS5zdHlsZS5oZWlnaHQ9dGhpcy5oZWlnaHQsdGhpcy5wYXJlbnRPYmplY3QuYXBwZW5kQ2hpbGQoZSksZX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX3hjbG9zZUFsbD1mdW5jdGlvbihlKXtpZighZS51blBhcnNlZCl7aWYodGhpcy5yb290SWQhPWUuaWQpe2lmKCFlLmh0bWxOb2RlKXJldHVybjtmb3IodmFyIHQ9ZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMsaT10Lmxlbmd0aCxuPTE7aT5uO24rKyl0W25dLnN0eWxlLmRpc3BsYXk9Im5vbmUiO3RoaXMuX2NvcnJlY3RQbHVzKGUpfWZvcih2YXIgbj0wO248ZS5jaGlsZHNDb3VudDtuKyspZS5jaGlsZE5vZGVzW25dLmNoaWxkc0NvdW50JiZ0aGlzLl94Y2xvc2VBbGwoZS5jaGlsZE5vZGVzW25dKX19LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl94b3BlbkFsbD1mdW5jdGlvbihlKXt0aGlzLl9IaWRlU2hvdyhlLDIpO2Zvcih2YXIgdD0wO3Q8ZS5jaGlsZHNDb3VudDt0KyspdGhpcy5feG9wZW5BbGwoZS5jaGlsZE5vZGVzW3RdKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2NvcnJlY3RQbHVzPWZ1bmN0aW9uKGUpe2lmKGUuaHRtbE5vZGUpe3ZhciB0PWUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubGFzdENoaWxkLGk9ZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1syXS5jaGlsZE5vZGVzWzBdLG49dGhpcy5saW5lQXJyYXk7aWYodGhpcy5YTUxzb3VyY2UmJiFlLlhNTGxvYWQpe3ZhciBuPXRoaXMucGx1c0FycmF5O2lmKHRoaXMuX3NldFNyYyhpLHRoaXMuaWNvblVSTCtlLmltYWdlc1syXSksdGhpcy5fdHh0aW1nKXJldHVybiB0LmlubmVySFRNTD0iWytdIn1lbHNlIGlmKGUuY2hpbGRzQ291bnR8fGUudW5QYXJzZWQpaWYoZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0mJiJub25lIiE9ZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0uc3R5bGUuZGlzcGxheSl7aWYoIWUud3NpZ24pdmFyIG49dGhpcy5taW51c0FycmF5O2lmKHRoaXMuX3NldFNyYyhpLHRoaXMuaWNvblVSTCtlLmltYWdlc1sxXSksdGhpcy5fdHh0aW1nKXJldHVybiB0LmlubmVySFRNTD0iWy1dIn1lbHNle2lmKCFlLndzaWduKXZhciBuPXRoaXMucGx1c0FycmF5O2lmKHRoaXMuX3NldFNyYyhpLHRoaXMuaWNvblVSTCtlLmltYWdlc1syXSksdGhpcy5fdHh0aW1nKXJldHVybiB0LmlubmVySFRNTD0iWytdIn1lbHNlIHRoaXMuX3NldFNyYyhpLHRoaXMuaWNvblVSTCtlLmltYWdlc1swXSk7dmFyIG89MjtlLnRyZWVOb2QudHJlZUxpbmVzT24/KGUucGFyZW50T2JqZWN0JiYobz10aGlzLl9nZXRDb3VudFN0YXR1cyhlLmlkLGUucGFyZW50T2JqZWN0KSksdGhpcy5fc2V0U3JjKHQsdGhpcy5pbVBhdGgrbltvXSkpOnRoaXMuX3NldFNyYyh0LHRoaXMuaW1QYXRoK25bM10pfX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2NvcnJlY3RMaW5lPWZ1bmN0aW9uKGUpe2lmKGUuaHRtbE5vZGUpe3ZhciB0PWUucGFyZW50T2JqZWN0O2lmKHQpaWYoMCE9dGhpcy5fZ2V0TGluZVN0YXR1cyhlLmlkLHQpJiZ0aGlzLnRyZWVMaW5lc09uKWZvcih2YXIgaT0xO2k8PWUuY2hpbGRzQ291bnQmJmUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzW2ldO2krKyllLmh0bWxOb2RlLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1tpXS5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmRJbWFnZT0idXJsKCIrdGhpcy5pbVBhdGgrdGhpcy5saW5lQXJyYXlbNV0rIikiLGUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzW2ldLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZFJlcGVhdD0icmVwZWF0LXkiO2Vsc2UgZm9yKHZhciBpPTE7aTw9ZS5jaGlsZHNDb3VudCYmZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbaV07aSsrKWUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzW2ldLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZEltYWdlPSIiLGUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzW2ldLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZFJlcGVhdD0iIn19LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9nZXRMaW5lU3RhdHVzPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQuY2hpbGROb2Rlc1t0LmNoaWxkc0NvdW50LTFdLmlkPT1lPzA6MX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX0hpZGVTaG93PWZ1bmN0aW9uKGUsdCl7aWYoIXRoaXMuX2xvY2tlcnx8dGhpcy5za2lwTG9ja3x8IXRoaXMuX2xvY2tlcltlLmlkXSl7aWYodGhpcy5YTUxzb3VyY2UmJiFlLlhNTGxvYWQpe2lmKDE9PXQpcmV0dXJuO3JldHVybiBlLlhNTGxvYWQ9MSx2b2lkIHRoaXMuX2xvYWREeW5YTUwoZS5pZCl9ZS51blBhcnNlZCYmdGhpcy5yZVBhcnNlKGUpO3ZhciBpPWUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLG49aS5sZW5ndGg7aWYobj4xKXsibm9uZSI9PWlbMV0uc3R5bGUuZGlzcGxheSYmMSE9dHx8Mj09dD9ub2Rlc3R5bGU9IiI6KHRoaXMuYWxsVHJlZS5jaGlsZE5vZGVzWzBdLmJvcmRlcj0iMSIsdGhpcy5hbGxUcmVlLmNoaWxkTm9kZXNbMF0uYm9yZGVyPSIwIixub2Rlc3R5bGU9Im5vbmUiKTtmb3IodmFyIG89MTtuPm87bysrKWlbb10uc3R5bGUuZGlzcGxheT1ub2Rlc3R5bGV9dGhpcy5fY29ycmVjdFBsdXMoZSl9fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fZ2V0T3BlblN0YXRlPWZ1bmN0aW9uKGUpe2lmKCFlLmh0bWxOb2RlKXJldHVybiAwO3ZhciB0PWUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzO3JldHVybiB0Lmxlbmd0aDw9MT8wOiJub25lIiE9dFsxXS5zdHlsZS5kaXNwbGF5PzE6LTF9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLm9uUm93Q2xpY2syPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5wYXJlbnRPYmplY3QudHJlZU5vZDtyZXR1cm4gZS5jYWxsRXZlbnQoIm9uRGJsQ2xpY2siLFt0aGlzLnBhcmVudE9iamVjdC5pZCxlXSk/KHRoaXMucGFyZW50T2JqZWN0LmNsb3NlYmxlJiYiMCIhPXRoaXMucGFyZW50T2JqZWN0LmNsb3NlYmxlP2UuX0hpZGVTaG93KHRoaXMucGFyZW50T2JqZWN0KTplLl9IaWRlU2hvdyh0aGlzLnBhcmVudE9iamVjdCwyKSxlLmNoZWNrRXZlbnQoIm9uT3BlbkVuZCIpJiYoZS54bWxzdGF0ZT8oZS5fb2llX29uWExFLnB1c2goZS5vblhMRSksZS5vblhMRT1lLl9lcG5GSGUpOmUuY2FsbEV2ZW50KCJvbk9wZW5FbmQiLFt0aGlzLnBhcmVudE9iamVjdC5pZCxlLl9nZXRPcGVuU3RhdGUodGhpcy5wYXJlbnRPYmplY3QpXSkpLCExKTohMX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUub25Sb3dDbGljaz1mdW5jdGlvbigpe3ZhciBlPXRoaXMucGFyZW50T2JqZWN0LnRyZWVOb2Q7cmV0dXJuIGUuY2FsbEV2ZW50KCJvbk9wZW5TdGFydCIsW3RoaXMucGFyZW50T2JqZWN0LmlkLGUuX2dldE9wZW5TdGF0ZSh0aGlzLnBhcmVudE9iamVjdCldKT8odGhpcy5wYXJlbnRPYmplY3QuY2xvc2VibGUmJiIwIiE9dGhpcy5wYXJlbnRPYmplY3QuY2xvc2VibGU/ZS5fSGlkZVNob3codGhpcy5wYXJlbnRPYmplY3QpOmUuX0hpZGVTaG93KHRoaXMucGFyZW50T2JqZWN0LDIpLHZvaWQoZS5jaGVja0V2ZW50KCJvbk9wZW5FbmQiKSYmKGUueG1sc3RhdGU/KGUuX29pZV9vblhMRS5wdXNoKGUub25YTEUpLGUub25YTEU9ZS5fZXBuRkhlKTplLmNhbGxFdmVudCgib25PcGVuRW5kIixbdGhpcy5wYXJlbnRPYmplY3QuaWQsZS5fZ2V0T3BlblN0YXRlKHRoaXMucGFyZW50T2JqZWN0KV0pKSkpOjB9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmdldFNlbGVjdGVkSXRlbUlkPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPW5ldyBBcnJheSx0PTA7dDx0aGlzLl9zZWxlY3RlZC5sZW5ndGg7dCsrKWVbdF09dGhpcy5fc2VsZWN0ZWRbdF0uaWQ7cmV0dXJuIGUuam9pbih0aGlzLmRsbXRyKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX3NlbGVjdEl0ZW09ZnVuY3Rpb24oZSx0KXtpZih0aGlzLmNoZWNrRXZlbnQoIm9uU2VsZWN0IikmJih0aGlzLl9vblNTQ0ZvbGQ9dGhpcy5nZXRTZWxlY3RlZEl0ZW1JZCgpKSx0aGlzLl9hbXNlbCYmdCYmKHQuY3RybEtleXx8dC5tZXRhS2V5fHx0LnNoaWZ0S2V5KXx8dGhpcy5fdW5zZWxlY3RJdGVtcygpLGUuaV9zZWwmJnRoaXMuX2Ftc2VsJiZ0JiYodC5jdHJsS2V5fHx0Lm1ldGFLZXkpKXRoaXMuX3Vuc2VsZWN0SXRlbShlKTtlbHNlIGlmKCEoZS5pX3NlbHx8dGhpcy5fYW1zZWxTJiYwIT10aGlzLl9zZWxlY3RlZC5sZW5ndGgmJnRoaXMuX3NlbGVjdGVkWzBdLnBhcmVudE9iamVjdCE9ZS5wYXJlbnRPYmplY3QpKWlmKHRoaXMuX2Ftc2VsJiZ0JiZ0LnNoaWZ0S2V5JiYwIT10aGlzLl9zZWxlY3RlZC5sZW5ndGgmJnRoaXMuX3NlbGVjdGVkW3RoaXMuX3NlbGVjdGVkLmxlbmd0aC0xXS5wYXJlbnRPYmplY3Q9PWUucGFyZW50T2JqZWN0KXt2YXIgaT10aGlzLl9nZXRJbmRleCh0aGlzLl9zZWxlY3RlZFt0aGlzLl9zZWxlY3RlZC5sZW5ndGgtMV0pLG49dGhpcy5fZ2V0SW5kZXgoZSk7aWYoaT5uKXt2YXIgbz1pO2k9bixuPW99Zm9yKHZhciByPWk7bj49cjtyKyspZS5wYXJlbnRPYmplY3QuY2hpbGROb2Rlc1tyXS5pX3NlbHx8dGhpcy5fbWFya0l0ZW0oZS5wYXJlbnRPYmplY3QuY2hpbGROb2Rlc1tyXSl9ZWxzZSB0aGlzLl9tYXJrSXRlbShlKTtpZih0aGlzLmNoZWNrRXZlbnQoIm9uU2VsZWN0Iikpe3ZhciBsPXRoaXMuZ2V0U2VsZWN0ZWRJdGVtSWQoKTtsIT10aGlzLl9vblNTQ0ZvbGQmJnRoaXMuY2FsbEV2ZW50KCJvblNlbGVjdCIsW2xdKX19LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9tYXJrSXRlbT1mdW5jdGlvbihlKXtlLnNjb2xvciYmKGUuc3Bhbi5zdHlsZS5jb2xvcj1lLnNjb2xvciksZS5zcGFuLmNsYXNzTmFtZT0ic2VsZWN0ZWRUcmVlUm93IixlLnNwYW4ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTmFtZT0ic2VsZWN0ZWRUcmVlUm93RnVsbCIsZS5pX3NlbD0hMCx0aGlzLl9zZWxlY3RlZFt0aGlzLl9zZWxlY3RlZC5sZW5ndGhdPWV9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmdldEluZGV4QnlJZD1mdW5jdGlvbihlKXt2YXIgdD10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKGUpO3JldHVybiB0P3RoaXMuX2dldEluZGV4KHQpOm51bGx9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9nZXRJbmRleD1mdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5wYXJlbnRPYmplY3QsaT0wO2k8dC5jaGlsZHNDb3VudDtpKyspaWYodC5jaGlsZE5vZGVzW2ldPT1lKXJldHVybiBpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fdW5zZWxlY3RJdGVtPWZ1bmN0aW9uKGUpe2lmKGUmJmUuaV9zZWwpe2Uuc3Bhbi5jbGFzc05hbWU9InN0YW5kYXJ0VHJlZVJvdyIsZS5zcGFuLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc05hbWU9IiIsZS5hY29sb3ImJihlLnNwYW4uc3R5bGUuY29sb3I9ZS5hY29sb3IpLGUuaV9zZWw9ITE7Zm9yKHZhciB0PTA7dDx0aGlzLl9zZWxlY3RlZC5sZW5ndGg7dCsrKWlmKCF0aGlzLl9zZWxlY3RlZFt0XS5pX3NlbCl7dGhpcy5fc2VsZWN0ZWQuc3BsaWNlKHQsMSk7YnJlYWt9fX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX3Vuc2VsZWN0SXRlbXM9ZnVuY3Rpb24oKXtmb3IodmFyIGU9MDtlPHRoaXMuX3NlbGVjdGVkLmxlbmd0aDtlKyspe3ZhciB0PXRoaXMuX3NlbGVjdGVkW2VdO3Quc3Bhbi5jbGFzc05hbWU9InN0YW5kYXJ0VHJlZVJvdyIsdC5zcGFuLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc05hbWU9IiIsdC5hY29sb3ImJih0LnNwYW4uc3R5bGUuY29sb3I9dC5hY29sb3IpLHQuaV9zZWw9ITF9dGhpcy5fc2VsZWN0ZWQ9bmV3IEFycmF5fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5vblJvd1NlbGVjdD1mdW5jdGlvbihlLHQsaSl7ZT1lfHx3aW5kb3cuZXZlbnQ7dmFyIG49dGhpcy5wYXJlbnRPYmplY3Q7dCYmKG49dC5wYXJlbnRPYmplY3QpO3ZhciBvPW4udHJlZU5vZCxyPW8uZ2V0U2VsZWN0ZWRJdGVtSWQoKTtlJiZlLnNraXBVblNlbHx8by5fc2VsZWN0SXRlbShuLGUpLGl8fChuLmFjdGlvbkhhbmRsZXI/bi5hY3Rpb25IYW5kbGVyKG4uaWQscik6by5jYWxsRXZlbnQoIm9uQ2xpY2siLFtuLmlkLHJdKSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9jcmVhdGVJdGVtPWZ1bmN0aW9uKGUsdCxpKXt2YXIgbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpO24uY2VsbFNwYWNpbmc9MCxuLmNlbGxQYWRkaW5nPTAsbi5ib3JkZXI9MCx0aGlzLmhmTW9kZSYmKG4uc3R5bGUudGFibGVMYXlvdXQ9ImZpeGVkIiksbi5zdHlsZS5tYXJnaW49MCxuLnN0eWxlLnBhZGRpbmc9MDt2YXIgbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpLHI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHIiKSxsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7aWYobC5jbGFzc05hbWU9InN0YW5kYXJ0VHJlZUltYWdlIix0aGlzLl90eHRpbWcpe3ZhciBzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2wuYXBwZW5kQ2hpbGQocykscy5jbGFzc05hbWU9ImRoeF90cmVlX3RleHRTaWduIn1lbHNle3ZhciBzPXRoaXMuX2dldEltZyh0LmlkKTtzLmJvcmRlcj0iMCIsIklNRyI9PXMudGFnTmFtZSYmKHMuYWxpZ249ImFic21pZGRsZSIpLGwuYXBwZW5kQ2hpbGQocykscy5zdHlsZS5wYWRkaW5nPTAscy5zdHlsZS5tYXJnaW49MCxzLnN0eWxlLndpZHRoPXRoaXMuZGVmX2xpbmVfaW1nX3h9dmFyIGE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKSxkPXRoaXMuX2dldEltZyh0aGlzLmNCUk9mP3RoaXMucm9vdElkOnQuaWQpO2QuY2hlY2tlZD0wLHRoaXMuX3NldFNyYyhkLHRoaXMuaW1QYXRoK3RoaXMuY2hlY2tBcnJheVswXSksZC5zdHlsZS53aWR0aD0iMThweCIsZC5zdHlsZS5oZWlnaHQ9IjE4cHgiLGV8fChhLnN0eWxlLmRpc3BsYXk9Im5vbmUiKSxhLmFwcGVuZENoaWxkKGQpLHRoaXMuY0JST2Z8fCJJTUciIT1kLnRhZ05hbWV8fChkLmFsaWduPSJhYnNtaWRkbGUiKSxkLm9uY2xpY2s9dGhpcy5vbkNoZWNrQm94Q2xpY2ssZC50cmVlTm9kPXRoaXMsZC5wYXJlbnRPYmplY3Q9dCx3aW5kb3cuX0tIVE1McnY/YS53aWR0aD0iMTZweCI6YS53aWR0aD0iMjBweCI7dmFyIGg9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTtoLmNsYXNzTmFtZT0ic3RhbmRhcnRUcmVlSW1hZ2UiO3ZhciBjPXRoaXMuX2dldEltZyh0aGlzLnRpbWdlbj90LmlkOnRoaXMucm9vdElkKTtjLm9ubW91c2Vkb3duPXRoaXMuX3ByZXZlbnROc0RyYWcsYy5vbmRyYWdzdGFydD10aGlzLl9wcmV2ZW50TnNEcmFnLGMuYm9yZGVyPSIwIix0aGlzLl9haW1ncyYmKGMucGFyZW50T2JqZWN0PXQsCiJJTUciPT1jLnRhZ05hbWUmJihjLmFsaWduPSJhYnNtaWRkbGUiKSxjLm9uY2xpY2s9dGhpcy5vblJvd1NlbGVjdCksaXx8dGhpcy5fc2V0U3JjKGMsdGhpcy5pY29uVVJMK3RoaXMuaW1hZ2VBcnJheVswXSksaC5hcHBlbmRDaGlsZChjKSxjLnN0eWxlLnBhZGRpbmc9MCxjLnN0eWxlLm1hcmdpbj0wLHRoaXMudGltZ2VuPyhoLnN0eWxlLndpZHRoPWMuc3R5bGUud2lkdGg9dGhpcy5kZWZfaW1nX3gsYy5zdHlsZS5oZWlnaHQ9dGhpcy5kZWZfaW1nX3kpOihjLnN0eWxlLndpZHRoPSIwcHgiLGMuc3R5bGUuaGVpZ2h0PSIwcHgiLChfaXNPcGVyYXx8d2luZG93Ll9LSFRNTHJ2KSYmKGguc3R5bGUuZGlzcGxheT0ibm9uZSIpKTt2YXIgdT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpO3JldHVybiB1LmNsYXNzTmFtZT0iZGh4VGV4dENlbGwgc3RhbmRhcnRUcmVlUm93Iix0LnNwYW49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpLHQuc3Bhbi5jbGFzc05hbWU9InN0YW5kYXJ0VHJlZVJvdyIsdGhpcy5tbGl0ZW1zPyh0LnNwYW4uc3R5bGUud2lkdGg9dGhpcy5tbGl0ZW1zLHQuc3Bhbi5zdHlsZS5kaXNwbGF5PSJibG9jayIpOnUubm9XcmFwPSEwLGRoeDQuaXNJRTg/dS5zdHlsZS53aWR0aD0iOTk5OTlweCI6d2luZG93Ll9LSFRNTHJ2fHwodS5zdHlsZS53aWR0aD0iMTAwJSIpLHQuc3Bhbi5pbm5lckhUTUw9dC5sYWJlbCx1LmFwcGVuZENoaWxkKHQuc3BhbiksdS5wYXJlbnRPYmplY3Q9dCxsLnBhcmVudE9iamVjdD10LHUub25jbGljaz10aGlzLm9uUm93U2VsZWN0LGwub25jbGljaz10aGlzLm9uUm93Q2xpY2ssdS5vbmRibGNsaWNrPXRoaXMub25Sb3dDbGljazIsdGhpcy5ldHRpcCYmKHIudGl0bGU9dC5sYWJlbCksdGhpcy5kcmFnQW5kRHJvcE9mZiYmKHRoaXMuX2FpbWdzJiYodGhpcy5kcmFnZ2VyLmFkZERyYWdnYWJsZUl0ZW0oaCx0aGlzKSxoLnBhcmVudE9iamVjdD10KSx0aGlzLmRyYWdnZXIuYWRkRHJhZ2dhYmxlSXRlbSh1LHRoaXMpKSx0LnNwYW4uc3R5bGUucGFkZGluZ0xlZnQ9IjVweCIsdC5zcGFuLnN0eWxlLnBhZGRpbmdSaWdodD0iNXB4Iix1LnN0eWxlLnZlcnRpY2FsQWxpZ249IiIsdS5zdHlsZS5mb250U2l6ZT0iMTBwdCIsdS5zdHlsZS5jdXJzb3I9dGhpcy5zdHlsZV9wb2ludGVyLHIuYXBwZW5kQ2hpbGQobCksci5hcHBlbmRDaGlsZChhKSxyLmFwcGVuZENoaWxkKGgpLHIuYXBwZW5kQ2hpbGQodSksby5hcHBlbmRDaGlsZChyKSxuLmFwcGVuZENoaWxkKG8pLCh0aGlzLmVobHR8fHRoaXMuY2hlY2tFdmVudCgib25Nb3VzZUluIil8fHRoaXMuY2hlY2tFdmVudCgib25Nb3VzZU91dCIpKSYmKHIub25tb3VzZW1vdmU9dGhpcy5faXRlbU1vdXNlSW4scltfaXNJRT8ib25tb3VzZWxlYXZlIjoib25tb3VzZW91dCJdPXRoaXMuX2l0ZW1Nb3VzZU91dCksbn0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0T25SaWdodENsaWNrSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvblJpZ2h0Q2xpY2siLGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRPbkNsaWNrSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvbkNsaWNrIixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0T25TZWxlY3RTdGF0ZUNoYW5nZT1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvblNlbGVjdCIsZSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnNldFhNTEF1dG9Mb2FkaW5nPWZ1bmN0aW9uKGUpe3RoaXMuWE1Mc291cmNlPWV9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnNldE9uQ2hlY2tIYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMuYXR0YWNoRXZlbnQoIm9uQ2hlY2siLGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRPbk9wZW5IYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMuYXR0YWNoRXZlbnQoIm9uT3BlblN0YXJ0IixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0T25PcGVuU3RhcnRIYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMuYXR0YWNoRXZlbnQoIm9uT3BlblN0YXJ0IixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0T25PcGVuRW5kSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvbk9wZW5FbmQiLGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRPbkRibENsaWNrSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvbkRibENsaWNrIixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUub3BlbkFsbEl0ZW1zPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSk7cmV0dXJuIHQ/dm9pZCB0aGlzLl94b3BlbkFsbCh0KTowfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5nZXRPcGVuU3RhdGU9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChlKTtyZXR1cm4gdD90aGlzLl9nZXRPcGVuU3RhdGUodCk6IiJ9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmNsb3NlQWxsSXRlbXM9ZnVuY3Rpb24oZSl7ZT09PXdpbmRvdy51bmRlZmluZWQmJihlPXRoaXMucm9vdElkKTt2YXIgdD10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKGUpO3JldHVybiB0Pyh0aGlzLl94Y2xvc2VBbGwodCksdGhpcy5hbGxUcmVlLmNoaWxkTm9kZXNbMF0uYm9yZGVyPSIxIix2b2lkKHRoaXMuYWxsVHJlZS5jaGlsZE5vZGVzWzBdLmJvcmRlcj0iMCIpKTowfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRVc2VyRGF0YT1mdW5jdGlvbihlLHQsaSl7dmFyIG49dGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChlLDAsITApO24mJigiaGludCI9PXQmJihuLmh0bWxOb2RlLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS50aXRsZT1pKSwidW5kZWZpbmVkIj09dHlwZW9mIG4udXNlckRhdGFbInRfIit0XSYmKG4uX3VzZXJkYXRhbGlzdD9uLl91c2VyZGF0YWxpc3QrPSIsIit0Om4uX3VzZXJkYXRhbGlzdD10KSxuLnVzZXJEYXRhWyJ0XyIrdF09aSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmdldFVzZXJEYXRhPWZ1bmN0aW9uKGUsdCl7dmFyIGk9dGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChlLDAsITApO2lmKGkpcmV0dXJuIGkudXNlckRhdGFbInRfIit0XX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZ2V0SXRlbUNvbG9yPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSk7aWYoIXQpcmV0dXJuIDA7dmFyIGk9bmV3IE9iamVjdDtyZXR1cm4gdC5hY29sb3ImJihpLmFjb2xvcj10LmFjb2xvciksdC5zY29sb3ImJihpLnNjb2xvcj10LnNjb2xvciksaX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0SXRlbUNvbG9yPWZ1bmN0aW9uKGUsdCxpKXtpZihlJiZlLnNwYW4pdmFyIG49ZTtlbHNlIHZhciBuPXRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSk7cmV0dXJuIG4/KG4uaV9zZWw/KGl8fHQpJiYobi5zcGFuLnN0eWxlLmNvbG9yPWl8fHQpOnQmJihuLnNwYW4uc3R5bGUuY29sb3I9dCksaSYmKG4uc2NvbG9yPWkpLHQmJihuLmFjb2xvcj10KSx2b2lkIDApOjB9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnNldE9uTW91c2VJbkhhbmRsZXI9ZnVuY3Rpb24oZSl7dGhpcy5laGx0PSEwLHRoaXMuYXR0YWNoRXZlbnQoIm9uTW91c2VJbiIsZSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnNldE9uTW91c2VPdXRIYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMuZWhsdD0hMCx0aGlzLmF0dGFjaEV2ZW50KCJvbk1vdXNlT3V0IixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZW5hYmxlVHJlZUxpbmVzPWZ1bmN0aW9uKGUpe3RoaXMudHJlZUxpbmVzT249ZGh4NC5zMmIoZSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLm9wZW5JdGVtPWZ1bmN0aW9uKGUpe3RoaXMuc2tpcExvY2s9ITA7dmFyIHQ9dGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChlKTtyZXR1cm4gdD90aGlzLl9vcGVuSXRlbSh0KTowfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fb3Blbkl0ZW09ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5fZ2V0T3BlblN0YXRlKGUpO2lmKDA+dHx8dGhpcy5YTUxzb3VyY2UmJiFlLlhNTGxvYWQpe2lmKCF0aGlzLmNhbGxFdmVudCgib25PcGVuU3RhcnQiLFtlLmlkLHRdKSlyZXR1cm4gMDt0aGlzLl9IaWRlU2hvdyhlLDIpLHRoaXMuY2hlY2tFdmVudCgib25PcGVuRW5kIikmJih0aGlzLm9uWExFPT10aGlzLl9lcG5GSGUmJnRoaXMuX2VwbkZIZSh0aGlzLGUuaWQsITApLHRoaXMueG1sc3RhdGUmJnRoaXMuWE1Mc291cmNlPyh0aGlzLl9vaWVfb25YTEUucHVzaCh0aGlzLm9uWExFKSx0aGlzLm9uWExFPXRoaXMuX2VwbkZIZSk6dGhpcy5jYWxsRXZlbnQoIm9uT3BlbkVuZCIsW2UuaWQsdGhpcy5fZ2V0T3BlblN0YXRlKGUpXSkpfWVsc2UgdGhpcy5fc3JuZCYmdGhpcy5fSGlkZVNob3coZSwyKTtlLnBhcmVudE9iamVjdCYmIXRoaXMuX3NraXBfb3Blbl9wYXJlbnQmJnRoaXMuX29wZW5JdGVtKGUucGFyZW50T2JqZWN0KX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2dldEFsbEZhdEl0ZW1zPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0iIixpPTA7aTxlLmNoaWxkc0NvdW50O2krKylpZihlLmNoaWxkTm9kZXNbaV0udW5QYXJzZWR8fGUuY2hpbGROb2Rlc1tpXS5jaGlsZHNDb3VudD4wKXtpZih0P3QrPXRoaXMuZGxtdHIrZS5jaGlsZE5vZGVzW2ldLmlkOnQ9IiIrZS5jaGlsZE5vZGVzW2ldLmlkLGUuY2hpbGROb2Rlc1tpXS51blBhcnNlZCl2YXIgbj10aGlzLl9nZXRBbGxGYXRJdGVtc1hNTChlLmNoaWxkTm9kZXNbaV0udW5QYXJzZWQsMSk7ZWxzZSB2YXIgbj10aGlzLl9nZXRBbGxGYXRJdGVtcyhlLmNoaWxkTm9kZXNbaV0pO24mJih0Kz10aGlzLmRsbXRyK24pfXJldHVybiB0fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZWxlY3RJdGVtPWZ1bmN0aW9uKGUsdCxpKXt0PWRoeDQuczJiKHQpO3ZhciBuPXRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSk7aWYoIW58fCFuLnBhcmVudE9iamVjdClyZXR1cm4gMDt0aGlzLlhNTGxvYWRpbmdXYXJuaW5nP24ucGFyZW50T2JqZWN0Lm9wZW5NZT0xOnRoaXMuX29wZW5JdGVtKG4ucGFyZW50T2JqZWN0KTt2YXIgbz1udWxsO2kmJihvPW5ldyBPYmplY3Qsby5jdHJsS2V5PSEwLG4uaV9zZWwmJihvLnNraXBVblNlbD0hMCkpLHQ/dGhpcy5vblJvd1NlbGVjdChvLG4uaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbM10sITEpOnRoaXMub25Sb3dTZWxlY3QobyxuLmh0bWxOb2RlLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzNdLCEwKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2NvbXByZXNzQ2hpbGRMaXN0PWZ1bmN0aW9uKGUsdCl7ZS0tO2Zvcih2YXIgaT0wO2U+aTtpKyspMD09dFtpXSYmKHRbaV09dFtpKzFdLHRbaSsxXT0wKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2RlbGV0ZU5vZGU9ZnVuY3Rpb24oZSx0LGkpe2lmKCF0fHwhdC5wYXJlbnRPYmplY3QpcmV0dXJuIDA7dmFyIG49MCxvPTA7dC50ci5uZXh0U2libGluZyYmKG49dC50ci5uZXh0U2libGluZy5ub2RlbSksdC50ci5wcmV2aW91c1NpYmxpbmcmJihvPXQudHIucHJldmlvdXNTaWJsaW5nLm5vZGVtKTtmb3IodmFyIHI9dC5wYXJlbnRPYmplY3QsbD1yLmNoaWxkc0NvdW50LHM9ci5jaGlsZE5vZGVzLGE9MDtsPmE7YSsrKWlmKHNbYV0uaWQ9PWUpe2l8fHIuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5yZW1vdmVDaGlsZChzW2FdLnRyKSxzW2FdPTA7YnJlYWt9dGhpcy5fY29tcHJlc3NDaGlsZExpc3QobCxzKSxpfHxyLmNoaWxkc0NvdW50LS0sbiYmKHRoaXMuX2NvcnJlY3RQbHVzKG4pLHRoaXMuX2NvcnJlY3RMaW5lKG4pKSxvJiYodGhpcy5fY29ycmVjdFBsdXMobyksdGhpcy5fY29ycmVjdExpbmUobykpLHRoaXMudHNjaGVjayYmdGhpcy5fY29ycmVjdENoZWNrU3RhdGVzKHIpLGl8fHRoaXMuX2dsb2JhbElkU3RvcmFnZVJlY1N1Yih0KX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZGVsZXRlQ2hpbGRJdGVtcz1mdW5jdGlvbihlKXt2YXIgdD10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKGUpO2lmKHQpZm9yKHZhciBpPXQuY2hpbGRzQ291bnQsbj0wO2k+bjtuKyspdGhpcy5fZGVsZXRlTm9kZSh0LmNoaWxkTm9kZXNbMF0uaWQsdC5jaGlsZE5vZGVzWzBdKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2dsb2JhbElkU3RvcmFnZVJlY1N1Yj1mdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0PGUuY2hpbGRzQ291bnQ7dCsrKXRoaXMuX2dsb2JhbElkU3RvcmFnZVJlY1N1YihlLmNoaWxkTm9kZXNbdF0pLHRoaXMuX2dsb2JhbElkU3RvcmFnZVN1YihlLmNoaWxkTm9kZXNbdF0uaWQpO3RoaXMuX2dsb2JhbElkU3RvcmFnZVN1YihlLmlkKTt2YXIgaT1lO2kuc3Bhbj1udWxsLGkudHIubm9kZW09bnVsbCxpLnRyPW51bGwsaS5odG1sTm9kZT1udWxsfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fYXV0b1Njcm9sbD1mdW5jdGlvbihlLHQsaSl7dGhpcy5hdXRvU2Nyb2xsJiYoZSYmKHQ9ZGh4NC5hYnNUb3AoZSksaT1kaHg0LmFic1RvcCh0aGlzLmFsbFRyZWUpLXRoaXMuYWxsVHJlZS5zY3JvbGxUb3ApLHQtaS1wYXJzZUludCh0aGlzLmFsbFRyZWUuc2Nyb2xsVG9wKT5wYXJzZUludCh0aGlzLmFsbFRyZWUub2Zmc2V0SGVpZ2h0KS01MCYmKHRoaXMuYWxsVHJlZS5zY3JvbGxUb3A9cGFyc2VJbnQodGhpcy5hbGxUcmVlLnNjcm9sbFRvcCkrMjApLHQtaTxwYXJzZUludCh0aGlzLmFsbFRyZWUuc2Nyb2xsVG9wKSszMCYmKHRoaXMuYWxsVHJlZS5zY3JvbGxUb3A9cGFyc2VJbnQodGhpcy5hbGxUcmVlLnNjcm9sbFRvcCktMjApKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZW5hYmxlVGV4dFNpZ25zPWZ1bmN0aW9uKGUpe3RoaXMuX3R4dGltZz1kaHg0LnMyYihlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUucHJldmVudElFQ2FjaGluZz1mdW5jdGlvbihlKXtkaHg0LmFqYXguY2FjaGU9IWV9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnByZXZlbnRJRUNhc2hpbmc9ZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUucHJldmVudElFQ2FjaGluZyxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRJY29uU2l6ZT1mdW5jdGlvbihlLHQsaSl7aWYoaSl7aWYoaSYmaS5zcGFuKXZhciBuPWk7ZWxzZSB2YXIgbj10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKGkpO2lmKCFuKXJldHVybiAwO3ZhciBvPW4uc3Bhbi5wYXJlbnROb2RlLnByZXZpb3VzU2libGluZy5jaGlsZE5vZGVzWzBdO2UmJihvLnN0eWxlLndpZHRoPWUrInB4Iix3aW5kb3cuX0tIVE1McnYmJihvLnBhcmVudE5vZGUuc3R5bGUud2lkdGg9ZSsicHgiKSksdCYmKG8uc3R5bGUuaGVpZ2h0PXQrInB4Iix3aW5kb3cuX0tIVE1McnYmJihvLnBhcmVudE5vZGUuc3R5bGUuaGVpZ2h0PXQrInB4IikpfWVsc2UgdGhpcy5kZWZfaW1nX3g9ZSsicHgiLHRoaXMuZGVmX2ltZ195PXQrInB4In0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZW5hYmxlU2luZ2xlUmFkaW9Nb2RlPWZ1bmN0aW9uKGUpe3RoaXMuX2ZyYnRycz1kaHg0LnMyYihlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUub3Blbk9uSXRlbUFkZGVkPWZ1bmN0aW9uKGUpe3RoaXMuX2hBZEk9IWRoeDQuczJiKGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5vcGVuT25JdGVtQWRkaW5nPWZ1bmN0aW9uKGUpe3RoaXMuX2hBZEk9IWRoeDQuczJiKGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5nZXRBbGxJdGVtc1dpdGhLaWRzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2dldEFsbEZhdEl0ZW1zKHRoaXMuaHRtbE5vZGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRTa2luPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMucGFyZW50T2JqZWN0LmNsYXNzTmFtZS5yZXBsYWNlKC9kaHh0cmVlX1teIF0qL2dpLCIiKTt0aGlzLnBhcmVudE9iamVjdC5jbGFzc05hbWU9dCsiIGRoeHRyZWVfIitlLCJkaHhfdGVycmFjZSIhPWUmJiJkaHhfd2ViIiE9ZSYmIm1hdGVyaWFsIiE9ZXx8dGhpcy5lbmFibGVUcmVlTGluZXMoITEpLCJtYXRlcmlhbCI9PWUmJnRoaXMuc2V0SWNvblNpemUoIjI1IiwiMjUiKX0sanNvblBvaW50ZXIucHJvdG90eXBlPXt0ZXh0OmZ1bmN0aW9uKCl7dmFyIGU9ZnVuY3Rpb24oZSl7Zm9yKHZhciBpPVtdLG49MDtuPGUubGVuZ3RoO24rKylpLnB1c2goInsiK3QoZVtuXSkrIn0iKTtyZXR1cm4gaS5qb2luKCIsIil9LHQ9ZnVuY3Rpb24oaSl7dmFyIG49W107Zm9yKHZhciBvIGluIGkpIm9iamVjdCI9PXR5cGVvZiBpW29dP28ubGVuZ3RoP24ucHVzaCgnIicrbysnIjpbJytlKGlbb10pKyJdIik6bi5wdXNoKCciJytvKyciOnsnK3QoaVtvXSkrIn0iKTpuLnB1c2goJyInK28rJyI6IicraVtvXSsnIicpO3JldHVybiBuLmpvaW4oIiwiKX07cmV0dXJuInsiK3QodGhpcy5kKSsifSJ9LGdldDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5kW2VdfSxleGlzdHM6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuZH0sY29udGVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmQuY29udGVudH0sZWFjaDpmdW5jdGlvbihlLHQsaSl7dmFyIG49dGhpcy5kW2VdLG89bmV3IGpzb25Qb2ludGVyO2lmKG4pZm9yKHZhciByPTA7cjxuLmxlbmd0aDtyKyspby5kPW5bcl0sdC5hcHBseShpLFtvLHJdKX0sZ2V0X2FsbDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmR9LHN1YjpmdW5jdGlvbihlKXtyZXR1cm4gbmV3IGpzb25Qb2ludGVyKHRoaXMuZFtlXSx0aGlzLmQpfSxzdWJfZXhpc3RzOmZ1bmN0aW9uKGUpe3JldHVybiEhdGhpcy5kW2VdfSxlYWNoX3g6ZnVuY3Rpb24oZSx0LGksbixvKXt2YXIgcj10aGlzLmRbZV0sbD1uZXcganNvblBvaW50ZXIoMCx0aGlzLmQpO2lmKHIpZm9yKG89b3x8MDtvPHIubGVuZ3RoO28rKylpZihyW29dW3RdJiYobC5kPXJbb10sLTE9PWkuYXBwbHkobixbbCxvXSkpKXJldHVybn0sdXA6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBqc29uUG9pbnRlcih0aGlzLmRwLHRoaXMuZCl9LHNldDpmdW5jdGlvbihlLHQpe3RoaXMuZFtlXT10fSxjbG9uZTpmdW5jdGlvbihlKXtyZXR1cm4gbmV3IGpzb25Qb2ludGVyKHRoaXMuZCx0aGlzLmRwKX0sdGhyb3VnaDpmdW5jdGlvbihlLHQsaSxuLG8pe3ZhciByPXRoaXMuZFtlXTtpZihyLmxlbmd0aClmb3IodmFyIGw9MDtsPHIubGVuZ3RoO2wrKyl7aWYobnVsbCE9cltsXVt0XSYmIiIhPXJbbF1bdF0mJighaXx8cltsXVt0XT09aSkpe3ZhciBzPW5ldyBqc29uUG9pbnRlcihyW2xdLHRoaXMuZCk7bi5hcHBseShvLFtzLGxdKX12YXIgYT10aGlzLmQ7dGhpcy5kPXJbbF0sdGhpcy5zdWJfZXhpc3RzKGUpJiZ0aGlzLnRocm91Z2goZSx0LGksbixvKSx0aGlzLmQ9YX19fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5sb2FkSlNPTk9iamVjdD1mdW5jdGlvbihlLHQpe3JldHVybiB3aW5kb3cuY29uc29sZSYmd2luZG93LmNvbnNvbGUuaW5mbyYmd2luZG93LmNvbnNvbGUuaW5mbygibG9hZEpTT05PYmplY3Qgd2FzIGRlcHJlY2F0ZWQiLCJodHRwOi8vZG9jcy5kaHRtbHguY29tL21pZ3JhdGlvbl9faW5kZXguaHRtbCNtaWdyYXRpb25mcm9tNDN0bzQ0IiksdGhpcy5fbG9hZEpTT05PYmplY3QoZSx0KX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2xvYWRKU09OT2JqZWN0PWZ1bmN0aW9uKGUsdCl7dGhpcy5wYXJzQ291bnR8fHRoaXMuY2FsbEV2ZW50KCJvblhMUyIsW3RoaXMsbnVsbF0pLHRoaXMueG1sc3RhdGU9MTt2YXIgaT1uZXcganNvblBvaW50ZXIoZSk7dGhpcy5fcGFyc2UoaSksdGhpcy5fcD1pLHQmJnQoKX0sd2luZG93LmFkZEV2ZW50TGlzdGVuZXI/d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLGRoeF9pbml0X3RyZWVzLCExKTp3aW5kb3cuYXR0YWNoRXZlbnQmJndpbmRvdy5hdHRhY2hFdmVudCgib25sb2FkIixkaHhfaW5pdF90cmVlcyk7dmFyIHN0eWxlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7c3R5bGUuaW5uZXJIVE1MPSdAa2V5ZnJhbWVzIGRoeF9sb2FkZXJfcm90YXRlezEwMCV7dHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpO319QGtleWZyYW1lcyBkaHhfbG9hZGVyX2Rhc2h7MCV7c3Ryb2tlLWRhc2hhcnJheToxLDIwMDtzdHJva2UtZGFzaG9mZnNldDowO301MCV7c3Ryb2tlLWRhc2hhcnJheTo4OSwyMDA7c3Ryb2tlLWRhc2hvZmZzZXQ6LTM1cHg7fTEwMCV7c3Ryb2tlLWRhc2hhcnJheTo4OSwyMDA7c3Ryb2tlLWRhc2hvZmZzZXQ6LTEyNHB4O319LmRodG1seE1lbnVfbWF0ZXJpYWxfTWlkZGxle3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDoyOHB4O2xpbmUtaGVpZ2h0OjI4cHg7YmFja2dyb3VuZC1jb2xvcjojZjVmNWY1O292ZXJmbG93OmhpZGRlbjtib3JkZXI6bm9uZTtmb250LXNpemU6MTRweDtmb250LWZhbWlseTpSb2JvdG8sQXJpYWwsSGVsdmV0aWNhO2NvbG9yOiM0MDQwNDA7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lOy1raHRtbC11c2VyLXNlbGVjdDpub25lOy1tb3otdXNlci1zZWxlY3Q6bm9uZTstbXMtdXNlci1zZWxlY3Q6bm9uZTstby11c2VyLXNlbGVjdDpub25lO3VzZXItc2VsZWN0Om5vbmU7fS5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9Ub3BMZXZlbF9JdGVtX05vcm1hbCwuZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9EaXNhYmxlZCwuZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9TZWxlY3RlZHtwb3NpdGlvbjpyZWxhdGl2ZTtmbG9hdDpsZWZ0O2ZvbnQ6aW5oZXJpdDtoZWlnaHQ6MjhweDtsaW5lLWhlaWdodDoyOHB4O21hcmdpbjowO3BhZGRpbmc6MCA4cHg7Y3Vyc29yOmRlZmF1bHQ7d2hpdGUtc3BhY2U6bm93cmFwOy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LW1zLXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9Ob3JtYWwgZGl2LnRvcF9sZXZlbF90ZXh0LC5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9Ub3BMZXZlbF9JdGVtX0Rpc2FibGVkIGRpdi50b3BfbGV2ZWxfdGV4dCwuZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9TZWxlY3RlZCBkaXYudG9wX2xldmVsX3RleHR7ZmxvYXQ6bGVmdDttYXJnaW46MCAzcHg7fS5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9Ub3BMZXZlbF9JdGVtX05vcm1hbCBpLC5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9Ub3BMZXZlbF9JdGVtX0Rpc2FibGVkIGksLmRodG1seE1lbnVfbWF0ZXJpYWxfTWlkZGxlIGRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1RvcExldmVsX0l0ZW1fU2VsZWN0ZWQgaXtoZWlnaHQ6aW5oZXJpdDtsaW5lLWhlaWdodDppbmhlcml0O2Zsb2F0OmxlZnQ7Y29sb3I6aW5oZXJpdDttYXJnaW46MCA0cHg7Zm9udC1zaXplOjEuMmVtO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9EaXNhYmxlZHtjb2xvcjojYTZhNmE2O30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9TZWxlY3RlZHtiYWNrZ3JvdW5kLWNvbG9yOiNlYmViZWI7fS5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBpbWcuZGh0bWx4TWVudV9Ub3BMZXZlbF9JdGVtX0ljb257ZmxvYXQ6bGVmdDttYXJnaW46NXB4IDNweCAwIDNweDt3aWR0aDoxOHB4O2hlaWdodDoxOHB4O2N1cnNvcjpkZWZhdWx0O30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LnRvcF9zZXB7cG9zaXRpb246cmVsYXRpdmU7ZmxvYXQ6bGVmdDtoZWlnaHQ6MjJweDt3aWR0aDowO2JvcmRlci1sZWZ0OjFweCBzb2xpZCAjZGZkZmRmO21hcmdpbjozcHggOHB4IDAgOHB4O2ZvbnQtc2l6ZToxcHg7b3ZlcmZsb3c6aGlkZGVuO2N1cnNvcjpkZWZhdWx0Oy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LW1zLXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfVG9wTGV2ZWxfVGV4dF9yaWdodCwuZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfVG9wTGV2ZWxfVGV4dF9sZWZ0e3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2hlaWdodDoyOHB4O2xpbmUtaGVpZ2h0OjI4cHg7Y3Vyc29yOmRlZmF1bHQ7Zm9udC1zaXplOjE0cHg7Zm9udC1mYW1pbHk6Um9ib3RvLEFyaWFsLEhlbHZldGljYTtjb2xvcjojNDA0MDQwOy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LW1zLXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfVG9wTGV2ZWxfVGV4dF9yaWdodHtyaWdodDo2cHg7fS5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9Ub3BMZXZlbF9UZXh0X2xlZnR7bGVmdDo2cHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29ue3Bvc2l0aW9uOmFic29sdXRlO3BhZGRpbmc6NXB4IDA7YmFja2dyb3VuZC1jb2xvcjojZmFmYWZhO292ZXJmbG93OmhpZGRlbjtjdXJzb3I6ZGVmYXVsdDtsaW5lLWhlaWdodDpub3JtYWw7b3ZlcmZsb3cteTphdXRvOy13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOnRvdWNoOy13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjpyZ2JhKDAsMCwwLDApO2JveC1zaGFkb3c6MCAxcHggM3B4IHJnYmEoMCwwLDAsMC4xMiksMCAxcHggMnB4IHJnYmEoMCwwLDAsMC4yNCk7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lOy1raHRtbC11c2VyLXNlbGVjdDpub25lOy1tb3otdXNlci1zZWxlY3Q6bm9uZTstbXMtdXNlci1zZWxlY3Q6bm9uZTstby11c2VyLXNlbGVjdDpub25lO3VzZXItc2VsZWN0Om5vbmU7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRke3BhZGRpbmc6MDttYXJnaW46MDtsaW5lLWhlaWdodDpub3JtYWw7d2hpdGUtc3BhY2U6bm93cmFwO2ZvbnQtc2l6ZToxNHB4O2ZvbnQtZmFtaWx5OlJvYm90byxBcmlhbCxIZWx2ZXRpY2E7Y29sb3I6IzQwNDA0MDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdGQuc3ViX2l0ZW1faWNvbnt3aWR0aDoxOHB4O3RleHQtYWxpZ246Y2VudGVyO31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZC5zdWJfaXRlbV9pY29uIGltZy5zdWJfaWNvbnttYXJnaW46NHB4IDZweCAwIDZweDt3aWR0aDoxOHB4O2hlaWdodDoxOHB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZC5zdWJfaXRlbV9pY29uIGl7d2lkdGg6MThweDtoZWlnaHQ6MzBweDtsaW5lLWhlaWdodDoyOXB4O21hcmdpbjowIDZweDtmb250LXNpemU6MS4yZW07dGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6aW5oZXJpdDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdGQuc3ViX2l0ZW1faWNvbiBkaXYuc3ViX2ljb257bWFyZ2luOjAgNnB4O3dpZHRoOjE4cHg7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgNXB4O2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLWltYWdlOnVybCgiaW1ncy9kaHhtZW51X21hdGVyaWFsL2RoeG1lbnVfY2hyZC5wbmciKTt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdGQuc3ViX2l0ZW1faWNvbiBkaXYuc3ViX2ljb24uY2hieF8we2JhY2tncm91bmQtcG9zaXRpb246MCA1cHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRkLnN1Yl9pdGVtX2ljb24gZGl2LnN1Yl9pY29uLmNoYnhfMXtiYWNrZ3JvdW5kLXBvc2l0aW9uOi0xOHB4IDVweDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdGQuc3ViX2l0ZW1faWNvbiBkaXYuc3ViX2ljb24ucmRidF8we2JhY2tncm91bmQtcG9zaXRpb246LTcycHggNXB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZC5zdWJfaXRlbV9pY29uIGRpdi5zdWJfaWNvbi5yZGJ0XzF7YmFja2dyb3VuZC1wb3NpdGlvbjotOTBweCA1cHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRkLnN1Yl9pdGVtX3RleHQgZGl2LnN1Yl9pdGVtX3RleHR7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtwYWRkaW5nOjAgMjJweCAwIDFweDtvdmVyZmxvdzpoaWRkZW47fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRkLnN1Yl9pdGVtX2hre3BhZGRpbmc6MCAxMHB4IDAgOHB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZC5zdWJfaXRlbV9oayBkaXYuc3ViX2l0ZW1faGt7Y29sb3I6IzhkOGQ4ZDtmb250LXNpemU6MTJweDt0ZXh0LWFsaWduOnJpZ2h0O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZCBkaXYuY29tcGxleF9hcnJvd3tmbG9hdDpyaWdodDt3aWR0aDoxMHB4O21hcmdpbjowIDFweCAwIDExcHg7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtiYWNrZ3JvdW5kLWltYWdlOnVybCgiaW1ncy9kaHhtZW51X21hdGVyaWFsL2RoeG1lbnVfc3ViYXIucG5nIik7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246MCAxMHB4O292ZXJmbG93OmhpZGRlbjtmb250LXNpemU6MXB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZCBkaXYuY29tcGxleF9hcnJvd19sb2FkaW5ne3dpZHRoOjE2cHg7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtiYWNrZ3JvdW5kLXBvc2l0aW9uOmNlbnRlciBjZW50ZXI7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtaW1hZ2U6dXJsKCJpbWdzL2RoeG1lbnVfbWF0ZXJpYWwvZGh4bWVudV9sb2FkZXIuZ2lmIik7ZmxvYXQ6cmlnaHQ7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX3NlbGVjdGVkIHRke2JhY2tncm91bmQtY29sb3I6I2ViZWJlYjt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdHIuc3ViX2l0ZW1fc2VsZWN0ZWQgdGQgZGl2LmNvbXBsZXhfYXJyb3d7YmFja2dyb3VuZC1wb3NpdGlvbjotMTBweCAxMHB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfaXRlbV9kaXMgdGQuc3ViX2l0ZW1faGsgZGl2LnN1Yl9pdGVtX2hre2NvbG9yOiNjMGMwYzA7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX2RpcyB0ZCBkaXYuc3ViX2l0ZW1fdGV4dCxkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfaXRlbV9kaXMgdGQgdGQuc3ViX2l0ZW1faWNvbiBpe2NvbG9yOiNhNmE2YTY7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX2RpcyB0ZCBkaXYuY29tcGxleF9hcnJvd3tiYWNrZ3JvdW5kLXBvc2l0aW9uOi0yMHB4IDEwcHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX2RpcyB0ZCBkaXYuc3ViX2ljb24uY2hieF8we2JhY2tncm91bmQtcG9zaXRpb246LTM2cHggNXB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfaXRlbV9kaXMgdGQgZGl2LnN1Yl9pY29uLmNoYnhfMXtiYWNrZ3JvdW5kLXBvc2l0aW9uOi01NHB4IDVweDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdHIuc3ViX2l0ZW1fZGlzIHRkIGRpdi5zdWJfaWNvbi5yZGJ0XzB7YmFja2dyb3VuZC1wb3NpdGlvbjotMTA4cHggNXB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfaXRlbV9kaXMgdGQgZGl2LnN1Yl9pY29uLnJkYnRfMXtiYWNrZ3JvdW5kLXBvc2l0aW9uOi0xMjZweCA1cHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX2RpcyB0ZCBpe2NvbG9yOiNhNmE2YTY7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9zZXAgdGR7cGFkZGluZzo1cHggM3B4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfc2VwIHRkIGRpdi5zdWJfc2Vwe3Bvc2l0aW9uOnJlbGF0aXZlO2ZvbnQtc2l6ZToxcHg7bGluZS1oZWlnaHQ6MXB4O2hlaWdodDowO3dpZHRoOjEwMCU7Ym9yZGVyLXRvcDoxcHggc29saWQgI2RmZGZkZjt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93VXAsZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93VXBfT3ZlcixkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfQXJyb3dVcF9EaXNhYmxlZHtwb3NpdGlvbjpyZWxhdGl2ZTtmb250LXNpemU6MXB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNkZmRmZGY7YmFja2dyb3VuZC1pbWFnZTp1cmwoImltZ3MvZGh4bWVudV9tYXRlcmlhbC9kaHhtZW51X2Fycm93X3VwLnBuZyIpO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLXBvc2l0aW9uOmNlbnRlciAycHg7cGFkZGluZzo4cHggMDttYXJnaW4tYm90dG9tOjNweDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93VXBfRGlzYWJsZWR7YmFja2dyb3VuZC1pbWFnZTp1cmwoImltZ3MvZGh4bWVudV9tYXRlcmlhbC9kaHhtZW51X2Fycm93X3VwX2Rpcy5wbmciKTt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93RG93bixkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfQXJyb3dEb3duX092ZXIsZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93RG93bl9EaXNhYmxlZHtwb3NpdGlvbjpyZWxhdGl2ZTtmb250LXNpemU6MXB4O2JvcmRlci10b3A6MXB4IHNvbGlkICNkZmRmZGY7YmFja2dyb3VuZC1pbWFnZTp1cmwoImltZ3MvZGh4bWVudV9tYXRlcmlhbC9kaHhtZW51X2Fycm93X2Rvd24ucG5nIik7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyIDZweDtwYWRkaW5nOjhweCAwO21hcmdpbi10b3A6M3B4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfQXJyb3dEb3duX0Rpc2FibGVke2JhY2tncm91bmQtaW1hZ2U6dXJsKCJpbWdzL2RoeG1lbnVfbWF0ZXJpYWwvZGh4bWVudV9hcnJvd19kb3duX2Rpcy5wbmciKTt9aWZyYW1lLmRodG1seE1lbnVfSUU2Q292ZXJGaXhfbWF0ZXJpYWx7cG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyOm5vbmU7YmFja2dyb3VuZDojMDAwO2ZpbHRlcjpwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuQWxwaGEob3BhY2l0eT0xMDApO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUuZGlyX2xlZnQgZGl2LmFsaWduX2xlZnR7ZmxvYXQ6bGVmdDt9LmRodG1seE1lbnVfbWF0ZXJpYWxfTWlkZGxlLmRpcl9sZWZ0IGRpdi5hbGlnbl9yaWdodHtmbG9hdDpyaWdodDt9LmRoeG1lbnVfc2tpbl9kZXRlY3R7cG9zaXRpb246YWJzb2x1dGU7bGVmdDowO3RvcDotMTAwcHg7bWFyZ2luOjA7cGFkZGluZzowO2JvcmRlcjowIHNvbGlkIHdoaXRlO3dpZHRoOjQwcHg7aGVpZ2h0OjEwcHg7b3ZlcmZsb3c6aGlkZGVuO31Aa2V5ZnJhbWVzIGRoeF9sb2FkZXJfcm90YXRlezEwMCV7dHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpO319QGtleWZyYW1lcyBkaHhfbG9hZGVyX2Rhc2h7MCV7c3Ryb2tlLWRhc2hhcnJheToxLDIwMDtzdHJva2UtZGFzaG9mZnNldDowO301MCV7c3Ryb2tlLWRhc2hhcnJheTo4OSwyMDA7c3Ryb2tlLWRhc2hvZmZzZXQ6LTM1cHg7fTEwMCV7c3Ryb2tlLWRhc2hhcnJheTo4OSwyMDA7c3Ryb2tlLWRhc2hvZmZzZXQ6LTEyNHB4O319LmRlZmF1bHRUcmVlVGFibGV7bWFyZ2luOjA7cGFkZGluZzowO2JvcmRlcjowO30uY29udGFpbmVyVGFibGVTdHlsZXtvdmVyZmxvdzphdXRvOy13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOnRvdWNoO3Bvc2l0aW9uOnJlbGF0aXZlO3RvcDowO2ZvbnQtc2l6ZToxMnB4Oy1raHRtbC11c2VyLXNlbGVjdDpub25lO30uY29udGFpbmVyVGFibGVTdHlsZVJUTCBzcGFue2RpcmVjdGlvbjpydGw7dW5pY29kZS1iaWRpOmJpZGktb3ZlcnJpZGU7fS5jb250YWluZXJUYWJsZVN0eWxlUlRMe2RpcmVjdGlvbjpydGw7b3ZlcmZsb3c6YXV0bztwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6MDtmb250LXNpemU6MTJweDt9LnN0YW5kYXJ0VHJlZVJvd3tmb250LWZhbWlseTpSb2JvdG8sQXJpYWwsSGVsdmV0aWNhO2ZvbnQtc2l6ZTo7LW1vei11c2VyLXNlbGVjdDpub25lO2xpbmUtaGVpZ2h0OjI0cHg7fS5zZWxlY3RlZFRyZWVSb3d7Zm9udC1mYW1pbHk6Um9ib3RvLEFyaWFsLEhlbHZldGljYTtmb250LXNpemU6Oy1tb3otdXNlci1zZWxlY3Q6bm9uZTtiYWNrZ3JvdW5kLWNvbG9yOiNlZWU7Y29sb3I6IzM5Yzt9LmRoeHRyZWVfbWF0ZXJpYWwgLnNlbGVjdGVkVHJlZVJvd0Z1bGwgLmRoeFRleHRDZWxse2JhY2tncm91bmQtY29sb3I6I2VlZTtjb2xvcjojMzljO30uZHJhZ0FuZERyb3BSb3d7Y29sb3I6IzM5Yzt9LnN0YW5kYXJ0VHJlZVJvd19sb3J7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTtiYWNrZ3JvdW5kLWNvbG9yOjtmb250LWZhbWlseTpSb2JvdG8sQXJpYWwsSGVsdmV0aWNhO2ZvbnQtc2l6ZTo7LW1vei11c2VyLXNlbGVjdDpub25lO30uc3RhbmRhcnRUcmVlSW1hZ2V7aGVpZ2h0OjI0cHg7b3ZlcmZsb3c6aGlkZGVuO2JvcmRlcjowO3BhZGRpbmc6MDttYXJnaW46MDtmb250LXNpemU6MXB4O30uc3RhbmRhcnRUcmVlSW1hZ2UgaW1ne3dpZHRoOjE4cHg7aGVpZ2h0OjI0cHg7YmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXIgY2VudGVyO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtib3JkZXI6MDtwYWRkaW5nOjA7bWFyZ2luOjA7Zm9udC1zaXplOjFweDstd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7LWtodG1sLXVzZXItc2VsZWN0Om5vbmU7LW1vei11c2VyLXNlbGVjdDpub25lOy1tcy11c2VyLXNlbGVjdDpub25lOy1vLXVzZXItc2VsZWN0Om5vbmU7dXNlci1zZWxlY3Q6bm9uZTt9LmhpZGRlblJvd3t3aWR0aDoxcHg7b3ZlcmZsb3c6aGlkZGVuO30uZHJhZ1NwYW5EaXYsLmRyYWdTcGFuRGl2IHRke2ZvbnQtZmFtaWx5OlJvYm90byxBcmlhbCxIZWx2ZXRpY2E7Zm9udC1zaXplOjtsaW5lLWhlaWdodDo7dmVydGljYWwtYWxpZ246Y2VudGVyO2JhY2tncm91bmQtY29sb3I6d2hpdGU7ei1pbmRleDo5OTk7fS5kcmFnU3BhbkRpdiB0ZHtwYWRkaW5nOjVweDt9LmFfZGh4X2hpZGRlbl9pbnB1dHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6LTFweDtsZWZ0Oi0xcHg7d2lkdGg6MXB4O2hlaWdodDoxcHg7Ym9yZGVyOm5vbmU7YmFja2dyb3VuZDpub25lO30uYV9kaHhfaGlkZGVuX2lucHV0e3Bvc2l0aW9uOmFic29sdXRlO3RvcDotMXB4O2xlZnQ6LTFweDt3aWR0aDoxcHg7aGVpZ2h0OjFweDtib3JkZXI6bm9uZTtiYWNrZ3JvdW5kOm5vbmU7fS5zZWxlY3Rpb25CYXJ7dG9wOjA7YmFja2dyb3VuZC1jb2xvcjpibGFjaztwb3NpdGlvbjphYnNvbHV0ZTtvdmVyZmxvdzpoaWRkZW47aGVpZ2h0OjJweDt6LWluZGV4OjExO30uaW50cmVlZWRpdFJvd3tmb250LXNpemU6OHB0O2hlaWdodDoxNnB4O2JvcmRlcjoxcHggc29saWQgc2lsdmVyO3BhZGRpbmc6MDttYXJnaW46MDttYXJnaW4tbGVmdDo0cHg7LW1vei11c2VyLXNlbGVjdDp0ZXh0Oy1raHRtbC11c2VyLXNlbGVjdDp0ZXh0O30uZGh4X3RyZWVfdGV4dFNpZ257Zm9udC1zaXplOjhwdDtmb250LWZhbWlseTptb25vc3BhY2U7d2lkdGg6MjFweDtjb2xvcjo7cGFkZGluZzowO21hcmdpbjowO2N1cnNvcjpwb2ludGVyO3RleHQtYWxpZ246Y2VudGVyO30uZGh4X3RyZWVfb3BhY2l0eXtvcGFjaXR5OjA7ZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYShvcGFjaXR5PTApOy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LW1zLXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lO30uZGh4X2JnX2ltZ19maXh7d2lkdGg6MThweDtoZWlnaHQ6MjRweDtiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7YmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXI7YmFja2dyb3VuZC1wb3NpdGlvbi14OmNlbnRlcjtiYWNrZ3JvdW5kLXBvc2l0aW9uLXk6Y2VudGVyO30uZGh4dHJlZV9za2luX2RldGVjdHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOi0xMDBweDttYXJnaW46MDtwYWRkaW5nOjA7Ym9yZGVyOjAgc29saWQgd2hpdGU7d2lkdGg6NDBweDtoZWlnaHQ6MTBweDtvdmVyZmxvdzpoaWRkZW47fScsZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7dmFyIGxheWFhaXJfZGVidWdfdmlldz17fTt3aW5kb3cubGF5YWFpcl9kZWJ1Z192aWV3PWxheWFhaXJfZGVidWdfdmlldyxsYXlhYWlyX2RlYnVnX3ZpZXcuaW5pdExheWFBaXJEZWJ1Z1ZpZXc9ZnVuY3Rpb24oZSl7ZS5zdHlsZS5ib3JkZXI9IjFweCBzb2xpZCBibGFjayI7dmFyIHQ9TWF0aC5taW4oMjUwLC4zKmUub2Zmc2V0V2lkdGgpLGk9JzxkaXYgY2xhc3M9InRvcC1iYW5uZXIiPlxuPC9kaXY+XG48ZGl2PlxuPGRpdiBzdHlsZT0ib3ZlcmZsb3c6aGlkZGVuOyBib3JkZXItYm90dG9tOjFweCBzb2xpZCAjNDQ0OyBwYWRkaW5nOjVweCI+XG48ZGl2IHN0eWxlPSJmbG9hdDpsZWZ0Ij5cbjxidXR0b24gaWQ9Im5vZGVfZnVuY3Rpb25hbGl0eV9jb250cm9sIj7lrqHmn6XlhYPntKA8L2J1dHRvbj5cbjxidXR0b24gaWQ9InJlZnJlc2hfY29udHJvbCI+5Yi35pawPC9idXR0b24+XG48L2Rpdj5cbjxkaXYgc3R5bGU9ImZsb2F0OnJpZ2h0Ij5cbjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNob3dfY3VycmVudF9jYWNoZV9jb250cm9sIj7mmL7npLrlvZPliY1jYWNoZemHjee7mDwvaW5wdXQ+XG48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzaG93X2FsbF9jYWNoZV9jb250cm9sIj7mmL7npLrmiYDmnIljYWNoZeWMuuWfnzwvaW5wdXQ+XG48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzaG93X2F0bGFzX2NvbnRyb2wiPuaYvuekuuWkp+WbvuWQiOmbhjwvaW5wdXQ+XG48L2Rpdj5cbjwvZGl2PlxuPGRpdiBjbGFzcz0iaGdyb3VwIj5cbjxkaXYgc3R5bGU9ImZsb2F0OmxlZnQ7d2lkdGg6Jyt0KydweDsgYm9yZGVyLXJpZ2h0OjFweCBzb2xpZCBibGFjayIgaWQ9InRyZWVfY29udGFpbmVyIj48L2Rpdj5cbjxkaXYgc3R5bGU9Im92ZXJmbG93OmhpZGRlbiI+XG48ZGl2IGlkPSJjb250ZW50X3Rvb2xiYXIiIHN0eWxlPSJ3aWR0aDoxMDAlO21hcmdpbjoxMHB4Ij48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJ2aXNpYmlsaXR5X2NvbnRyb2wiPuWPr+ingTwvaW5wdXQ+XG48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzaG93X2JvcmRlcl9jb250cm9sIj7mmL7npLrovrnmoYY8L2lucHV0PlxuPGJ1dHRvbiBpZD0ibG9nX2luZm9fY29udHJvbCI+5omT5Y2w5Yiw5o6n5Yi25Y+wPC9idXR0b24+XG48YnV0dG9uIGlkPSJlbmFibGVkX25vZGVfY2hhaW5fY29udHJvbCI+ZW5hYmxl6ZO+PC9idXR0b24+XG48YnV0dG9uIGlkPSJzaXplX2NoYWluX2NvbnRyb2wiPnNpemXpk748L2J1dHRvbj5cbjwvZGl2PjxkaXYgc3R5bGU9Im92ZXJmbG93OmF1dG8iPjx0YWJsZSBpZD0iY29udGVudF90YWJsZSIgc3R5bGU9ImJvcmRlcjoxcHggc29saWQgI2NjY2NjYztib3JkZXItY29sbGFwc2U6Y29sbGFwc2UiPjwvdGFibGU+XG48L2Rpdj48L2Rpdj5cbjwvZGl2PlxuPC9kaXY+JztlLmlubmVySFRNTD1pLHRoaXMuY29udGFpbmVyPWUsdGhpcy50cmVlPW5ldyBkaHRtbFhUcmVlT2JqZWN0KHRyZWVfY29udGFpbmVyLCIxMDAlIiwiMTAwJSIsMCksbm9kZV9mdW5jdGlvbmFsaXR5X2NvbnRyb2wub25jbGljaz1mdW5jdGlvbihlKXtlLnN0b3BQcm9wYWdhdGlvbigpLGxheWFhaXJfZGVidWdfdmlldy5vbl9pbnNwZWN0X2VsZW1lbnRfY2FsbGJhY2soKSxub2RlX2Z1bmN0aW9uYWxpdHlfY29udHJvbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9IiNGRkYiLG5vZGVfZnVuY3Rpb25hbGl0eV9jb250cm9sLnN0eWxlLmNvbG9yPSJyZ2IoMTA3LCAxNjMsIDI1NSkifX0sbGF5YWFpcl9kZWJ1Z192aWV3LnNldFRyZWU9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PXRoaXMudHJlZS5nZXRBbGxJdGVtc1dpdGhLaWRzKCkuc3BsaXQoIiwiKSxpPVtdLG49MDtuPHQubGVuZ3RoO24rKyl7dmFyIG89dFtuXSxyPXRoaXMudHJlZS5nZXRPcGVuU3RhdGUobyk7MT09ciYmaS5wdXNoKG8pfXRoaXMudHJlZS5kZWxldGVDaGlsZEl0ZW1zKDApLHRoaXMudHJlZS5wYXJzZShlLCJqc29uIik7Zm9yKHZhciBuPTA7bjxpLmxlbmd0aDtuKyspdGhpcy50cmVlLm9wZW5JdGVtKGlbbl0pfSxsYXlhYWlyX2RlYnVnX3ZpZXcucmVzaXplPWZ1bmN0aW9uKGUsdCl7dGhpcy5jb250YWluZXIuc3R5bGUud2lkdGg9ZSsicHgiLHRoaXMuY29udGFpbmVyLnN0eWxlLmhlaWdodD10KyJweCI7dmFyIGk9dGhpcy5jb250YWluZXIub2Zmc2V0SGVpZ2h0LXRyZWVfY29udGFpbmVyLm9mZnNldFRvcDt0cmVlX2NvbnRhaW5lci5zdHlsZS5oZWlnaHQ9aSsicHgiLGNvbnRlbnRfdG9vbGJhci5zdHlsZS53aWR0aD1lLXRyZWVfY29udGFpbmVyLm9mZnNldFdpZHRoKyJweCIsY29udGVudF90YWJsZS5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodD1pLWNvbnRlbnRfdG9vbGJhci5vZmZzZXRIZWlnaHQtMjErInB4Iixjb250ZW50X3RhYmxlLnN0eWxlLndpZHRoPWUtdHJlZV9jb250YWluZXIub2Zmc2V0V2lkdGgtMTYrInB4In0sbGF5YWFpcl9kZWJ1Z192aWV3LmJvdW5jZVVwSW5zcGVjdEJ1dHRvbj1mdW5jdGlvbigpe25vZGVfZnVuY3Rpb25hbGl0eV9jb250cm9sLnN0eWxlLmJhY2tncm91bmRDb2xvcj0iYnV0dG9uZmFjZSIsbm9kZV9mdW5jdGlvbmFsaXR5X2NvbnRyb2wuc3R5bGUuY29sb3I9ImJsYWNrIn0sbGF5YWFpcl9kZWJ1Z192aWV3LnNldFZhbHVlSW5wdXRIYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMudmFsdWVfaW5wdXRfY2FsbGJhY2s9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3LnNldFZhbHVlQ2hhbmdlSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLnZhbHVlX2NoYW5nZV9jYWxsYmFjaz1lfSxsYXlhYWlyX2RlYnVnX3ZpZXcuYWRkQ29udGVudD1mdW5jdGlvbihlKXt2YXIgdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ciIpO3QuaW5uZXJIVE1MPSc8dGQgc3R5bGU9IndpZHRoOjEwMHB4O2ZvbnQtc2l6ZToxM3B4O2JvcmRlcjoxcHggc29saWQgI0NDQztwYWRkaW5nLWxlZnQ6MTBweCI+JytlLmtleSsnPC90ZD5cbjx0ZCBzdHlsZT0id2lkdGg6MjAwcHg7Ym9yZGVyOjFweCBzb2xpZCAjQ0NDOyI+PGlucHV0IHN0eWxlPSJib3JkZXI6bm9uZTt3aWR0aDoxMDAlO2hlaWdodDoyNXB4O3BhZGRpbmctbGVmdDoxMHB4OyIgdmFsdWU9JytlLnZhbHVlKyI+PC90ZD4iLGNvbnRlbnRfdGFibGUuYXBwZW5kQ2hpbGQodCk7dmFyIGk9dC5sYXN0RWxlbWVudENoaWxkLmxhc3RFbGVtZW50Q2hpbGQ7aS5kYXRhPWUsaS5vbmlucHV0PWZ1bmN0aW9uKGUpe3RoaXMudmFsdWVfaW5wdXRfY2FsbGJhY2smJnRoaXMudmFsdWVfaW5wdXRfY2FsbGJhY2soZS50YXJnZXQuZGF0YSxlLnRhcmdldC52YWx1ZSl9LmJpbmQodGhpcyksaS5vbmNoYW5nZT1mdW5jdGlvbihlKXt0aGlzLnZhbHVlX2NoYW5nZV9jYWxsYmFjayYmdGhpcy52YWx1ZV9jaGFuZ2VfY2FsbGJhY2soZS50YXJnZXQuZGF0YSxlLnRhcmdldC52YWx1ZSl9LmJpbmQodGhpcyl9LGxheWFhaXJfZGVidWdfdmlldy5zZXRDb250ZW50cz1mdW5jdGlvbihlKXtjb250ZW50X3RhYmxlLmlubmVySFRNTD0iIjtmb3IodmFyIHQ9MDt0PGUubGVuZ3RoO3QrKyl7dmFyIGk9ZVt0XTt0aGlzLmFkZENvbnRlbnQoaSl9fSxsYXlhYWlyX2RlYnVnX3ZpZXcuY2hhbmdlVmFsdWVBdD1mdW5jdGlvbihlLHQpe2NvbnRlbnRfdGFibGUuY2hpbGRyZW5bZV0ubGFzdEVsZW1lbnRDaGlsZC5maXJzdEVsZW1lbnRDaGlsZC52YWx1ZT10fSxsYXlhYWlyX2RlYnVnX3ZpZXcuY2hhbmdlVmFsdWVCeUxhYmVsPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBpPWNvbnRlbnRfdGFibGUuY2hpbGRyZW4ubGVuZ3RoLTE7aT49MDtpLS0paWYoY29udGVudF90YWJsZS5jaGlsZHJlbltpXS5maXJzdEVsZW1lbnRDaGlsZC5pbm5lclRleHQ9PWUpe2NvbnRlbnRfdGFibGUuY2hpbGRyZW5baV0ubGFzdEVsZW1lbnRDaGlsZC5maXJzdEVsZW1lbnRDaGlsZC52YWx1ZT10O2JyZWFrfX0sbGF5YWFpcl9kZWJ1Z192aWV3LnNldFZpc2liaWxpdHk9ZnVuY3Rpb24oZSl7dmlzaWJpbGl0eV9jb250cm9sLmNoZWNrZWQ9ISFlfSxsYXlhYWlyX2RlYnVnX3ZpZXcuc2V0U2hvd0RlYnVnQm9yZGVyPWZ1bmN0aW9uKGUpe3Nob3dfYm9yZGVyX2NvbnRyb2wuY2hlY2tlZD0hIWV9LGxheWFhaXJfZGVidWdfdmlldy5nZXRWaXNpYmlsaXR5PWZ1bmN0aW9uKCl7cmV0dXJuIHZpc2liaWxpdHlfY29udHJvbC5jaGVja2VkfSxsYXlhYWlyX2RlYnVnX3ZpZXcuZ2V0U2hvd0RlYnVnQm9yZGVyPWZ1bmN0aW9uKCl7cmV0dXJuIHNob3dfYm9yZGVyX2NvbnRyb2wuY2hlY2tlZH0sbGF5YWFpcl9kZWJ1Z192aWV3LmdldFNob3dDdXJyZW50Q2FjaGU9ZnVuY3Rpb24oKXtyZXR1cm4gc2hvd19jdXJyZW50X2NhY2hlX2NvbnRyb2wuY2hlY2tlZH0sbGF5YWFpcl9kZWJ1Z192aWV3LmdldFNob3dBbGxDYWNoZT1mdW5jdGlvbigpe3JldHVybiBzaG93X2FsbF9jYWNoZV9jb250cm9sLmNoZWNrZWR9LGxheWFhaXJfZGVidWdfdmlldy5nZXRTaG93QXRsYXM9ZnVuY3Rpb24oKXtyZXR1cm4gc2hvd19hdGxhc19jb250cm9sLmNoZWNrZWR9LGxheWFhaXJfZGVidWdfdmlldy5vbkluc3BlY3RFbGVtZW50PWZ1bmN0aW9uKGUpe3RoaXMub25faW5zcGVjdF9lbGVtZW50X2NhbGxiYWNrPWV9LGxheWFhaXJfZGVidWdfdmlldy5vbkxvZ0luZm89ZnVuY3Rpb24oZSl7bG9nX2luZm9fY29udHJvbC5vbmNsaWNrPWV9LGxheWFhaXJfZGVidWdfdmlldy5vblJlZnJlc2g9ZnVuY3Rpb24oZSl7cmVmcmVzaF9jb250cm9sLm9uY2xpY2s9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3Lm9uUHJpbnRFbmFibGVkTm9kZUNoYWluPWZ1bmN0aW9uKGUpe2VuYWJsZWRfbm9kZV9jaGFpbl9jb250cm9sLm9uY2xpY2s9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3Lm9uUHJpbnRTaXplQ2hhaW49ZnVuY3Rpb24oZSl7c2l6ZV9jaGFpbl9jb250cm9sLm9uY2xpY2s9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3Lm9uVG9nZ2xlVmlzaWJpbGl0eT1mdW5jdGlvbihlKXt2aXNpYmlsaXR5X2NvbnRyb2wub25jaGFuZ2U9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3Lm9uVG9nZ2xlRGVidWdCb3JkZXI9ZnVuY3Rpb24oZSl7c2hvd19ib3JkZXJfY29udHJvbC5vbmNoYW5nZT1lfSxsYXlhYWlyX2RlYnVnX3ZpZXcub25Ub2dnbGVTaG93Q3VycmVudENhY2hlPWZ1bmN0aW9uKGUpe3Nob3dfY3VycmVudF9jYWNoZV9jb250cm9sLm9uY2hhbmdlPWV9LGxheWFhaXJfZGVidWdfdmlldy5vblRvZ2dsZVNob3dBbGxDYWNoZT1mdW5jdGlvbihlKXtzaG93X2FsbF9jYWNoZV9jb250cm9sLm9uY2hhbmdlPWV9LGxheWFhaXJfZGVidWdfdmlldy5vblRvZ2dsZVNob3dBdGxhcz1mdW5jdGlvbihlKXtzaG93X2F0bGFzX2NvbnRyb2wub25jaGFuZ2U9ZX07",e}(),ze=function(){function t(){this.mSprite=null,this.mIndex=0,this.mTextureDic={}}E(t,"laya.debug.tools.AtlasTools");var e=t.prototype;return e.start=function(){hn.isWebGL&&(null==this.mSprite&&(this.mSprite=new ya),S.stage.addChild(this.mSprite),this.showNext())},e.end=function(){hn.isWebGL&&this.mSprite&&S.stage.removeChild(this.mSprite)},e.showNext=function(){if(hn.isWebGL){var t;null==this.mSprite&&(this.mSprite=new ya),S.stage.addChild(this.mSprite),this.mIndex++;var e,i=(t=laya.webgl.atlas.AtlasResourceManager.instance).getAtlaserCount();if(this.mIndex>=i&&(this.mIndex=0),this.mTextureDic[this.mIndex])e=this.mTextureDic[this.mIndex];else{var n=t.getAtlaserByIndex(this.mIndex);n&&n.texture&&(e=new Hr(n.texture,null),this.mTextureDic[this.mIndex]=e)}e&&(this.mSprite.graphics.clear(),this.mSprite.graphics.save(),this.mSprite.graphics.alpha(.9),this.mSprite.graphics.drawRect(0,0,1024,1024,"#efefefe"),this.mSprite.graphics.restore(),this.mSprite.graphics.drawTexture(e,0,0,1024,1024),this.mSprite.graphics.fillText((this.mIndex+1).toString()+"/"+i.toString(),25,100,"40px Arial","#ff0000","left"))}},t.getInstance=function(){return t.mInstance=t.mInstance||new t},t.mInstance=null,t}(),je=function(){function t(t,e){this.data=null,this.replaceO=null,this.idKey=null,this._loadedHandler=null,this.data=t,e||(e=Math.random()+"key"),this.idKey=e,this.init()}E(t,"laya.debug.tools.Base64Atlas");var e=t.prototype;return e.init=function(){var t;for(t in this.replaceO={},this.data)this.replaceO[t]=this.idKey+"/"+t},e.getAdptUrl=function(t){return this.replaceO[t]},e.preLoad=function(t){this._loadedHandler=t,S.loader.load(Je.getPreloads(this.data),new C(this,this.preloadEnd))},e.preloadEnd=function(){var t;for(t in this.data){var e;e=S.loader.getRes(this.data[t]),kr.cacheRes(this.replaceO[t],e)}this._loadedHandler&&this._loadedHandler.run()},e.replaceRes=function(t){xi.replaceValue(t,this.replaceO)},t}(),Je=function(){function e(){}return E(e,"laya.debug.tools.Base64ImageTool"),e.getCanvasPic=function(t){t=t.bitmap;var e=vn.createElement("canvas"),i=e.getContext("2d");return e.height=t.height,e.width=t.width,i.drawImage(t.source,0,0),e},e.getBase64Pic=function(t){return e.getCanvasPic(t).toDataURL("image/png")},e.getPreloads=function(t){var e,i;for(i in e=[],t)e.push({url:t[i],type:"image"});return e},e}(),Ke=function(){function c(){}return E(c,"laya.debug.tools.Base64Tool"),c.init=function(){if(!c.lookup){c.lookup=new Uint8Array(256);for(var t=0;t<c.chars.length;t++)c.lookup[c.chars.charCodeAt(t)]=t}},c.encode=function(t){var e=new Uint8Array(t),i=0,n=e.length,r="";for(i=0;i<n;i+=3)r+=c.chars[e[i]>>2],r+=c.chars[(3&e[i])<<4|e[i+1]>>4],r+=c.chars[(15&e[i+1])<<2|e[i+2]>>6],r+=c.chars[63&e[i+2]];return n%3==2?r=r.substring(0,r.length-1)+"=":n%3==1&&(r=r.substring(0,r.length-2)+"=="),r},c.encodeStr=function(t){var e;return(e=new yn).writeUTFString(t),c.encodeByte(e)},c.encodeStr2=function(t){var e;return(e=new yn).writeUTFBytes(t),c.encodeByte(e)},c.encodeByte=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),i<0&&(i=t.length),c.encode(t.buffer.slice(e,i))},c.decodeToByte=function(t){return new yn(c.decode(t))},c.decode=function(t){c.init();var e=.75*t.length,i=t.length,n=0,r=0,a=0,s=0,o=0,l=0;"="===t[t.length-1]&&(e--,"="===t[t.length-2]&&e--);var h=new ArrayBuffer(e),u=new Uint8Array(h);for(n=0;n<i;n+=4)a=c.lookup[t.charCodeAt(n)],s=c.lookup[t.charCodeAt(n+1)],o=c.lookup[t.charCodeAt(n+2)],l=c.lookup[t.charCodeAt(n+3)],u[r++]=a<<2|s>>4,u[r++]=(15&s)<<4|o>>2,u[r++]=(3&o)<<6|63&l;return h},c.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c.lookup=null,c}(),Qe=function(){function n(){}E(n,"laya.debug.tools.CacheAnalyser");var t=n.prototype;return t.renderCanvas=function(t,e){void 0===e&&(e=0),n.showCacheSprite&&(Is.I.isDebugItem(t)||Xe.showDisBoundToSprite(t,Is.I.cacheViewLayer,ni.CANVAS_REC_COLOR,4))},t.reCacheCanvas=function(t,e){var i;(void 0===e&&(e=0),n.showRecacheSprite)&&(Is.I.isDebugItem(t)||((i=n.getNodeInfoByNode(t)).addCount(e),n.counter.addTime(t,e),i.parent||Is.I.nodeRecInfoLayer.addChild(i)))},n.renderLoopBegin=function(){Is.I.cacheViewLayer.graphics.clear()},n.getNodeInfoByNode=function(t){pi.idObj(t);var e;return e=pi.getObjID(t),n._nodeInfoDic[e]||(n._nodeInfoDic[e]=new So),n._nodeInfoDic[e].setTarget(t),n._nodeInfoDic[e]},n._nodeInfoDic={},n.showCacheSprite=!1,n.showRecacheSprite=!0,m(n,["counter",function(){return this.counter=new bi},"I",function(){return this.I=new n}]),n}(),qe=function(){function _(){}return E(_,"laya.debug.tools.CanvasTools"),_.createCanvas=function(t,e){var i=new Ys("2D");return i.getContext("2d"),i.size(t,e),i},_.renderSpriteToCanvas=function(t,e,i,n){cn.renders[t._renderType]._fun(t,e.context,i,n)},_.getImageDataFromCanvas=function(t,e,i,n,r){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),n<=0&&(n=t.width),r<=0&&(r=t.height),t.context.getImageData(e,i,n,r)},_.getImageDataFromCanvasByRec=function(t,e){return t.context.getImageData(e.x,e.y,e.width,e.height)},_.getDifferCount=function(t,e){var r=t.data,a=e.data,s=0;return s=0,_.walkImageData(t,function(t,e,i,n){_.isPoinSame(i,r,a)||s++}),s},_.getDifferRate=function(t,e){return _.getDifferCount(t,e)/(t.width*t.height)},_.getCanvasDisRec=function(t){var e,i;e=new nn;var n=0,r=0,a=0,s=0;n=a=0,r=(i=_.getImageDataFromCanvas(t,0,0)).width,s=i.height;var o,l,h,u=0,c=0;o=i.width,l=i.height,h=i.data;var d=0;for(c=0;c<l;c++)for(u=0;u<o;u++)_.isEmptyPoint(h,d)||(u<r&&(r=u),n<u&&(n=u),c<s&&(s=c),a<c&&(a=c)),d+=4;return e.setTo(r,s,n-r+1,a-s+1),e},_.fillCanvasRec=function(t,e,i){var n=t.context;n.fillStyle=i,n.fillRect(e.x,e.y,e.width,e.height)},_.isEmptyPoint=function(t,e){return 0==t[e]&&0==t[e+1]&&0==t[e+2]&&0==t[e+3]},_.isPoinSame=function(t,e,i){return e[t]==i[t]&&e[t+1]==i[t+1]&&e[t+2]==i[t+2]&&e[t+3]==i[t+3]},_.walkImageData=function(t,e){var i,n,r=0,a=0;i=t.width,n=t.height;var s=0,o=t.data;for(r=0;r<i;r++)for(a=0;a<n;a++)e(r,a,s,o),s+=4},_.getSpriteByCanvas=function(t){var e;return(e=new ya).graphics.drawTexture(new Hr(t),0,0,t.width,t.height),e},_.renderSpritesToCanvas=function(t,e,i,n,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var a,s=0;for(a=e.length,s=r;s<a;s++)_.renderSpriteToCanvas(e[s],t,i,n)},_.clearCanvas=function(t){var e,i;e=t.width,i=t.height,t.size(e+1,i),t.size(e,i)},_.getImagePixels=function(t,e,i,n,r){void 0===r&&(r=4);var a;a=(t*i+e)*r;var s,o,l=0;for(o=[],s=r,l=0;l<s;l++)o.push(n[a+l]);return o},_}(),$e=function(){function r(){}return E(r,"laya.debug.tools.ClassTool"),r.defineProperty=function(t,e,i){Object.defineProperty(t,e,i)},r.getOwnPropertyDescriptor=function(t,e){return Object.getOwnPropertyDescriptor(t,e)},r.getOwnPropertyDescriptors=function(t){return Object.getOwnPropertyDescriptors(t)},r.getOwnPropertyNames=function(t){return Object.getOwnPropertyNames(t)},r.getObjectGetSetKeys=function(t,e){var i,n;for(n in e||(e=[]),i=laya.debug.tools.ClassTool.getOwnPropertyNames(t))0<=(n=i[n]).indexOf("_$get_")&&(n=n.replace("_$get_",""),e.push(n));return t.__proto__&&r.getObjectGetSetKeys(t.__proto__,e),e},r.getObjectDisplayAbleKeys=function(t,e){var i;for(i in e||(e=[]),t)typeof t[i],"_"!=i.charAt(0)&&e.push(i);return r.getObjectGetSetKeys(t,e),e=xi.getNoSameArr(e)},r.getClassName=function(t){return"function"==typeof t?t.name:t.constructor.name},r.getNodeClassAndName=function(t){return t?t.name?r.getClassName(t)+"("+t.name+")":r.getClassName(t):"null"},r.getClassNameByClz=function(t){return t.name},r.getClassByName=function(t){return S._runScript(t)},r.createObjByName=function(t){return new(r.getClassByName(t))},m(r,["displayTypes",function(){return this.displayTypes={boolean:!0,number:!0,string:!0}}]),r}(),ti=function(){function e(){this.completeHandler=null,this.tSelectTar=null,this._selectTip=new ya,this._selectTip.setBounds(new nn(0,0,0,0)),Fr.listen("ItemClicked",this,this.itemClicked)}E(e,"laya.debug.tools.ClickSelectTool");var t=e.prototype;return t.beginClickSelect=function(t){this.completeHandler=t,e.isClickSelectState=!0,this.clickSelectChange()},t.clickSelectChange=function(){vn.onPC&&(this.tSelectTar=null,this.clearSelectTip(),e.isClickSelectState?S.timer.loop(200,this,this.updateSelectTar,null,!0):S.timer.clear(this,this.updateSelectTar))},t.clearSelectTip=function(){this._selectTip.removeSelf()},t.updateSelectTar=function(){var t,e;(this.clearSelectTip(),this.tSelectTar=li.instance.getDisUnderMouse(),this.tSelectTar)&&(Is.I.isDebugItem(this.tSelectTar)||((t=this._selectTip.graphics).clear(),e=Fi.getGRec(this.tSelectTar),Is.I.popLayer.addChild(this._selectTip),t.drawRect(0,0,e.width,e.height,null,ni.CLICK_SELECT_COLOR,2),this._selectTip.pos(e.x,e.y)))},t.itemClicked=function(t){e.isClickSelectState&&(e.ignoreDebugTool&&Is.I.isDebugItem(t)||t instanceof laya.debug.uicomps.ContextMenuItem||t.parent instanceof laya.debug.uicomps.ContextMenuItem||(Xe.showDisBound(t),this.completeHandler&&this.completeHandler.runWith(t),e.isClickSelectState=!1,this.clickSelectChange()))},v(1,e,"I",function(){return e._I||(e._I=new e),e._I}),e._I=null,e.isClickSelectState=!1,e.ignoreDebugTool=!1,e}(),ei=function(){function e(){this.red=NaN,this.green=NaN,this.blue=NaN}return E(e,"laya.debug.tools.ColorTool"),e.toHexColor=function(t){return Dn.toHexColor(t)},e.getRGBByRGBStr=function(t){"#"==t.charAt(0)&&(t=t.substr(1));var e=parseInt(t,16);t.length;return[(16711680&e)>>16,(65280&e)>>8,255&e]},e.getColorBit=function(t){var e;return e=1<(e=Math.floor(t).toString(16)).length?e:"0"+e},e.getRGBStr=function(t){return"#"+e.getColorBit(t[0])+e.getColorBit(t[1])+e.getColorBit(t[2])},e.traseHSB=function(t){console.log("hsb:",t[0],t[1],t[2])},e.rgb2hsb=function(t,e,i){var n=[t,e,i];n.sort(vi.sortNumSmallFirst);var r=n[2],a=n[0],s=0;return r==a?s=1:0==t&&0==e&&0==i||(r==t&&i<=e?s=60*(e-i)/(r-a)+0:r==t&&e<i?s=60*(e-i)/(r-a)+360:r==e?s=60*(i-t)/(r-a)+120:r==i&&(s=60*(t-e)/(r-a)+240)),[s,0==r?0:(r-a)/r,r/255]},e.hsb2rgb=function(t,e,i){var n=0,r=0,a=0,s=Math.floor(t/60%6),o=t/60-s,l=i*(1-e),h=i*(1-o*e),u=i*(1-(1-o)*e);switch(s){case 0:n=i,r=u,a=l;break;case 1:n=h,r=i,a=l;break;case 2:n=l,r=i,a=u;break;case 3:n=l,r=h,a=i;break;case 4:n=u,r=l,a=i;break;case 5:n=i,r=l,a=h}return[Math.floor(255*n),Math.floor(255*r),Math.floor(255*a)]},e}(),ii=function(){function t(){this.data={},this.preO={},this.changeO={},this.count=0}E(t,"laya.debug.tools.CountTool");var e=t.prototype;return e.reset=function(){this.data={},this.count=0},e.add=function(t,e){void 0===e&&(e=1),this.count++,this.data.hasOwnProperty(t)||(this.data[t]=0),this.data[t]=this.data[t]+e},e.getKeyCount=function(t){return this.data.hasOwnProperty(t)||(this.data[t]=0),this.data[t]},e.getKeyChange=function(t){return this.changeO[t]?this.changeO[t]:0},e.record=function(){var t;for(t in this.changeO)this.changeO[t]=0;for(t in this.data)this.preO[t]||(this.preO[t]=0),this.changeO[t]=this.data[t]-this.preO[t],this.preO[t]=this.data[t]},e.getCount=function(t){var e,i=0;for(e in t)i+=t[e];return i},e.traceSelf=function(t){t||(t=this.data);var e;return e=this.getCount(t),console.log("total:"+e),"total:"+e+"\n"+Mi.traceObj(t)},e.traceSelfR=function(t){t||(t=this.data);var e;return e=this.getCount(t),console.log("total:"+e),"total:"+e+"\n"+Mi.traceObjR(t)},t}(),ni=function(){function t(){}return E(t,"laya.debug.tools.DebugConsts"),t.CLICK_SELECT_COLOR="#ff0000",t.CANVAS_REC_COLOR="#FF00FF",t.RECACHE_REC_COLOR="#00ff00",t.SPRITE_REC_COLOR="#ff0000",t.SPRITE_REC_LINEWIDTH=2,t}(),ri=function(){function i(){}return E(i,"laya.debug.tools.DebugExport"),i.export=function(){var t,e;for(e in t=d,i._exportsDic)t[e]=i._exportsDic[e]},m(i,["_exportsDic",function(){return this._exportsDic={DebugTool:Xe,Watcher:Vi}}]),i}(),ai=function(){function n(t,e){this.autoTrace=!0,this.sign="",this.obj=null,void 0===t&&(t=""),void 0===e&&(e=!0),this.sign=t,this.autoTrace=e}return E(n,"laya.debug.tools.DifferTool"),n.prototype.update=function(t,e){e&&console.log(e);var i,n=xi.copyObj(t);return this.obj||(this.obj={}),i=xi.differ(this.obj,n),this.obj=n,this.autoTrace&&(console.log(this.sign+" differ:"),xi.traceDifferObj(i)),i},n.differ=function(t,e,i){return n._differO[t]||(n._differO[t]=new n(t,!0)),n._differO[t].update(e,i)},n._differO={},n}(),si=function(){function e(){this.arrowAxis=null,this._target=null,this.recInfo=null,e.init(),this.arrowAxis=new Ts,this.arrowAxis.mouseEnabled=!0}E(e,"laya.debug.tools.DisController");var t=e.prototype;return t.switchType=function(){this.arrowAxis.switchType()},t.updateMe=function(){this._target&&(this.recInfo=Ti.getGlobalRecInfo(this._target,0,0,1,0,0,1),console.log("rotation:",this.recInfo.rotation),console.log("pos:",this.recInfo.x,this.recInfo.y),console.log("scale:",this.recInfo.width,this.recInfo.height),this.arrowAxis.x=this.recInfo.x,this.arrowAxis.y=this.recInfo.y,this.arrowAxis.rotation=this.recInfo.rotation,this.arrowAxis.yAxis.rotation=this.recInfo.rotationV-this.recInfo.rotation)},v(0,t,"target",function(){return this._target},function(t){(this._target=t)?(e._container.addChild(this.arrowAxis),S.timer.loop(100,this,this.updateMe)):(this.arrowAxis.removeSelf(),S.timer.clear(this,this.updateMe)),this.arrowAxis.target=t,this.updateMe()}),v(0,t,"type",function(){return this.arrowAxis.type},function(t){this.arrowAxis.type=t}),e.init=function(){e._container?oi.setTop(e._container):((e._container=new ya).mouseEnabled=!0,S.stage.addChild(e._container))},e._container=null,m(e,["I",function(){return this.I=new e}]),e}(),oi=function(){function l(){}return E(l,"laya.debug.tools.DisControlTool"),l.getObjectsUnderPoint=function(t,e,i,n,r){if(n=n||[],null!=r&&!r(t))return n;if(t.getBounds().contains(e,i)){n.push(t);var a=new en;a.setTo(e,i),e=(a=t.fromParentPoint(a)).x,i=a.y;for(var s=t._childs.length-1;-1<s;s--){var o=t._childs[s];o instanceof laya.display.Sprite&&l.getObjectsUnderPoint(o,e,i,n,r)}}return n},l.getObjectsUnderGlobalPoint=function(t,e){var i=new en;return i.setTo(S.stage.mouseX,S.stage.mouseY),t.parent&&(i=t.parent.globalToLocal(i)),l.getObjectsUnderPoint(t,i.x,i.y,null,e)},l.findFirstObjectsUnderGlobalPoint=function(){var t;if(!(t=l.getObjectsUnderGlobalPoint(S.stage)))return null;var e,i=0;for(i=t.length-1;0<=i;i--)if((e=t[i])&&e.numChildren<1)return e;return e},l.visibleAndEnableObjFun=function(t){return t.visible&&t.mouseEnabled},l.visibleObjFun=function(t){return t.visible},l.getMousePoint=function(t){var e=new en;return e.setTo(S.stage.mouseX,S.stage.mouseY),e=t.globalToLocal(e)},l.isChildE=function(t,e){if(!t)return!1;for(;e;){if(e.parent==t)return!0;e=e.parent}return!1},l.isInTree=function(t,e){return t==e||l.isChildE(t,e)},l.setTop=function(t){var e;t&&t.parent&&(e=t.parent).setChildIndex(t,e.numChildren-1)},l.clearItemRelativeInfo=function(t){t.getLayout().left="NaN",t.getLayout().right="NaN",t.getLayout().top="NaN",t.getLayout().bottom="NaN"},l.swap=function(t,e){if(t!=e){var i;i=t.parent.getChildIndex(t);var n,r;n=e.parent.getChildIndex(e),r=e.parent,t.parent.addChildAt(e,i),r.addChildAt(t,n)}},l.insertToTarParent=function(t,e,i){void 0===i&&(i=!1);var n,r=0;t&&(n=t.parent)&&(r=n.getChildIndex(t),i&&r++,l.insertToParent(n,e,r))},l.insertToParent=function(t,e,i){if(void 0===i&&(i=-1),t){i<0&&(i=t.numChildren);var n,r=0;for(n=e.length,r=0;r<n;r++)l.transParent(e[r],t),t.addChildAt(e[r],i)}},l.transParent=function(t,e){var i,n;t&&e&&(t.parent&&(i=t.parent,n=new en(t.x,t.y),n=i.localToGlobal(n),n=e.globalToLocal(n),t.pos(n.x,n.y)))},l.transPoint=function(t,e,i){return i=t.localToGlobal(i),i=e.globalToLocal(i)},l.removeItems=function(t){var e,i=0;for(e=t.length,i=0;i<e;i++)t[i].removeSelf()},l.addItems=function(t,e){var i,n=0;for(i=t.length,n=0;n<i;n++)e.addChild(t[n])},l.getAllChild=function(t){if(!t)return[];var e,i=0,n=[];for(e=t.numChildren,i=0;i<e;i++)n.push(t.getChildAt(i));return n},l.upDis=function(t){if(t&&t.parent){var e,i=0;(i=(e=t.parent).getChildIndex(t)+1)>=e.numChildren&&(i=e.numChildren-1),console.log("setChildIndex:"+i),e.setChildIndex(t,i)}},l.downDis=function(t){if(t&&t.parent){var e,i=0;(i=(e=t.parent).getChildIndex(t)-1)<0&&(i=0),console.log("setChildIndex:"+i),e.setChildIndex(t,i)}},l.setResizeAbleEx=function(t){var e;(e=t.getChildByName("resizeBtn"))&&Ri.setResizeAble(e,t)},l.setResizeAble=function(t){t.on("click",null,l.resizeHandler,[t])},l.resizeHandler=function(t){Ei.setUp(t)},l.setDragingItem=function(t,e){t.on("mousedown",null,l.dragingHandler,[e]),e.on("dragend",null,l.dragingEnd,[e])},l.dragingHandler=function(t){t&&t.startDrag()},l.dragingEnd=function(t){l.intFyDisPos(t),console.log(t.x,t.y)},l.showToStage=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.getBounds();t.x=S.stage.mouseX+e,t.y=S.stage.mouseY+i,t.x+n.width>S.stage.width&&(t.x-=n.width+e),t.y+n.height>S.stage.height&&(t.y-=n.height+i),l.intFyDisPos(t)},l.intFyDisPos=function(t){t&&(t.x=Math.round(t.x),t.y=Math.round(t.y))},l.showOnly=function(t,e){var i,n=0;for(i=t.length,n=0;n<i;n++)t[n].visible=t[n]==e},l.showOnlyByIndex=function(t,e){l.showOnly(t,t[e])},l.addOnly=function(t,e,i){var n,r=0;for(n=t.length,r=0;r<n;r++)t[r]!=e?t[r].removeSelf():i.addChild(t[r])},l.addOnlyByIndex=function(t,e,i){l.addOnly(t,t[e],i)},m(l,["tempP",function(){return this.tempP=new en}]),l}(),li=function(){function c(){this.mouseX=NaN,this.mouseY=NaN,this._stage=null,this._target=null,this.isGetting=!1,this._matrix=new tn,this._point=new en,this._rect=new nn,this._event=ki.EMPTY,this._stage=S.stage,this.init(hn.context.canvas)}E(c,"laya.debug.tools.DisplayHook");var t=c.prototype;return t.init=function(t){var r=this;vn.window.navigator.msPointerEnabled&&(t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none");var a=this;function s(t,e){a._event._stoped=!1,a._event.nativeEvent=e||t,a._target=null,t.offsetX?(a.mouseX=t.offsetX,a.mouseY=t.offsetY):(a.mouseX=t.clientX-S.stage.offset.x,a.mouseY=t.clientY-S.stage.offset.y)}vn.document.addEventListener("mousedown",function(t){r._event._stoped=!1,c.isFirst=!0,a.check(a._stage,t.offsetX,t.offsetY,a.onMouseDown,!0,!1)},!0),vn.document.addEventListener("touchstart",function(t){r._event._stoped=!1,c.isFirst=!0;for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){s(e[i],t),a.check(a._stage,a.mouseX,a.mouseY,a.onMouseDown,!0,!1)}},!0)},t.onMouseMove=function(t,e){this.sendEvent(t,"mousemove")},t.onMouseUp=function(t,e){e&&this.sendEvent(t,"mouseup")},t.onMouseDown=function(t,e){e&&(t.$_MOUSEDOWN=!0,this.sendEvent(t,"mousedown"))},t.sendEvent=function(t,e){this._event._stoped||(t.event(e,this._event.setTo(e,t,t)),"mouseup"===e&&t.$_MOUSEDOWN&&(t.$_MOUSEDOWN=!1,t.event("click",this._event.setTo("click",t,t))))},t.selectDisUnderMouse=function(){c.isFirst=!0,this.check(S.stage,S.stage.mouseX,S.stage.mouseY,null,!0,!1),sl.I.setSelectTarget(Xe.target)},t.getDisUnderMouse=function(){return this.isGetting=!0,c.isFirst=!0,Xe.target=null,this.check(S.stage,S.stage.mouseX,S.stage.mouseY,null,!0,!1),this.isGetting=!1,Xe.target},t.check=function(t,e,i,n,r,a){if(t==Xe.debugLayer)return!1;if(t==Is.I)return!1;if(this.isGetting&&t==Is.I)return!1;if(!t.visible||t.getSelfBounds().width<=0)return!1;var s=!1,o=!!0;if(r&&(this._rect=t.getBounds(),s=this._rect.contains(e,i),this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y),s){for(var l=!1,h=t._childs.length-1;-1<h;h--){var u=t._childs[h];if(l=this.check(u,e,i,n,r,!0))break}o=t.getGraphicBounds().contains(e,i),(s=l||o)&&!l&&c.isFirst&&(c.isFirst=!1,t instanceof laya.debug.tools.debugUI.DButton||(Xe.target=t,this.isGetting||(Xe.autoWork(),Fr.notify("ItemClicked",t))))}return s},c.initMe=function(){c.instance||(c.instance=new c)},c.ITEM_CLICKED="ItemClicked",c.instance=null,c.isFirst=!1,c}(),hi=function(){function i(){}return E(i,"laya.debug.tools.DTrace"),i.getArgArr=function(t){var e;e=[];var i=0,n=t.length;for(i=0;i<n;i++)e.push(t[i]);return e},i.dTrace=function(t){var e=arguments;(e=i.getArgArr(e)).push(Mi.getCallLoc(2)),console.log.apply(console,e),e.join(" ")},i.timeStart=function(t){console.time(t)},i.timeEnd=function(t){console.timeEnd(t)},i.traceTable=function(t){console.table(t)},i}(),ui=function(){function a(){this.createInfo={}}E(a,"laya.debug.tools.enginehook.ClassCreateHook");var t=a.prototype;return t.hookClass=function(e){var i=this;if(!a.isInited){a.isInited=!0;fi.hook(e,"call",function(t){i.classCreated(t,e)})}},t.classCreated=function(t,e){var i;i=$e.getNodeClassAndName(t);var n,r=0;for(n=t;n&&n!=e;)n=n.__super,r++;a.I.createInfo[i]||(a.I.createInfo[i]=0),a.I.createInfo[i]=a.I.createInfo[i]+1,Ci.run(i,r+6)},t.getClassCreateInfo=function(t){var e;return e=$e.getClassName(t),Ci.getRunInfo(e)},a.isInited=!1,m(a,["I",function(){return this.I=new a}]),a}(),ci=function(){function n(){}E(n,"laya.debug.tools.enginehook.RenderSpriteHook");var t=n.prototype;return t.createRenderSprite=function(t,e){var i;return i=n._preCreateFun(t,e),16==t&&(i._oldCanvas=i._fun,i._fun=n.I._canvas),i},t._canvas=function(t,e,i,n){if(di.allowRendering){var r=t._$P.cacheCanvas,a=this._next;if(r&&!di.isVisibleTesting){var s;s=vn.now();var o=r.ctx,l=t._needRepaint()||!o;this._oldCanvas(t,e,i,n),T.showCanvasMark,l?Qe.I.reCacheCanvas(t,vn.now()-s):Qe.I.renderCanvas(t,vn.now()-s)}else a._fun.call(a,t,e,i,n)}},n.init=function(){n.I||(n.I=new n,n._preCreateFun=M.createRenderSprite,M.createRenderSprite=n.I.createRenderSprite)},n.IMAGE=1,n.FILTERS=2,n.ALPHA=4,n.TRANSFORM=8,n.CANVAS=16,n.BLEND=32,n.CLIP=64,n.STYLE=128,n.GRAPHICS=256,n.CUSTOM=512,n.ENABLERENDERMERGE=1024,n.CHILDS=2048,n.INIT=69905,n.renders=[],n.I=null,n._preCreateFun=null,n}(),di=function(){function r(){this._repaint=1,this._renderType=1,this._x=0,this._y=0,this.target=null,this.isTargetRenderd=!1,this.preFun=null,this._next=null,this.pgraphic=cn.prototype._graphics,this.pimage=cn.prototype._image,this.pimage2=cn.prototype._image2}E(r,"laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse");var t=r.prototype;return t.setRenderHook=function(){ya.prototype.render=r.I.render},t.render=function(t,e,i){if(this,!Is.I.isDebugItem(this))if(this==laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.I.target&&(laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.allowRendering=!0,laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.I.isTargetRenderd=!0,qe.clearCanvas(r.mainCanvas)),cn.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this==laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.I.target)r.tarRec=qe.getCanvasDisRec(laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.mainCanvas),console.log("rec",r.tarRec.toString()),0<r.tarRec.width&&0<r.tarRec.height?(r.isTarRecOK=!0,r.preImageData=qe.getImageDataFromCanvasByRec(r.mainCanvas,r.tarRec),r.tarImageData=qe.getImageDataFromCanvasByRec(r.mainCanvas,r.tarRec)):console.log("tarRec Not OK:",r.tarRec);else if(r.isTarRecOK){r.tImageData=qe.getImageDataFromCanvasByRec(r.mainCanvas,r.tarRec);var n;n=qe.getDifferRate(r.preImageData,r.tImageData),r.preImageData=r.tImageData,0<n&&Di.addCoverNode(this,n)}},t.analyseNode=function(t){Di.resetCoverList(),ya.prototype.render!=r.I.render&&(this.preFun=ya.prototype.render),this.target=t,ya.prototype.render=this.render,r.tarCanvas||(r.tarCanvas=qe.createCanvas(S.stage.width,S.stage.height)),r.mainCanvas||(r.mainCanvas=qe.createCanvas(S.stage.width,S.stage.height)),this.isTargetRenderd=!1,r.isVisibleTesting=!0,r.allowRendering=!1,qe.clearCanvas(r.mainCanvas),qe.clearCanvas(r.tarCanvas),r.isTarRecOK=!1;var e=new un(r.mainCanvas.width,r.mainCanvas.height,r.mainCanvas);r.mainCanvas=e.canvas,this.render.call(S.stage,e,0,0),r.coverRate=r.isTarRecOK?qe.getDifferRate(r.preImageData,r.tarImageData):0,Di.coverRate=r.coverRate,Di.isTarRecOK=r.isTarRecOK,console.log("coverRate:",r.coverRate),this.isTargetRenderd=!1,r.isVisibleTesting=!1,r.allowRendering=!0,ya.prototype.render=this.preFun},t.noRenderMode=function(){},t.normalMode=function(){cn.prototype._graphics=this.pgraphic,cn.prototype._image=this.pimage,cn.prototype._image2=this.pimage2},t.inits=function(){this.noRenderMode()},t.m_graphics=function(t,e,i,n){if(laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.allowRendering){var r=t._style._tf;t._graphics&&t._graphics._render(t,e,i-r.translateX,n-r.translateY)}var a=this._next;a._fun.call(a,t,e,i,n)},t.m_image=function(t,e,i,n){if(laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.allowRendering){var r=t._style;e.ctx.drawTexture2(i,n,r._tf.translateX,r._tf.translateY,t.transform,r.alpha,r.blendMode,t._graphics._one)}},t.m_image2=function(t,e,i,n){if(laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.allowRendering){var r=t._style._tf;e.ctx.drawTexture2(i,n,r.translateX,r.translateY,t.transform,1,null,t._graphics._one)}},r.tarCanvas=null,r.mainCanvas=null,r.preImageData=null,r.tImageData=null,r.tarImageData=null,r.tarRec=null,r.isTarRecOK=!1,r.isVisibleTesting=!1,r.allowRendering=!0,r.coverRate=NaN,m(r,["I",function(){return this.I=new r}]),r}(),_i=function(){function t(){this._repaint=1,this._renderType=1,this._x=0,this._y=0}return E(t,"laya.debug.tools.enginehook.SpriteRenderHook"),t.prototype.render=function(t,e,i){this==S.stage&&Qe.renderLoopBegin();var n;n=vn.now(),Cn.spriteCount++,this.ShowBorderSign&&Xe.showDisBoundToSprite(this,Is.I.cacheViewLayer,ni.SPRITE_REC_COLOR,ni.SPRITE_REC_LINEWIDTH),cn.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0,Si.I.render(this,vn.now()-n)},t.init=function(){t.I||(t.I=new t,t.setRenderHook())},t.setRenderHook=function(){ya.prototype.render=t.I.render},t.showDisplayBorder=function(t,e){void 0===e&&(e=!0),t.ShowBorderSign=e},t.isDisplayShowBorder=function(t){return t.ShowBorderSign},t.I=null,t.ShowBorderSign="ShowBorderSign",t}(),fi=function(){function r(){}return E(r,"laya.debug.tools.hook.FunHook"),r.hook=function(t,e,i,n){r.hookFuns(t,e,[i,t[e],n],1)},r.hookAllFun=function(t){var e,i;for(e in i=$e.getOwnPropertyNames(t))e=i[e],r.special[e]||(console.log("try hook:",e),"function"==typeof t[e]&&(console.log("hook:",e),r.hookFuns(t,e,[r.getTraceMsg("call:"+e),t[e]],1)));t.__proto__?r.hookAllFun(t.__proto__):console.log("end:",t)},r.getTraceMsg=function(t){return function(){console.log(t)}},r.hookFuns=function(t,e,a,s){void 0===s&&(s=-1);var i,n=t[e];(i=function(t){var e,i,n=arguments,r=0;for(i=a.length,r=0;r<i;r++)a[r]&&(r==s?e=a[r].apply(this,n):a[r].apply(this,n));return e}).pre=n,t[e]=i},r.removeHook=function(t,e){null!=t[e].pre&&(t[e]=t[e].pre)},r.debugHere=function(){},r.traceLoc=function(t,e){void 0===t&&(t=0),void 0===e&&(e=""),console.log(e,"fun loc:",Mi.getCallLoc(3+t))},r.getLocFun=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=""),t+=1,function(){r.traceLoc(t,e)}},m(r,["special",function(){return this.special={length:!0,name:!0,arguments:!0,caller:!0,prototype:!0,is:!0,isExtensible:!0,isFrozen:!0,isSealed:!0,preventExtensions:!0,seal:!0,unobserve:!0,apply:!0,call:!0,bind:!0,freeze:!0,unobserve:!0}}]),r}(),mi=function(){function t(){}return E(t,"laya.debug.tools.hook.VarHook"),t.hookVar=function(t,e,i,n){i||(i=[]),n||(n=[]);var r,a=t,s=t[e],o={},l=function(t){console.log("var hook set "+e+":",t),s=t},h=function(){return console.log("var hook get"+e+":",s),s};if(r=$e.getOwnPropertyDescriptor(t,e))return o.set=l,o.get=h,o.enumerable=r.enumerable,i.push(o.set),n.push(o.get),fi.hookFuns(o,"set",i),fi.hookFuns(o,"get",n,n.length-1),void $e.defineProperty(t,e,o);for(;!r&&t.__proto__;)t=t.__proto__,r=$e.getOwnPropertyDescriptor(t,e);r&&(o.set=r.set?r.set:l,o.get=r.get?r.get:h,o.enumerable=r.enumerable,i.push(o.set),n.push(o.get),fi.hookFuns(o,"set",i),fi.hookFuns(o,"get",n,n.length-1),$e.defineProperty(a,e,o)),r||(console.log("get des fail add directly"),o.set=l,o.get=h,i.push(o.set),n.push(o.get),fi.hookFuns(o,"set",i),fi.hookFuns(o,"get",n,n.length-1),$e.defineProperty(t,e,o))},t.getLocFun=function(t,e){return void 0===t&&(t=""),void 0===e&&(e=0),e+=1,function(){fi.traceLoc(e,t)}},t}(),pi=function(){function i(){this.tID=1}return E(i,"laya.debug.tools.IDTools"),i.prototype.getID=function(){return this.tID++},i.getAID=function(){return i._ID.getID()},i.idObjE=function(t,e){return void 0===e&&(e="default"),t._M_id_||(e||(e="default"),i._idDic[e]||(i._idDic[e]=new i),t._M_id_=i._idDic[e].getAID()),t},i.setObjID=function(t,e){return t._M_id_=e,t},i.idObj=function(t){return t._M_id_||(t._M_id_=i.getAID()),t},i.getObjID=function(t){return t?t._M_id_:-1},i.idSign="_M_id_",m(i,["_ID",function(){return this._ID=new i},"_idDic",function(){return this._idDic={default:new i}}]),i}(),gi=(function(){function f(){}E(f,"laya.debug.tools.JsonTool"),f.getJsonString=function(t,e,i,n,r){void 0===e&&(e=!0),void 0===i&&(i="\n"),void 0===n&&(n=0),void 0===r&&(r=4);var a,s,o,l,h="";for(s in h=f.getEmptyStr(n*r),a={},l=[],t)l.push(s),o=t[s],f.singleLineKey[s]?a[s]=f.getValueStr(o,!0,i,n+1,r):a[s]=f.getValueStr(o,e,i,n+1,r);var u,c,d,_=0;for(u=l.length,l.sort(),l=l.reverse(),c=f.getEmptyStr((n+1)*r),e&&(c=h=i=""),d=[],_=0;_<u;_++)s=l[_],d.push(c+f.wrapValue(s)+":"+a[s]);return"{"+i+d.join(","+i)+i+h+"}"},f.wrapValue=function(t,e){return void 0===e&&(e='"'),e+t+e},f.getArrStr=function(t,e,i,n,r){void 0===e&&(e=!0),void 0===i&&(i="\n"),void 0===n&&(n=0),void 0===r&&(r=4);var a,s,o=0;for(a=t.length,s=[],o=0;o<a;o++)s.push(f.getValueStr(t[o],e,i,n+1,r));var l="";return l=f.getEmptyStr((n+1)*r),e&&(l=i=""),"["+i+l+s.join(","+i+l)+"]"},f.quote=function(t){return f.escapable.lastIndex=0,f.escapable.test(t)?'"'+t.replace(f.escapable,function(t){var e=f.meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'},f.getValueStr=function(t,e,i,n,r){return void 0===e&&(e=!0),void 0===i&&(i="\n"),void 0===n&&(n=0),void 0===r&&(r=0),"string"==typeof t?f.quote(t):null==t?"null":"number"==typeof t||"number"==typeof t&&Math.floor(t)==t||"boolean"==typeof t?t:t instanceof Array?f.getArrStr(t,e,i,n,r):"object"==typeof t?f.getJsonString(t,e,i,n,r):t},f.getEmptyStr=function(t){if(!f.emptyDic.hasOwnProperty(t)){var e,i,n=0;for(e=t,i="",n=0;n<e;n++)i+=" ";f.emptyDic[t]=i}return f.emptyDic[t]},f.emptyDic={},m(f,["singleLineKey",function(){return this.singleLineKey={props:!0}},"escapable",function(){return this.escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g},"meta",function(){return this.meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}}])}(),function(){function a(){}return E(a,"laya.debug.tools.JSTools"),a.showToBody=function(t,e,i){var n;void 0===e&&(e=0),void 0===i&&(i=0),vn.document.body.appendChild(t),(n=t.style).position="absolute",n.top=i+"px",n.left=e+"px"},a.showToParent=function(t,e,i,n){var r;void 0===e&&(e=0),void 0===i&&(i=0),n.appendChild(t),(r=t.style).position="absolute",r.top=i+"px",r.left=e+"px"},a.addToBody=function(t){vn.document.body.appendChild(t)},a.setPos=function(t,e,i){var n;(n=t.style).top=i+"px",n.left=e+"px"},a.setSize=function(t,e,i){var n;(n=t.style).width=e+"px",n.height=i+"px"},a.setTransform=function(t,e){var i;(i=t.style).transformOrigin=i.webkitTransformOrigin=i.msTransformOrigin=i.mozTransformOrigin=i.oTransformOrigin="0px 0px 0px",i.transform=i.webkitTransform=i.msTransform=i.mozTransform=i.oTransform="matrix("+e.toString()+")"},a.noMouseEvent=function(t){t.style["pointer-events"]="none"},a.setMouseEnable=function(t,e){t.style["pointer-events"]=e?"auto":"none"},a.setZIndex=function(t,e){t.style["z-index"]=e},a.showAboveSprite=function(t,e,i,n){var r;void 0===i&&(i=0),void 0===n&&(n=0),r=new en,(r=e.localToGlobal(r)).x+=i,r.y+=n,r.x+=S.stage.offset.x,r.y+=S.stage.offset.y,a.showToBody(t,r.x,r.y)},a.removeElement=function(t){vn.removeElement(t)},a.isElementInDom=function(t){return t&&t.parentNode},a.getImageSpriteByFile=function(t,i,n){var r,a;return void 0===i&&(i=0),void 0===n&&(n=0),(r=new FileReader).readAsDataURL(t),a=new ya,r.onload=function(t){var e;(e=new Hr).load(r.result),a.graphics.drawTexture(e,0,0,i,n)},a},a.getPixelRatio=function(){if(0<a._pixelRatio)return a._pixelRatio;var t=vn.createElement("canvas").getContext("2d"),e=(vn.window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1);return console.log("pixelRatioc:",e),a._pixelRatio=e},a._pixelRatio=-1,a}()),vi=function(){function r(){}return E(r,"laya.debug.tools.MathTools"),r.sortBigFirst=function(t,e){return t==e?0:t<e?1:-1},r.sortSmallFirst=function(t,e){return t==e?0:t<e?-1:1},r.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},r.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},r.sortByKey=function(i,t,e){var n;return void 0===t&&(t=!1),void 0===e&&(e=!0),n=t?e?r.sortNumBigFirst:r.sortBigFirst:e?r.sortNumSmallFirst:r.sortSmallFirst,function(t,e){return n(t[i],e[i])}},r}(),yi=function(){function p(){}return E(p,"laya.debug.tools.MouseEventAnalyser"),p.analyseNode=function(t){var e,i,n;for(Xe.showDisBound(t,!0),e=t,xi.clearObj(p.infoO),xi.clearObj(p.nodeO),xi.clearObj(p.hitO),i=[];t;)pi.idObj(t),p.nodeO[pi.getObjID(t)]=t,i.push(t),t=t.parent;p.check(S.stage,S.stage.mouseX,S.stage.mouseY,null),n=p.hitO[pi.getObjID(e)]?(console.log("can hit"),"can hit"):(console.log("can't hit"),"can't hit");var r,a,s,o=0;for(r=(i=i.reverse()).length,a=["[分析对象]:"+$e.getNodeClassAndName(e)+":"+n],o=0;o<r;o++)t=i[o],p.hitO[pi.getObjID(t)]?(console.log("can hit:",$e.getNodeClassAndName(t)),console.log("原因:",p.infoO[pi.getObjID(t)]),a.push("can hit: "+$e.getNodeClassAndName(t)),a.push("原因: "+p.infoO[pi.getObjID(t)])):(console.log("can't hit:"+$e.getNodeClassAndName(t)),console.log("原因:",p.infoO[pi.getObjID(t)]?p.infoO[pi.getObjID(t)]:"鼠标事件在父级已停止派发"),a.push("can't hit: "+$e.getNodeClassAndName(t)),a.push("原因: "+(p.infoO[pi.getObjID(t)]?p.infoO[pi.getObjID(t)]:"鼠标事件在父级已停止派发")));s=a.join("\n"),Ls.I.showTxtInfo(s)},p.check=function(t,e,i,n){pi.idObj(t);var r;r=p.nodeO[pi.getObjID(t)],p._point.setTo(e,i),t.fromParentPoint(p._point),e=p._point.x,i=p._point.y;var a=t.scrollRect;if(a){p._rect.setTo(a.x,a.y,a.width,a.height);var s=p._rect.contains(e,i);if(!s)return r&&(p.infoO[pi.getObjID(t)]="scrollRect没有包含鼠标"+p._rect.toString()+":"+e+","+i),!1}var o,l,h,u,c=0;for(o=(l=t._childs).length,u=null,c=0;c<o;c++)if(h=l[c],pi.idObj(h),p.nodeO[pi.getObjID(h)]){u=h;break}var d=!1;d=!!u;if(t.hitTestPrior&&!t.mouseThrough&&!p.hitTest(t,e,i))return p.infoO[pi.getObjID(t)]="hitTestPrior=true，宽高区域不包含鼠标::"+e+","+i+" size:"+t.width+","+t.height,!1;for(c=t._childs.length-1;-1<c;c--)if((h=t._childs[c])==u&&(u.mouseEnabled||(p.infoO[pi.getObjID(u)]="mouseEnabled=false"),u.visible||(p.infoO[pi.getObjID(u)]="visible=false"),d=!1),h.mouseEnabled&&h.visible){if(p.check(h,e,i,n))return p.hitO[pi.getObjID(t)]=!0,p.infoO[pi.getObjID(t)]="子对象被击中",h==u?p.infoO[pi.getObjID(t)]="子对象被击中,击中对象在分析链中":(p.infoO[pi.getObjID(t)]="子对象被击中,击中对象不在分析链中",d&&(p.infoO[pi.getObjID(u)]="被兄弟节点挡住,兄弟节点信息:"+$e.getNodeClassAndName(h)+","+h.getBounds().toString(),Xe.showDisBound(h,!1,"#ffff00"))),!0;h==u&&(d=!1)}var _,f=new nn;if(_=t.getGraphicBounds().contains(e,i),0<t.width&&0<t.height){var m=p._rect;t.mouseThrough?(s=_,f.copyFrom(t.getGraphicBounds())):(t.hitArea?m=t.hitArea:m.setTo(0,0,t.width,t.height),f.copyFrom(m),s=m.contains(e,i)),s&&(p.hitO[pi.getObjID(t)]=!0)}return p.infoO[pi.getObjID(t)]=s?"自身区域被击中":_?"子对象未包含鼠标，实际绘图区域包含鼠标，设置的宽高区域不包含鼠标::"+e+","+i+" hitRec:"+f.toString()+" graphicBounds:"+t.getGraphicBounds().toString()+"，设置mouseThrough=true或将宽高设置到实际绘图区域可解决问题":"子对象未包含鼠标，实际绘图区域不包含鼠标，设置的宽高区域不包含鼠标::"+e+","+i+" hitRec:"+f.toString()+" graphicBounds:"+t.getGraphicBounds().toString(),s},p.hitTest=function(t,e,i){var n=!1;if(t.hitArea instanceof laya.utils.HitArea)return t.hitArea.isHit(e,i);if(0<t.width&&0<t.height||t.mouseThrough||t.hitArea){var r=p._rect;n=t.mouseThrough?t.getGraphicBounds().contains(e,i):(t.hitArea?r=t.hitArea:r.setTo(0,0,t.width,t.height),r.contains(e,i))}return n},p.infoO={},p.nodeO={},p.hitO={},m(p,["_matrix",function(){return this._matrix=new tn},"_point",function(){return this._point=new en},"_rect",function(){return this._rect=new nn}]),p}(),xi=function(){function a(){}return E(a,"laya.debug.tools.ObjectTools"),a.getFlatKey=function(t,e){return""==t?e:t+a.sign+e},a.flatObj=function(t,e,i){var n;for(n in void 0===i&&(i=""),e=e||{},t)"object"==typeof t[n]?a.flatObj(t[n],e,a.getFlatKey(i,n)):(t[n],e[a.getFlatKey(i,n)]=t[n]);return e},a.recoverObj=function(t){var e,i={};for(e in t)a.setKeyValue(i,e,t[e]);return i},a.differ=function(t,e){var i;t=a.flatObj(t),e=a.flatObj(e);var n={};for(i in t)e.hasOwnProperty(i)||(n[i]="被删除");for(i in e)e[i]!=t[i]&&(n[i]={pre:t[i],now:e[i]});return n},a.traceDifferObj=function(t){var e,i;for(e in t)"string"==typeof t[e]?console.log(e+":",t[e]):(i=t[e],console.log(e+":","now:",i.now,"pre:",i.pre))},a.setKeyValue=function(t,e,i){if(0<=e.indexOf(a.sign)){for(var n,r=e.split(a.sign);1<r.length;)if(t[n=r.shift()]||(t[n]={},console.log("addKeyObj:",n)),!(t=t[n]))return void console.log("wrong flatKey:",e);t[r.shift()]=i}else t[e]=i},a.clearObj=function(t){var e;for(e in t)delete t[e]},a.copyObjFast=function(t){var e;return e=laya.debug.tools.ObjectTools.getJsonString(t),laya.debug.tools.ObjectTools.getObj(e)},a.copyObj=function(t){if(t instanceof Array)return a.copyArr(t);var e,i={};for(e in t)null===t[e]||void 0===t[e]?i[e]=t[e]:t[e]instanceof Array?i[e]=a.copyArr(t[e]):"object"==typeof t[e]?i[e]=a.copyObj(t[e]):i[e]=t[e];return i},a.copyArr=function(t){var e;e=[];var i,n=0;for(i=t.length,n=0;n<i;n++)e.push(a.copyObj(t[n]));return e},a.concatArr=function(t,e){if(!e)return t;if(!t)return e;var i=0,n=e.length;for(i=0;i<n;i++)t.push(e[i]);return t},a.insertArrToArr=function(t,e,i){void 0===i&&(i=0),i<0&&(i=0),i>t.length&&(i=t.length);t.length;var n,r=0;t.length+=e.length;var a;for(a=e.length,r=t.length-1;i<=r;r--)t[r]=t[r-a];for(n=e.length,r=0;r<n;r++)t[i+r]=e[r];return t},a.clearArr=function(t){return t&&(t.length=0),t},a.removeFromArr=function(t,e){var i,n=0;for(i=t.length,n=0;n<i;n++)if(t[n]==e)return void t[n].splice(n,1)},a.setValueArr=function(t,e){return t||(t=[]),t.length=0,a.concatArr(t,e)},a.getFrom=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e[n]);return t},a.getFromR=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e.pop());return t},a.enableDisplayTree=function(t){for(;t;)t.mouseEnabled=!0,t=t.parent},a.getJsonString=function(t){return JSON.stringify(t)},a.getObj=function(t){return JSON.parse(t)},a.getKeyArr=function(t){var e,i;for(i in e=[],t)e.push(i);return e},a.getObjValues=function(t,e){var i,n,r=0;for(n=t.length,i=[],r=0;r<n;r++)i.push(t[r][e]);return i},a.hasKeys=function(t,e){var i,n=0;for(i=e.length,n=0;n<i;n++)if(!t.hasOwnProperty(e[n]))return!1;return!0},a.copyValueByArr=function(t,e,i){var n=0,r=i.length;for(n=0;n<r;n++)null!==e[i[n]]&&(t[i[n]]=e[i[n]])},a.getNoSameArr=function(t){var e,i,n,r=0;for(i=[],e=t.length,r=0;r<e;r++)n=t[r],i.indexOf(n)<0&&i.push(n);return i},a.insertValue=function(t,e){var i;for(i in e)t[i]=e[i]},a.replaceValue=function(t,e){var i;for(i in t)e.hasOwnProperty(t[i])&&(t[i]=e[t[i]]),"object"==typeof t[i]&&a.replaceValue(t[i],e)},a.setKeyValues=function(t,e,i){var n,r=0;for(n=t.length,r=0;r<n;r++)t[r][e]=i},a.findItemPos=function(t,e,i){var n,r=0;for(n=t.length,r=0;r<n;r++)if(t[r][e]==i)return r;return-1},a.setObjValue=function(t,e,i){return t[e]=i,t},a.setAutoTypeValue=function(t,e,i){return t.hasOwnProperty(e)&&a.isNumber(t[e])?t[e]=parseFloat(i):t[e]=i,t},a.getAutoValue=function(t){var e=parseFloat(t);return"string"==typeof t&&e+""===Ii.trimSide(t)?e:t},a.isNumber=function(t){return parseFloat(t)==t},a.isNaNS=function(t){return"NaN"==t.toString()},a.isNaN=function(t){return"number"!=typeof t&&("string"!=typeof t||"NaN"==parseFloat(t).toString()||parseFloat(t)!=t)},a.getStrTypedValue=function(t){return"false"!=t&&("true"==t||("null"==t?null:"undefined"==t?null:a.getAutoValue(t)))},a.createKeyValueDic=function(t,e){var i;i={};var n,r,a=0;for(n=t.length,a=0;a<n;a++)i[(r=t[a])[e]]=r;return i},a.sign="_",a}(),bi=function(){function t(){this.timeDic={},this.resultDic={},this.countDic={},this.resultCountDic={},this.nodeDic={},this.resultNodeDic={}}E(t,"laya.debug.tools.ObjTimeCountTool");var e=t.prototype;return e.addTime=function(t,e){pi.idObj(t);var i;i=pi.getObjID(t),this.timeDic.hasOwnProperty(i)||(this.timeDic[i]=0),this.timeDic[i]=this.timeDic[i]+e,this.countDic.hasOwnProperty(i)||(this.countDic[i]=0),this.countDic[i]=this.countDic[i]+1,this.nodeDic[i]=t},e.getTime=function(t){pi.idObj(t);var e;return e=pi.getObjID(t),this.resultDic[e]?this.resultDic[e]:0},e.getCount=function(t){pi.idObj(t);var e;return e=pi.getObjID(t),this.resultCountDic[e]},e.reset=function(){var t;for(t in this.timeDic)this.timeDic[t]=0,this.countDic[t]=0;xi.clearObj(this.nodeDic)},e.updates=function(){xi.clearObj(this.resultDic),xi.insertValue(this.resultDic,this.timeDic),xi.clearObj(this.resultCountDic),xi.insertValue(this.resultCountDic,this.countDic),xi.insertValue(this.resultNodeDic,this.nodeDic),this.reset()},t}(),Ti=function(){function o(){this.oX=0,this.oY=0,this.hX=1,this.hY=0,this.vX=0,this.vY=1}E(o,"laya.debug.tools.RecInfo");var t=o.prototype;return t.initByPoints=function(t,e,i){this.oX=t.x,this.oY=t.y,this.hX=e.x,this.hY=e.y,this.vX=i.x,this.vY=i.y},v(0,t,"rotation",function(){return this.rotationRad/Math.PI*180}),v(0,t,"width",function(){return Math.sqrt((this.hX-this.oX)*(this.hX-this.oX)+(this.hY-this.oY)*(this.hY-this.oY))}),v(0,t,"x",function(){return this.oX}),v(0,t,"rotationRadV",function(){var t=this.vX-this.oX,e=this.vY-this.oY;return Math.atan2(e,t)}),v(0,t,"y",function(){return this.oY}),v(0,t,"rotationRad",function(){var t=this.hX-this.oX,e=this.hY-this.oY;return Math.atan2(e,t)}),v(0,t,"height",function(){return Math.sqrt((this.vX-this.oX)*(this.vX-this.oX)+(this.vY-this.oY)*(this.vY-this.oY))}),v(0,t,"rotationV",function(){return this.rotationRadV/Math.PI*180}),o.createByPoints=function(t,e,i){var n;return(n=new o).initByPoints(t,e,i),n},o.getGlobalPoints=function(t,e,i){return t.localToGlobal(new en(e,i))},o.getGlobalRecInfo=function(t,e,i,n,r,a,s){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===s&&(s=1),o.createByPoints(o.getGlobalPoints(t,e,i),o.getGlobalPoints(t,n,r),o.getGlobalPoints(t,a,s))},o}(),Si=function(){function t(){this.timeDic={},this.resultDic={},this.countDic={},this.resultCountDic={},this.nodeDic={},this.isWorking=!1,this.working=!0}E(t,"laya.debug.tools.RenderAnalyser");var e=t.prototype;return e.render=function(t,e){this.addTime(t,e)},e.addTime=function(t,e){pi.idObj(t);var i;i=pi.getObjID(t),this.timeDic.hasOwnProperty(i)||(this.timeDic[i]=0),this.timeDic[i]=this.timeDic[i]+e,this.countDic.hasOwnProperty(i)||(this.countDic[i]=0),this.countDic[i]=this.countDic[i]+1,this.nodeDic[i]=t},e.getTime=function(t){pi.idObj(t);var e;return e=pi.getObjID(t),this.resultDic[e]?this.resultDic[e]:0},e.getCount=function(t){pi.idObj(t);var e;return e=pi.getObjID(t),this.resultCountDic[e]},e.reset=function(){var t;for(t in this.timeDic)this.timeDic[t]=0,this.countDic[t]=0;xi.clearObj(this.nodeDic)},e.updates=function(){xi.clearObj(this.resultDic),xi.insertValue(this.resultDic,this.timeDic),xi.clearObj(this.resultCountDic),xi.insertValue(this.resultCountDic,this.countDic),this.reset()},v(0,e,"working",null,function(t){(this.isWorking=t)?S.timer.loop(Pi.RenderCostMaxTime,this,this.updates):S.timer.clear(this,this.updates)}),m(t,["I",function(){return this.I=new t}]),t}(),Ei=function(){function i(){}return E(i,"laya.debug.tools.resizer.DisResizer"),i.init=function(){i._up||((i._up=new oo("T")).height=2,i._up.type=0,(i._down=new oo("T")).height=2,i._down.type=0,(i._left=new oo("R")).width=2,i._left.type=1,(i._right=new oo("R")).width=2,i._right.type=1,i._barList=[i._up,i._down,i._left,i._right],i.addEvent())},i.stageDown=function(t){var e;e=t.target,i._tar&&oi.isInTree(i._tar,e)||i.clear()},i.clear=function(){i._tar=null,S.stage.off("mouseup",null,i.stageDown),oi.removeItems(i._barList),i.clearDragEvents()},i.addEvent=function(){var t,e=0;for(t=i._barList.length,e=0;e<t;e++)i._barList[e].on("mousedown",null,i.barDown)},i.barDown=function(t){var e;(i.clearDragEvents(),i.tBar=t.target)&&(e=new nn,0==i.tBar.type?(e.x=i.tBar.x,e.width=0,e.y=i.tBar.y-200,e.height=400):(e.x=i.tBar.x-200,e.width=400,e.y=0,e.height=0),i.tBar.record(),i.tBar.startDrag(e),i.tBar.on("dragmove",null,i.draging),i.tBar.on("dragend",null,i.dragEnd))},i.draging=function(t){if(console.log("draging"),i.tBar&&i._tar){switch(i.tBar){case i._left:i._tar.x+=i.tBar.getDx(),i._tar.width-=i.tBar.getDx(),i._up.width-=i.tBar.getDx(),i._down.width-=i.tBar.getDx(),i._right.x-=i.tBar.getDx(),i.tBar.x-=i.tBar.getDx();break;case i._right:i._tar.width+=i.tBar.getDx(),i._up.width+=i.tBar.getDx(),i._down.width+=i.tBar.getDx();break;case i._up:i._tar.y+=i.tBar.getDy(),i._tar.height-=i.tBar.getDy(),i._right.height-=i.tBar.getDy(),i._left.height-=i.tBar.getDy(),i._down.y-=i.tBar.getDy(),i.tBar.y-=i.tBar.getDy();break;case i._down:i._tar.height+=i.tBar.getDy(),i._right.height+=i.tBar.getDy(),i._left.height+=i.tBar.getDy()}i.tBar.record()}},i.dragEnd=function(t){console.log("dragEnd"),i.clearDragEvents(),i.updates()},i.clearDragEvents=function(){i.tBar&&(i.tBar.off("dragmove",null,i.draging),i.tBar.off("dragend",null,i.dragEnd))},i.setUp=function(t,e){void 0===e&&(e=!1),e&&t==i._tar||(oi.removeItems(i._barList),(i._tar!=t||(i._tar=null,i.clearDragEvents(),e))&&(i._tar=t,i.updates(),oi.addItems(i._barList,t),S.stage.off("mouseup",null,i.stageDown),S.stage.on("mouseup",null,i.stageDown)))},i.updates=function(){var t,e;(t=i._tar)&&(e=new nn(0,0,t.width,t.height),i._up.x=e.x,i._up.y=e.y,i._up.width=e.width,i._down.x=e.x,i._down.y=e.y+e.height-2,i._down.width=e.width,i._left.x=e.x,i._left.y=e.y,i._left.height=e.height,i._right.x=e.x+e.width-2,i._right.y=e.y,i._right.height=e.height)},i.Side=2,i.Vertical=1,i.Horizon=0,i._up=null,i._down=null,i._left=null,i._right=null,i._barList=null,i._tar=null,i.barWidth=2,i.useGetBounds=!1,i.tBar=null,i}(),Ri=function(){function s(){}return E(s,"laya.debug.tools.resizer.SimpleResizer"),s.setResizeAble=function(t,e,i,n){void 0===i&&(i=150),void 0===n&&(n=150),t.on("mousedown",null,s.onMouseDown,[e,i,n])},s.onMouseDown=function(t,e,i,n){if(s.clearEvents(),t){var r;for(s.preMousePoint.setTo(S.stage.mouseX,S.stage.mouseY),s.preTarSize.setTo(t.width,t.height),s.preScale.setTo(1,1),r=t;r&&r!=S.stage;)s.preScale.x*=r.scaleX,s.preScale.y*=r.scaleY,r=r.parent;S.stage.on("mouseup",null,s.onMouseMoveEnd),S.timer.loop(100,null,s.onMouseMoving,[t,e,i])}},s.onMouseMoving=function(t,e,i,n){var r=(S.stage.mouseX-s.preMousePoint.x)/s.preScale.x+s.preTarSize.x,a=(S.stage.mouseY-s.preMousePoint.y)/s.preScale.y+s.preTarSize.y;t.width=e<r?r:e,t.height=i<a?a:i},s.onMouseMoveEnd=function(t){s.clearEvents()},s.clearEvents=function(){S.timer.clear(null,s.onMouseMoving),S.stage.off("mouseup",null,s.onMouseMoveEnd)},m(s,["preMousePoint",function(){return this.preMousePoint=new en},"preTarSize",function(){return this.preTarSize=new en},"preScale",function(){return this.preScale=new en}]),s}(),wi=function(){function i(){}return E(i,"laya.debug.tools.ResTools"),i.getCachedResList=function(){return hn.isWebGL?i.getWebGlResList():i.getCanvasResList()},i.getWebGlResList=function(){var t,e,i;t=[],i=_n.currentResourceManager._resources;for(var n=0;n<i.length;n++)if(e=i[n],"WebGLImage"==$e.getClassName(e)){var r=e.src;r&&r.indexOf("data:image/png;base64")<0&&t.push(r)}return t},i.getCanvasResList=function(){var t,e;return t={},e=kr.loadedMap,i.collectPics(e,t),i.getArrFromDic(t)},i.getArrFromDic=function(t){var e,i;for(e in i=[],t)i.push(e);return i},i.collectPics=function(t,e){var i,n;if(t)for(i in t){if(n=t[i])if(n.bitmap&&n.bitmap.src)n.bitmap.src.indexOf("data:image/png;base64")<0&&(e[n.bitmap.src]=!0)}},i}(),Ci=function(){function r(){}return E(r,"laya.debug.tools.RunProfile"),r.run=function(t,e){var i,n;void 0===e&&(e=3),r.infoDic.hasOwnProperty(t)||(r.infoDic[t]=new ii),i=r.infoDic[t],n=Mi.getCallLoc(e)+"\n"+Mi.getCallStack(1,e-3),i.add(n),r._runShowDic[t]&&(console.log("Create:"+t),console.log(n))},r.showClassCreate=function(t){r._runShowDic[t]=!0},r.hideClassCreate=function(t){r._runShowDic[t]=!1},r.getRunInfo=function(t){return r.infoDic[t],r.infoDic[t]},r.runTest=function(t,e,i){void 0===i&&(i="runTest"),hi.timeStart(i);var n=0;for(n=0;n<e;n++)t();hi.timeEnd(i)},r.runTest2=function(t,e,i){void 0===i&&(i="runTest");var n;n=vn.now();var r=0;for(r=0;r<e;r++)t();return vn.now()-n},r.infoDic={},r._runShowDic={},r}(),Ii=function(){function h(){}return E(h,"laya.debug.tools.StringTool"),h.toUpCase=function(t){return t.toUpperCase()},h.toLowCase=function(t){return t.toLowerCase()},h.toUpHead=function(t){return t.length<=1?t.toUpperCase():t.charAt(0).toUpperCase()+t.substr(1)},h.toLowHead=function(t){return t.length<=1?t.toLowerCase():t.charAt(0).toLowerCase()+t.substr(1)},h.packageToFolderPath=function(t){return t.replace(".","/")},h.insert=function(t,e,i){return t.substring(0,i)+e+t.substr(i)},h.insertAfter=function(t,e,i,n){void 0===n&&(n=!1);var r=0;return 0<=(r=n?t.lastIndexOf(i):t.indexOf(i))?h.insert(t,e,r+i.length):t},h.insertBefore=function(t,e,i,n){void 0===n&&(n=!1);var r=0;return 0<=(r=n?t.lastIndexOf(i):t.indexOf(i))?h.insert(t,e,r):t},h.insertParamToFun=function(t,e){var i,n;return i=h.getParamArr(t),n=e.join(","),0<i.length&&(n=","+n),h.insertBefore(t,n,")",!0)},h.trim=function(t,e){var i;e||(e=[" ","\r","\n","\t",String.fromCharCode(65279)]);var n,r=0;for(i=t,n=e.length,r=0;r<n;r++)i=h.getReplace(i,e[r],"");return i},h.isEmpty=function(t){return t.length<1||h.emptyStrDic.hasOwnProperty(t)},h.trimLeft=function(t){var e=0,i=e=0;for(i=t.length;h.isEmpty(t.charAt(e))&&e<i;)e++;return e<i?t.substr(e):""},h.trimRight=function(t){var e=0;for(e=t.length-1;h.isEmpty(t.charAt(e))&&0<=e;)e--;return t.substring(0,e),0<=e?t.substring(0,e+1):""},h.trimSide=function(t){var e;return e=h.trimLeft(t),e=h.trimRight(e)},h.isOkFileName=function(t){if(""==laya.debug.tools.StringTool.trimSide(t))return!1;var e,i=0;for(e=t.length,i=0;i<e;i++)if(h.specialChars[t.charAt(i)])return!1;return!0},h.trimButEmpty=function(t){return h.trim(t,["\r","\n","\t"])},h.removeEmptyStr=function(t){var e,i=0;for(i=i=t.length-1;0<=i;i--)e=t[i],e=laya.debug.tools.StringTool.trimSide(e),h.isEmpty(e)?t.splice(i,1):t[i]=e;return t},h.ifNoAddToTail=function(t,e){return 0<=t.indexOf(e)?t:t+e},h.trimEmptyLine=function(t){var e,i,n=0;for(n=(e=t.split("\n")).length-1;0<=n;n--)i=e[n],h.isEmptyLine(i)&&e.splice(n,1);return e.join("\n")},h.isEmptyLine=function(t){return""==(t=laya.debug.tools.StringTool.trim(t))},h.removeCommentLine=function(t){var e;e=[];var i,n,r=0,a=r=0,s=0;for(a=t.length;r<a;){if(n=i=t[r],0<=(s=i.indexOf("/**")))for(n=i.substring(0,s-1),h.addIfNotEmpty(e,n);r<a;){if(0<=(s=(i=t[r]).indexOf("*/"))){n=i.substring(s+2),h.addIfNotEmpty(e,n);break}r++}else 0<=i.indexOf("//")&&0==laya.debug.tools.StringTool.trim(i).indexOf("//")||h.addIfNotEmpty(e,n);r++}return e},h.addIfNotEmpty=function(t,e){e&&(""!=h.trim(e)&&t.push(e))},h.trimExt=function(t,e){var i;i=h.trim(t);var n,r=0;for(n=e.length,r=0;r<n;r++)i=h.getReplace(i,e[r],"");return i},h.getBetween=function(t,e,i,n){if(void 0===n&&(n=!1),!t)return"";if(!e)return"";if(!i)return"";var r,a=0;if((r=t.indexOf(e))<0)return"";if(n){if((a=t.lastIndexOf(i))<r)return""}else a=t.indexOf(i,r+1);return a<0?"":t.substring(r+e.length,a)},h.getSplitLine=function(t,e){return void 0===e&&(e=" "),t.split(e)},h.getLeft=function(t,e){var i;return i=t.indexOf(e),t.substr(0,i)},h.getRight=function(t,e){var i;return i=t.indexOf(e),t.substr(i+1)},h.delelteItem=function(t){for(;0<t.length&&""==t[0];)t.shift()},h.getWords=function(t){var e=h.getSplitLine(t);return h.delelteItem(e),e},h.getLinesI=function(t,e,i){var n=0,r=[];for(n=t;n<=e;n++)r.push(i[n]);return r},h.structfy=function(t,e,i){var n;void 0===e&&(e=4),void 0===i&&(i=!0),i&&(t=laya.debug.tools.StringTool.trimEmptyLine(t));var r,a=0;r=h.getEmptyStr(a=0);var s,o,l=0;for(s=(n=t.split("\n")).length,l=0;l<s;l++)o=n[l],o=laya.debug.tools.StringTool.trimLeft(o),o=laya.debug.tools.StringTool.trimRight(o),a+=h.getPariCount(o),0<=o.indexOf("}")&&(r=h.getEmptyStr(a*e)),o=r+o,n[l]=o,r=h.getEmptyStr(a*e);return n.join("\n")},h.getEmptyStr=function(t){if(!h.emptyDic.hasOwnProperty(t)){var e,i,n=0;for(e=t,i="",n=0;n<e;n++)i+=" ";h.emptyDic[t]=i}return h.emptyDic[t]},h.getPariCount=function(t,e,i){var n;void 0===e&&(e="{"),void 0===i&&(i="}"),(n={})[e]=1,n[i]=-1;var r,a,s=0;r=t.length;var o=0;for(s=o=0;s<r;s++)a=t.charAt(s),n.hasOwnProperty(a)&&(o+=n[a]);return o},h.readInt=function(t,e){void 0===e&&(e=0);var i,n=NaN,r=(n=0,0),a=!1;a=!1;var s;for(s=t.length,r=e;r<s;r++)if(i=t.charAt(r),0<Number(i)||"0"==i)0<(n=10*n+Number(i))&&(a=!0);else if(a)return n;return n},h.getReplace=function(t,e,i){return t?t.replace(new RegExp(e,"g"),i):""},h.getWordCount=function(t,e){var i=new RegExp(e,"g");return t.match(i).length},h.getResolvePath=function(t,e){if(h.isAbsPath(t))return t;var i,n,r;i="\\",0<=e.indexOf("/")&&(i="/"),e.charAt(e.length-1)==i&&(e=e.substr(0,e.length-1)),r="."+i;var a;a=h.getWordCount(t,n=".."+i),t=laya.debug.tools.StringTool.getReplace(t,n,""),t=laya.debug.tools.StringTool.getReplace(t,r,"");var s,o=0;s=a;for(o=0;o<s;o++)e=h.removeLastSign(t,i);return e+i+t},h.isAbsPath=function(t){return 0<=t.indexOf(":")},h.removeLastSign=function(t,e){var i;return i=t.lastIndexOf(e),t=t.substring(0,i)},h.getParamArr=function(t){var e;return e=laya.debug.tools.StringTool.getBetween(t,"(",")",!0),h.trim(e).length<1?[]:e.split(",")},h.copyStr=function(t){return t.substring()},h.ArrayToString=function(t){return"[{items}]".replace(new RegExp("\\{items\\}","g"),h.getArrayItems(t))},h.getArrayItems=function(t){var e;if(t.length<1)return"";e=h.parseItem(t[0]);var i,n=0;for(i=t.length,n=1;n<i;n++)e+=","+h.parseItem(t[n]);return e},h.parseItem=function(t){return'"'+t+'"',""},h.initAlphaSign=function(){h.alphaSigns||(h.addSign("a","z",h.alphaSigns={}),h.addSign("A","Z",h.alphaSigns),h.addSign("0","9",h.alphaSigns))},h.addSign=function(t,e,i){var n,r,a=0;for(r=t.charCodeAt(0),n=e.charCodeAt(0),a=r;a<=n;a++)i[String.fromCharCode(a)]=!0,console.log("add :"+String.fromCharCode(a))},h.isPureAlphaNum=function(t){if(h.initAlphaSign(),!t)return!0;var e,i=0;for(e=t.length,i=0;i<e;i++)if(!h.alphaSigns[t.charAt(i)])return!1;return!0},h.emptyDic={},h.alphaSigns=null,m(h,["emptyStrDic",function(){return this.emptyStrDic={" ":!0,"\r":!0,"\n":!0,"\t":!0}},"specialChars",function(){return this.specialChars={"*":!0,"&":!0,"%":!0,"#":!0,"?":!0}}]),h}(),Mi=function(){function a(){}return E(a,"laya.debug.tools.TraceTool"),a.closeAllLog=function(){var t;t=a.emptyLog,vn.window.console.log=t},a.emptyLog=function(){},a.traceObj=function(t){var e,i;for(e in a.tempArr.length=0,t)a.tempArr.push(e+":"+t[e]);return i=a.tempArr.join("\n"),console.log(i),i},a.traceObjR=function(t){var e,i;for(e in a.tempArr.length=0,t)a.tempArr.push(t[e]+":"+e);return i=a.tempArr.join("\n"),console.log(i),i},a.traceSize=function(t){Xe.dTrace("Size: x:"+t.x+" y:"+t.y+" w:"+t.width+" h:"+t.height+" scaleX:"+t.scaleX+" scaleY:"+t.scaleY)},a.traceSplit=function(t){console.log("---------------------"+t+"---------------------------")},a.group=function(t){console.group(t)},a.groupEnd=function(){console.groupEnd()},a.getCallStack=function(t,e){var i,n;for(void 0===t&&(t=1),void 0===e&&(e=1),i=(i=a.getCallStack).caller.caller,n="";i&&0<t;)e<=0&&(n+=i+"<-",t--),i=i.caller,e--;return n},a.getCallLoc=function(e){var i;void 0===e&&(e=2);try{a.Erroer.i++}catch(t){var n;i=(n=t.stack.replace(/Error\n/).split(/\n/))[e]?n[e].replace(/^\s+|\s+$/,""):"unknow"}return i},a.traceCallStack=function(){var e;try{a.Erroer.i++}catch(t){e=t.stack}return console.log(e),e},a.getPlaceHolder=function(t){if(!a.holderDic.hasOwnProperty(t)){var e;e="";var i=0;for(i=0;i<t;i++)e+="-";a.holderDic[t]=e}return a.holderDic[t]},a.traceTree=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=!0),i&&console.log("traceTree"),t){var n,r=0;if(t.numChildren<1)console.log(t);else{for(a.group(t),n=t.numChildren,e++,r=0;r<n;r++)a.traceTree(t.getChildAt(r),e,!1);a.groupEnd()}}},a.getClassName=function(t){return t.constructor.name},a.traceSpriteInfo=function(t,e,i,n){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=!0),t instanceof laya.display.Sprite?t?(a.traceSplit("traceSpriteInfo"),Xe.dTrace(laya.debug.tools.TraceTool.getClassName(t)+":"+t.name),n?a.traceTree(t):console.log(t),i&&a.traceSize(t),e&&console.log("bounds:"+t.getBounds())):console.log("null Sprite"):console.log("not Sprite")},a.tempArr=[],a.Erroer=null,a.holderDic={},a}(),Ai=function(){function n(){this.target=null,this.key=null,this._tValue=NaN,this.preValue=0}E(n,"laya.debug.tools.ValueChanger");var t=n.prototype;return t.record=function(){this.preValue=this.value},t.showValueByAdd=function(t){this.value=this.preValue+t},t.showValueByScale=function(t){this.value=this.preValue*t},t.recover=function(){this.value=this.preValue},t.dispose=function(){this.target=null},v(0,t,"value",function(){return this.target&&(this._tValue=this.target[this.key]),this._tValue},function(t){this._tValue=t,this.target&&(this.target[this.key]=t)}),v(0,t,"dValue",function(){return this.value-this.preValue}),v(0,t,"scaleValue",function(){return this.value/this.preValue}),n.create=function(t,e){var i;return(i=new n).target=t,i.key=e,i},n}(),Di=function(){function h(){}return E(h,"laya.debug.tools.VisibleAnalyser"),h.analyseTarget=function(t){var e,i;e=t.displayedInStage,i=Fi.getGRec(t);var n=new nn;n.setTo(0,0,S.stage.width,S.stage.height);var r,a=!1;a=0<(r=n.intersection(i)).width&&0<r.height;var s;s=Fi.getGAlpha(t);var o,l;l="",l+="isInstage:"+e+"\n",l+="isInVisibleRec:"+a+"\n",l+="gVisible:"+(o=Fi.getGVisible(t))+"\n",l+="gAlpha:"+s+"\n",e&&a&&o&&0<s&&(hn.isWebGL?h.anlyseRecVisible(t):di.I.analyseNode(t),l+="coverRate:"+h.coverRate+"\n",0<h._coverList.length&&S.timer.once(1e3,null,h.showListLater)),console.log(l),nl.I.showTxt(l)},h.showListLater=function(){Qo.I.showList(h._coverList)},h.isCoverByBrother=function(t){var e=t.parent;if(e){if(!(e._childs.indexOf(t)<0)){var i;(i=e.getSelfBounds()).width<=0||i.height}}},h.anlyseRecVisible=function(t){h.isNodeWalked=!1,h._analyseTarget=t,h.mainCanvas||(h.mainCanvas=qe.createCanvas(S.stage.width,S.stage.height)),qe.clearCanvas(h.mainCanvas),h.tColor=1,h.resetCoverList(),Li.walkTargetEX(S.stage,h.recVisibleWalker,null,h.filterFun),h.coverRate=h.isTarRecOK?qe.getDifferRate(h.preImageData,h.tarImageData):0,console.log("coverRate:",h.coverRate)},h.getRecArea=function(t){return t.width*t.height},h.addCoverNode=function(t,e){var i;(i={}).path=t,i.label=$e.getNodeClassAndName(t)+":"+e,i.coverRate=e,h._coverList.push(i),console.log("coverByNode:",t,e)},h.resetCoverList=function(){h._coverList.length=0},h.recVisibleWalker=function(t){var e;if(t==h._analyseTarget)h.isNodeWalked=!0,h.tarRec.copyFrom(Fi.getGRec(t)),console.log("tarRec:",h.tarRec.toString()),0<h.tarRec.width&&0<h.tarRec.height?(h.isTarRecOK=!0,h.tColor++,qe.fillCanvasRec(h.mainCanvas,h.tarRec,ei.toHexColor(h.tColor)),h.preImageData=qe.getImageDataFromCanvasByRec(h.mainCanvas,h.tarRec),h.tarImageData=qe.getImageDataFromCanvasByRec(h.mainCanvas,h.tarRec)):console.log("tarRec Not OK:",h.tarRec);else if(h.isTarRecOK&&(e=Fi.getGRec(t),(h.interRec=h.tarRec.intersection(e,h.interRec))&&0<h.interRec.width&&0<h.interRec.height)){h.tColor++,qe.fillCanvasRec(h.mainCanvas,e,ei.toHexColor(h.tColor)),h.tImageData=qe.getImageDataFromCanvasByRec(h.mainCanvas,h.tarRec);var i;i=qe.getDifferRate(h.preImageData,h.tImageData),h.preImageData=h.tImageData,h.addCoverNode(t,i)}},h.filterFun=function(t){return 0!=t.visible&&(!(t.alpha<0)&&!Is.I.isDebugItem(t))},h.isNodeWalked=!1,h._analyseTarget=null,h.isTarRecOK=!1,h.mainCanvas=null,h.preImageData=null,h.tImageData=null,h.tarImageData=null,h.coverRate=NaN,h.tColor=0,h._coverList=[],m(h,["tarRec",function(){return this.tarRec=new nn},"interRec",function(){return this.interRec=new nn}]),h}(),Li=function(){function l(){}return E(l,"laya.debug.tools.WalkTools"),l.walkTarget=function(t,e,i){e.apply(i,[t]);var n,r,a=0;for(n=t.numChildren,a=0;a<n;a++)r=t.getChildAt(a),l.walkTarget(r,e,r)},l.walkTargetEX=function(t,e,i,n){if(null==n||n(t)){e.apply(i,[t]);var r,a,s,o=0;for(r=(s=t._childs).length,o=0;o<r;o++)a=s[o],l.walkTarget(a,e,a)}},l.walkChildren=function(t,e,i){!t||t.numChildren<1||l.walkArr(oi.getAllChild(t),e,i)},l.walkArr=function(t,e,i){if(t){var n,r=0;for(n=t.length,r=0;r<n;r++)e.apply(i,[t[r],r])}},l}(),Vi=function(){function r(){}return E(r,"laya.debug.tools.Watcher"),r.watch=function(t,e,i){mi.hookVar(t,e,i)},r.traceChange=function(t,e,i){void 0===i&&(i="var changed:"),mi.hookVar(t,e,[r.getTraceValueFun(e),mi.getLocFun(i)])},r.debugChange=function(t,e){mi.hookVar(t,e,[mi.getLocFun("debug loc"),fi.debugHere])},r.differChange=function(t,e,i,n){void 0===n&&(n=""),mi.hookVar(t,e,[r.getDifferFun(t,e,i,n)])},r.getDifferFun=function(t,e,i,n){return void 0===n&&(n=""),function(){ai.differ(i,t[e],n)}},r.traceValue=function(t){console.log("value:",t)},r.getTraceValueFun=function(e){return function(t){console.log("set "+e+" :",t)}},r}(),Ni=function(){function t(){this._tar=null,this._menu=null,this._shareBtns=["信息面板","边框","进入节点","树定位","Enable链","Size链","节点工具","可见分析","输出到控制台"],this._menuItems=["隐藏节点"],this._menuHide=null,this._menuItemsHide=["显示节点"],this._menu1=null,this._menuItems1=["输出到控制台"]}E(t,"laya.debug.view.nodeInfo.menus.NodeMenu");var e=t.prototype;return e.showNodeMenu=function(t){t._style?(this._tar=t,this._menu||(this._menuItems=this._menuItems.concat(this._shareBtns),this._menu=No.createMenuByArray(this._menuItems),this._menu.on("select",this,this.onEmunSelect),this._menuItemsHide=this._menuItemsHide.concat(this._shareBtns),this._menuHide=No.createMenuByArray(this._menuItemsHide),this._menuHide.on("select",this,this.onEmunSelect)),t.visible?this._menu.show():this._menuHide.show()):Xe.log("该节点已不存在，请刷新列表")},e.nodeDoubleClick=function(t){qo.I.showByNode(t)},e.setNodeListDoubleClickAction=function(t){vn.onMobile||t.on("doubleclick",this,this.onListDoubleClick,[t])},e.onListDoubleClick=function(t){var e;t.selectedItem&&(e=t.selectedItem.path,laya.debug.view.nodeInfo.menus.NodeMenu.I.nodeDoubleClick(e))},e.setNodeListAction=function(t){t.on(Xe.getMenuShowEvent(),this,this.onListRightClick,[t])},e.onListRightClick=function(t){var e;t.selectedItem&&(e=t.selectedItem.path,laya.debug.view.nodeInfo.menus.NodeMenu.I.objRightClick(e))},e.objRightClick=function(t){t instanceof laya.display.Sprite?laya.debug.view.nodeInfo.menus.NodeMenu.I.showNodeMenu(t):"object"==typeof t&&laya.debug.view.nodeInfo.menus.NodeMenu.I.showObjectMenu(t)},e.showObjectMenu=function(t){this._tar=t,this._menu1||(this._menu1=No.createMenuByArray(this._menuItems1),this._menu1.on("select",this,this.onEmunSelect)),this._menu1.show()},e.onEmunSelect=function(t){var e=t.target.data;if("string"==typeof e)switch(e){case"信息面板":il.showObject(this._tar);break;case"边框":Xe.showDisBound(this._tar);break;case"输出到控制台":console.log(this._tar);break;case"树节点":case"进入节点":Ls.I.showNodeTree(this._tar);break;case"树定位":Ls.I.showSelectInStage(this._tar);break;case"Enable链":nl.I.dTrace(Xe.traceDisMouseEnable(this._tar)),sl.I.setSelectList(Xe.selectedNodes);break;case"Size链":nl.I.dTrace(Xe.traceDisSizeChain(this._tar)),sl.I.setSelectList(Xe.selectedNodes);break;case"节点工具":qo.I.showByNode(this._tar);break;case"显示节点":this._tar.visible=!0;break;case"隐藏节点":this._tar.visible=!1;break;case"可见分析":this._tar&&Di.analyseTarget(this._tar)}},v(1,t,"I",function(){return t._I||(t._I=new t),t._I}),t._I=null,t}(),Pi=function(){function t(){}return E(t,"laya.debug.view.nodeInfo.NodeConsts"),t.defaultFitlerStr="x,y,width,height,scaleX,scaleY,alpha,renderCost",t.RenderCostMaxTime=3e3,t}(),Fi=function(){function h(){}return E(h,"laya.debug.view.nodeInfo.NodeUtils"),h.getFilterdTree=function(t,e){var i,n;e||(e=h.defaultKeys),i={};var r,a,s,o=0,l=0;for(l=e.length,o=0;o<l;o++)i[n=e[o]]=t[n];for(l=(r=t._childs).length,s=[],o=0;o<l;o++)a=r[o],s.push(h.getFilterdTree(a,e));return i.childs=s,i},h.getPropertyDesO=function(t,e){e||(e=h.defaultKeys);var i,n={};n.label="object"==typeof t?""+$e.getNodeClassAndName(t):""+t,n.type="",n.path=t,n.childs=[],n.isDirectory=!1;var r,a=0,s=0;if(t instanceof laya.display.Node){for(n.des=$e.getNodeClassAndName(t),n.isDirectory=!0,s=e.length,a=0;a<s;a++)i=e[a],r=h.getPropertyDesO(t[i],e),t.hasOwnProperty(i)?r.label=i+":"+r.des:r.label=i+":"+il.getNodeValue(t,i),n.childs.push(r);(r=h.getPropertyDesO(t[i="_childs"],e)).label=i+":"+r.des,r.isChilds=!0,n.childs.push(r)}else if(t instanceof Array){var o;for(n.des="Array["+t.length+"]",n.isDirectory=!0,s=(o=t).length,a=0;a<s;a++)(r=h.getPropertyDesO(o[a],e)).label=a+":"+r.des,n.childs.push(r)}else if("object"==typeof t)for(i in n.des=$e.getNodeClassAndName(t),n.isDirectory=!0,t)(r=h.getPropertyDesO(t[i],e)).label=i+":"+r.des,n.childs.push(r);else n.des=""+t;return n.hasChild=0<n.childs.length,n},h.adptShowKeys=function(t){var e=0;for(e=t.length-1;0<=e;e--)t[e]=Ii.trimSide(t[e]),t[e].length<1&&t.splice(e,1);return t},h.getNodeTreeData=function(t,e){var i,n;return h.adptShowKeys(e),i=h.getPropertyDesO(t,e),h.getTreeArr(i,n=[]),n},h.getTreeArr=function(t,e,i){void 0===i&&(i=!0),i&&e.push(t);var n=t.childs,r=0,a=n.length;for(r=0;r<a;r++)n[r].nodeParent=i?t:null,n[r].isDirectory?h.getTreeArr(n[r],e):e.push(n[r])},h.traceStage=function(){console.log(h.getFilterdTree(S.stage,null)),console.log("treeArr:",h.getNodeTreeData(S.stage,null))},h.getNodeCount=function(t,e){if(void 0===e&&(e=!1),e&&!t.visible)return 0;var i=0;i=1;var n,r,a=0;for(n=(r=t._childs).length,a=0;a<n;a++)i+=h.getNodeCount(r[a],e);return i},h.getGVisible=function(t){for(;t;){if(!t.visible)return!1;t=t.parent}return!0},h.getGAlpha=function(t){var e=NaN;for(e=1;t;)e*=t.alpha,t=t.parent;return e},h.getGPos=function(t){var e;return e=new en,t.localToGlobal(e),e},h.getGRec=function(t){var e,i;return!(e=t._getBoundPointsM(!0))||e.length<1?nn.TEMP.setTo(0,0,0,0):(e=qi.pListToPointList(e,!0),Li.walkArr(e,t.localToGlobal,t),e=qi.pointListToPlist(e),i=nn._getWrapRec(e,i))},h.getGGraphicRec=function(t){var e,i;return!(e=t.getGraphicBounds()._getBoundPoints())||e.length<1?nn.TEMP.setTo(0,0,0,0):(e=qi.pListToPointList(e,!0),Li.walkArr(e,t.localToGlobal,t),e=qi.pointListToPlist(e),i=nn._getWrapRec(e,i))},h.getNodeCmdCount=function(t){return t.graphics?t.graphics.cmds?t.graphics.cmds.length:t.graphics._one?1:0:0},h.getNodeCmdTotalCount=function(t){var e,i,n=0,r=0;for(e=(i=t._childs).length,n=h.getNodeCmdCount(t),r=0;r<e;r++)n+=h.getNodeCmdTotalCount(i[r]);return n},h.getRenderNodeCount=function(t){if("none"!=t.cacheAs)return 1;var e,i,n=0,r=0;for(e=(i=t._childs).length,n=1,r=0;r<e;r++)n+=h.getRenderNodeCount(i[r]);return n},h.getReFreshRenderNodeCount=function(t){var e,i,n=0,r=0;for(e=(i=t._childs).length,n=1,r=0;r<e;r++)n+=h.getRenderNodeCount(i[r]);return n},h.showCachedSpriteRecs=function(){(h.g=Is.I.graphicLayer.graphics).clear(),Li.walkTarget(S.stage,h.drawCachedBounds,null)},h.drawCachedBounds=function(t){var e;"none"!=t.cacheAs&&(Is.I.isDebugItem(t)||(e=h.getGRec(t),h.g.drawRect(e.x,e.y,e.width,e.height,null,"#0000ff",2)))},h.g=null,m(h,["defaultKeys",function(){return this.defaultKeys=["x","y","width","height"]}]),h}(),Oi=function(){function e(){}return E(e,"laya.debug.view.StyleConsts"),e.setViewScale=function(t){t.scaleX=t.scaleY=e.PanelScale},m(e,["PanelScale",function(){return this.PanelScale=vn.onPC?1:vn.pixelRatio}]),e}(),Bi=function(){function t(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}E(t,"laya.display.BitmapFont");var e=t.prototype;return e.loadFont=function(t,e){this._path=t,this._complete=e,S.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],C.create(this,this.onLoaded))},e.onLoaded=function(){this.parseFont(kr.getRes(this._path),kr.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},e.parseFont=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");if(!i[0].getAttributeNode)return this.parseFont2(t,e);this.fontSize=parseInt(i[0].getAttributeNode("size").nodeValue);var n,r=i[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n=t.getElementsByTagName("char");var a=0;for(a=0;a<n.length;a++){var s=n[a],o=parseInt(s.getAttributeNode("id").nodeValue),l=parseInt(s.getAttributeNode("xoffset").nodeValue)/1,h=parseInt(s.getAttributeNode("yoffset").nodeValue)/1,u=parseInt(s.getAttributeNode("xadvance").nodeValue)/1,c=new nn;c.x=parseInt(s.getAttributeNode("x").nodeValue),c.y=parseInt(s.getAttributeNode("y").nodeValue),c.width=parseInt(s.getAttributeNode("width").nodeValue),c.height=parseInt(s.getAttributeNode("height").nodeValue);var d=Hr.create(e,c.x,c.y,c.width,c.height,l,h);this._maxWidth=Math.max(this._maxWidth,u+this.letterSpacing),this._fontCharDic[o]=d,this._fontWidthMap[o]=u}}},e.parseFont2=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");this.fontSize=parseInt(i[0].attributes.size.nodeValue);var n=i[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];var r=t.getElementsByTagName("char"),a=0;for(a=0;a<r.length;a++){var s=r[a].attributes,o=parseInt(s.id.nodeValue),l=parseInt(s.xoffset.nodeValue)/1,h=parseInt(s.yoffset.nodeValue)/1,u=parseInt(s.xadvance.nodeValue)/1,c=new nn;c.x=parseInt(s.x.nodeValue),c.y=parseInt(s.y.nodeValue),c.width=parseInt(s.width.nodeValue),c.height=parseInt(s.height.nodeValue);var d=Hr.create(e,c.x,c.y,c.width,c.height,l,h);this._maxWidth=Math.max(this._maxWidth,u+this.letterSpacing),this._fontCharDic[o]=d,this._fontWidthMap[o]=u}}},e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]},e.destroy=function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},e.setSpaceWidth=function(t){this._spaceWidth=t},e.getCharWidth=function(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "==t?this._spaceWidth+this.letterSpacing:0},e.getTextWidth=function(t){for(var e=0,i=0,n=t.length;i<n;i++)e+=this.getCharWidth(t.charAt(i));return e},e.getMaxWidth=function(){return this._maxWidth},e.getMaxHeight=function(){return this.fontSize},e.drawText=function(t,e,i,n,r,a){var s,o=this.getTextWidth(t),l=0;"center"===r&&(l=(a-o)/2),"right"===r&&(l=a-o);for(var h=0,u=0,c=t.length;u<c;u++)(s=this.getCharTexture(t.charAt(u)))&&(e.graphics.drawTexture(s,i+h+l,n),h+=this.getCharWidth(t.charAt(u)))},t}(),Gi=function(){function i(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=i._TF_EMPTY}E(i,"laya.display.css.Style");var t=i.prototype;return t.getTransform=function(){return this._tf},t.setTransform=function(t){this._tf="none"!==t&&t?t:i._TF_EMPTY},t.setTranslateX=function(t){this._tf===i._TF_EMPTY&&(this._tf=new Ui),this._tf.translateX=t},t.setTranslateY=function(t){this._tf===i._TF_EMPTY&&(this._tf=new Ui),this._tf.translateY=t},t.setScaleX=function(t){this._tf===i._TF_EMPTY&&(this._tf=new Ui),this._tf.scaleX=t},t.setScale=function(t,e){this._tf===i._TF_EMPTY&&(this._tf=new Ui),this._tf.scaleX=t,this._tf.scaleY=e},t.setScaleY=function(t){this._tf===i._TF_EMPTY&&(this._tf=new Ui),this._tf.scaleY=t},t.setRotate=function(t){this._tf===i._TF_EMPTY&&(this._tf=new Ui),this._tf.rotate=t},t.setSkewX=function(t){this._tf===i._TF_EMPTY&&(this._tf=new Ui),this._tf.skewX=t},t.setSkewY=function(t){this._tf===i._TF_EMPTY&&(this._tf=new Ui),this._tf.skewY=t},t.destroy=function(){this.scrollRect=null},t.render=function(t,e,i,n){},t.getCSSStyle=function(){return jr.EMPTY},t._enableLayout=function(){return!1},v(0,t,"scaleX",function(){return this._tf.scaleX},function(t){this.setScaleX(t)}),v(0,t,"transform",function(){return this.getTransform()},function(t){this.setTransform(t)}),v(0,t,"translateX",function(){return this._tf.translateX},function(t){this.setTranslateX(t)}),v(0,t,"translateY",function(){return this._tf.translateY},function(t){this.setTranslateY(t)}),v(0,t,"scaleY",function(){return this._tf.scaleY},function(t){this.setScaleY(t)}),v(0,t,"block",function(){return 0!=(1&this._type)}),v(0,t,"skewY",function(){return this._tf.skewY},function(t){this.setSkewY(t)}),v(0,t,"rotate",function(){return this._tf.rotate},function(t){this.setRotate(t)}),v(0,t,"skewX",function(){return this._tf.skewX},function(t){this.setSkewX(t)}),v(0,t,"paddingLeft",function(){return 0}),v(0,t,"paddingTop",function(){return 0}),v(0,t,"absolute",function(){return!0}),i.__init__=function(){i._TF_EMPTY=new Ui,i.EMPTY=new i},i.EMPTY=null,i._TF_EMPTY=null,i}(),Wi=function(){function e(t){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=Tn.create(e.defaultColor),this.family=e.defaultFamily,this.stroke=e._STROKE,this.size=e.defaultSize,t&&t!==e.EMPTY&&t.copyTo(this)}E(e,"laya.display.css.Font");var t=e.prototype;return t.set=function(t){this._text=null;for(var e=t.split(" "),i=0,n=e.length;i<n;i++){var r=e[i];switch(r){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<r.indexOf("px")&&(this.size=parseInt(r),this.family=e[i+1],i++)}},t.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},t.copyTo=function(t){t._type=this._type,t._text=this._text,t._weight=this._weight,t._color=this._color,t.family=this.family,t.stroke=this.stroke!=e._STROKE?this.stroke.slice():e._STROKE,t.indent=this.indent,t.size=this.size},v(0,t,"password",function(){return 0!=(1024&this._type)},function(t){t?this._type|=1024:this._type&=-1025}),v(0,t,"color",function(){return this._color.strColor},function(t){this._color=Tn.create(t)}),v(0,t,"italic",function(){return 0!=(512&this._type)},function(t){t?this._type|=512:this._type&=-513}),v(0,t,"bold",function(){return 0!=(2048&this._type)},function(t){t?this._type|=2048:this._type&=-2049}),v(0,t,"weight",function(){return""+this._weight},function(t){var e=0;switch(t){case"normal":break;case"bold":this.bold=!0,e=700;break;case"bolder":e=800;break;case"lighter":e=100;break;default:e=parseInt(t)}this._weight=e,this._text=null}),v(0,t,"decoration",function(){return this._decoration?this._decoration.value:null},function(t){var e=t.split(" ");switch(this._decoration||(this._decoration={}),e[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=e[0]}e[1]&&(this._decoration.color=Tn.create(e)),this._decoration.value=t}),e.__init__=function(){e.EMPTY=new e(null)},e.EMPTY=null,e.defaultColor="#000000",e.defaultSize=12,e.defaultFamily="Arial",e.defaultFont="12px Arial",e._STROKE=[0,"#000000"],e._ITALIC=512,e._PASSWORD=1024,e._BOLD=2048,e}(),Ui=function(){function t(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return E(t,"laya.display.css.TransformInfo"),t}(),Zi=function(){function y(){this._cacheBoundsType=!1}E(y,"laya.display.GraphicsBounds");var t=y.prototype;return t.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},t.reset=function(){this._temp&&(this._temp.length=0)},t.getBounds=function(t){return void 0===t&&(t=!1),(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=nn._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds},t.getBoundPoints=function(t){return void 0===t&&(t=!1),(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=Dn.copyArray(this._rstBoundPoints,this._temp)},t._getCmdPoints=function(t){void 0===t&&(t=!1);var e,i,n=hn._context,r=this._graphics.cmds;if((e=this._temp||(this._temp=[])).length=0,r||null==this._graphics._one||(y._tempCmds.length=0,y._tempCmds.push(this._graphics._one),r=y._tempCmds),!r)return e;(i=y._tempMatrixArrays).length=0;var a=y._initMatrix;a.identity();for(var s,o,l=y._tempMatrix,h=NaN,u=NaN,c=NaN,d=NaN,_=NaN,f=NaN,m=0,p=r.length;m<p;m++)if((s=r[m]).callee)switch(s.callee){case n._save:case 7:i.push(a),a=a.clone();break;case n._restore:case 8:a=i.pop();break;case n._scale:case 5:l.identity(),l.translate(-s[2],-s[3]),l.scale(s[0],s[1]),l.translate(s[2],s[3]),this._switchMatrix(a,l);break;case n._rotate:case 3:l.identity(),l.translate(-s[1],-s[2]),l.rotate(s[0]),l.translate(s[1],s[2]),this._switchMatrix(a,l);break;case n._translate:case 6:l.identity(),l.translate(s[0],s[1]),this._switchMatrix(a,l);break;case n._transform:case 4:l.identity(),l.translate(-s[1],-s[2]),l.concat(s[0]),l.translate(s[1],s[2]),this._switchMatrix(a,l);break;case 16:case 24:y._addPointArrToRst(e,nn._getBoundPointS(s[0],s[1],s[2],s[3]),a);break;case 17:a.copyTo(l),l.concat(s[4]),y._addPointArrToRst(e,nn._getBoundPointS(s[0],s[1],s[2],s[3]),l);break;case n._drawTexture:o=s[0],t?s[3]&&s[4]?y._addPointArrToRst(e,nn._getBoundPointS(s[1],s[2],s[3],s[4]),a):(o=s[0],y._addPointArrToRst(e,nn._getBoundPointS(s[1],s[2],o.width,o.height),a)):(h=(s[3]||o.sourceWidth)/o.width,u=(s[4]||o.sourceHeight)/o.height,c=h*o.sourceWidth,d=u*o.sourceHeight,_=0<o.offsetX?o.offsetX:0,f=0<o.offsetY?o.offsetY:0,_*=h,f*=u,y._addPointArrToRst(e,nn._getBoundPointS(s[1]-_,s[2]-f,c,d),a));break;case n._fillTexture:s[3]&&s[4]?y._addPointArrToRst(e,nn._getBoundPointS(s[1],s[2],s[3],s[4]),a):(o=s[0],y._addPointArrToRst(e,nn._getBoundPointS(s[1],s[2],o.width,o.height),a));break;case n._drawTextureWithTransform:var g;g=s[5]?(a.copyTo(l),l.concat(s[5]),l):a,t?s[3]&&s[4]?y._addPointArrToRst(e,nn._getBoundPointS(s[1],s[2],s[3],s[4]),g):(o=s[0],y._addPointArrToRst(e,nn._getBoundPointS(s[1],s[2],o.width,o.height),g)):(o=s[0],h=(s[3]||o.sourceWidth)/o.width,u=(s[4]||o.sourceHeight)/o.height,c=h*o.sourceWidth,d=u*o.sourceHeight,_=0<o.offsetX?o.offsetX:0,f=0<o.offsetY?o.offsetY:0,_*=h,f*=u,y._addPointArrToRst(e,nn._getBoundPointS(s[1]-_,s[2]-f,c,d),g));break;case n._drawRect:case 13:y._addPointArrToRst(e,nn._getBoundPointS(s[0],s[1],s[2],s[3]),a);break;case n._drawCircle:case n._fillCircle:case 14:y._addPointArrToRst(e,nn._getBoundPointS(s[0]-s[2],s[1]-s[2],s[2]+s[2],s[2]+s[2]),a);break;case n._drawLine:case 20:y._tempPoints.length=0;var v;v=.5*s[5],s[0]==s[2]?y._tempPoints.push(s[0]+v,s[1],s[2]+v,s[3],s[0]-v,s[1],s[2]-v,s[3]):s[1]==s[3]?y._tempPoints.push(s[0],s[1]+v,s[2],s[3]+v,s[0],s[1]-v,s[2],s[3]-v):y._tempPoints.push(s[0],s[1],s[2],s[3]),y._addPointArrToRst(e,y._tempPoints,a);break;case n._drawCurves:case 22:y._addPointArrToRst(e,Qi.I.getBezierPoints(s[2]),a,s[0],s[1]);break;case n._drawPoly:case n._drawLines:case 18:y._addPointArrToRst(e,s[2],a,s[0],s[1]);break;case n._drawPath:case 19:y._addPointArrToRst(e,this._getPathPoints(s[2]),a,s[0],s[1]);break;case n._drawPie:case 15:y._addPointArrToRst(e,this._getPiePoints(s[0],s[1],s[2],s[3],s[4]),a)}return 200<e.length?e=Dn.copyArray(e,nn._getWrapRec(e)._getBoundPoints()):8<e.length&&(e=qi.scanPList(e)),e},t._switchMatrix=function(t,e){e.concat(t),e.copyTo(t)},t._getPiePoints=function(t,e,i,n,r){var a=y._tempPoints;y._tempPoints.length=0,a.push(t,e);var s=(r-n)%(2*Math.PI)/10,o=NaN,l=n;for(o=0;o<=10;o++)a.push(t+i*Math.cos(l),e+i*Math.sin(l)),l+=s;return a},t._getPathPoints=function(t){var e,i,n=0,r=y._tempPoints;for(r.length=0,e=t.length,n=0;n<e;n++)1<(i=t[n]).length&&(r.push(i[1],i[2]),3<i.length&&r.push(i[3],i[4]));return r},y._addPointArrToRst=function(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var a,s=0;for(a=e.length,s=0;s<a;s+=2)y._addPointToRst(t,e[s]+n,e[s+1]+r,i)},y._addPointToRst=function(t,e,i,n){var r=en.TEMP;r.setTo(e||0,i||0),n.transformPoint(r),t.push(r.x,r.y)},y._tempPoints=[],y._tempMatrixArrays=[],y._tempCmds=[],m(y,["_tempMatrix",function(){return this._tempMatrix=new tn},"_initMatrix",function(){return this._initMatrix=new tn}]),y}(),ki=function(){function t(){}E(t,"laya.events.Event");var e=t.prototype;return e.setTo=function(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this},e.stopPropagation=function(){this._stoped=!0},v(0,e,"stageY",function(){return S.stage.mouseY}),v(0,e,"charCode",function(){return this.nativeEvent.charCode}),v(0,e,"touches",function(){var t=this.nativeEvent.touches;if(t)for(var e=S.stage,i=0,n=t.length;i<n;i++){var r=t[i],a=en.TEMP;a.setTo(r.clientX,r.clientY),e._canvasTransform.invertTransformPoint(a),e.transform.invertTransformPoint(a),r.stageX=a.x,r.stageY=a.y}return t}),v(0,e,"keyLocation",function(){return this.nativeEvent.keyLocation}),v(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),v(0,e,"altKey",function(){return this.nativeEvent.altKey}),v(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey}),v(0,e,"stageX",function(){return S.stage.mouseX}),t.EMPTY=new t,t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.CLICK="click",t.RIGHT_MOUSE_DOWN="rightmousedown",t.RIGHT_MOUSE_UP="rightmouseup",t.RIGHT_CLICK="rightclick",t.MOUSE_MOVE="mousemove",t.MOUSE_OVER="mouseover",t.MOUSE_OUT="mouseout",t.MOUSE_WHEEL="mousewheel",t.ROLL_OVER="mouseover",t.ROLL_OUT="mouseout",t.DOUBLE_CLICK="doubleclick",t.CHANGE="change",t.CHANGED="changed",t.RESIZE="resize",t.ADDED="added",t.REMOVED="removed",t.DISPLAY="display",t.UNDISPLAY="undisplay",t.ERROR="error",t.COMPLETE="complete",t.LOADED="loaded",t.PROGRESS="progress",t.INPUT="input",t.RENDER="render",t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.KEY_DOWN="keydown",t.KEY_PRESS="keypress",t.KEY_UP="keyup",t.FRAME="enterframe",t.DRAG_START="dragstart",t.DRAG_MOVE="dragmove",t.DRAG_END="dragend",t.ENTER="enter",t.SELECT="select",t.BLUR="blur",t.FOCUS="focus",t.VISIBILITY_CHANGE="visibilitychange",t.FOCUS_CHANGE="focuschange",t.PLAYED="played",t.PAUSED="paused",t.STOPPED="stopped",t.START="start",t.END="end",t.ENABLE_CHANGED="enablechanged",t.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",t.COMPONENT_ADDED="componentadded",t.COMPONENT_REMOVED="componentremoved",t.LAYER_CHANGED="layerchanged",t.HIERARCHY_LOADED="hierarchyloaded",t.RECOVERED="recovered",t.RELEASED="released",t.LINK="link",t.LABEL="label",t.FULL_SCREEN_CHANGE="fullscreenchange",t.DEVICE_LOST="devicelost",t.MESH_CHANGED="meshchanged",t.MATERIAL_CHANGED="materialchanged",t.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",t.ANIMATION_CHANGED="animationchanged",t.TRIGGER_ENTER="triggerenter",t.TRIGGER_STAY="triggerstay",t.TRIGGER_EXIT="triggerexit",t.TRAIL_FILTER_CHANGE="trailfilterchange",t.DOMINO_FILTER_CHANGE="dominofilterchange",t}(),Hi=function(){function r(){}return E(r,"laya.events.KeyBoardManager"),r.__init__=function(){r._addEvent("keydown"),r._addEvent("keypress"),r._addEvent("keyup")},r._addEvent=function(e){vn.document.addEventListener(e,function(t){laya.events.KeyBoardManager._dispatch(t,e)},!0)},r._dispatch=function(t,e){if(r.enabled){r._event._stoped=!1,r._event.nativeEvent=t,r._event.keyCode=t.keyCode||t.which||t.charCode,"keydown"===e?r._pressKeys[r._event.keyCode]=!0:"keyup"===e&&(r._pressKeys[r._event.keyCode]=null);for(var i=S.stage.focus&&null!=S.stage.focus.event&&S.stage.focus.displayedInStage?S.stage.focus:S.stage,n=i;n;)n.event(e,r._event.setTo(e,n,i)),n=n.parent}},r.hasKeyDown=function(t){return r._pressKeys[t]},r._pressKeys={},r.enabled=!0,m(r,["_event",function(){return this._event=new ki}]),r}(),Xi=function(){function u(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new ki,this._matrix=new tn,this._point=new en,this._rect=new nn,this._prePoint=new en,this._curTouchID=NaN}E(u,"laya.events.MouseManager");var t=u.prototype;return t.__init__=function(t,e){var i=this;this._stage=t;var n=this,r=this._eventList;e.oncontextmenu=function(t){if(u.enabled)return!1},e.addEventListener("mousedown",function(t){u.enabled&&(vn.onIE||t.preventDefault(),r.push(t),n.mouseDownTime=vn.now())}),e.addEventListener("mouseup",function(t){u.enabled&&(t.preventDefault(),r.push(t),n.mouseDownTime=-vn.now())},!0),e.addEventListener("mousemove",function(t){if(u.enabled){t.preventDefault();var e=vn.now();if(e-n._lastMoveTimer<10)return;n._lastMoveTimer=e,r.push(t)}},!0),e.addEventListener("mouseout",function(t){u.enabled&&r.push(t)}),e.addEventListener("mouseover",function(t){u.enabled&&r.push(t)}),e.addEventListener("touchstart",function(t){u.enabled&&(r.push(t),u._isFirstTouch||To.isInputting||t.preventDefault(),n.mouseDownTime=vn.now())}),e.addEventListener("touchend",function(t){u.enabled?(u._isFirstTouch||To.isInputting||t.preventDefault(),u._isFirstTouch=!1,r.push(t),n.mouseDownTime=-vn.now()):i._curTouchID=NaN},!0),e.addEventListener("touchmove",function(t){u.enabled&&(t.preventDefault(),r.push(t))},!0),e.addEventListener("touchcancel",function(t){u.enabled?(t.preventDefault(),r.push(t)):i._curTouchID=NaN},!0),e.addEventListener("mousewheel",function(t){u.enabled&&r.push(t)}),e.addEventListener("DOMMouseScroll",function(t){u.enabled&&r.push(t)})},t.initEvent=function(t,e){var i;this._event._stoped=!1,this._event.nativeEvent=e||t,this._target=null,this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=t.identifier||0,this._tTouchID=this._event.touchId,(i=Yi.I._event)._stoped=!1,i.nativeEvent=this._event.nativeEvent,i.touchId=this._event.touchId},t.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=Yi.I.getLastOvers(),i=0,n=e.length;i<n;i++){var r=e[i];r.event("mousewheel",this._event.setTo("mousewheel",r,this._target))}},t.onMouseMove=function(t){Yi.I.onMouseMove(t,this._tTouchID)},t.onMouseDown=function(t){if(To.isInputting&&S.stage.focus&&S.stage.focus.focus&&!S.stage.focus.contains(this._target)){var e=S.stage.focus._tf||S.stage.focus,i=t._tf||t;i instanceof laya.display.Input&&i.multiline==e.multiline?e._focusOut():e.focus=!1}Yi.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)},t.onMouseUp=function(t){Yi.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)},t.check=function(t,e,i,n){this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y;var r=t.scrollRect;if(r&&(this._rect.setTo(r.x,r.y,r.width,r.height),!this._rect.contains(e,i)))return!1;if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i))return!1;for(var a=t._childs.length-1;-1<a;a--){var s=t._childs[a];if(!s.destroyed&&s.mouseEnabled&&s.visible&&this.check(s,e,i,n))return!0}}var o=!(!t.hitTestPrior||t.mouseThrough||this.disableMouseEvent)||this.hitTest(t,e,i);return o?(this._target=t,n.call(this,t)):n===this.onMouseUp&&t===this._stage&&(this._target=this._stage,n.call(this,this._target)),o},t.hitTest=function(t,e,i){var n=!1;if(t.scrollRect&&(e-=t.scrollRect.x,i-=t.scrollRect.y),t.hitArea instanceof laya.utils.HitArea)return t.hitArea.isHit(e,i);if(0<t.width&&0<t.height||t.mouseThrough||t.hitArea)if(t.mouseThrough)n=t.getGraphicBounds().contains(e,i);else{var r=this._rect;t.hitArea?r=t.hitArea:r.setTo(0,0,t.width,t.height),n=r.contains(e,i)}return n},t.runEvent=function(){var t=this._eventList.length;if(t){for(var e,i=this,n=0,r=0,a=0;n<t;){var s=this._eventList[n];switch("mousemove"!==s.type&&(this._prePoint.x=this._prePoint.y=-1e6),s.type){case"mousedown":this._touchIDs[0]=this._id++,u._isTouchRespond?u._isTouchRespond=!1:(i._isLeftMouse=0===s.button,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"mouseup":i._isLeftMouse=0===s.button,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-s.clientX)+Math.abs(this._prePoint.y-s.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=s.clientX,this._prePoint.y=s.clientY,i.initEvent(s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"touchstart":u._isTouchRespond=!0,i._isLeftMouse=!0;var o=s.changedTouches;for(r=0,a=o.length;r<a;r++)e=o[r],(u.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=e.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[e.identifier]=this._id++,i.initEvent(e,s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"touchend":case"touchcancel":u._isTouchRespond=!0,i._isLeftMouse=!0;var l=s.changedTouches;for(r=0,a=l.length;r<a;r++)if(e=l[r],u.multiTouchEnabled||e.identifier==this._curTouchID){this._curTouchID=NaN,i.initEvent(e,s);i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp)||i.onMouseUp(null)}break;case"touchmove":var h=s.changedTouches;for(r=0,a=h.length;r<a;r++)e=h[r],(u.multiTouchEnabled||e.identifier==this._curTouchID)&&(i.initEvent(e,s),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":i.checkMouseWheel(s);break;case"mouseout":Yi.I.stageMouseOut();break;case"mouseover":i._stage.event("mouseover",i._event.setTo("mouseover",i._stage,i._stage))}n++}this._eventList.length=0}},u.enabled=!0,u.multiTouchEnabled=!0,u._isTouchRespond=!1,u._isFirstTouch=!0,m(u,["instance",function(){return this.instance=new u}]),u}(),Yi=function(){function f(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new ki}E(f,"laya.events.TouchManager");var t=f.prototype;return t._clearTempArrs=function(){f._oldArr.length=0,f._newArr.length=0,f._tEleArr.length=0},t.getTouchFromArr=function(t,e){var i,n,r=0;for(i=e.length,r=0;r<i;r++)if((n=e[r]).id==t)return n;return null},t.removeTouchFromArr=function(t,e){var i=0;for(i=e.length-1;0<=i;i--)e[i].id==t&&e.splice(i,1)},t.createTouchO=function(t,e){var i;return(i=wn.getItem("TouchData")||{}).id=e,i.tar=t,i},t.onMouseDown=function(t,e,i){var n,r,a,s;(void 0===i&&(i=!1),this.enable)&&(n=this.getTouchFromArr(e,this.preOvers),a=this.getEles(t,null,f._tEleArr),n?n.tar=t:(r=this.createTouchO(t,e),this.preOvers.push(r)),vn.onMobile&&this.sendEvents(a,"mouseover"),s=i?this.preDowns:this.preRightDowns,(n=this.getTouchFromArr(e,s))?n.tar=t:(r=this.createTouchO(t,e),s.push(r)),this.sendEvents(a,i?"mousedown":"rightmousedown"),this._clearTempArrs())},t.sendEvents=function(t,e){var i,n,r,a=0;for(i=t.length,this._event._stoped=!1,n=t[0],a=0;a<i;a++){if((r=t[a]).destroyed)return;if(r.event(e,this._event.setTo(e,r,n)),this._event._stoped)break}},t.getEles=function(t,e,i){for(i?i.length=0:i=[];t&&t!=e;)i.push(t),t=t.parent;return i},t.checkMouseOutAndOverOfMove=function(t,e,i){if(void 0===i&&(i=0),e!=t){var n,r,a=0,s=0;if(e.contains(t))r=this.getEles(t,e,f._tEleArr),this.sendEvents(r,"mouseover");else if(t.contains(e))r=this.getEles(e,t,f._tEleArr),this.sendEvents(r,"mouseout");else{var o,l;(r=f._tEleArr).length=0,o=this.getEles(e,null,f._oldArr),l=this.getEles(t,null,f._newArr),s=o.length;var h=0;for(a=0;a<s;a++){if(n=o[a],0<=(h=l.indexOf(n))){l.splice(h,l.length-h);break}r.push(n)}0<r.length&&this.sendEvents(r,"mouseout"),0<l.length&&this.sendEvents(l,"mouseover")}}},t.onMouseMove=function(t,e){var i,n;this.enable&&((i=this.getTouchFromArr(e,this.preOvers))?(this.checkMouseOutAndOverOfMove(t,i.tar),i.tar=t,n=this.getEles(t,null,f._tEleArr)):(n=this.getEles(t,null,f._tEleArr),this.sendEvents(n,"mouseover"),this.preOvers.push(this.createTouchO(t,e))),this.sendEvents(n,"mousemove"),this._clearTempArrs())},t.getLastOvers=function(){return(f._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,f._tEleArr):(f._tEleArr.push(S.stage),f._tEleArr)},t.stageMouseOut=function(){var t;t=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(t,"mouseout")},t.onMouseUp=function(t,e,i){if(void 0===i&&(i=!1),this.enable){var n,r,a,s,o,l,h=0,u=0,c=vn.onMobile;if(r=this.getEles(t,null,f._tEleArr),this.sendEvents(r,i?"mouseup":"rightmouseup"),l=i?this.preDowns:this.preRightDowns,n=this.getTouchFromArr(e,l)){var d,_=vn.now();if(d=_-this._lastClickTime<300,this._lastClickTime=_,t==n.tar)o=r;else for(a=this.getEles(n.tar,null,f._oldArr),(o=f._newArr).length=0,u=a.length,h=0;h<u;h++)s=a[h],0<=r.indexOf(s)&&o.push(s);0<o.length&&this.sendEvents(o,i?"click":"rightclick"),i&&d&&this.sendEvents(o,"doubleclick"),this.removeTouchFromArr(e,l),n.tar=null,wn.recover("TouchData",n)}else;(n=this.getTouchFromArr(e,this.preOvers))&&c&&((o=this.getEles(n.tar,null,o))&&0<o.length&&this.sendEvents(o,"mouseout"),this.removeTouchFromArr(e,this.preOvers),n.tar=null,wn.recover("TouchData",n)),this._clearTempArrs()}},f._oldArr=[],f._newArr=[],f._tEleArr=[],m(f,["I",function(){return this.I=new f}]),f}(),zi=function(){function t(){this._action=null}E(t,"laya.filters.Filter");var e=t.prototype;return S.imps(e,{"laya.filters.IFilter":!0}),e.callNative=function(t){},v(0,e,"type",function(){return-1}),v(0,e,"action",function(){return this._action}),t.BLUR=16,t.COLOR=32,t.GLOW=8,t._filterStart=null,t._filterEnd=null,t._EndTarget=null,t._recycleScope=null,t._filter=null,t._useSrc=null,t._endSrc=null,t._useOut=null,t._endOut=null,t}(),ji=function(){function t(){this.data=null}E(t,"laya.filters.ColorFilterAction");var e=t.prototype;return S.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){var e=t.ctx.ctx,i=t.ctx.ctx.canvas;if(0==i.width||0==i.height)return i;for(var n,r=e.getImageData(0,0,i.width,i.height),a=r.data,s=0,o=a.length;s<o;s+=4)n=this.getColor(a[s],a[s+1],a[s+2],a[s+3]),0!=a[s+3]&&(a[s]=n[0],a[s+1]=n[1],a[s+2]=n[2],a[s+3]=n[3]);return e.putImageData(r,0,0),t},e.getColor=function(t,e,i,n){var r=[];if(this.data._mat&&this.data._alpha){var a=this.data._mat,s=this.data._alpha;r[0]=a[0]*t+a[1]*e+a[2]*i+a[3]*n+s[0],r[1]=a[4]*t+a[5]*e+a[6]*i+a[7]*n+s[1],r[2]=a[8]*t+a[9]*e+a[10]*i+a[11]*n+s[2],r[3]=a[12]*t+a[13]*e+a[14]*i+a[15]*n+s[3]}return r},t}(),Ji=function(){function t(){}E(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;return S.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=function(t){},e.setValueMix=function(t){},e.apply3d=function(t,e,i,n,r){return null},e.apply=function(t){return null},v(0,e,"typeMix",function(){return 0}),t}(),Ki=function(){function t(){}return E(t,"laya.maths.Arith"),t.formatR=function(t){return t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI),t},t.isPOT=function(t,e){return 0<t&&0==(t&t-1)&&0<e&&0==(e&e-1)},t.setMatToArray=function(t,e){t.a,t.b,t.c,t.d,t.tx,t.ty,e[0]=t.a,e[1]=t.b,e[4]=t.c,e[5]=t.d,e[12]=t.tx,e[13]=t.ty},t}(),Qi=function(){function t(){this._controlPoints=[new en,new en,new en],this._calFun=this.getPoint2}E(t,"laya.maths.Bezier");var e=t.prototype;return e._switchPoint=function(t,e){var i=this._controlPoints.shift();i.setTo(t,e),this._controlPoints.push(i)},e.getPoint2=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],a=Math.pow(1-t,2)*i.x+2*t*(1-t)*n.x+Math.pow(t,2)*r.x,s=Math.pow(1-t,2)*i.y+2*t*(1-t)*n.y+Math.pow(t,2)*r.y;e.push(a,s)},e.getPoint3=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],a=this._controlPoints[3],s=Math.pow(1-t,3)*i.x+3*n.x*t*(1-t)*(1-t)+3*r.x*t*t*(1-t)+a.x*Math.pow(t,3),o=Math.pow(1-t,3)*i.y+3*n.y*t*(1-t)*(1-t)+3*r.y*t*t*(1-t)+a.y*Math.pow(t,3);e.push(s,o)},e.insertPoints=function(t,e){var i,n=NaN;for(i=1/(t=0<t?t:5),n=0;n<=1;n+=i)this._calFun(n,e)},e.getBezierPoints=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=2);var n,r,a=0;if((n=t.length)<2*(i+1))return[];switch(r=[],i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(new en);for(a=0;a<2*i;a+=2)this._switchPoint(t[a],t[a+1]);for(a=2*i;a<n;a+=2)this._switchPoint(t[a],t[a+1]),a/2%i==0&&this.insertPoints(e,r);return r},m(t,["I",function(){return this.I=new t}]),t}(),qi=function(){function h(){}return E(h,"laya.maths.GrahamScan"),h.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)},h.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},h._getPoints=function(t,e,i){for(void 0===e&&(e=!1),h._mPointList||(h._mPointList=[]);h._mPointList.length<t;)h._mPointList.push(new en);return i||(i=[]),i.length=0,e?h.getFrom(i,h._mPointList,t):h.getFromR(i,h._mPointList,t),i},h.getFrom=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e[n]);return t},h.getFromR=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e.pop());return t},h.pListToPointList=function(t,e){void 0===e&&(e=!1);var i=0,n=t.length/2,r=h._getPoints(n,e,h._tempPointList);for(i=0;i<n;i++)r[i].setTo(t[i+i],t[i+i+1]);return r},h.pointListToPlist=function(t){var e,i=0,n=t.length,r=h._temPList;for(i=r.length=0;i<n;i++)e=t[i],r.push(e.x,e.y);return r},h.scanPList=function(t){return Dn.copyArray(t,h.pointListToPlist(h.scan(h.pListToPointList(t,!0))))},h.scan=function(t){var e,i,n,r=0,a=0,s=0,o=t.length,l={};for((i=h._temArr).length=0,r=(o=t.length)-1;0<=r;r--)n=(e=t[r]).x+"_"+e.y,l.hasOwnProperty(n)||(l[n]=!0,i.push(e));for(o=i.length,Dn.copyArray(t,i),r=1;r<o;r++)(t[r].y<t[s].y||t[r].y==t[s].y&&t[r].x<t[s].x)&&(s=r);for(e=t[0],t[0]=t[s],t[s]=e,r=1;r<o-1;r++){for(a=(s=r)+1;a<o;a++)(0<h.multiply(t[a],t[s],t[0])||0==h.multiply(t[a],t[s],t[0])&&h.dis(t[0],t[a])<h.dis(t[0],t[s]))&&(s=a);e=t[r],t[r]=t[s],t[s]=e}if((i=h._temArr).length=0,t.length<3)return Dn.copyArray(i,t);for(i.push(t[0],t[1],t[2]),r=3;r<o;r++){for(;2<=i.length&&0<=h.multiply(t[r],i[i.length-1],i[i.length-2]);)i.pop();t[r]&&i.push(t[r])}return i},h._mPointList=null,h._tempPointList=[],h._temPList=[],h._temArr=[],h}(),$i=function(){function r(){}return E(r,"laya.maths.MathUtil"),r.subtractVector3=function(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]},r.lerp=function(t,e,i){return t*(1-i)+e*i},r.scaleVector3=function(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e},r.lerpVector3=function(t,e,i,n){var r=t[0],a=t[1],s=t[2];n[0]=r+i*(e[0]-r),n[1]=a+i*(e[1]-a),n[2]=s+i*(e[2]-s)},r.lerpVector4=function(t,e,i,n){var r=t[0],a=t[1],s=t[2],o=t[3];n[0]=r+i*(e[0]-r),n[1]=a+i*(e[1]-a),n[2]=s+i*(e[2]-s),n[3]=o+i*(e[3]-o)},r.slerpQuaternionArray=function(t,e,i,n,r,a,s){var o,l,h,u,c,d=t[e+0],_=t[e+1],f=t[e+2],m=t[e+3],p=i[n+0],g=i[n+1],v=i[n+2],y=i[n+3];return(l=d*p+_*g+f*v+m*y)<0&&(l=-l,p=-p,g=-g,v=-v,y=-y),c=1e-6<1-l?(o=Math.acos(l),h=Math.sin(o),u=Math.sin((1-r)*o)/h,Math.sin(r*o)/h):(u=1-r,r),a[s+0]=u*d+c*p,a[s+1]=u*_+c*g,a[s+2]=u*f+c*v,a[s+3]=u*m+c*y,a},r.getRotation=function(t,e,i,n){return Math.atan2(n-e,i-t)/Math.PI*180},r.sortBigFirst=function(t,e){return t==e?0:t<e?1:-1},r.sortSmallFirst=function(t,e){return t==e?0:t<e?-1:1},r.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},r.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},r.sortByKey=function(i,t,e){var n;return void 0===t&&(t=!1),void 0===e&&(e=!0),n=t?e?r.sortNumBigFirst:r.sortBigFirst:e?r.sortNumSmallFirst:r.sortSmallFirst,function(t,e){return n(t[i],e[i])}},r}(),tn=function(){function i(t,e,i,n,r,a){this.inPool=!1,this.bTransform=!1,void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a,this._checkTransform()}E(i,"laya.maths.Matrix");var t=i.prototype;return t.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},t._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},t.setTranslate=function(t,e){return this.tx=t,this.ty=e,this},t.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.scale=function(t,e){this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this.bTransform=!0},t.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,a=this.tx;this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this.bTransform=!0},t.skew=function(t,e){var i=Math.tan(t),n=Math.tan(e),r=this.a,a=this.b;return this.a+=n*this.c,this.b+=n*this.d,this.c+=i*r,this.d+=i*a,this},t.invertTransformPoint=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,a=this.tx,s=e*r-i*n,o=r/s,l=-i/s,h=-n/s,u=e/s,c=(n*this.ty-r*a)/s,d=-(e*this.ty-i*a)/s;return t.setTo(o*t.x+h*t.y+c,l*t.x+u*t.y+d)},t.transformPoint=function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)},t.transformPointN=function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)},t.transformPointArray=function(t,e){for(var i=t.length,n=0;n<i;n+=2){var r=t[n],a=t[n+1];e[n]=this.a*r+this.c*a+this.tx,e[n+1]=this.b*r+this.d*a+this.ty}return e},t.transformPointArrayScale=function(t,e){for(var i=t.length,n=0;n<i;n+=2){var r=t[n],a=t[n+1];e[n]=this.a*r+this.c*a,e[n+1]=this.b*r+this.d*a}return e},t.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},t.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},t.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,a=t*n-e*i;return this.a=n/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-n*r)/a,this.ty=-(t*this.ty-e*r)/a,this},t.setTo=function(t,e,i,n,r,a){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a,this},t.concat=function(t){var e=this.a,i=this.c,n=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=n*t.a+this.ty*t.c+t.tx,this.ty=n*t.b+this.ty*t.d+t.ty,this},t.scaleEx=function(t,e){var i=this.a,n=this.b,r=this.c,a=this.d;this.d=(this.c=0!==n||0!==r?(this.a=t*i,this.b=t*n,e*r):(this.a=t*i,this.b=0*a,0*i),e*a),this.bTransform=!0},t.rotateEx=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.b,a=this.c,s=this.d;this.d=0!==r||0!==a?(this.a=e*n+i*a,this.b=e*r+i*s,this.c=-i*n+e*a,-i*r+e*s):(this.a=e*n,this.b=i*s,this.c=-i*n,e*s),this.bTransform=!0},t.clone=function(){var t=i.create();return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t.bTransform=this.bTransform,t},t.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t.bTransform=this.bTransform,t},t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},t.destroy=function(){if(!this.inPool){var t=i._cache;this.inPool=!0,t._length||(t._length=0),(t[t._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},i.mul=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=t.tx,l=t.ty,h=e.a,u=e.b,c=e.c,d=e.d,_=e.tx,f=e.ty;return i.ty=0!==u||0!==c?(i.a=n*h+r*c,i.b=n*u+r*d,i.c=a*h+s*c,i.d=a*u+s*d,i.tx=h*o+c*l+_,u*o+d*l+f):(i.a=n*h,i.b=r*d,i.c=a*h,i.d=s*d,i.tx=h*o+_,d*l+f),i},i.mul16=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=t.tx,l=t.ty,h=e.a,u=e.b,c=e.c,d=e.d,_=e.tx,f=e.ty;return i[13]=0!==u||0!==c?(i[0]=n*h+r*c,i[1]=n*u+r*d,i[4]=a*h+s*c,i[5]=a*u+s*d,i[12]=h*o+c*l+_,u*o+d*l+f):(i[0]=n*h,i[1]=r*d,i[4]=a*h,i[5]=s*d,i[12]=h*o+_,d*l+f),i},i.mulPre=function(t,e,i,n,r,a,s,o){var l=t.a,h=t.b,u=t.c,c=t.d,d=t.tx,_=t.ty;return o.ty=0!==i||0!==n?(o.a=l*e+h*n,o.b=l*i+h*r,o.c=u*e+c*n,o.d=u*i+c*r,o.tx=e*d+n*_+a,i*d+r*_+s):(o.a=l*e,o.b=h*r,o.c=u*e,o.d=c*r,o.tx=e*d+a,r*_+s),o},i.mulPos=function(t,e,i,n,r,a,s,o){var l=t.a,h=t.b,u=t.c,c=t.d,d=t.tx,_=t.ty;return o.ty=0!==h||0!==u?(o.a=e*l+i*u,o.b=e*h+i*c,o.c=n*l+r*u,o.d=n*h+r*c,o.tx=l*a+u*s+d,h*a+c*s+_):(o.a=e*l,o.b=i*c,o.c=n*l,o.d=r*c,o.tx=l*a+d,c*s+_),o},i.preMul=function(t,e,i){var n=t.a,r=t.b,a=t.c,s=t.d,o=e.a,l=e.b,h=e.c,u=e.d,c=e.tx,d=e.ty;return i.a=o*n,i.b=i.c=0,i.d=u*s,i.tx=c*n+t.tx,i.ty=d*s+t.ty,0===l&&0===h&&0===r&&0===a||(i.a+=l*a,i.d+=h*r,i.b+=o*r+l*s,i.c+=h*n+u*a,i.tx+=d*a,i.ty+=c*r),i},i.preMulXY=function(t,e,i,n){var r=t.a,a=t.b,s=t.c,o=t.d;return n.a=r,n.b=a,n.c=s,n.d=o,n.tx=e*r+t.tx+i*s,n.ty=i*o+t.ty+e*a,n},i.create=function(){var t=i._cache,e=t._length?t[--t._length]:new i;return e.inPool=!1,e},i.EMPTY=new i,i.TEMP=new i,i._cache=[],i}(),en=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}E(t,"laya.maths.Point");var e=t.prototype;return e.setTo=function(t,e){return this.x=t,this.y=e,this},e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))},e.toString=function(){return this.x+","+this.y},e.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(0<t){var e=1/t;this.x*=e,this.y*=e}},t.TEMP=new t,t.EMPTY=new t,t}(),nn=function(){function h(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}E(h,"laya.maths.Rectangle");var t=h.prototype;return t.setTo=function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},t.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom)},t.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)},t.intersection=function(t,e){return this.intersects(t)?(e||(e=new h),e.x=Math.max(this.x,t.x),e.y=Math.max(this.y,t.y),e.width=Math.min(this.right,t.right)-e.x,e.height=Math.min(this.bottom,t.bottom)-e.y,e):null},t.union=function(t,e){return e||(e=new h),this.clone(e),t.width<=0||t.height<=0?e:(e.addPoint(t.x,t.y),e.addPoint(t.right,t.bottom),this)},t.clone=function(t){return t||(t=new h),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},t.equals=function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)},t.addPoint=function(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this},t._getBoundPoints=function(){var t=h._temB;return(t.length=0)==this.width||0==this.height||t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),t},t.isEmpty=function(){return this.width<=0||this.height<=0},v(0,t,"right",function(){return this.x+this.width}),v(0,t,"bottom",function(){return this.y+this.height}),h._getBoundPointS=function(t,e,i,n){var r=h._temA;return(r.length=0)==i||0==n||r.push(t,e,t+i,e,t,e+n,t+i,e+n),r},h._getWrapRec=function(t,e){if(!t||t.length<1)return e?e.setTo(0,0,0,0):h.TEMP.setTo(0,0,0,0);e=e||new h;var i,n,r,a,s,o=t.length,l=en.TEMP;for(r=s=-(n=a=99999),i=0;i<o;i+=2)l.x=t[i],l.y=t[i+1],n=n<l.x?n:l.x,a=a<l.y?a:l.y,r=r>l.x?r:l.x,s=s>l.y?s:l.y;return e.setTo(n,a,r-n,s-a)},h.EMPTY=new h,h.TEMP=new h,h._temB=[],h._temA=[],h}(),rn=function(){function l(){}return E(l,"laya.media.SoundManager"),v(1,l,"useAudioMusic",function(){return l._useAudioMusic},function(t){l._useAudioMusic=t,l._musicClass=t?Gr:null}),v(1,l,"autoStopMusic",function(){return l._autoStopMusic},function(t){S.stage.off("blur",null,l._stageOnBlur),S.stage.off("focus",null,l._stageOnFocus),S.stage.off("visibilitychange",null,l._visibilityChange),(l._autoStopMusic=t)&&(S.stage.on("blur",null,l._stageOnBlur),S.stage.on("focus",null,l._stageOnFocus),S.stage.on("visibilitychange",null,l._visibilityChange))}),v(1,l,"muted",function(){return l._muted},function(t){t!=l._muted&&(t&&l.stopAllSound(),l.musicMuted=t,l._muted=t)}),v(1,l,"musicMuted",function(){return l._musicMuted},function(t){t!=l._musicMuted&&(t?(l._tMusic&&l._musicChannel&&!l._musicChannel.isStopped?hn.isConchApp?l._musicChannel._audio&&(l._musicChannel._audio.muted=!0):l._musicChannel.pause():l._musicChannel=null,l._musicMuted=t):(l._musicMuted=t,l._tMusic&&l._musicChannel&&(hn.isConchApp?l._musicChannel._audio&&(l._musicChannel._audio.muted=!1):l._musicChannel.resume())))}),v(1,l,"soundMuted",function(){return l._soundMuted},function(t){l._soundMuted=t}),l.addChannel=function(t){0<=l._channels.indexOf(t)||l._channels.push(t)},l.removeChannel=function(t){var e=0;for(e=l._channels.length-1;0<=e;e--)l._channels[e]==t&&l._channels.splice(e,1)},l.disposeSoundIfNotUsed=function(t){var e=0;for(e=l._channels.length-1;0<=e;e--)if(l._channels[e].url==t)return;l.destroySound(t)},l._visibilityChange=function(){S.stage.isVisibility?l._stageOnFocus():l._stageOnBlur()},l._stageOnBlur=function(){l._isActive=!1,l._musicChannel&&(l._musicChannel.isStopped||(l._blurPaused=!0,l._musicChannel.pause())),l.stopAllSound(),S.stage.once("mousedown",null,l._stageOnFocus)},l._recoverWebAudio=function(){Ur.ctx&&"running"!=Ur.ctx.state&&Ur.ctx.resume&&Ur.ctx.resume()},l._stageOnFocus=function(){l._isActive=!0,l._recoverWebAudio(),S.stage.off("mousedown",null,l._stageOnFocus),l._blurPaused&&l._musicChannel&&l._musicChannel.isStopped&&(l._blurPaused=!1,l._musicChannel.resume())},l.playSound=function(t,e,i,n,r){if(void 0===e&&(e=1),void 0===r&&(r=0),!l._isActive||!t)return null;if(l._muted)return null;if(l._recoverWebAudio(),(t=on.formatURL(t))==l._tMusic){if(l._musicMuted)return null}else{if(hn.isConchApp){var a=Dn.getFileExtension(t);if("wav"!=a&&"ogg"!=a)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(l._soundMuted)return null}var s,o;return vn.onMiniGame||(s=S.loader.getRes(t)),n||(n=l._soundClass),s||((s=new n).load(t),vn.onMiniGame||kr.cacheRes(t,s)),(o=s.play(r,e))?(o.url=t,o.volume=t==l._tMusic?l.musicVolume:l.soundVolume,o.completeHandler=i,o):null},l.destroySound=function(t){var e=S.loader.getRes(t);e&&(kr.clearRes(t),e.dispose())},l.playMusic=function(t,e,i,n){return void 0===e&&(e=0),void 0===n&&(n=0),t=on.formatURL(t),l._tMusic=t,l._musicChannel&&l._musicChannel.stop(),l._musicChannel=l.playSound(t,e,i,l._musicClass,n)},l.stopSound=function(t){t=on.formatURL(t);var e,i=0;for(i=l._channels.length-1;0<=i;i--)(e=l._channels[i]).url==t&&e.stop()},l.stopAll=function(){l._tMusic=null;var t=0;for(t=l._channels.length-1;0<=t;t--)l._channels[t].stop()},l.stopAllSound=function(){var t,e=0;for(e=l._channels.length-1;0<=e;e--)(t=l._channels[e]).url!=l._tMusic&&t.stop()},l.stopMusic=function(){l._musicChannel&&l._musicChannel.stop(),l._tMusic=null},l.setSoundVolume=function(t,e){if(e)e=on.formatURL(e),l._setVolume(e,t);else{l.soundVolume=t;var i,n=0;for(n=l._channels.length-1;0<=n;n--)(i=l._channels[n]).url!=l._tMusic&&(i.volume=t)}},l.setMusicVolume=function(t){l.musicVolume=t,l._setVolume(l._tMusic,t)},l._setVolume=function(t,e){t=on.formatURL(t);var i,n=0;for(n=l._channels.length-1;0<=n;n--)(i=l._channels[n]).url==t&&(i.volume=e)},l.musicVolume=1,l.soundVolume=1,l.playbackRate=1,l._useAudioMusic=!0,l._muted=!1,l._soundMuted=!1,l._musicMuted=!1,l._tMusic=null,l._musicChannel=null,l._channels=[],l._autoStopMusic=!1,l._blurPaused=!1,l._isActive=!0,l._soundClass=null,l._musicClass=null,l.autoReleaseSound=!0,l}(),an=function(){var t;function i(){}return E(i,"laya.net.LocalStorage"),i.__init__=function(){i._baseClass||(i._baseClass=t).init(),i.items=i._baseClass.items,i.support=i._baseClass.support},i.setItem=function(t,e){i._baseClass.setItem(t,e)},i.getItem=function(t){return i._baseClass.getItem(t)},i.setJSON=function(t,e){i._baseClass.setJSON(t,e)},i.getJSON=function(t){return i._baseClass.getJSON(t)},i.removeItem=function(t){i._baseClass.removeItem(t)},i.clear=function(){i._baseClass.clear()},i._baseClass=null,i.items=null,i.support=!1,i.__init$=function(){t=function(){function i(){}return E(i,""),i.init=function(){try{i.support=!0,i.items=d.localStorage,i.setItem("laya","1"),i.removeItem("laya")}catch(t){i.support=!1}i.support||console.log("LocalStorage is not supprot or browser is private mode.")},i.setItem=function(t,e){try{i.support&&i.items.setItem(t,e)}catch(t){console.warn("set localStorage failed",t)}},i.getItem=function(t){return i.support?i.items.getItem(t):null},i.setJSON=function(t,e){try{i.support&&i.items.setItem(t,JSON.stringify(e))}catch(t){console.warn("set localStorage failed",t)}},i.getJSON=function(t){return JSON.parse(i.support?i.items.getItem(t):null)},i.removeItem=function(t){i.support&&i.items.removeItem(t)},i.clear=function(){i.support&&i.items.clear()},i.items=null,i.support=!1,i}()},i}(),sn=function(){function t(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}E(t,"laya.net.TTFLoader");var e=t.prototype;return e.load=function(t){var e=(this._url=t).split(".ttf")[0].split("/");this.fontName=e[e.length-1],vn.window.conch?this._loadConch():vn.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},e._loadConch=function(){this._http=new Zr,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},e._onHttpLoaded=function(t){vn.window.conch.setFontFaceFromBuffer(this.fontName,t),this._clearHttp(),this._complete()},e._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},e._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},e._complete=function(){S.timer.clear(this,this._complete),S.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},e._checkComplete=function(){M.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},e._loadWithFontFace=function(){var t=new vn.window.FontFace(this.fontName,"url('"+this._url+"')");vn.window.document.fonts.add(t);var e=this;t.loaded.then(function(){e._complete()}),t.load()},e._createDiv=function(){this._div=vn.createElement("div"),this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName,t.position="absolute",t.left="-100px",t.top="-100px",vn.document.body.appendChild(this._div)},e._loadWithCSS=function(){var t=this,e=vn.createElement("style");e.type="text/css",vn.document.body.appendChild(e),e.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=M.measureText("LayaTTFFont",this._fontTxt).width;var i=this;e.onload=function(){S.timer.once(1e4,i,t._complete)},S.timer.loop(20,this,this._checkComplete),this._createDiv()},t._testString="LayaTTFFont",t}(),on=function(){function n(t){this._url=null,this._path=null,this._url=n.formatURL(t),this._path=n.getPath(t)}E(n,"laya.net.URL");var t=n.prototype;return v(0,t,"path",function(){return this._path}),v(0,t,"url",function(){return this._url}),n.formatURL=function(t,e){if(!t)return"null path";if(0<t.indexOf(":"))return t;null!=n.customFormat&&(t=n.customFormat(t,e));var i=t.charAt(0);if("."===i)return n.formatRelativePath((e||n.basePath)+t);if("~"===i)return n.rootPath+t.substring(1);if("d"===i){if(0===t.indexOf("data:image"))return t}else if("/"===i)return t;return(e||n.basePath)+t},n.formatRelativePath=function(t){for(var e=t.split("/"),i=0,n=e.length;i<n;i++)".."==e[i]&&(e.splice(i-1,2),i-=2);return e.join("/")},n.isAbsolute=function(t){return 0<t.indexOf(":")||"/"==t.charAt(0)},n.getPath=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(0,e+1):""},n.getFileName=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(e+1):t},n.version={},n.basePath="",n.rootPath="",n.customFormat=function(t){var e=n.version[t];return!hn.isConchApp&&e&&(t+="?v="+e),t},n}(),ln=function(){function t(){}return E(t,"laya.webgl.shader.ShaderValue"),t}(),hn=function(){function r(t,e){this._timeId=0;var i=r._mainCanvas.source.style;i.position="absolute",i.top=i.left="0px",i.background="#000000",r._mainCanvas.source.id="layaCanvas";var n=laya.renders.Render.isWebGL;r._mainCanvas.source.width=t,r._mainCanvas.source.height=e,n&&r.WebGL.init(r._mainCanvas,t,e),vn.container.appendChild(r._mainCanvas.source),(r._context=new un(t,e,n?null:r._mainCanvas)).ctx.setIsMainContext(),vn.window.requestAnimationFrame(function t(e){S.stage._loop();vn.window.requestAnimationFrame(t)}),S.stage.on("visibilitychange",this,this._onVisibilitychange)}E(r,"laya.renders.Render");var t=r.prototype;return t._onVisibilitychange=function(){S.stage.isVisibility?0!=this._timeId&&vn.window.clearInterval(this._timeId):this._timeId=vn.window.setInterval(this._enterFrame,1e3)},t._enterFrame=function(t){S.stage._loop()},v(1,r,"context",function(){return r._context}),v(1,r,"canvas",function(){return r._mainCanvas.source}),r._context=null,r._mainCanvas=null,r.WebGL=null,r.isConchNode=!1,r.isConchApp=!1,r.isConchWebGL=!1,r.isWebGL=!1,r.is3DMode=!1,r.optimizeTextureMemory=function(t,e){return!0},r.__init$=function(){d.ConchRenderType=d.ConchRenderType||1,d.ConchRenderType|=d.conch?4:0,r.isConchNode=5==(5&d.ConchRenderType),r.isConchApp=4==(4&d.ConchRenderType),r.isConchWebGL=6==d.ConchRenderType},r}(),un=function(){function s(t,e,i){this.x=0,this.y=0,this._drawTexture=function(t,e,i){i[0].loaded&&this.ctx.drawTexture(i[0],i[1],i[2],i[3],i[4],t,e)},this._fillTexture=function(t,e,i){i[0].loaded&&this.ctx.fillTexture(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._drawTextureWithTransform=function(t,e,i){i[0].loaded&&this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],t,e,i[6])},this._fillQuadrangle=function(t,e,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])},this._drawRect=function(t,e,i){var n=this.ctx;null!=i[4]&&(n.fillStyle=i[4],n.fillRect(t+i[0],e+i[1],i[2],i[3],null)),null!=i[5]&&(n.strokeStyle=i[5],n.lineWidth=i[6],n.strokeRect(t+i[0],e+i[1],i[2],i[3],i[6]))},this._drawPie=function(t,e,i){var n=this.ctx;hn.isWebGL&&n.setPathId(i[8]),n.beginPath(),hn.isWebGL?(n.movePath(i[0]+t,i[1]+e),n.moveTo(0,0)):n.moveTo(t+i[0],e+i[1]),n.arc(t+i[0],e+i[1],i[2],i[3],i[4]),n.closePath(),this._fillAndStroke(i[5],i[6],i[7],!0)},this._clipRect=function(t,e,i){this.ctx.clipRect(t+i[0],e+i[1],i[2],i[3])},this._fillRect=function(t,e,i){this.ctx.fillRect(t+i[0],e+i[1],i[2],i[3],i[4])},this._drawCircle=function(t,e,i){var n=this.ctx;hn.isWebGL&&n.setPathId(i[6]),Cn.drawCall++,n.beginPath(),hn.isWebGL&&n.movePath(i[0]+t,i[1]+e),n.arc(i[0]+t,i[1]+e,i[2],0,s.PI2),n.closePath(),this._fillAndStroke(i[3],i[4],i[5],!0)},this._fillCircle=function(t,e,i){Cn.drawCall++;var n=this.ctx;n.beginPath(),n.fillStyle=i[3],n.arc(i[0]+t,i[1]+e,i[2],0,s.PI2),n.fill()},this._setShader=function(t,e,i){this.ctx.setShader(i[0])},this._drawLine=function(t,e,i){var n=this.ctx;hn.isWebGL&&n.setPathId(i[6]),n.beginPath(),n.strokeStyle=i[4],n.lineWidth=i[5],hn.isWebGL?(n.movePath(t,e),n.moveTo(i[0],i[1]),n.lineTo(i[2],i[3])):(n.moveTo(t+i[0],e+i[1]),n.lineTo(t+i[2],e+i[3])),n.stroke()},this._drawLines=function(t,e,i){var n=this.ctx;hn.isWebGL&&n.setPathId(i[5]),n.beginPath(),t+=i[0],e+=i[1],hn.isWebGL&&n.movePath(t,e),n.strokeStyle=i[3],n.lineWidth=i[4];var r=i[2],a=2,s=r.length;if(hn.isWebGL)for(n.moveTo(r[0],r[1]);a<s;)n.lineTo(r[a++],r[a++]);else for(n.moveTo(t+r[0],e+r[1]);a<s;)n.lineTo(t+r[a++],e+r[a++]);n.stroke()},this._drawLinesWebGL=function(t,e,i){this.ctx.drawLines(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])},this._drawCurves=function(t,e,i){this.ctx.drawCurves(t,e,i)},this._draw=function(t,e,i){i[0].call(null,this,t,e)},this._transformByMatrix=function(t,e,i){this.ctx.transformByMatrix(i[0])},this._setTransform=function(t,e,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},this._setTransformByMatrix=function(t,e,i){this.ctx.setTransformByMatrix(i[0])},this._save=function(t,e,i){this.ctx.save()},this._restore=function(t,e,i){this.ctx.restore()},this._translate=function(t,e,i){this.ctx.translate(i[0],i[1])},this._transform=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);var n=i[0];this.ctx.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.ctx.translate(-t-i[1],-e-i[2])},this._rotate=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e),this.ctx.rotate(i[0]),this.ctx.translate(-t-i[1],-e-i[2])},this._scale=function(t,e,i){this.ctx.translate(i[2]+t,i[3]+e),this.ctx.scale(i[0],i[1]),this.ctx.translate(-t-i[2],-e-i[3])},this._alpha=function(t,e,i){this.ctx.globalAlpha*=i[0]},this._setAlpha=function(t,e,i){this.ctx.globalAlpha=i[0]},this._fillText=function(t,e,i){this.ctx.fillText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5])},this._strokeText=function(t,e,i){this.ctx.strokeText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])},this._fillBorderText=function(t,e,i){this.ctx.fillBorderText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._blendMode=function(t,e,i){this.ctx.globalCompositeOperation=i[0]},this._beginClip=function(t,e,i){this.ctx.beginClip&&this.ctx.beginClip(t+i[0],e+i[1],i[2],i[3])},this._setIBVB=function(t,e,i){this.ctx.setIBVB(i[0]+t,i[1]+e,i[2],i[3],i[4],i[5],i[6],i[7])},this._fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1]+t,i[2]+e,i[3],i[4])},this._drawPath=function(t,e,i){var n=this.ctx;hn.isWebGL&&n.setPathId(-1),n.beginPath(),t+=i[0],e+=i[1],hn.isWebGL&&n.movePath(t,e);for(var r=i[2],a=0,s=r.length;a<s;a++){var o=r[a];switch(o[0]){case"moveTo":hn.isWebGL?n.moveTo(o[1],o[2]):n.moveTo(t+o[1],e+o[2]);break;case"lineTo":hn.isWebGL?n.lineTo(o[1],o[2]):n.lineTo(t+o[1],e+o[2]);break;case"arcTo":hn.isWebGL?n.arcTo(o[1],o[2],o[3],o[4],o[5]):n.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":n.closePath()}}var l=i[3];null!=l&&(n.fillStyle=l.fillStyle,n.fill());var h=i[4];null!=h&&(n.strokeStyle=h.strokeStyle,n.lineWidth=h.lineWidth||1,n.lineJoin=h.lineJoin,n.lineCap=h.lineCap,n.miterLimit=h.miterLimit,n.stroke())},this.drawPoly=function(t,e,i){this.ctx.drawPoly(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._drawPoly=function(t,e,i){var n=this.ctx,r=i[2],a=2,s=r.length;if(hn.isWebGL)for(n.setPathId(i[6]),n.beginPath(),t+=i[0],e+=i[1],n.movePath(t,e),n.moveTo(r[0],r[1]);a<s;)n.lineTo(r[a++],r[a++]);else for(n.beginPath(),t+=i[0],e+=i[1],n.moveTo(t+r[0],e+r[1]);a<s;)n.lineTo(t+r[a++],e+r[a++]);n.closePath(),this._fillAndStroke(i[3],i[4],i[5],i[7])},this._drawSkin=function(t,e,i){var n=i[0];if(n){var r=this.ctx;n.render(r,t,e)}},this._drawParticle=function(t,e,i){this.ctx.drawParticle(t+this.x,e+this.y,i[0])},this._setFilters=function(t,e,i){this.ctx.setFilters(i)},i?this.ctx=i.getContext("2d"):(i=Ys.create("3D"),this.ctx=M.createWebGLContext2D(i),i._setContext(this.ctx)),i.size(t,e),this.canvas=i}E(s,"laya.renders.RenderContext");var t=s.prototype;return t.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},t.drawTexture=function(t,e,i,n,r){t.loaded&&this.ctx.drawTexture(t,e,i,n,r,this.x,this.y)},t._drawTextures=function(t,e,i){i[0].loaded&&this.ctx.drawTextures(i[0],i[1],t+this.x,e+this.y)},t.drawTextureWithTransform=function(t,e,i,n,r,a,s){t.loaded&&this.ctx.drawTextureWithTransform(t,e,i,n,r,a,this.x,this.y,s)},t.fillQuadrangle=function(t,e,i,n,r){this.ctx.fillQuadrangle(t,e,i,n,r)},t.drawCanvas=function(t,e,i,n,r){this.ctx.drawCanvas(t,e+this.x,i+this.y,n,r)},t.drawRect=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=this.ctx;s.strokeStyle=r,s.lineWidth=a,s.strokeRect(t+this.x,e+this.y,i,n,a)},t._fillAndStroke=function(t,e,i,n){void 0===n&&(n=!1);var r=this.ctx;null!=t&&(r.fillStyle=t,hn.isWebGL?r.fill(n):r.fill()),null!=e&&0<i&&(r.strokeStyle=e,r.lineWidth=i,r.stroke())},t.clipRect=function(t,e,i,n){this.ctx.clipRect(t+this.x,e+this.y,i,n)},t.fillRect=function(t,e,i,n,r){this.ctx.fillRect(t+this.x,e+this.y,i,n,r)},t.drawCircle=function(t,e,i,n,r){void 0===r&&(r=1),Cn.drawCall++;var a=this.ctx;a.beginPath(),a.strokeStyle=n,a.lineWidth=r,a.arc(t+this.x,e+this.y,i,0,s.PI2),a.stroke()},t.drawTriangles=function(t,e,i){if(hn.isWebGL)this.ctx.drawTriangles(i[0],t+i[1],e+i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9]);else{var n=i[5],r=0,a=n.length,s=this.ctx;for(r=0;r<a;r+=3){var o=2*n[r],l=2*n[r+1],h=2*n[r+2];s.drawTriangle(i[0],i[3],i[4],o,l,h,i[6],!0)}}},t.fillCircle=function(t,e,i,n){Cn.drawCall++;var r=this.ctx;r.beginPath(),r.fillStyle=n,r.arc(t+this.x,e+this.y,i,0,s.PI2),r.fill()},t.setShader=function(t){this.ctx.setShader(t)},t.drawLine=function(t,e,i,n,r,a){void 0===a&&(a=1);var s=this.ctx;s.beginPath(),s.strokeStyle=r,s.lineWidth=a,s.moveTo(this.x+t,this.y+e),s.lineTo(this.x+i,this.y+n),s.stroke()},t.clear=function(){this.ctx.clear()},t.transformByMatrix=function(t){this.ctx.transformByMatrix(t)},t.setTransform=function(t,e,i,n,r,a){this.ctx.setTransform(t,e,i,n,r,a)},t.setTransformByMatrix=function(t){this.ctx.setTransformByMatrix(t)},t.save=function(){this.ctx.save()},t.restore=function(){this.ctx.restore()},t.translate=function(t,e){this.ctx.translate(t,e)},t.transform=function(t,e,i,n,r,a){this.ctx.transform(t,e,i,n,r,a)},t.rotate=function(t){this.ctx.rotate(t)},t.scale=function(t,e){this.ctx.scale(t,e)},t.alpha=function(t){this.ctx.globalAlpha*=t},t.setAlpha=function(t){this.ctx.globalAlpha=t},t.fillWords=function(t,e,i,n,r,a){void 0===a&&(a=0),this.ctx.fillWords(t,e,i,n,r,a)},t.fillBorderWords=function(t,e,i,n,r,a,s){this.ctx.fillBorderWords(t,e,i,n,r,a,s)},t.fillText=function(t,e,i,n,r,a){this.ctx.fillText(t,e+this.x,i+this.y,n,r,a)},t.strokeText=function(t,e,i,n,r,a,s){this.ctx.strokeText(t,e+this.x,i+this.y,n,r,a,s)},t.blendMode=function(t){this.ctx.globalCompositeOperation=t},t.flush=function(){this.ctx.flush&&this.ctx.flush()},t.addRenderObject=function(t){this.ctx.addRenderObject(t)},t.beginClip=function(t,e,i,n){this.ctx.beginClip&&this.ctx.beginClip(t,e,i,n)},t.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},t.fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],4<i.length?i[4]:null)},s.PI2=2*Math.PI,s}(),cn=function(){function s(t,e){switch(this._next=e||s.NORENDER,t){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=zi._filter);case 69905:return void(this._fun=s._initRenderFun)}this.onCreate(t)}E(s,"laya.renders.RenderSprite");var t=s.prototype;return t.onCreate=function(t){},t._style=function(t,e,i,n){t._style.render(t,e,i,n);var r=this._next;r._fun.call(r,t,e,i,n)},t._no=function(t,e,i,n){},t._custom=function(t,e,i,n){t.customRender(e,i,n);var r=t._style._tf;this._next._fun.call(this._next,t,e,i-r.translateX,n-r.translateY)},t._clip=function(t,e,i,n){var r=this._next;if(r!=s.NORENDER){var a=t._style.scrollRect;e.ctx.save(),e.ctx.clipRect(i,n,a.width,a.height),r._fun.call(r,t,e,i-a.x,n-a.y),e.ctx.restore()}},t._blend=function(t,e,i,n){var r=t._style;r.blendMode&&(e.ctx.globalCompositeOperation=r.blendMode);var a=this._next;a._fun.call(a,t,e,i,n),e.ctx.globalCompositeOperation="source-over"},t._mask=function(t,e,i,n){var r=this._next;r._fun.call(r,t,e,i,n);var a=t.mask;a&&(e.ctx.globalCompositeOperation="destination-in",(0<a.numChildren||!a.graphics._isOnlyOne())&&(a.cacheAsBitmap=!0),a.render(e,i-t.pivotX,n-t.pivotY)),e.ctx.globalCompositeOperation="source-over"},t._graphics=function(t,e,i,n){var r=t._style._tf;t._graphics&&t._graphics._render(t,e,i-r.translateX,n-r.translateY);var a=this._next;a._fun.call(a,t,e,i,n)},t._image=function(t,e,i,n){var r=t._style;e.ctx.drawTexture2(i,n,r._tf.translateX,r._tf.translateY,t.transform,r.alpha,r.blendMode,t._graphics._one)},t._image2=function(t,e,i,n){var r=t._style._tf;e.ctx.drawTexture2(i,n,r.translateX,r.translateY,t.transform,1,null,t._graphics._one)},t._alpha=function(t,e,i,n){var r;if(.01<(r=t._style.alpha)||t._needRepaint()){var a=e.ctx.globalAlpha;e.ctx.globalAlpha*=r;var s=this._next;s._fun.call(s,t,e,i,n),e.ctx.globalAlpha=a}},t._transform=function(t,e,i,n){var r=t.transform,a=this._next;r&&a!=s.NORENDER?(e.save(),e.transform(r.a,r.b,r.c,r.d,r.tx+i,r.ty+n),a._fun.call(a,t,e,0,0),e.restore()):a._fun.call(a,t,e,i,n)},t._childs=function(t,e,i,n){var r=t._style,a=r._tf;if(i=i-a.translateX+r.paddingLeft,n=n-a.translateY+r.paddingTop,r._calculation){var s=t._getWords();if(s){var o=r;o&&(o.stroke?e.fillBorderWords(s,i,n,o.font,o.color,o.strokeColor,o.stroke):e.fillWords(s,i,n,o.font,o.color,"none"!=o.textDecoration&&o.underLine?1:0))}}var l,h=t._childs,u=h.length;if(t.viewport||t.optimizeScrollRect&&t._style.scrollRect){var c=t.viewport||t._style.scrollRect,d=c.x,_=c.y,f=c.right,m=c.bottom,p=NaN,g=NaN;for(v=0;v<u;++v)(l=h[v]).visible&&(p=l._x)<f&&p+l.width>d&&(g=l._y)<m&&g+l.height>_&&l.render(e,i,n)}else for(var v=0;v<u;++v)(l=h[v])._style.visible&&l.render(e,i,n)},t._canvas=function(t,e,i,n){var r=t._$P.cacheCanvas;if(r){"bitmap"===r.type?Cn.canvasBitmap++:Cn.canvasNormal++;var a=r.ctx;if(t._needRepaint()||!a)this._canvas_repaint(t,e,i,n);else{var s=r._cacheRec;e.drawCanvas(a.canvas,i+s.x,n+s.y,s.width,s.height)}}else this._next._fun.call(this._next,t,e,i,n)},t._canvas_repaint=function(t,e,i,n){var r=t._$P.cacheCanvas,a=this._next;if(r){var s,o,l,h,u=r.ctx,c=t._needRepaint()||!u,d=r.type;if("bitmap"===d?Cn.canvasBitmap++:Cn.canvasNormal++,c){var _,f;r._cacheRec||(r._cacheRec=new nn),hn.isWebGL&&"bitmap"!==d?r._cacheRec.setTo(-t.pivotX,-t.pivotY,1,1):((h=t.getSelfBounds()).x=h.x-t.pivotX,h.y=h.y-t.pivotY,h.x=h.x-16,h.y=h.y-16,h.width=h.width+32,h.height=h.height+32,h.x=Math.floor(h.x+i)-i,h.y=Math.floor(h.y+n)-n,h.width=Math.floor(h.width),h.height=Math.floor(h.height),r._cacheRec.copyFrom(h)),h=r._cacheRec;var m,p=hn.isWebGL?1:vn.pixelRatio*S.stage.clientScaleX,g=hn.isWebGL?1:vn.pixelRatio*S.stage.clientScaleY;if(!hn.isWebGL){var v,y=1,x=1;for(v=t;v&&v!=S.stage;)y*=v.scaleX,x*=v.scaleY,v=v.parent;hn.isWebGL?(y<1&&(p*=y),x<1&&(g*=x)):(1<y&&(p*=y),1<x&&(g*=x))}if(t.scrollRect){var b=t.scrollRect;h.x-=b.x,h.y-=b.y}if(_=h.width*p,f=h.height*g,o=h.x,l=h.y,hn.isWebGL&&"bitmap"===d&&(2048<_||2048<f))return console.warn("cache bitmap size larger than 2048,cache ignored"),r.ctx&&(wn.recover("RenderContext",r.ctx),r.ctx.canvas.size(0,0),r.ctx=null),void a._fun.call(a,t,e,i,n);if(u||(u=r.ctx=wn.getItem("RenderContext")||new un(_,f,Ys.create("AUTO"))),u.ctx.sprite=t,(s=u.canvas).clear(),(s.width!=_||s.height!=f)&&s.size(_,f),"bitmap"===d?s.context.asBitmap=!0:"normal"===d&&(s.context.asBitmap=!1),1!=p||1!=g){var T=u.ctx;T.save(),T.scale(p,g),!hn.isConchWebGL&&hn.isConchApp&&(m=t._$P.cf)&&T.setFilterMatrix&&T.setFilterMatrix(m._mat,m._alpha),a._fun.call(a,t,u,-o,-l),T.restore(),hn.isConchApp&&!hn.isConchWebGL||t._applyFilters()}else T=u.ctx,!hn.isConchWebGL&&hn.isConchApp&&(m=t._$P.cf)&&T.setFilterMatrix&&T.setFilterMatrix(m._mat,m._alpha),a._fun.call(a,t,u,-o,-l),hn.isConchApp&&!hn.isConchWebGL||t._applyFilters();t._$P.staticCache&&(r.reCache=!1),Cn.canvasReCache++}else o=(h=r._cacheRec).x,l=h.y,s=u.canvas;e.drawCanvas(s,i+o,n+l,h.width,h.height)}else a._fun.call(a,t,u,i,n)},s.__init__=function(){var t,e,i=0;for(e=M.createRenderSprite(69905,null),t=s.renders.length=4096,i=0;i<t;i++)s.renders[i]=e;s.renders[0]=M.createRenderSprite(0,null),function(t,e){for(var i=0,n=0;n<t.length;n++)i|=t[n],s.renders[i]=e}([1,512,4,2],new s(1,null)),s.renders[513]=M.createRenderSprite(513,null),s.renders[517]=new s(517,null)},s._initRenderFun=function(t,e,i,n){var r=t._renderType;(s.renders[r]=s._getTypeRender(r))._fun(t,e,i,n)},s._getTypeRender=function(t){for(var e=null,i=2048;1<i;)i&t&&(e=M.createRenderSprite(i,e)),i>>=1;return e},s.IMAGE=1,s.ALPHA=2,s.TRANSFORM=4,s.BLEND=8,s.CANVAS=16,s.FILTERS=32,s.MASK=64,s.CLIP=128,s.STYLE=256,s.GRAPHICS=512,s.CUSTOM=1024,s.CHILDS=2048,s.INIT=69905,s.renders=[],s.NORENDER=new s(0,null),s}(),dn=function(){function o(){this._repaint=!1}E(o,"laya.resource.Context");var t=o.prototype;return t.replaceReset=function(){var t,e,i=0;for(t=o.replaceKeys.length,i=0;i<t;i++)e=o.replaceKeys[i],this[o.newKeys[i]]=this[e]},t.replaceResotre=function(){this.__restore(),this.__reset()},t.setIsMainContext=function(){},t.drawTextures=function(t,e,i,n){Cn.drawCall+=e.length/2;for(var r=t.width,a=t.height,s=0,o=e.length;s<o;s+=2)this.drawTexture(t,e[s],e[s+1],r,a,i,n)},t.drawCanvas=function(t,e,i,n,r){Cn.drawCall++,this.drawImage(t.source,e,i,n,r)},t.fillRect=function(t,e,i,n,r){Cn.drawCall++,r&&(this.fillStyle=r),this.__fillRect(t,e,i,n)},t.fillText=function(t,e,i,n,r,a){Cn.drawCall++,3<arguments.length&&null!=n&&(this.font=n,this.fillStyle=r,this.textAlign=a,this.textBaseline="top"),this.__fillText(t,e,i)},t.fillBorderText=function(t,e,i,n,r,a,s,o){Cn.drawCall++,this.font=n,this.fillStyle=r,this.textBaseline="top",this.strokeStyle=a,this.lineWidth=s,this.textAlign=o,this.__strokeText(t,e,i),this.__fillText(t,e,i)},t.strokeText=function(t,e,i,n,r,a,s){Cn.drawCall++,3<arguments.length&&null!=n&&(this.font=n,this.strokeStyle=r,this.lineWidth=a,this.textAlign=s,this.textBaseline="top"),this.__strokeText(t,e,i)},t.transformByMatrix=function(t){this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.setTransformByMatrix=function(t){this.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.clipRect=function(t,e,i,n){Cn.drawCall++,this.beginPath(),this.rect(t,e,i,n),this.clip()},t.drawTexture=function(t,e,i,n,r,a,s){Cn.drawCall++;var o=t.uv,l=t.bitmap.width,h=t.bitmap.height;this.drawImage(t.source,o[0]*l,o[1]*h,(o[2]-o[0])*l,(o[5]-o[3])*h,e+a,i+s,n,r)},t.drawTextureWithTransform=function(t,e,i,n,r,a,s,o,l){Cn.drawCall++;var h=t.uv,u=t.bitmap.width,c=t.bitmap.height;this.save(),1!=l&&(this.globalAlpha*=l),a?(this.transform(a.a,a.b,a.c,a.d,a.tx+s,a.ty+o),this.drawImage(t.source,h[0]*u,h[1]*c,(h[2]-h[0])*u,(h[5]-h[3])*c,e,i,n,r)):this.drawImage(t.source,h[0]*u,h[1]*c,(h[2]-h[0])*u,(h[5]-h[3])*c,e+s,i+o,n,r),this.restore()},t.drawTexture2=function(t,e,i,n,r,a,s,o){var l=o[0];if(l.loaded&&l.bitmap&&l.source){Cn.drawCall++;var h=1!==a;if(h){var u=this.globalAlpha;this.globalAlpha*=a}var c=l.uv,d=l.bitmap.width,_=l.bitmap.height;r?(this.save(),this.transform(r.a,r.b,r.c,r.d,r.tx+t,r.ty+e),this.drawImage(l.source,c[0]*d,c[1]*_,(c[2]-c[0])*d,(c[5]-c[3])*_,o[1]-i,o[2]-n,o[3],o[4]),this.restore()):this.drawImage(l.source,c[0]*d,c[1]*_,(c[2]-c[0])*d,(c[5]-c[3])*_,o[1]-i+t,o[2]-n+e,o[3],o[4]),h&&(this.globalAlpha=u)}},t.fillTexture=function(t,e,i,n,r,a,s,o){if(!o.pat){if(t.uv!=Hr.DEF_UV){var l=new Ys("2D");l.getContext("2d"),l.size(t.width,t.height),l.context.drawTexture(t,0,0,t.width,t.height,0,0),t=new Hr(l)}o.pat=this.createPattern(t.bitmap.source,a)}var h=e,u=i,c=0,d=0;s&&(h+=s.x%t.width,u+=s.y%t.height,c-=s.x%t.width,d-=s.y%t.height),this.translate(h,u),this.fillRect(c,d,n,r,o.pat),this.translate(-h,-u)},t.drawTriangle=function(t,e,i,n,r,a,s,o){var l=t.bitmap,h=l.source,u=t.width,c=t.height,d=l.width,_=l.height,f=i[n]*d,m=i[r]*d,p=i[a]*d,g=i[n+1]*_,v=i[r+1]*_,y=i[a+1]*_,x=e[n],b=e[r],T=e[a],S=e[n+1],E=e[r+1],R=e[a+1];if(o){var w=(x+b+T)/3,C=(S+E+R)/3,I=x-w,M=S-C,A=Math.sqrt(I*I+M*M);x=w+I/A*(A+1),S=C+M/A*(A+1),M=E-C,b=w+(I=b-w)/(A=Math.sqrt(I*I+M*M))*(A+1),E=C+M/A*(A+1),M=R-C,T=w+(I=T-w)/(A=Math.sqrt(I*I+M*M))*(A+1),R=C+M/A*(A+1)}this.save(),s&&this.transform(s.a,s.b,s.c,s.d,s.tx,s.ty),this.beginPath(),this.moveTo(x,S),this.lineTo(b,E),this.lineTo(T,R),this.closePath(),this.clip();var D=1/(f*v+g*p+m*y-v*p-g*m-f*y),L=x*v+g*T+b*y-v*T-g*b-x*y,V=f*b+x*p+m*T-b*p-x*m-f*T,N=f*v*T+g*b*p+x*m*y-x*v*p-g*m*T-f*b*y,P=S*v+g*R+E*y-v*R-g*E-S*y,F=f*E+S*p+m*R-E*p-S*m-f*R,O=f*v*R+g*E*p+S*m*y-S*v*p-g*m*R-f*E*y;this.transform(L*D,P*D,V*D,F*D,N*D,O*D),this.drawImage(h,t.uv[0]*d,t.uv[1]*_,u,c,t.uv[0]*d,t.uv[1]*_,u,c),this.restore()},t.flush=function(){return 0},t.fillWords=function(t,e,i,n,r,a){n&&(this.font=n),r&&(this.fillStyle=r);this.textBaseline="top",this.textAlign="left";for(var s=0,o=t.length;s<o;s++){var l=t[s];if(this.__fillText(l.char,l.x+e,l.y+i),1===a){var h=l.height,u=.5*l.style.letterSpacing;u||(u=0),this.beginPath(),this.strokeStyle=r,this.lineWidth=1,this.moveTo(e+l.x-u+.5,i+l.y+h+.5),this.lineTo(e+l.x+l.width+u+.5,i+l.y+h+.5),this.stroke()}}},t.fillBorderWords=function(t,e,i,n,r,a,s){n&&(this.font=n),r&&(this.fillStyle=r),this.textBaseline="top",this.lineWidth=s,this.textAlign="left",this.strokeStyle=a;for(var o=0,l=t.length;o<l;o++){var h=t[o];this.__strokeText(h.char,h.x+e,h.y+i),this.__fillText(h.char,h.x+e,h.y+i)}},t.destroy=function(){this.canvas.width=this.canvas.height=0},t.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},t.drawCurves=function(t,e,i){this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],this.moveTo(t+n[0],e+n[1]);for(var r=2,a=n.length;r<a;)this.quadraticCurveTo(t+n[r++],e+n[r++],t+n[r++],e+n[r++]);this.stroke()},o.__init__=function(e){var i=laya.resource.Context.prototype;if(!(e=e||CanvasRenderingContext2D.prototype).inited){e.inited=!0,e.__fillText=e.fillText,e.__fillRect=e.fillRect,e.__strokeText=e.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(t){e[t]=i[t]})}},o.replaceCanvasGetSet=function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i.configurable)return!1;var n,r={};for(n in i)"set"!=n&&(r[n]=i[n]);var a=i.set;return r.set=function(t){a.call(this,t);var e=this.getContext("2d");e&&"__reset"in e&&e.__reset()},Object.defineProperty(t,e,r),!0},o.replaceGetSet=function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i.configurable)return!1;var n,r={};for(n in i)"set"!=n&&(r[n]=i[n]);var a=i.set,s="___"+e+"__";return o.newKeys.push(s),r.set=function(t){t!=this[s]&&(this[s]=t,a.call(this,t))},Object.defineProperty(t,e,r),!0},o._default=new o,o.newKeys=[],m(o,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),o}(),_n=function(){function a(t){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++a._uniqueIDCounter,this._name=t||"Content Manager",a._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,a._resourceManagers.push(this),this._resources=[]}E(a,"laya.resource.ResourceManager");var t=a.prototype;return S.imps(t,{"laya.resource.IDispose":!0}),t.getResourceByIndex=function(t){return this._resources[t]},t.getResourcesLength=function(){return this._resources.length},t.addResource=function(t){return t.resourceManager&&t.resourceManager.removeResource(t),-1===this._resources.indexOf(t)&&((t._resourceManager=this)._resources.push(t),this.addSize(t.memorySize),!0)},t.removeResource=function(t){var e=this._resources.indexOf(t);return-1!==e&&(this._resources.splice(e,1),t._resourceManager=null,this._memorySize-=t.memorySize,!0)},t.unload=function(){for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++){t[e].destroy()}t.length=0},t.dispose=function(){if(this===a._systemResourceManager)throw new Error("systemResourceManager不能被释放！");a._resourceManagers.splice(a._resourceManagers.indexOf(this),1),a._isResourceManagersSorted=!1;for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++){var i=t[e];i.resourceManager.removeResource(i),i.destroy()}t.length=0},t.addSize=function(t){t&&(this.autoRelease&&0<t&&this._memorySize+t>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=t)},t.garbageCollection=function(t){var e=this._resources;(e=e.slice()).sort(function(t,e){if(!t||!e)throw new Error("a或b不能为空！");return t.released&&e.released?0:t.released?1:e.released?-1:t._lastUseFrameCount-e._lastUseFrameCount});for(var i=Cn.loopCount,n=0,r=e.length;n<r;n++){var a=e[n];if(!(1<i-a._lastUseFrameCount))return void(this._memorySize>=t&&(this._isOverflow=!0));if(a.releaseResource(),this._memorySize<t)return void(this._isOverflow=!1)}},v(0,t,"id",function(){return this._id}),v(0,t,"name",function(){return this._name},function(t){!t&&""===t||this._name===t||(this._name=t,a._isResourceManagersSorted=!1)}),v(0,t,"memorySize",function(){return this._memorySize}),v(1,a,"systemResourceManager",function(){return a._systemResourceManager}),a.__init__=function(){a.currentResourceManager=a.systemResourceManager},a.getLoadedResourceManagerByIndex=function(t){return a._resourceManagers[t]},a.getLoadedResourceManagersCount=function(){return a._resourceManagers.length},a.recreateContentManagers=function(t){void 0===t&&(t=!1);for(var e=a.currentResourceManager,i=0;i<a._resourceManagers.length;i++){a.currentResourceManager=a._resourceManagers[i];for(var n=0;n<a.currentResourceManager._resources.length;n++)a.currentResourceManager._resources[n].releaseResource(t),a.currentResourceManager._resources[n].activeResource(t)}a.currentResourceManager=e},a.releaseContentManagers=function(t){void 0===t&&(t=!1);for(var e=a.currentResourceManager,i=0;i<a._resourceManagers.length;i++){a.currentResourceManager=a._resourceManagers[i];for(var n=0;n<a.currentResourceManager._resources.length;n++){var r=a.currentResourceManager._resources[n];!r.released&&r.releaseResource(t)}}a.currentResourceManager=e},a._uniqueIDCounter=0,a._isResourceManagersSorted=!1,a._resourceManagers=[],m(a,["_systemResourceManager",function(){return this._systemResourceManager=new a("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=a._systemResourceManager}]),a}(),fn=function(){function t(){}return E(t,"laya.system.System"),t.changeDefinition=function(t,e){S[t]=e;var i=t+"=classObj";S._runScript(i)},t.__init__=function(){hn.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())},t}(),mn=function(){function t(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return E(t,"laya.ui.LayoutStyle"),m(t,["EMPTY",function(){return this.EMPTY=new t}]),t}(),pn=function(){function t(){}return E(t,"laya.ui.Styles"),t.labelColor="#000000",t.buttonStateNum=3,t.scrollBarMinNum=15,t.scrollBarDelayTime=500,m(t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),t}(),gn=function(){function r(){}return E(r,"laya.ui.UIUtils"),r.fillArray=function(t,e,i){var n=t.concat();if(e)for(var r=e.split(","),a=0,s=Math.min(n.length,r.length);a<s;a++){var o=r[a];n[a]="true"==o||"false"!=o&&o,null!=i&&(n[a]=i(o))}return n},r.toColor=function(t){return Dn.toHexColor(t)},r.gray=function(t,e){void 0===e&&(e=!0),e?r.addFilter(t,r.grayFilter):r.clearFilter(t,Jr)},r.addFilter=function(t,e){var i=t.filters||[];i.push(e),t.filters=i},r.clearFilter=function(t,e){var i=t.filters;if(null!=i&&0<i.length){for(var n=i.length-1;-1<n;n--){var r=i[n];S.__typeof(r,e)&&i.splice(n,1)}t.filters=i}},r._getReplaceStr=function(t){return r.escapeSequence[t]},r.adptString=function(t){return t.replace(/\\(\w)/g,r._getReplaceStr)},r.getBindFun=function(t){var e=r._funMap.get(t);if(null==e){var i='"'+t+'"',n="(function(data){if(data==null)return;with(data){try{\nreturn "+(i=i.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";e=S._runScript(n),r._funMap.set(t,e)}return e},m(r,["grayFilter",function(){return this.grayFilter=new Jr([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new Vn}]),r}(),vn=function(){function i(){}return E(i,"laya.utils.Browser"),v(1,i,"pixelRatio",function(){return i.__init__(),-1<i.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:M.getPixelRatio()}),v(1,i,"height",function(){return i.__init__(),(S.stage&&S.stage.canvasRotation?i.clientWidth:i.clientHeight)*i.pixelRatio}),v(1,i,"clientWidth",function(){return i.__init__(),i.window.innerWidth||i.document.body.clientWidth}),v(1,i,"window",function(){return i.__init__(),i._window}),v(1,i,"clientHeight",function(){return i.__init__(),i.window.innerHeight||i.document.body.clientHeight||i.document.documentElement.clientHeight}),v(1,i,"width",function(){return i.__init__(),(S.stage&&S.stage.canvasRotation?i.clientHeight:i.clientWidth)*i.pixelRatio}),v(1,i,"container",function(){return i.__init__(),i._container||((i._container=i.createElement("div")).id="layaContainer",i.document.body.appendChild(i._container)),i._container},function(t){i._container=t}),v(1,i,"document",function(){return i.__init__(),i._document}),i.__init__=function(){if(!i._window){i._window=M.getWindow(),i._document=i.window.document,i._window.addEventListener("message",function(t){laya.utils.Browser._onMessage(t)},!1),i.document.__createElement=i.document.createElement,d.requestAnimationFrame=d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame||d.msRequestAnimationFrame||function(t){return d.setTimeout(t,1e3/60)};var t=d.document.body.style;t["-webkit-user-select"]="none",t["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",i.userAgent=i.window.navigator.userAgent,i.onIOS=!!(i.u=i.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),i.onMobile=-1<i.u.indexOf("Mobile"),i.onIPhone=-1<i.u.indexOf("iPhone"),i.onMac=-1<i.u.indexOf("Mac OS X"),i.onIPad=-1<i.u.indexOf("iPad"),i.onAndroid=-1<i.u.indexOf("Android")||-1<i.u.indexOf("Adr"),i.onWP=-1<i.u.indexOf("Windows Phone"),i.onQQBrowser=-1<i.u.indexOf("QQBrowser"),i.onMQQBrowser=-1<i.u.indexOf("MQQBrowser")||-1<i.u.indexOf("Mobile")&&-1<i.u.indexOf("QQ"),i.onIE=!!i.window.ActiveXObject||"ActiveXObject"in i.window,i.onWeiXin=-1<i.u.indexOf("MicroMessenger"),i.onPC=!i.onMobile,i.onSafari=-1<i.u.indexOf("Safari"),i.onFirefox=-1<i.u.indexOf("Firefox"),i.onEdge=-1<i.u.indexOf("Edge"),i.onMiniGame=-1<i.u.indexOf("MiniGame"),i.onLimixiu=-1<i.u.indexOf("limixiu"),i.httpProtocol="http:"==i.window.location.protocol,i.onMiniGame&&null==i.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),i.webAudioEnabled=!!(i.window.AudioContext||i.window.webkitAudioContext||i.window.mozAudioContext),i.soundType=i.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",Wr=i.webAudioEnabled?Ur:Gr,i.webAudioEnabled&&Ur.initWebAudio(),Gr._initMusicAudio(),i.enableTouch="ontouchstart"in d||d.DocumentTouch&&e instanceof DocumentTouch,d.focus(),rn._soundClass=Wr,rn._musicClass=Gr,hn._mainCanvas=hn._mainCanvas||Ys.create("2D"),i.canvas||(i.canvas=Ys.create("2D"),i.context=i.canvas.getContext("2d"))}},i._onMessage=function(t){if(t.data&&"size"==t.data.name){if(i.window.innerWidth=t.data.width,i.window.innerHeight=t.data.height,i.window.__innerHeight=t.data.clientHeight,!i.document.createEvent)return void console.warn("no document.createEvent");var e=i.document.createEvent("HTMLEvents");return e.initEvent("resize",!1,!1),void i.window.dispatchEvent(e)}},i.createElement=function(t){return i.__init__(),i.document.__createElement(t)},i.getElementById=function(t){return i.__init__(),i.document.getElementById(t)},i.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},i.now=function(){return M.now()},i._window=null,i._document=null,i._container=null,i.userAgent=null,i.u=null,i.onIOS=!1,i.onMac=!1,i.onMobile=!1,i.onIPhone=!1,i.onIPad=!1,i.onAndroid=!1,i.onWP=!1,i.onQQBrowser=!1,i.onMQQBrowser=!1,i.onSafari=!1,i.onFirefox=!1,i.onEdge=!1,i.onIE=!1,i.onWeiXin=!1,i.onMiniGame=!1,i.onLimixiu=!1,i.onPC=!1,i.httpProtocol=!1,i.webAudioEnabled=!1,i.soundType=null,i.enableTouch=!1,i.canvas=null,i.context=null,i.__init$=function(){},i}(),yn=function(){function e(t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}E(e,"laya.utils.Byte");var t=e.prototype;return t.___resizeBuffer=function(e){try{var t=new Uint8Array(e);null!=this._u8d_&&(this._u8d_.length<=e?t.set(this._u8d_):t.set(this._u8d_.subarray(0,e))),this._u8d_=t,this._d_=new DataView(t.buffer)}catch(t){throw"___resizeBuffer err:"+e}},t.getString=function(){return this.rUTF(this.getUint16())},t.getFloat32Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Float32Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getUint8Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Uint8Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getInt16Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Int16Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},t.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t},t.writeFloat32=function(t){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},t.writeFloat64=function(t){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8},t.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},t.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},t.writeInt32=function(t){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},t.writeUint32=function(t){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},t.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},t.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},t.writeUint16=function(t){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},t.writeInt16=function(t){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},t.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},t.writeUint8=function(t){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++},t._getUInt8=function(t){return this._d_.getUint8(t)},t._getUint16=function(t){return this._d_.getUint16(t,this._xd_)},t._getMatrix=function(){return new tn(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},t.rUTF=function(t){for(var e="",i=this._pos_+t,n=0,r=String.fromCharCode,a=this._u8d_;this._pos_<i;)(n=a[this._pos_++])<128?0!=n&&(e+=r(n)):e+=r(n<224?(63&n)<<6|127&a[this._pos_++]:n<240?(31&n)<<12|(127&a[this._pos_++])<<6|127&a[this._pos_++]:(15&n)<<18|(127&a[this._pos_++])<<12|a[this._pos_++]<<6&127|127&a[this._pos_++]),0;return e},t.getCustomString=function(t){for(var e="",i=0,n=0,r=String.fromCharCode,a=this._u8d_;0<t;)if((n=a[this._pos_])<128)e+=r(n),this._pos_++,t--;else for(i=n-128,this._pos_++,t-=i;0<i;)n=a[this._pos_++],e+=r(a[this._pos_++]<<8|n),i--;return e},t.clear=function(){this._pos_=0,this.length=0},t.__getBuffer=function(){return this._d_.buffer},t.writeUTFBytes=function(t){for(var e=0,i=(t+="").length;e<i;e++){var n=t.charCodeAt(e);n<=127?this.writeByte(n):n<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|n>>6,128|63&n],this._pos_),this._pos_+=2):n<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|n>>12,128|n>>6&63,128|63&n],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n],this._pos_),this._pos_+=4)}},t.writeUTFString=function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;if(65536<=i)throw"writeUTFString byte len more than 65536";this._d_.setUint16(e,i,this._xd_)},t.readUTFString=function(){return this.readUTFBytes(this.getUint16())},t.getUTFString=function(){return this.readUTFString()},t.readUTFBytes=function(t){if(void 0===t&&(t=-1),0==t)return"";var e=this.bytesAvailable;if(e<t)throw"readUTFBytes error - Out of bounds";return t=0<t?t:e,this.rUTF(t)},t.getUTFBytes=function(t){return void 0===t&&(t=-1),this.readUTFBytes(t)},t.writeByte=function(t){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},t.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},t.getByte=function(){return this.readByte()},t.ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)},t.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this.ensureWrite(this._pos_+i);var n=new Uint8Array(t);this._u8d_.set(n.subarray(e,e+i),this._pos_),this._pos_+=i},t.readArrayBuffer=function(t){var e;return e=this._u8d_.buffer.slice(this._pos_,this._pos_+t),this._pos_=this._pos_+t,e},v(0,t,"buffer",function(){var t=this._d_.buffer;return t.byteLength==this.length?t:t.slice(0,this.length)}),v(0,t,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_="littleEndian"==t}),v(0,t,"length",function(){return this._length},function(t){this._allocated_<t?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this.___resizeBuffer(this._allocated_=t),this._length=t}),v(0,t,"pos",function(){return this._pos_},function(t){this._pos_=t}),v(0,t,"bytesAvailable",function(){return this._length-this._pos_}),e.getSystemEndian=function(){if(!e._sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,!0),e._sysEndian=256===new Int16Array(t)[0]?"littleEndian":"bigEndian"}return e._sysEndian},e.BIG_ENDIAN="bigEndian",e.LITTLE_ENDIAN="littleEndian",e._sysEndian=null,e}(),xn=function(){function r(){}return E(r,"laya.utils.CacheManager"),r.regCacheByFunction=function(t,e){var i;r.unRegCacheByFunction(t,e),i={tryDispose:t,getCacheList:e},r._cacheList.push(i)},r.unRegCacheByFunction=function(t,e){var i,n=0;for(i=r._cacheList.length,n=0;n<i;n++)if(r._cacheList[n].tryDispose==t&&r._cacheList[n].getCacheList==e)return void r._cacheList.splice(n,1)},r.forceDispose=function(){var t=0,e=r._cacheList.length;for(t=0;t<e;t++)r._cacheList[t].tryDispose(!0)},r.beginCheck=function(t){void 0===t&&(t=15e3),S.timer.loop(t,null,r._checkLoop)},r.stopCheck=function(){S.timer.clear(null,r._checkLoop)},r._checkLoop=function(){var t=r._cacheList;if(!(t.length<1)){var e,i=vn.now(),n=0;for(e=n=t.length;0<n&&(t[r._index=++r._index%e].tryDispose(!1),!(vn.now()-i>r.loopTimeLimit));)n--}},r.loopTimeLimit=2,r._cacheList=[],r._index=0,r}(),bn=function(){function _(){}return E(_,"laya.utils.ClassUtils"),_.regClass=function(t,e){_._classMap[t]=e},_.getRegClass=function(t){return _._classMap[t]},_.getInstance=function(t){var e=_.getClass(t);return e?new e:(console.warn("[error] Undefined class:",t),null)},_.createByJson=function(t,e,i,n,r){"string"==typeof t&&(t=JSON.parse(t));var a=t.props;if(!e&&!(e=r?r.runWith(t):_.getInstance(a.runtime||t.type)))return null;var s=t.child;if(s)for(var o=0,l=s.length;o<l;o++){var h=s[o];if("render"!==h.props.name&&"render"!==h.props.renderType||!e._$set_itemRender)if("Graphic"==h.type)_.addGraphicsToSprite(h,e);else if(_.isDrawType(h.type))_.addGraphicToSprite(h,e,!0);else{var u=_.createByJson(h,null,i,n,r);"Script"==h.type?u.hasOwnProperty("owner")?u.owner=e:u.hasOwnProperty("target")&&(u.target=e):"mask"==h.props.renderType?e.mask=u:e.addChild(u)}else e.itemRender=h}if(a)for(var c in a){var d=a[c];"var"===c&&i?i[d]=e:d instanceof Array&&"function"==typeof e[c]?e[c].apply(e,d):e[c]=d}return n&&t.customProps&&n.runWith([e,t]),e.created&&e.created(),e},_.addGraphicsToSprite=function(t,e){var i;if((i=t.child)&&!(i.length<1)){var n;n=_._getGraphicsFromSprite(t,e);var r=0,a=0;t.props&&(r=_._getObjVar(t.props,"x",0),a=_._getObjVar(t.props,"y",0)),0!=r&&0!=a&&n.translate(r,a);var s,o=0;for(s=i.length,o=0;o<s;o++)_._addGraphicToGraphics(i[o],n);0!=r&&0!=a&&n.translate(-r,-a)}},_.addGraphicToSprite=function(t,e,i){var n;void 0===i&&(i=!1),n=i?_._getGraphicsFromSprite(t,e):e.graphics,_._addGraphicToGraphics(t,n)},_._getGraphicsFromSprite=function(t,e){var i,n;if(!t||!t.props)return e.graphics;switch(n=t.props.renderType){case"hit":case"unHit":var r;e.hitArea||(e.hitArea=new Rn),(r=e.hitArea)[n]||(r[n]=new f),i=r[n]}return i||(i=e.graphics),i},_._getTransformData=function(t){var e;(t.hasOwnProperty("pivotX")||t.hasOwnProperty("pivotY"))&&(e=e||new tn).translate(-_._getObjVar(t,"pivotX",0),-_._getObjVar(t,"pivotY",0));var i=_._getObjVar(t,"scaleX",1),n=_._getObjVar(t,"scaleY",1),r=_._getObjVar(t,"rotation",0);_._getObjVar(t,"skewX",0),_._getObjVar(t,"skewY",0);return 1==i&&1==n&&0==r||((e=e||new tn).scale(i,n),e.rotate(.0174532922222222*r)),e},_._addGraphicToGraphics=function(t,e){var i,n;if((i=t.props)&&(n=_.DrawTypeDic[t.type])){var r,a;r=e;var s=_._getParams(i,n[1],n[2],n[3]);((a=_._tM)||1!=_._alpha)&&(r.save(),a&&r.transform(a),1!=_._alpha&&r.alpha(_._alpha)),r[n[0]].apply(r,s),(a||1!=_._alpha)&&r.restore()}},_._adptLineData=function(t){return t[2]=parseFloat(t[0])+parseFloat(t[2]),t[3]=parseFloat(t[1])+parseFloat(t[3]),t},_._adptTextureData=function(t){return t[0]=kr.getRes(t[0]),t},_._adptLinesData=function(t){return t[2]=_._getPointListByStr(t[2]),t},_.isDrawType=function(t){return"Image"!=t&&_.DrawTypeDic.hasOwnProperty(t)},_._getParams=function(t,e,i,n){var r;void 0===i&&(i=0),(r=_._temParam).length=e.length;var a,s,o=0;for(a=e.length,o=0;o<a;o++)r[o]=_._getObjVar(t,e[o][0],e[o][1]);return _._alpha=_._getObjVar(t,"alpha",1),s=_._getTransformData(t),_._tM=s?(i||(i=0),s.translate(r[i],r[i+1]),r[i]=r[i+1]=0,s):null,n&&_[n]&&(r=_[n](r)),r},_._getPointListByStr=function(t){var e,i,n=0;for(i=(e=t.split(",")).length,n=0;n<i;n++)e[n]=parseFloat(e[n]);return e},_._getObjVar=function(t,e,i){return t.hasOwnProperty(e)?t[e]:i},_._temParam=[],_._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},_.getClass=function(t){var e=_._classMap[t]||t;return"string"==typeof e?S.__classmap[e]:e},_._tM=null,_._alpha=NaN,m(_,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),_}(),Tn=function(){function a(t){if(this._color=[],"string"==typeof t){null===(this.strColor=t)&&(t="#000000"),"#"==t.charAt(0)&&(t=t.substr(1));var e=t.length;if(3==e||4==e){for(var i="",n=0;n<e;n++)i+=t[n]+t[n];t=i}var r=this.numColor=parseInt(t,16);if(8==t.length)return void(this._color=[parseInt(t.substr(0,2),16)/255,((16711680&r)>>16)/255,((65280&r)>>8)/255,(255&r)/255])}else r=this.numColor=t,this.strColor=Dn.toHexColor(r);this._color=[((16711680&r)>>16)/255,((65280&r)>>8)/255,(255&r)/255,1],this._color.__id=++a._COLODID}return E(a,"laya.utils.Color",null,"Color$1"),a._initDefault=function(){for(var t in a._DEFAULT={},a._COLOR_MAP)a._SAVE[t]=a._DEFAULT[t]=new a(a._COLOR_MAP[t]);return a._DEFAULT},a._initSaveMap=function(){for(var t in a._SAVE_SIZE=0,a._SAVE={},a._DEFAULT)a._SAVE[t]=a._DEFAULT[t]},a.create=function(t){var e=a._SAVE[t+""];return null!=e?e:(a._SAVE_SIZE<1e3||a._initSaveMap(),a._SAVE[t+""]=new a(t))},a._SAVE={},a._SAVE_SIZE=0,a._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},a._DEFAULT=a._initDefault(),a._COLODID=1,a}(),Sn=function(){function t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}E(t,"laya.utils.Dragging");var e=t.prototype;return e.start=function(t,e,i,n,r,a,s,o){void 0===o&&(o=.92),this.clearTimer(),this.target=t,this.area=e,this.hasInertia=i,this.elasticDistance=e?n:0,this.elasticBackTime=r,this.data=a,this._disableMouseEvent=s,this.ratio=o,this._parent=t.parent,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,S.stage.on("mouseup",this,this.onStageMouseUp),S.stage.on("mouseout",this,this.onStageMouseUp),S.timer.frameLoop(1,this,this.loop)},e.clearTimer=function(){S.timer.clear(this,this.loop),S.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},e.stop=function(){this._dragging&&(Xi.instance.disableMouseEvent=!1,S.stage.off("mouseup",this,this.onStageMouseUp),S.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},e.loop=function(){var t=this._parent.getMousePoint(),e=t.x,i=t.y,n=e-this._lastX,r=i-this._lastY;if(this._clickOnly){if(!(1<Math.abs(n*S.stage._canvasTransform.getScaleX())||1<Math.abs(r*S.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),Xi.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(n,r);0===n&&0===r||(this._lastX=e,this._lastY=i,this.target.x+=n*this._elasticRateX,this.target.y+=r*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},e.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var t=this.area.x-this.target.x;else t=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target.y<this.area.y)var e=this.area.y-this.target.y;else e=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}},e.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},e.onStageMouseUp=function(t){if(Xi.instance.disableMouseEvent=!1,S.stage.off("mouseup",this,this.onStageMouseUp),S.stage.off("mouseout",this,this.onStageMouseUp),S.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,i=Math.min(e,6),n=this._offsets.length-i,r=e-1;n<r;r--)this._offsetY+=this._offsets[r--],this._offsetX+=this._offsets[r];this._offsetX=this._offsetX/i*2,this._offsetY=this._offsetY/i*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),S.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},e.checkElastic=function(){var t=NaN,e=NaN;if(this.target.x<this.area.x?t=this.area.x:this.target.x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target.y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=An.to(this.target,i,this.elasticBackTime,En.sineOut,C.create(this,this.clear),0,!1,!1)}},e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(S.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event("dragend",this.data)}},t}(),En=function(){function o(){}return E(o,"laya.utils.Ease"),o.linearNone=function(t,e,i,n){return i*t/n+e},o.linearIn=function(t,e,i,n){return i*t/n+e},o.linearInOut=function(t,e,i,n){return i*t/n+e},o.linearOut=function(t,e,i,n){return i*t/n+e},o.bounceIn=function(t,e,i,n){return i-o.bounceOut(n-t,0,i,n)+e},o.bounceInOut=function(t,e,i,n){return t<.5*n?.5*o.bounceIn(2*t,0,i,n)+e:.5*o.bounceOut(2*t-n,0,i,n)+.5*i+e},o.bounceOut=function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},o.backIn=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},o.backInOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=.5*n)<1?.5*i*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},o.backOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},o.elasticIn=function(t,e,i,n,r,a){var s;return void 0===r&&(r=0),void 0===a&&(a=0),0==t?e:1==(t/=n)?e+i:(a||(a=.3*n),s=!r||0<i&&r<i||i<0&&r<-i?(r=i,a/4):a/o.PI2*Math.asin(i/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*o.PI2/a)+e)},o.elasticInOut=function(t,e,i,n,r,a){var s;return void 0===r&&(r=0),void 0===a&&(a=0),0==t?e:2==(t/=.5*n)?e+i:(a||(a=n*(.3*1.5)),s=!r||0<i&&r<i||i<0&&r<-i?(r=i,a/4):a/o.PI2*Math.asin(i/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*o.PI2/a)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*n-s)*o.PI2/a)*.5+i+e)},o.elasticOut=function(t,e,i,n,r,a){var s;return void 0===r&&(r=0),void 0===a&&(a=0),0==t?e:1==(t/=n)?e+i:(a||(a=.3*n),s=!r||0<i&&r<i||i<0&&r<-i?(r=i,a/4):a/o.PI2*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*n-s)*o.PI2/a)+i+e)},o.strongIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},o.strongInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},o.strongOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},o.sineInOut=function(t,e,i,n){return.5*-i*(Math.cos(Math.PI*t/n)-1)+e},o.sineIn=function(t,e,i,n){return-i*Math.cos(t/n*o.HALF_PI)+i+e},o.sineOut=function(t,e,i,n){return i*Math.sin(t/n*o.HALF_PI)+e},o.quintIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},o.quintInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},o.quintOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},o.quartIn=function(t,e,i,n){return i*(t/=n)*t*t*t+e},o.quartInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e},o.quartOut=function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},o.cubicIn=function(t,e,i,n){return i*(t/=n)*t*t+e},o.cubicInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e},o.cubicOut=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},o.quadIn=function(t,e,i,n){return i*(t/=n)*t+e},o.quadInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e},o.quadOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},o.expoIn=function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},o.expoInOut=function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=.5*n)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(2-Math.pow(2,-10*--t))+e},o.expoOut=function(t,e,i,n){return t==n?e+i:i*(1-Math.pow(2,-10*t/n))+e},o.circIn=function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},o.circInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e},o.circOut=function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},o.HALF_PI=.5*Math.PI,o.PI2=2*Math.PI,o}(),Rn=function(){function c(){this._hit=null,this._unHit=null}E(c,"laya.utils.HitArea");var t=c.prototype;return t.isHit=function(t,e){return!!c.isHitGraphic(t,e,this.hit)&&!c.isHitGraphic(t,e,this.unHit)},t.contains=function(t,e){return this.isHit(t,e)},v(0,t,"hit",function(){return this._hit||(this._hit=new f),this._hit},function(t){this._hit=t}),v(0,t,"unHit",function(){return this._unHit||(this._unHit=new f),this._unHit},function(t){this._unHit=t}),c.isHitGraphic=function(t,e,i){if(!i)return!1;var n;if(!(n=i.cmds)&&i._one&&((n=c._cmds).length=1,n[0]=i._one),!n)return!1;var r,a,s=0;for(r=n.length,s=0;s<r;s++)if(a=n[s]){var o=hn._context;switch(a.callee){case o._translate:case 6:t-=a[0],e-=a[1]}if(c.isHitCmd(t,e,a))return!0}return!1},c.isHitCmd=function(t,e,i){if(!i)return!1;var n=hn._context,r=!1;switch(i.callee){case n._drawRect:case 13:c._rec.setTo(i[0],i[1],i[2],i[3]),r=c._rec.contains(t,e);break;case n._drawCircle:case n._fillCircle:case 14:r=(t-=i[0])*t+(e-=i[1])*e<i[2]*i[2];break;case n._drawPoly:case 18:t-=i[0],e-=i[1],r=c.ptInPolygon(t,e,i[2])}return r},c.ptInPolygon=function(t,e,i){var n;(n=c._ptPoint).setTo(t,e);var r,a=0,s=NaN,o=NaN,l=NaN,h=NaN;r=i.length;for(var u=0;u<r;u+=2){if(s=i[u],o=i[u+1],l=i[(u+2)%r],o!=(h=i[(u+3)%r]))if(!(n.y<Math.min(o,h)))if(!(n.y>=Math.max(o,h)))(n.y-o)*(l-s)/(h-o)+s>n.x&&a++}return a%2==1},c._cmds=[],m(c,["_rec",function(){return this._rec=new nn},"_ptPoint",function(){return this._ptPoint=new en}]),c}(),wn=(function(){function r(t,e,i,n){this.char=t,this.charNum=t.charCodeAt(0),this._x=this._y=0,this.width=e,this.height=i,this.style=n,this.isWord=!r._isWordRegExp.test(t)}E(r,"laya.utils.HTMLChar");var t=r.prototype;S.imps(t,{"laya.display.ILayout":!0}),t.setSprite=function(t){this._sprite=t},t.getSprite=function(){return this._sprite},t._isChar=function(){return!0},t._getCSSStyle=function(){return this.style},v(0,t,"width",function(){return this._w},function(t){this._w=t}),v(0,t,"x",function(){return this._x},function(t){this._sprite&&(this._sprite.x=t),this._x=t}),v(0,t,"y",function(){return this._y},function(t){this._sprite&&(this._sprite.y=t),this._y=t}),v(0,t,"height",function(){return this._h},function(t){this._h=t}),r._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function a(){}return E(a,"laya.utils.Pool"),a.getPoolBySign=function(t){return a._poolDic[t]||(a._poolDic[t]=[])},a.clearBySign=function(t){a._poolDic[t]&&(a._poolDic[t].length=0)},a.recover=function(t,e){e.__InPool||(e.__InPool=!0,a.getPoolBySign(t).push(e))},a.getItemByClass=function(t,e){var i=a.getPoolBySign(t),n=i.length?i.pop():new e;return n.__InPool=!1,n},a.getItemByCreateFun=function(t,e,i){var n=a.getPoolBySign(t),r=n.length?n.pop():e.call(i);return r.__InPool=!1,r},a.getItem=function(t){var e=a.getPoolBySign(t),i=e.length?e.pop():null;return i&&(i.__InPool=!1),i},a._poolDic={},a.InPoolSign="__InPool",a}()),Cn=function(){function l(){}return E(l,"laya.utils.Stat"),v(1,l,"onclick",null,function(t){l._sp&&l._sp.on("click",l._sp,t),l._canvas&&(l._canvas.source.onclick=t,l._canvas.source.style.pointerEvents="")}),l.show=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),!hn.isConchApp||hn.isConchWebGL?(hn.isConchWebGL||vn.onMiniGame||vn.onLimixiu||(l._useCanvas=!0),l._show=!0,l._fpsData.length=60,l._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},l._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},l._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"},l._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},hn.isWebGL?(l._view[4]={title:"Shader",value:"shaderCall",color:"white",units:"int"},hn.is3DMode?(l._view[0].title="FPS(3D)",l._view[5]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},l._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},l._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"}):(l._view[0].title="FPS(WebGL)",l._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"})):l._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},l._useCanvas?l.createUIPre(t,e):l.createUI(t,e),l.enable()):vn.window.conch.showFPS&&vn.window.conch.showFPS(t,e)},l.createUIPre=function(t,e){var i=vn.pixelRatio;l._width=130*i,l._vx=75*i,l._height=i*(12*l._view.length+3*i)+4,l._fontSize=12*i;for(var n=0;n<l._view.length;n++)l._view[n].x=4,l._view[n].y=n*l._fontSize+2*i;l._canvas||((l._canvas=new Ys("2D")).size(l._width,l._height),(l._ctx=l._canvas.getContext("2d")).textBaseline="top",l._ctx.font=l._fontSize+"px Sans-serif",l._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+t+"px;top:"+e+"px;width:"+l._width/i+"px;height:"+l._height/i+"px;"),l._first=!0,l.loop(),l._first=!1,vn.container.appendChild(l._canvas.source)},l.createUI=function(t,e){var i=l._sp,n=vn.pixelRatio;i||(i=new ya,(l._leftText=new Es).pos(5,5),l._leftText.color="#ffffff",i.addChild(l._leftText),(l._txt=new Es).pos(80*n,5),l._txt.color="#ffffff",i.addChild(l._txt),l._sp=i),i.pos(t,e);for(var r="",a=0;a<l._view.length;a++){r+=l._view[a].title+"\n"}l._leftText.text=r;var s=138*n,o=n*(12*l._view.length+3*n)+4;l._txt.fontSize=l._fontSize*n,l._leftText.fontSize=l._fontSize*n,i.size(s,o),i.graphics.clear(),i.graphics.setAlpha(.5),i.graphics.drawRect(0,0,s,o,"#999999"),i.graphics.setAlpha(1),l.loop()},l.enable=function(){S.timer.frameLoop(1,l,l.loop)},l.hide=function(){l._show=!1,S.timer.clear(l,l.loop),l._canvas&&vn.removeElement(l._canvas.source)},l.clear=function(){l.trianglesFaces=l.drawCall=l.shaderCall=l.spriteCount=l.spriteRenderUseCacheCount=l.treeNodeCollision=l.treeSpriteCollision=l.canvasNormal=l.canvasBitmap=l.canvasReCache=0},l.loop=function(){l._count++;var t=vn.now();if(!(t-l._timer<1e3)){var e=l._count;if(l.FPS=Math.round(1e3*e/(t-l._timer)),l._show){l.trianglesFaces=Math.round(l.trianglesFaces/e),l.spriteCount=l._useCanvas?(l.drawCall=Math.round(l.drawCall/e)-2,l.shaderCall=Math.round(l.shaderCall/e),Math.round(l.spriteCount/e)-1):(l.drawCall=Math.round(l.drawCall/e)-2,l.shaderCall=Math.round(l.shaderCall/e)-4,Math.round(l.spriteCount/e)-4),l.spriteRenderUseCacheCount=Math.round(l.spriteRenderUseCacheCount/e),l.canvasNormal=Math.round(l.canvasNormal/e),l.canvasBitmap=Math.round(l.canvasBitmap/e),l.canvasReCache=Math.ceil(l.canvasReCache/e),l.treeNodeCollision=Math.round(l.treeNodeCollision/e),l.treeSpriteCollision=Math.round(l.treeSpriteCollision/e);var i=0<l.FPS?Math.floor(1e3/l.FPS).toString():" ";l._fpsStr=l.FPS+(l.renderSlow?" slow":"")+" "+i,l._spriteStr=l.spriteCount+(l.spriteRenderUseCacheCount?"/"+l.spriteRenderUseCacheCount:""),l._canvasStr=l.canvasReCache+"/"+l.canvasNormal+"/"+l.canvasBitmap,l.currentMemorySize=_n.systemResourceManager.memorySize,l._useCanvas?l.renderInfoPre():l.renderInfo(),l.clear()}l._count=0,l._timer=t}},l.renderInfoPre=function(){if(l._canvas){var t=l._ctx;t.clearRect(l._first?0:l._vx,0,l._width,l._height);for(var e=0;e<l._view.length;e++){var i=l._view[e];l._first&&(t.fillStyle="white",t.fillText(i.title,i.x,i.y,null,null,null)),t.fillStyle=i.color;var n=l[i.value];"M"==i.units&&(n=Math.floor(n/1048576*100)/100+" M"),t.fillText(n+"",i.x+l._vx,i.y,null,null,null)}}},l.renderInfo=function(){for(var t="",e=0;e<l._view.length;e++){var i=l._view[e],n=l[i.value];"M"==i.units&&(n=Math.floor(n/1048576*100)/100+" M"),"K"==i.units&&(n=Math.floor(n/1024*100)/100+" K"),t+=n+"\n"}l._txt.text=t},l.FPS=0,l.loopCount=0,l.shaderCall=0,l.drawCall=0,l.trianglesFaces=0,l.spriteCount=0,l.spriteRenderUseCacheCount=0,l.treeNodeCollision=0,l.treeSpriteCollision=0,l.canvasNormal=0,l.canvasBitmap=0,l.canvasReCache=0,l.renderSlow=!1,l.currentMemorySize=0,l._fpsStr=null,l._canvasStr=null,l._spriteStr=null,l._fpsData=[],l._timer=0,l._count=0,l._view=[],l._fontSize=12,l._txt=null,l._leftText=null,l._sp=null,l._show=!1,l._useCanvas=!1,l._canvas=null,l._ctx=null,l._first=!1,l._vx=NaN,l._width=0,l._height=100,l}(),In=function(){function t(){this._strsToID={},this._idToStrs=[],this._length=0}E(t,"laya.utils.StringKey");var e=t.prototype;return e.add=function(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)},e.getID=function(t){var e=this._strsToID[t];return null==e?-1:e},e.getName=function(t){var e=this._idToStrs[t];return null==e?void 0:e},t}(),Mn=function(){var l;function h(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map=[],this._laters=[],this._handlers=[],this._temp=[],this._count=0,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}E(h,"laya.utils.Timer");var t=h.prototype;return t._init=function(){S.timer&&S.timer.frameLoop(1,this,this._update)},t._now=function(){return Date.now()},t._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var t=this.currFrame=this.currFrame+this.scale,e=this._now();this._delta=(e-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;var n=this._handlers;for(s=this._count=0,o=n.length;s<o;s++)if(null!==(l=n[s]).method){var r=l.userFrame?t:i;if(r>=l.exeTime)if(l.repeat)if(l.jumpFrame)for(;r>=l.exeTime;)l.exeTime+=l.delay,l.run(!1);else l.exeTime+=l.delay,l.run(!1),r>l.exeTime&&(l.exeTime+=Math.ceil((r-l.exeTime)/l.delay)*l.delay);else l.run(!0)}else this._count++;(30<this._count||t%200==0)&&this._clearHandlers();for(var a=this._laters,s=0,o=a.length-1;s<=o;s++){var l=a[s];null!==l.method&&(this._map[l.key]=null,l.run(!1)),this._recoverHandler(l),s===o&&(o=a.length-1)}a.length=0}},t._clearHandlers=function(){for(var t=this._handlers,e=0,i=t.length;e<i;e++){var n=t[e];null!==n.method?this._temp.push(n):this._recoverHandler(n)}this._handlers=this._temp,this._temp=t,this._temp.length=0},t._recoverHandler=function(t){this._map[t.key]==t&&(this._map[t.key]=null),t.clear(),h._pool.push(t)},t._create=function(t,e,i,n,r,a,s){if(!i)return r.apply(n,a),null;if(s){var o=this._getHandler(n,r);if(o)return o.repeat=e,o.userFrame=t,o.delay=i,o.caller=n,o.method=r,o.args=a,o.exeTime=i+(t?this.currFrame:this.currTimer+this._now()-this._lastTimer),o}return(o=0<h._pool.length?h._pool.pop():new l).repeat=e,o.userFrame=t,o.delay=i,o.caller=n,o.method=r,o.args=a,o.exeTime=i+(t?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(o),this._handlers.push(o),o},t._indexHandler=function(t){var e=t.caller,i=t.method,n=e?e.$_GID||(e.$_GID=Dn.getGID()):0,r=i.$_TID||(i.$_TID=1e5*this._mid++);t.key=n+r,this._map[t.key]=t},t.once=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!1,!1,t,e,i,n,r)},t.loop=function(t,e,i,n,r,a){void 0===r&&(r=!0),void 0===a&&(a=!1);var s=this._create(!1,!0,t,e,i,n,r);s&&(s.jumpFrame=a)},t.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!1,t,e,i,n,r)},t.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!0,t,e,i,n,r)},t.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+h._pool.length},t.clear=function(t,e){var i=this._getHandler(t,e);i&&(this._map[i.key]=null,i.key=0,i.clear())},t.clearAll=function(t){if(t)for(var e=0,i=this._handlers.length;e<i;e++){var n=this._handlers[e];n.caller===t&&(this._map[n.key]=null,n.key=0,n.clear())}},t._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=Dn.getGID()):0,n=e.$_TID||(e.$_TID=1e5*this._mid++);return this._map[i+n]},t.callLater=function(t,e,i){if(null==this._getHandler(t,e)){if(h._pool.length)var n=h._pool.pop();else n=new l;n.caller=t,n.method=e,n.args=i,this._indexHandler(n),this._laters.push(n)}},t.runCallLater=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))},t.runTimer=function(t,e){this.runCallLater(t,e)},v(0,t,"delta",function(){return this._delta}),h._pool=[],h.__init$=function(){l=function(){function t(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}E(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null},e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,n=this.args;t&&this.clear(),null!=i&&(n?i.apply(e,n):i.call(e))},t}()},h}(),An=function(){function c(){this.gid=0}E(c,"laya.utils.Tween");var t=c.prototype;return t.to=function(t,e,i,n,r,a,s){return void 0===a&&(a=0),void 0===s&&(s=!1),this._create(t,e,i,n,r,a,s,!0,!1,!0)},t.from=function(t,e,i,n,r,a,s){return void 0===a&&(a=0),void 0===s&&(s=!1),this._create(t,e,i,n,r,a,s,!1,!1,!0)},t._create=function(t,e,i,n,r,a,s,o,l,h){if(!t)throw new Error("Tween:target is null");this._target=t,this._duration=i,this._ease=n||e.ease||c.easeNone,this._complete=r||e.complete,this._delay=a,this._props=[],this._usedTimer=0,this._startTimer=vn.now(),this._usedPool=l,this._delayParam=null,this.update=e.update;var u=t.$_GID||(t.$_GID=Dn.getGID());return c.tweenMap[u]?(s&&c.clearTween(t),c.tweenMap[u].push(this)):c.tweenMap[u]=[this],h?a<=0?this.firstStart(t,e,o):(this._delayParam=[t,e,o],S.scaleTimer.once(a,this,this.firstStart,this._delayParam)):this._initProps(t,e,o),this},t.firstStart=function(t,e,i){this._delayParam=null,t.destroyed?this.clear():(this._initProps(t,e,i),this._beginLoop())},t._initProps=function(t,e,i){for(var n in e)if("number"==typeof t[n]){var r=i?t[n]:e[n],a=i?e[n]:t[n];this._props.push([n,r,a-r]),i||(t[n]=r)}},t._beginLoop=function(){S.scaleTimer.frameLoop(1,this,this._doEase)},t._doEase=function(){this._updateEase(vn.now())},t._updateEase=function(t){var e=this._target;if(e){if(e.destroyed)return c.clearTween(e);var i=this._usedTimer=t-this._startTimer-this._delay;if(!(i<0)){if(i>=this._duration)return this.complete();for(var n=0<i?this._ease(i,0,1,this._duration):0,r=this._props,a=0,s=r.length;a<s;a++){var o=r[a];e[o[0]]=o[1]+n*o[2]}this.update&&this.update.run()}}},t.complete=function(){if(this._target){S.scaleTimer.runTimer(this,this.firstStart);for(var t=this._target,e=this._props,i=this._complete,n=0,r=e.length;n<r;n++){var a=e[n];t[a[0]]=a[1]+a[2]}this.update&&this.update.run(),this.clear(),i&&i.run()}},t.pause=function(){S.scaleTimer.clear(this,this._beginLoop),S.scaleTimer.clear(this,this._doEase),S.scaleTimer.clear(this,this.firstStart);var t;(t=vn.now()-this._startTimer-this._delay)<0&&(this._usedTimer=t)},t.setStartTime=function(t){this._startTimer=t},t.clear=function(){this._target&&(this._remove(),this._clear())},t._clear=function(){this.pause(),S.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,wn.recover("tween",this))},t.recover=function(){this._usedPool=!0,this._clear()},t._remove=function(){var t=c.tweenMap[this._target.$_GID];if(t)for(var e=0,i=t.length;e<i;e++)if(t[e]===this){t.splice(e,1);break}},t.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=vn.now(),this._delayParam)S.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var t=this._props,e=0,i=t.length;e<i;e++){var n=t[e];this._target[n[0]]=n[1]}S.scaleTimer.once(this._delay,this,this._beginLoop)}},t.resume=function(){this._usedTimer>=this._duration||(this._startTimer=vn.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?S.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},v(0,t,"progress",null,function(t){var e=t*this._duration;this._startTimer=vn.now()-this._delay-e}),c.to=function(t,e,i,n,r,a,s,o){return void 0===a&&(a=0),void 0===s&&(s=!1),void 0===o&&(o=!0),wn.getItemByClass("tween",c)._create(t,e,i,n,r,a,s,!0,o,!0)},c.from=function(t,e,i,n,r,a,s,o){return void 0===a&&(a=0),void 0===s&&(s=!1),void 0===o&&(o=!0),wn.getItemByClass("tween",c)._create(t,e,i,n,r,a,s,!1,o,!0)},c.clearAll=function(t){if(t&&t.$_GID){var e=c.tweenMap[t.$_GID];if(e){for(var i=0,n=e.length;i<n;i++)e[i]._clear();e.length=0}}},c.clear=function(t){t.clear()},c.clearTween=function(t){c.clearAll(t)},c.easeNone=function(t,e,i,n){return i*t/n+e},c.tweenMap={},c}(),Dn=function(){function o(){}return E(o,"laya.utils.Utils"),o.toRadian=function(t){return t*o._pi2},o.toAngle=function(t){return t*o._pi},o.toHexColor=function(t){if(t<0||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e},o.getGID=function(){return o._gid++},o.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,n=e.length;for(i=0;i<n;i++)t.push(e[i]);return t},o.clearArray=function(t){return t&&(t.length=0),t},o.copyArray=function(t,e){if(t||(t=[]),!e)return t;t.length=e.length;var i=0,n=e.length;for(i=0;i<n;i++)t[i]=e[i];return t},o.getGlobalRecByPoints=function(t,e,i,n,r){var a,s;return a=new en(e,i),a=t.localToGlobal(a),s=new en(n,r),s=t.localToGlobal(s),nn._getWrapRec([a.x,a.y,s.x,s.y])},o.getGlobalPosAndScale=function(t){return o.getGlobalRecByPoints(t,0,0,1,1)},o.bind=function(t,e){return t.bind(e)},o.measureText=function(t,e){return M.measureText(t,e)},o.updateOrder=function(t){if(!t||t.length<2)return!1;for(var e,i=1,n=0,r=t.length,a=NaN;i<r;){for(e=t[n=i],a=t[n]._zOrder;-1<--n&&t[n]._zOrder>a;)t[n+1]=t[n];t[n+1]=e,i++}var s=e.parent.conchModel;if(s)if(null!=s.updateZOrder)s.updateZOrder();else{for(i=0;i<r;i++)s.removeChild(t[i].conchModel);for(i=0;i<r;i++)s.addChildAt(t[i].conchModel,i)}return!0},o.transPointList=function(t,e,i){var n=0,r=t.length;for(n=0;n<r;n+=2)t[n]+=e,t[n+1]+=i},o.parseInt=function(t,e){void 0===e&&(e=0);var i=vn.window.parseInt(t,e);return isNaN(i)?0:i},o.getFileExtension=function(t){o._extReg.lastIndex=t.lastIndexOf(".");var e=o._extReg.exec(t);return e&&1<e.length?e[1].toLowerCase():null},o.getTransformRelativeToWindow=function(t,e,i){var n=S.stage,r=laya.utils.Utils.getGlobalPosAndScale(t),a=n._canvasTransform.clone(),s=a.tx,o=a.ty;a.rotate(-Math.PI/180*S.stage.canvasDegree),a.scale(S.stage.clientScaleX,S.stage.clientScaleY);var l=S.stage.canvasDegree%180!=0,h=NaN,u=NaN;l?(h=i+r.y,u=e+r.x,h*=a.d,u*=a.a,90==S.stage.canvasDegree?(h=s-h,u+=o):(h+=s,u=o-u)):(h=e+r.x,u=i+r.y,h*=a.a,u*=a.d,h+=s,u+=o);var c=NaN,d=NaN;return d=l?(c=a.d*r.height,a.a*r.width):(c=a.a*r.width,a.d*r.height),{x:h,y:u,scaleX:c,scaleY:d}},o.fitDOMElementInArea=function(t,e,i,n,r,a){t._fitLayaAirInitialized||(t._fitLayaAirInitialized=!0,t.style.transformOrigin=t.style.webKittransformOrigin="left top",t.style.position="absolute");var s=o.getTransformRelativeToWindow(e,i,n);t.style.transform=t.style.webkitTransform="scale("+s.scaleX+","+s.scaleY+") rotate("+S.stage.canvasDegree+"deg)",t.style.width=r+"px",t.style.height=a+"px",t.style.left=s.x+"px",t.style.top=s.y+"px"},o.isOkTextureList=function(t){if(!t)return!1;var e,i=0,n=t.length;for(i=0;i<n;i++)if(!(e=t[i])||!e.source)return!1;return!0},o.isOKCmdList=function(t){if(!t)return!1;var e,i,n=0,r=t.length,a=hn._context;for(n=0;n<r;n++)switch((e=t[n]).callee){case a._drawTexture:case a._fillTexture:case a._drawTextureWithTransform:if(!(i=e[0])||!i.source)return!1}return!0},o._gid=1,o._pi=180/Math.PI,o._pi2=Math.PI/180,o._extReg=/\.(\w+)\??/g,o.parseXMLFromString=function(t){var e;if(t=t.replace(/>\s+</g,"><"),-1<(e=(new DOMParser).parseFromString(t,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(e.firstChild.firstChild.textContent);return e},o}(),Ln=function(){function t(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],hn.isWebGL&&xn.regCacheByFunction(Dn.bind(this.startDispose,this),Dn.bind(this.getCacheList,this))}E(t,"laya.utils.VectorGraphManager");var e=t.prototype;return e.getId=function(){return this._id++},e.addShape=function(t,e){this.shapeDic[t]=e,this.useDic[t]||(this.useDic[t]=!0)},e.addLine=function(t,e){this.shapeLineDic[t]=e,this.shapeLineDic[t]||(this.shapeLineDic[t]=!0)},e.getShape=function(t){this._checkKey&&null!=this.useDic[t]&&(this.useDic[t]=!0)},e.deleteShape=function(t){this.shapeDic[t]&&(this.shapeDic[t]=null,delete this.shapeDic[t]),this.shapeLineDic[t]&&(this.shapeLineDic[t]=null,delete this.shapeLineDic[t]),null!=this.useDic[t]&&delete this.useDic[t]},e.getCacheList=function(){var t,e=[];for(t in this.shapeDic)e.push(this.shapeDic[t]);for(t in this.shapeLineDic)e.push(this.shapeLineDic[t]);return e},e.startDispose=function(t){var e;for(e in this.useDic)this.useDic[e]=!1;this._checkKey=!0},e.endDispose=function(){if(this._checkKey){var t;for(t in this.useDic)this.useDic[t]||this.deleteShape(t);this._checkKey=!1}},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),Vn=function(){function n(){this._obj=null,this._obj=n.supportWeakMap?new vn.window.WeakMap:{},n.supportWeakMap||n._maps.push(this)}E(n,"laya.utils.WeakObject");var t=n.prototype;return t.set=function(t,e){if(null!=t)if(n.supportWeakMap){var i=t;"string"!=typeof t&&"number"!=typeof t||(i=n._keys[t])||(i=n._keys[t]={k:t}),this._obj.set(i,e)}else"string"==typeof t||"number"==typeof t?this._obj[t]=e:(t.$_GID||(t.$_GID=Dn.getGID()),this._obj[t.$_GID]=e)},t.get=function(t){if(null==t)return null;if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;return e?this._obj.get(e):null}return"string"==typeof t||"number"==typeof t?this._obj[t]:this._obj[t.$_GID]},t.del=function(t){if(null!=t)if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;if(!e)return;this._obj.delete(e)}else"string"==typeof t||"number"==typeof t?delete this._obj[t]:delete this._obj[this._obj.$_GID]},t.has=function(t){if(null==t)return!1;if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;return this._obj.has(e)}return"string"==typeof t||"number"==typeof t?null!=this._obj[t]:null!=this._obj[this._obj.$_GID]},n.__init__=function(){(n.supportWeakMap=null!=vn.window.WeakMap)||S.timer.loop(n.delInterval,null,n.clearCache)},n.clearCache=function(){for(var t=0,e=n._maps.length;t<e;t++){n._maps[t]._obj={}}},n.supportWeakMap=!1,n.delInterval=3e5,n._keys={},n._maps=[],m(n,["I",function(){return this.I=new n}]),n}(),Nn=function(){function t(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}E(t,"laya.utils.WordText");var e=t.prototype;return e.setText=function(t){this.changed=!0,this._text=t},e.toString=function(){return this._text},e.charCodeAt=function(t){return this._text?this._text.charCodeAt(t):NaN},e.charAt=function(t){return this._text?this._text.charAt(t):null},v(0,e,"length",function(){return this._text?this._text.length:0}),t}(),Pn=function(){var n,r;function t(t,e,i){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new r,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this._init(t,e),this._atlasID=i}E(t,"laya.webgl.atlas.AtlasGrid");var e=t.prototype;return e.getAltasID=function(){return this._atlasID},e.setAltasID=function(t){0<=t&&(this._atlasID=t)},e.addTex=function(t,e,i){var n=this._get(e,i);return 0==n.ret||(this._fill(n.x,n.y,e,i,t),this._texCount++),n},e._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},e._init=function(t,e){if(this._width=t,this._height=e,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=R(this._height);for(var i=0;i<this._height;i++)this._rowInfo[i]=new n;return this._clear(),!0},e._get=function(t,e){var i=new On;if(t>=this._failSize.width&&e>=this._failSize.height)return i;for(var n=-1,r=-1,a=this._width,s=this._height,o=this._cells,l=0;l<s;l++)if(!(this._rowInfo[l].spaceCount<t))for(var h=0;h<a;){var u=3*(l*a+h);if(0!=o[u]||o[u+1]<t||o[u+2]<e)h+=o[u+1];else{n=h,r=l;for(var c=0;c<t;c++)if(o[3*c+u+2]<e){n=-1;break}if(!(n<0))return i.ret=!0,i.x=n,i.y=r,i;h+=o[u+1]}}return i},e._fill=function(t,e,i,n,r){var a=this._width,s=this._height;this._check(t+i<=a&&e+n<=s);for(var o=e;o<n+e;++o){this._check(this._rowInfo[o].spaceCount>=i),this._rowInfo[o].spaceCount-=i;for(var l=0;l<i;l++){var h=3*(t+o*a+l);this._check(0==this._cells[h]),this._cells[h]=r,this._cells[h+1]=i,this._cells[h+2]=n}}if(0<t)for(o=0;o<n;++o){var u=0;for(l=t-1;0<=l&&0==this._cells[3*((e+o)*a+l)];--l,++u);for(l=u;0<l;--l)this._cells[3*((e+o)*a+t-l)+1]=l,this._check(0<l)}if(0<e)for(l=t;l<t+i;++l){for(u=0,o=e-1;0<=o&&0==this._cells[3*(l+o*a)];--o,u++);for(o=u;0<o;--o)this._cells[3*(l+(e-o)*a)+2]=o,this._check(0<o)}},e._check=function(t){0==t&&console.log("xtexMerger 错误啦")},e._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var n=3*(e*this._width+i);this._cells[n]=0,this._cells[n+1]=this._width-i,this._cells[n+2]=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},t.__init$=function(){n=function(){function t(){this.spaceCount=0}return E(t,""),t}(),r=function(){function t(){this.width=0,this.height=0}return E(t,""),t}()},t}(),Fn=function(){function g(t,e,i,n){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=n,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}E(g,"laya.webgl.atlas.AtlasResourceManager");var t=g.prototype;return t.setAtlasParam=function(t,e,i,n){if(1==this._setAtlasParam)return g._sid_=0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=n,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},t.pushData=function(t){var e,i=t.bitmap,n=-1,r=null,a=0,s=0;for(a=0,e=this._atlaserArray.length;a<e&&(s=(this._curAtlasIndex+a)%e,-1==(n=(r=this._atlaserArray[s]).findBitmapIsExist(i)));a++);if(-1!=n){var o=r.InAtlasWebGLImagesOffsetValue[n];return f=o[0],m=o[1],r.addToAtlas(t,f,m),!0}this._setAtlasParam=!1;for(var l=Math.ceil((t.bitmap.width+2)/this._gridSize),h=Math.ceil((t.bitmap.height+2)/this._gridSize),u=!1,c=0;c<2;c++){var d=this._maxAtlaserCount;for(a=0;a<d;a++){s=(this._curAtlasIndex+a)%d,this._atlaserArray.length-1>=s||this._atlaserArray.push(new ta(this._gridNumX,this._gridNumY,this._width,this._height,g._sid_++));var _=this._atlaserArray[s],f=0,m=0,p=_.addTex(1,l,h);if(p.ret){f=p.x*this._gridSize+1,m=p.y*this._gridSize+1,i.lock=!0,_.addToAtlasTexture(i,f,m),_.addToAtlas(t,f,m),u=!0,this._curAtlasIndex=s;break}}if(u)break;this._atlaserArray.push(new ta(this._gridNumX,this._gridNumY,this._width,this._height,g._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return u||console.log(">>>AtlasManager pushData error"),u},t.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},t.garbageCollection=function(){if(!0===this._needGC){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;e<t;e++)this._atlaserArray[e].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+t),this._atlaserArray.splice(0,t),this._needGC=!1}return!0},t.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},t.getAtlaserCount=function(){return this._atlaserArray.length},t.getAtlaserByIndex=function(t){return this._atlaserArray[t]},v(1,g,"instance",function(){return g._Instance||(g._Instance=new g(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),g._Instance}),v(1,g,"enabled",function(){return T.atlasEnable}),v(1,g,"atlasLimitWidth",function(){return g._atlasLimitWidth},function(t){g._atlasLimitWidth=t}),v(1,g,"atlasLimitHeight",function(){return g._atlasLimitHeight},function(t){g._atlasLimitHeight=t}),g._enable=function(){T.atlasEnable=!0},g._disable=function(){T.atlasEnable=!1},g.__init__=function(){g.atlasTextureWidth=2048,g.atlasTextureHeight=2048,g.maxTextureCount=6,g.atlasLimitWidth=512,g.atlasLimitHeight=512},g._atlasLimitWidth=0,g._atlasLimitHeight=0,g.gridSize=16,g.atlasTextureWidth=0,g.atlasTextureHeight=0,g.maxTextureCount=0,g._atlasRestore=0,g.BOARDER_TYPE_NO=0,g.BOARDER_TYPE_RIGHT=1,g.BOARDER_TYPE_LEFT=2,g.BOARDER_TYPE_BOTTOM=4,g.BOARDER_TYPE_TOP=8,g.BOARDER_TYPE_ALL=15,g._sid_=0,g._Instance=null,g}(),On=function(){function t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return E(t,"laya.webgl.atlas.MergeFillInfo"),t}(),Bn=function(){function e(){}return E(e,"laya.webgl.canvas.BlendMode"),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]},e.BlendNormal=function(t){t.blendFunc(1,771)},e.BlendAdd=function(t){t.blendFunc(1,772)},e.BlendMultiply=function(t){t.blendFunc(774,771)},e.BlendScreen=function(t){t.blendFunc(1,1)},e.BlendOverlay=function(t){t.blendFunc(1,769)},e.BlendLight=function(t){t.blendFunc(1,1)},e.BlendNormalTarget=function(t){t.blendFunc(1,771)},e.BlendAddTarget=function(t){t.blendFunc(1,772)},e.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},e.BlendScreenTarget=function(t){t.blendFunc(1,1)},e.BlendOverlayTarget=function(t){t.blendFunc(1,769)},e.BlendLightTarget=function(t){t.blendFunc(1,1)},e.BlendMask=function(t){t.blendFunc(0,770)},e.BlendDestinationOut=function(t){t.blendFunc(0,0)},e.activeBlendFunction=null,e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],e.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.LIGHT="light",e.OVERLAY="overlay",e.DESTINATIONOUT="destination-out",e.fns=[],e.targetFns=[],e}(),Gn=function(){function i(t){this._color=Tn.create("black"),this.setValue(t)}E(i,"laya.webgl.canvas.DrawStyle");var t=i.prototype;return t.setValue=function(t){if(t){if("string"==typeof t)return void(this._color=Tn.create(t));if(t instanceof laya.utils.Color)return void(this._color=t)}},t.reset=function(){this._color=Tn.create("black")},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.Color&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},i.create=function(t){var e;if(t&&("string"==typeof t?e=Tn.create(t):t instanceof laya.utils.Color&&(e=t),e))return e._drawStyle||(e._drawStyle=new i(t));return laya.webgl.canvas.DrawStyle.DEFAULT},m(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),Wn=function(){function t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];mr.mainContext;this.ib=Io.create(35048),this.vb=Mo.create(5)}E(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.addPoint=function(t,e){this.tempArray.push(t,e)},e.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},e.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},e.polygon=function(t,e,i,n,r,a){var s;return this.geomatrys.push(this._curGeomatry=s=new ra(t,e,i,n,r,a)),n||(s.fill=!1),null==a&&(s.borderWidth=0),s},e.setGeomtry=function(t){this.geomatrys.push(this._curGeomatry=t)},e.drawLine=function(t,e,i,n,r){var a;return this.closePath?this.geomatrys.push(this._curGeomatry=a=new na(t,e,i,n,r)):this.geomatrys.push(this._curGeomatry=a=new ia(t,e,i,n,r)),a.fill=!1,a},e.update=function(){var t=this.ib._byteLength,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;i<e;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=e,this.count=(this.ib._byteLength-t)/cr.BYTES_PIDX},e.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},e.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},t}(),Un=function(){function o(){}E(o,"laya.webgl.canvas.save.SaveBase");var t=o.prototype;return S.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,(o._cache[o._cache._length++]=this)._newSubmit&&(t._curSubmit=er.RENDERBASE,t._renderKey=0)},o._createArray=function(){var t=[];return t._length=0,t},o._init=function(){var t=o._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t},o.save=function(t,e,i,n){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var r=o._cache,a=0<r._length?r[--r._length]:new o;a._value=i[a._valueName=o._namemap[e]],a._dataObj=i,a._newSubmit=n;var s=t._save;s[s._length++]=a}},o._cache=laya.webgl.canvas.save.SaveBase._createArray(),o._namemap=o._init(),o}(),Zn=function(){function a(){this._clipRect=new nn}E(a,"laya.webgl.canvas.save.SaveClipRect");var t=a.prototype;return S.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._clipRect=this._clipSaveRect,(a._cache[a._cache._length++]=this)._submitScissor.submitLength=t._submits._length-this._submitScissor.submitIndex,t._curSubmit=er.RENDERBASE,t._renderKey=0},a.save=function(t,e){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var i=a._cache,n=0<i._length?i[--i._length]:new a;n._clipSaveRect=t._clipRect,t._clipRect=n._clipRect.copyFrom(t._clipRect),n._submitScissor=e;var r=t._save;r[r._length++]=n}},m(a,["_cache",function(){return this._cache=Un._createArray()}]),a}(),kn=function(){function _(){this._contextX=0,this._contextY=0,this._clipRect=new nn,this._rect=new nn,this._matrix=new tn}E(_,"laya.webgl.canvas.save.SaveClipRectStencil");var t=_.prototype;return S.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){sr.restore(t,this._rect,this._saveMatrix,this._contextX,this._contextY),t._clipRect=this._clipSaveRect,t._curMat=this._saveMatrix,t._x=this._contextX,t._y=this._contextY,_._cache[_._cache._length++]=this,t._curSubmit=er.RENDERBASE},_.save=function(t,e,i,n,r,a,s,o,l,h){if(262144!=(262144&t._saveMark._saveuse)){t._saveMark._saveuse|=262144;var u=_._cache,c=0<u._length?u[--u._length]:new _;c._clipSaveRect=t._clipRect,c._clipRect.setTo(s,o,l,h),t._clipRect=c._clipRect,c._rect.x=i,c._rect.y=n,c._rect.width=r,c._rect.height=a,c._contextX=t._x,c._contextY=t._y,c._saveMatrix=t._curMat,t._curMat.copyTo(c._matrix),t._curMat=c._matrix,c._submitStencil=e;var d=t._save;d[d._length++]=c}},m(_,["_cache",function(){return this._cache=Un._createArray()}]),_}(),Hn=function(){function n(){this._saveuse=0}E(n,"laya.webgl.canvas.save.SaveMark");var t=n.prototype;return S.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,n._no[n._no._length++]=this},n.Create=function(t){var e=n._no,i=0<e._length?e[--e._length]:new n;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},m(n,["_no",function(){return this._no=Un._createArray()}]),n}(),Xn=function(){function a(){this._matrix=new tn}E(a,"laya.webgl.canvas.save.SaveTransform");var t=a.prototype;return S.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,a._no[a._no._length++]=this},a.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=a._no,n=0<i._length?i[--i._length]:new a;n._savematrix=t._curMat,t._curMat=t._curMat.copyTo(n._matrix);var r=t._save;r[r._length++]=n}},m(a,["_no",function(){return this._no=Un._createArray()}]),a}(),Yn=function(){function r(){}E(r,"laya.webgl.canvas.save.SaveTranslate");var t=r.prototype;return S.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat;t._x=this._x,t._y=this._y,r._no[r._no._length++]=this},r.save=function(t){var e=r._no,i=0<e._length?e[--e._length]:new r;i._x=t._x,i._y=t._y;var n=t._save;n[n._length++]=i},m(r,["_no",function(){return this._no=Un._createArray()}]),r}(),zn=function(){function t(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new nn}E(t,"laya.webgl.resource.RenderTargetMAX");var e=t.prototype;return e.setSP=function(t){this._sp=t},e.size=function(t,e){var i=this;this._width!==t||this._height!==e?(this.repaint=!0,this._width=t,this._height=e,this.target?this.target.size(t,e):this.target=Ya.create(t,e),this.target.hasListener("recovered")||this.target.on("recovered",this,function(t){S.timer.callLater(i._sp,i._sp.repaint)})):this.target.size(t,e)},e._flushToTarget=function(t,e){if(!e._destroy){var i=fr.worldScissorTest,n=fr.worldClipRect;fr.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,fr.worldScissorTest=!1,mr.mainContext.disable(3089);var r=fr.worldAlpha,a=fr.worldMatrix4,s=fr.worldMatrix,o=fr.worldFilters,l=fr.worldShaderDefines;if(fr.worldMatrix=tn.EMPTY,fr.restoreTempArray(),fr.worldMatrix4=fr.TEMPMAT4_ARRAY,fr.worldAlpha=1,fr.worldFilters=null,fr.worldShaderDefines=null,Pa.activeShader=null,e.start(),T.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),Pa.activeShader=null,fr.worldAlpha=r,fr.worldMatrix4=a,fr.worldMatrix=s,fr.worldFilters=o,fr.worldShaderDefines=l,fr.worldScissorTest=i){var h=fr.height-n.y-n.height;mr.mainContext.scissor(n.x,h,n.width,n.height),mr.mainContext.enable(3089)}fr.worldClipRect=n}},e.flush=function(t){this.repaint&&(this._flushToTarget(t,this.target),this.repaint=!1)},e.drawTo=function(t,e,i,n,r){t.drawTexture(this.target.getTexture(),e,i,n,r,0,0)},e.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},t}(),jn=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new ea}return E(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},t.__init__=function(){var t,e;ks.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),ks.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),ks.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),ks.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),ks.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),ks.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),ks.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),ks.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',ks.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",e='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',ks.preCompile2D(0,2,t,e,null),t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",ks.preCompile2D(0,4,t,e,null),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',ks.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",ks.preCompile2D(0,512,t,e,null)},t}(),Jn=function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}E(e,"laya.webgl.shader.ShaderDefines",null,"ShaderDefines$1");var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,n){n[i[t]=e]=t},e._toText=function(t,e,i){var n=i[t];if(n)return n;for(var r={},a=1,s=0;s<32&&!(t<(a=1<<s));s++)if(t&a){var o=e[a];o&&(r[o]="")}return i[t]=r},e._toInt=function(t,e){for(var i=t.split("."),n=0,r=0,a=i.length;r<a;r++){var s=e[i[r]];if(!s)throw new Error("Defines to int err:"+t+"/"+i[r]);n|=s}return n},e}(),Kn=function(){function s(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new tn}E(s,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var t=s.prototype;return t.init=function(t,e,i){if(e)this._vs=e;else{this._vs=[];var n=t.width,r=t.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(n,0,1,0,1,1,1,1),this._vs.push(n,r,1,1,1,1,1,1),this._vs.push(0,r,0,1,1,1,1,1)}this._ps=i||(s._defaultPS||(s._defaultPS=[]).push(0,1,3,3,1,2),s._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=t},t.init2=function(t,e,i,n,r){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=n,this._uvs=r,this.mEleNum=this._ps.length,this.mTexture=t,(hn.isConchNode||hn.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},t._initMyData=function(){var t=0,e=0,i=4*this._verticles.length;this._vs=s._tempVS;var n=!1;if(hn.isConchNode||hn.isConchApp?(this._vs.length=i,n=!0):this._vs.length<i&&(this._vs.length=i,n=!0),s._tVSLen=i,n)for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],this._vs[t+4]=1,this._vs[t+5]=1,this._vs[t+6]=1,this._vs[t+7]=1,t+=8,e+=2;else for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],t+=8,e+=2},t.getData2=function(t,e,i){var n;this.mVBBuffer=t,this.mIBBuffer=e,this._initMyData(),t.appendEx2(this._vs,Float32Array,s._tVSLen,4),this._indexStart=e._byteLength,(n=s._tempIB).length<this._ps.length&&(n.length=this._ps.length);for(var r=0,a=this._ps.length;r<a;r++)n[r]=this._ps[r]+i;e.appendEx2(n,Uint16Array,this._ps.length,2)},t.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e._byteLength,this.mIBData.start!=i){for(var n=0,r=this._ps.length;n<r;n++)this.mIBData[n]=this._ps[n]+i;this.mIBData.start=i}e.append(this.mIBData)},t.render=function(t,e,i){if(hn.isWebGL&&this.mTexture){t._renderKey=0,t._shader2D.glTexture=null,Qn.getInstance().addSkinMesh(this);var n=er.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Qr.create(512,0));this.transform||(this.transform=tn.EMPTY),this.transform.translate(e,i),tn.mul(this.transform,t._curMat,this._tempMatrix),this.transform.translate(-e,-i);var r=n.shaderValue,a=r.u_mmat2||fr.getMatrArray();fr.mat2MatArray(this._tempMatrix,a),r.textureHost=this.mTexture,r.offsetX=0,r.offsetY=0,r.u_mmat2=a,r.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=n}else hn.isConchApp&&this.mTexture&&(this.transform||(this.transform=tn.EMPTY),t.setSkinMesh&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},s._tempVS=[],s._tempIB=[],s._defaultPS=null,s._tVSLen=0,s}(),Qn=function(){function t(){this.ib=null,this.vb=null;mr.mainContext;this.ib=Io.create(35048),this.vb=Mo.create(8)}E(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),qn=function(){function t(t,e,i,n,r,a,s,o,l){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===l&&(l=0),this.x=t,this.y=e,this.width=i,this.height=n,this.edges=r,this.color=a,this.borderWidth=s,this.borderColor=o}E(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;return S.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.rebuild=function(t){},e.setMatrix=function(t){},e.needUpdate=function(t){return!0},e.sector=function(t,e,i){var n=this.x,r=this.y,a=this.edges,s=(this.r1-this.r0)/a,o=this.width,l=this.height,h=this.color,u=(h>>16&255)/255,c=(h>>8&255)/255,d=(255&h)/255;t.push(n,r,u,c,d);for(var _=0;_<a+1;_++)t.push(n+Math.sin(s*_+this.r0)*o,r+Math.cos(s*_+this.r0)*l),t.push(u,c,d);for(_=0;_<a;_++)e.push(i,i+_+1,i+_+2)},e.createLine2=function(t,e,i,n,r,a){var s,o,l,h,u,c,d,_,f,m,p,g,v,y,x,b,T,S,E,R,w=t.concat(),C=r,I=this.borderColor,M=(I>>16&255)/255,A=(I>>8&255)/255,D=(255&I)/255,L=w.length/2,V=n,N=i/2;l=w[0],h=w[1],m=l-(u=w[2]),f=(f=-(h-(c=w[3])))/(R=Math.sqrt(f*f+m*m))*N,m=m/R*N,C.push(l-f+this.x,h-m+this.y,M,A,D,l+f+this.x,h+m+this.y,M,A,D);for(var P=1;P<L-1;P++)l=w[2*(P-1)],h=w[2*(P-1)+1],u=w[2*P],c=w[2*P+1],d=w[2*(P+1)],_=w[2*(P+1)+1],m=l-u,g=u-d,x=(-(f=(f=-(h-c))/(R=Math.sqrt(f*f+m*m))*N)+l)*(-(m=m/R*N)+c)-(-f+u)*(-m+h),S=(-(p=(p=-(c-_))/(R=Math.sqrt(p*p+g*g))*N)+d)*(-(g=g/R*N)+c)-(-p+u)*(-g+_),E=(v=-m+h-(-m+c))*(T=-p+u-(-p+d))-(b=-g+_-(-g+c))*(y=-f+u-(-f+l)),Math.abs(E)<.1?(E+=10.1,C.push(u-f+this.x,c-m+this.y,M,A,D,u+f+this.x,c+m+this.y,M,A,D)):(((s=(y*S-T*x)/E)-u)*(s-u)+((o=(b*x-v*S)/E)-c)+(o-c),C.push(s+this.x,o+this.y,M,A,D,u-(s-u)+this.x,c-(o-c)+this.y,M,A,D));l=w[w.length-4],h=w[w.length-3],m=l-(u=w[w.length-2]),f=(f=-(h-(c=w[w.length-1])))/(R=Math.sqrt(f*f+m*m))*N,m=m/R*N,C.push(u-f+this.x,c-m+this.y,M,A,D,u+f+this.x,c+m+this.y,M,A,D);var F=a;for(P=1;P<F;P++)e.push(V+2*(P-1),V+2*(P-1)+1,V+2*P+1,V+2*P+1,V+2*P,V+2*(P-1));return C},e.createLine=function(t,e,i,n){var r=t.concat(),a=t,s=this.borderColor,o=(s>>16&255)/255,l=(s>>8&255)/255,h=(255&s)/255;r.splice(0,5);var u,c,d,_,f,m,p,g,v,y,x,b,T,S,E,R,w,C,I,M,A=r.length/5,D=n,L=i/2;d=r[0],_=r[1],y=d-(f=r[5]),v=(v=-(_-(m=r[6])))/(M=Math.sqrt(v*v+y*y))*L,y=y/M*L,a.push(d-v,_-y,o,l,h,d+v,_+y,o,l,h);for(var V=1;V<A-1;V++)d=r[5*(V-1)],_=r[5*(V-1)+1],f=r[5*V],m=r[5*V+1],p=r[5*(V+1)],g=r[5*(V+1)+1],y=d-f,b=f-p,E=(-(v=(v=-(_-m))/(M=Math.sqrt(v*v+y*y))*L)+d)*(-(y=y/M*L)+m)-(-v+f)*(-y+_),C=(-(x=(x=-(m-g))/(M=Math.sqrt(x*x+b*b))*L)+p)*(-(b=b/M*L)+m)-(-x+f)*(-b+g),I=(T=-y+_-(-y+m))*(w=-x+f-(-x+p))-(R=-b+g-(-b+m))*(S=-v+f-(-v+d)),Math.abs(I)<.1?(I+=10.1,a.push(f-v,m-y,o,l,h,f+v,m+y,o,l,h)):(((u=(S*C-w*E)/I)-f)*(u-f)+((c=(R*E-T*C)/I)-m)+(c-m),a.push(u,c,o,l,h,f-(u-f),m-(c-m),o,l,h));d=r[r.length-10],_=r[r.length-9],y=d-(f=r[r.length-5]),v=(v=-(_-(m=r[r.length-4])))/(M=Math.sqrt(v*v+y*y))*L,y=y/M*L,a.push(f-v,m-y,o,l,h,f+v,m+y,o,l,h);var N=this.edges+1;for(V=1;V<N;V++)e.push(D+2*(V-1),D+2*(V-1)+1,D+2*V+1,D+2*V+1,D+2*V,D+2*(V-1));return a},e.createLoopLine=function(t,e,i,n,r,a){var s=t.concat(),o=r||t,l=this.borderColor,h=(l>>16&255)/255,u=(l>>8&255)/255,c=(255&l)/255;s.splice(0,5);var d=[s[0],s[1]],_=[s[s.length-5],s[s.length-4]],f=_[0]+.5*(d[0]-_[0]),m=_[1]+.5*(d[1]-_[1]);s.unshift(f,m,0,0,0),s.push(f,m,0,0,0);var p,g,v,y,x,b,T,S,E,R,w,C,I,M,A,D,L,V,N,P,F=s.length/5,O=n,B=i/2;v=s[0],y=s[1],R=v-(x=s[5]),E=(E=-(y-(b=s[6])))/(P=Math.sqrt(E*E+R*R))*B,R=R/P*B,o.push(v-E,y-R,h,u,c,v+E,y+R,h,u,c);for(var G=1;G<F-1;G++)v=s[5*(G-1)],y=s[5*(G-1)+1],x=s[5*G],b=s[5*G+1],T=s[5*(G+1)],S=s[5*(G+1)+1],R=v-x,C=x-T,A=(-(E=(E=-(y-b))/(P=Math.sqrt(E*E+R*R))*B)+v)*(-(R=R/P*B)+b)-(-E+x)*(-R+y),V=(-(w=(w=-(b-S))/(P=Math.sqrt(w*w+C*C))*B)+T)*(-(C=C/P*B)+b)-(-w+x)*(-C+S),N=(I=-R+y-(-R+b))*(L=-w+x-(-w+T))-(D=-C+S-(-C+b))*(M=-E+x-(-E+v)),Math.abs(N)<.1?(N+=10.1,o.push(x-E,b-R,h,u,c,x+E,b+R,h,u,c)):(((p=(M*V-L*A)/N)-x)*(p-x)+((g=(D*A-I*V)/N)-b)+(g-b),o.push(p,g,h,u,c,x-(p-x),b-(g-b),h,u,c));a&&(e=a);var W=this.edges+1;for(G=1;G<W;G++)e.push(O+2*(G-1),O+2*(G-1)+1,O+2*G+1,O+2*G+1,O+2*G,O+2*(G-1));return e.push(O+2*(G-1),O+2*(G-1)+1,O+1,O+1,O,O+2*(G-1)),o},t}(),$n=function(){function m(){}return E(m,"laya.webgl.shapes.Earcut"),m.earcut=function(t,e,i){i=i||2;var n,r,a,s,o,l,h,u=e&&e.length,c=u?e[0]*i:t.length,d=m.linkedList(t,0,c,i,!0),_=[];if(!d)return _;if(u&&(d=m.eliminateHoles(t,e,d,i)),t.length>80*i){n=a=t[0],r=s=t[1];for(var f=i;f<c;f+=i)(o=t[f])<n&&(n=o),(l=t[f+1])<r&&(r=l),a<o&&(a=o),s<l&&(s=l);h=0!==(h=Math.max(a-n,s-r))?1/h:0}return m.earcutLinked(d,_,i,n,r,h),_},m.linkedList=function(t,e,i,n,r){var a,s;if(r===0<m.signedArea(t,e,i,n))for(a=e;a<i;a+=n)s=m.insertNode(a,t[a],t[a+1],s);else for(a=i-n;e<=a;a-=n)s=m.insertNode(a,t[a],t[a+1],s);return s&&m.equals(s,s.next)&&(m.removeNode(s),s=s.next),s},m.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!m.equals(n,n.next)&&0!==m.area(n.prev,n,n.next))n=n.next;else{if(m.removeNode(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e},m.earcutLinked=function(t,e,i,n,r,a,s){if(t){!s&&a&&m.indexCurve(t,n,r,a);for(var o,l,h=t;t.prev!==t.next;)if(o=t.prev,l=t.next,a?m.isEarHashed(t,n,r,a):m.isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),m.removeNode(t),t=l.next,h=l.next;else if((t=l)===h){s?1===s?(t=m.cureLocalIntersections(t,e,i),m.earcutLinked(t,e,i,n,r,a,2)):2===s&&m.splitEarcut(t,e,i,n,r,a):m.earcutLinked(m.filterPoints(t,null),e,i,n,r,a,1);break}}},m.isEar=function(t){var e=t.prev,i=t,n=t.next;if(0<=m.area(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(m.pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=m.area(r.prev,r,r.next))return!1;r=r.next}return!0},m.isEarHashed=function(t,e,i,n){var r=t.prev,a=t,s=t.next;if(0<=m.area(r,a,s))return!1;for(var o=r.x<a.x?r.x<s.x?r.x:s.x:a.x<s.x?a.x:s.x,l=r.y<a.y?r.y<s.y?r.y:s.y:a.y<s.y?a.y:s.y,h=r.x>a.x?r.x>s.x?r.x:s.x:a.x>s.x?a.x:s.x,u=r.y>a.y?r.y>s.y?r.y:s.y:a.y>s.y?a.y:s.y,c=m.zOrder(o,l,e,i,n),d=m.zOrder(h,u,e,i,n),_=t.nextZ;_&&_.z<=d;){if(_!==t.prev&&_!==t.next&&m.pointInTriangle(r.x,r.y,a.x,a.y,s.x,s.y,_.x,_.y)&&0<=m.area(_.prev,_,_.next))return!1;_=_.nextZ}for(_=t.prevZ;_&&_.z>=c;){if(_!==t.prev&&_!==t.next&&m.pointInTriangle(r.x,r.y,a.x,a.y,s.x,s.y,_.x,_.y)&&0<=m.area(_.prev,_,_.next))return!1;_=_.prevZ}return!0},m.cureLocalIntersections=function(t,e,i){var n=t;do{var r=n.prev,a=n.next.next;!m.equals(r,a)&&m.intersects(r,n,n.next,a)&&m.locallyInside(r,a)&&m.locallyInside(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),m.removeNode(n),m.removeNode(n.next),n=t=a),n=n.next}while(n!==t);return n},m.splitEarcut=function(t,e,i,n,r,a){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&m.isValidDiagonal(s,o)){var l=m.splitPolygon(s,o);return s=m.filterPoints(s,s.next),l=m.filterPoints(l,l.next),m.earcutLinked(s,e,i,n,r,a),void m.earcutLinked(l,e,i,n,r,a)}o=o.next}s=s.next}while(s!==t)},m.eliminateHoles=function(t,e,i,n){var r,a,s,o,l,h=[];for(r=0,a=e.length;r<a;r++)s=e[r]*n,o=r<a-1?e[r+1]*n:t.length,(l=m.linkedList(t,s,o,n,!1))===l.next&&(l.steiner=!0),h.push(m.getLeftmost(l));for(h.sort(m.compareX),r=0;r<h.length;r++)m.eliminateHole(h[r],i),i=m.filterPoints(i,i.next);return i},m.compareX=function(t,e){return t.x-e.x},m.eliminateHole=function(t,e){if(e=m.findHoleBridge(t,e)){var i=m.splitPolygon(e,t);m.filterPoints(i,i.next)}},m.findHoleBridge=function(t,e){var i,n=e,r=t.x,a=t.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&s<o){if((s=o)===r){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===s)return i.prev;var l,h=i,u=i.x,c=i.y,d=1/0;for(n=i.next;n!==h;)r>=n.x&&n.x>=u&&r!==n.x&&m.pointInTriangle(a<c?r:s,a,u,c,a<c?s:r,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(r-n.x))<d||l===d&&n.x>i.x)&&m.locallyInside(n,t)&&(i=n,d=l),n=n.next;return i},m.indexCurve=function(t,e,i,n){for(var r=t;null===r.z&&(r.z=m.zOrder(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,m.sortLinked(r)},m.sortLinked=function(t){var e,i,n,r,a,s,o,l,h=1;do{for(i=t,a=t=null,s=0;i;){for(s++,n=i,e=o=0;e<h&&(o++,n=n.nextZ);e++);for(l=h;0<o||0<l&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(i=(r=i).nextZ,o--):(n=(r=n).nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,h*=2}while(1<s);return t},m.zOrder=function(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},m.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},m.pointInTriangle=function(t,e,i,n,r,a,s,o){return 0<=(r-s)*(e-o)-(t-s)*(a-o)&&0<=(t-s)*(n-o)-(i-s)*(e-o)&&0<=(i-s)*(a-o)-(r-s)*(n-o)},m.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!m.intersectsPolygon(t,e)&&m.locallyInside(t,e)&&m.locallyInside(e,t)&&m.middleInside(t,e)},m.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},m.equals=function(t,e){return t.x===e.x&&t.y===e.y},m.intersects=function(t,e,i,n){return!!(m.equals(t,e)&&m.equals(i,n)||m.equals(t,n)&&m.equals(i,e))||0<m.area(t,e,i)!=0<m.area(t,e,n)&&0<m.area(i,n,t)!=0<m.area(i,n,e)},m.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&m.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},m.locallyInside=function(t,e){return m.area(t.prev,t,t.next)<0?0<=m.area(t,e,t.next)&&0<=m.area(t,t.prev,e):m.area(t,e,t.prev)<0||m.area(t,t.next,e)<0},m.middleInside=function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),(i=i.next)!==t;);return n},m.splitPolygon=function(t,e){var i=new tr(t.i,t.x,t.y),n=new tr(e.i,e.x,e.y),r=t.next,a=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(a.next=n).prev=a,n},m.insertNode=function(t,e,i,n){var r=new tr(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r},m.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},m.signedArea=function(t,e,i,n){for(var r=0,a=e,s=i-n;a<i;a+=n)r+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return r},m}(),tr=function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return E(t,"laya.webgl.shapes.EarcutNode"),t}(),er=(function(){function t(t,e,i,n,r,a,s){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=n,this.fillAlpha=r,this.shape=s,this.fill=a}E(t,"laya.webgl.shapes.GeometryData");var e=t.prototype;e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.getIndexData=function(){return null},e.getVertexData=function(){return null},e.destroy=function(){this.shape=null}}(),function(){function l(t){void 0===t&&(t=1e4),this._renderType=t}E(l,"laya.webgl.submit.Submit");var t=l.prototype;return S.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=l._cache;(t[t._length++]=this).shaderValue.release(),this._vb=null},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=mr.mainContext;return this.shaderValue.upload(),Bn.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),Bn.activeBlendFunction=this._blendFn),Cn.drawCall++,Cn.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this._startIdx),1},l.__init__=function(){var t=l.RENDERBASE=new l(-1);t.shaderValue=new Qr(0,0),t.shaderValue.ALPHA=-1234},l.createSubmit=function(t,e,i,n,r){var a=l._cache._length?l._cache[--l._cache._length]:new l;null==i&&((i=a._selfVb||(a._selfVb=Mo.create(-1))).clear(),n=0),a._ib=e,a._vb=i,a._startIdx=n*cr.BYTES_PIDX,a._numEle=0;var s=t._nBlendType;a._blendFn=t._targets?Bn.targetFns[s]:Bn.fns[s],a.shaderValue=r,a.shaderValue.setValue(t._shader2D);var o=t._shader2D.filters;return o&&a.shaderValue.setFilters(o),a},l.createShape=function(t,e,i,n,r,a){var s=l._cache._length?l._cache[--l._cache._length]:new l;s._ib=e,s._vb=i,s._numEle=n,s._startIdx=r,s.shaderValue=a,s.shaderValue.setValue(t._shader2D);var o=t._nBlendType;return s._blendFn=t._targets?Bn.targetFns[o]:Bn.fns[o],s},l.TYPE_2D=1e4,l.TYPE_CANVAS=10003,l.TYPE_CMDSETRT=10004,l.TYPE_CUSTOM=10005,l.TYPE_BLURRT=10006,l.TYPE_CMDDESTORYPRERT=10007,l.TYPE_DISABLESTENCIL=10008,l.TYPE_OTHERIBVB=10009,l.TYPE_PRIMITIVE=10010,l.TYPE_RT=10011,l.TYPE_BLUR_RT=10012,l.TYPE_TARGET=10013,l.TYPE_CHANGE_VALUE=10014,l.TYPE_SHAPE=10015,l.TYPE_TEXTURE=10016,l.TYPE_FILLTEXTURE=10017,l.RENDERBASE=null,l._cache=((l._cache=[])._length=0,l._cache),l}()),ir=function(){function n(){this.fun=null,this.args=null}E(n,"laya.webgl.submit.SubmitCMD");var t=n.prototype;return S.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(null,this.args),1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=n._cache;t[t._length++]=this},n.create=function(t,e){var i=n._cache._length?n._cache[--n._cache._length]:new n;return i.fun=e,i.args=t,i},n._cache=((n._cache=[])._length=0,n._cache),n}(),nr=function(){function e(){this.variables={}}E(e,"laya.webgl.submit.SubmitCMDScope");var t=e.prototype;return t.getValue=function(t){return this.variables[t]},t.addValue=function(t,e){return this.variables[t]=e},t.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},t.clear=function(){for(var t in this.variables)delete this.variables[t]},t.recycle=function(){this.clear(),e.POOL.push(this)},e.create=function(){var t=e.POOL.pop();return t||(t=new e),t},e.POOL=[],e}(),rr=function(){function c(){this.offset=0,this.startIndex=0,this._mat=tn.create()}E(c,"laya.webgl.submit.SubmitOtherIBVB");var t=c.prototype;return S.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=c._cache;t[t._length++]=this},t.getRenderType=function(){return 10009},t.renderSubmit=function(){var t=this._shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this._shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=fr.worldMatrix4,n=tn.TEMP;tn.mulPre(this._mat,i[0],i[1],i[4],i[5],i[12],i[13],n);var r=fr.worldMatrix4=c.tempMatrix4;r[0]=n.a,r[1]=n.b,r[4]=n.c,r[5]=n.d,r[12]=n.tx,r[13]=n.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var a=mr.mainContext;return Bn.activeBlendFunction!==this._blendFn&&(a.enable(3042),this._blendFn(a),Bn.activeBlendFunction=this._blendFn),Cn.drawCall++,Cn.trianglesFaces+=this._numEle/3,a.drawElements(4,this._numEle,5123,this.startIndex),fr.worldMatrix4=i,Pa.activeShader=null,1},c.create=function(t,e,i,n,r,a,s,o,l){void 0===l&&(l=0);var h=c._cache._length?c._cache[--c._cache._length]:new c;h._ib=i,h._vb=e,h._numEle=n,h._shader=r,h._shaderValue=a;var u=t._nBlendType;switch(h._blendFn=t._targets?Bn.targetFns[u]:Bn.fns[u],l){case 0:h.offset=0,h.startIndex=o/(cr.BYTES_PE*e.vertexStride)*1.5,h.startIndex*=cr.BYTES_PIDX;break;case 1:h.startIndex=s,h.offset=o}return h},c._cache=((c._cache=[])._length=0,c._cache),c.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c}(),ar=function(){function i(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new nn,this.screenRect=new nn}E(i,"laya.webgl.submit.SubmitScissor");var t=i.prototype;return S.imps(t,{"laya.webgl.submit.ISubmit":!0}),t._scissor=function(t,e,i,n){var r=fr.worldMatrix4,a=r[0],s=r[5],o=r[12],l=r[13];if(n*=s,(i*=a)<1||n<1)return!1;var h=(t=t*a+o)+i,u=(e=e*s+l)+n;t<0&&(i=h-(t=0)),e<0&&(n=u-(e=0));var c=fr.worldClipRect;if(t=Math.max(t,c.x),e=Math.max(e,c.y),i=Math.min(h,c.right)-t,n=Math.min(u,c.bottom)-e,i<1||n<1)return!1;var d=fr.worldScissorTest;return this.screenRect.copyFrom(c),c.x=t,c.y=e,c.width=i,c.height=n,fr.worldScissorTest=!0,e=fr.height-e-n,mr.mainContext.scissor(t,e,i,n),mr.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),d?(e=fr.height-this.screenRect.y-this.screenRect.height,mr.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),mr.mainContext.enable(3089)):(mr.mainContext.disable(3089),fr.worldScissorTest=!1),c.copyFrom(this.screenRect),!0},t._scissorWithTagart=function(t,e,i,n){if(i<1||n<1)return!1;var r=t+i,a=e+n;t<0&&(i=r-(t=0)),e<0&&(n=a-(e=0));var s=fr.worldClipRect;if(t=Math.max(t,s.x),e=Math.max(e,s.y),i=Math.min(r,s.right)-t,n=Math.min(a,s.bottom)-e,i<1||n<1)return!1;var o=fr.worldScissorTest;return this.screenRect.copyFrom(s),fr.worldScissorTest=!0,s.x=t,s.y=e,s.width=i,s.height=n,e=fr.height-e-n,mr.mainContext.scissor(t,e,i,n),mr.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),o?(e=fr.height-this.screenRect.y-this.screenRect.height,mr.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),mr.mainContext.enable(3089)):(mr.mainContext.disable(3089),fr.worldScissorTest=!1),s.copyFrom(this.screenRect),!0},t.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=i._cache;(t[t._length++]=this).context=null},i.create=function(t){var e=i._cache._length?i._cache[--i._cache._length]:new i;return e.context=t,e},i._cache=((i._cache=[])._length=0,i._cache),i}(),sr=function(){function l(){this.step=0,this.blendMode=null,this.level=0}E(l,"laya.webgl.submit.SubmitStencil");var t=l.prototype;return S.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=l._cache;t[t._length++]=this},t.do1=function(){var t=mr.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},t.do2=function(){var t=mr.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do3=function(){var t=mr.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},t.do4=function(){var t=mr.mainContext;0==this.level&&(t.enable(2960),t.clear(1024)),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,0,255),t.stencilOp(7680,7680,7682)},t.do5=function(){var t=mr.mainContext;t.stencilFunc(514,this.level,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do6=function(){var t=mr.mainContext;Bn.targetFns[Bn.TOINT[this.blendMode]](t)},t.do7=function(){var t=mr.mainContext;t.colorMask(!1,!1,!1,!1),t.stencilOp(7680,7680,7683)},t.do8=function(){var t=mr.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7680)},l.restore=function(t,e,i,n,r){var a;if((t._renderKey=0)<l._mask&&l._mask--,0==l._mask)a=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(a),t._curSubmit=er.RENDERBASE;else{a=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(a);var s=t._vb;s._byteLength;if(dr.fillRectImgVb(s,null,e.x,e.y,e.width,e.height,Hr.DEF_UV,i,n,r,0,0)){t._shader2D.glTexture=null;var o=t._curSubmit=er.createSubmit(t,t._ib,s,(s._byteLength-64)/32*3,Qr.create(2,0));o.shaderValue.ALPHA=1,t._submits[t._submits._length++]=o,t._curSubmit._numEle+=6,t._curSubmit=er.RENDERBASE}else alert("clipRect calc stencil rect error");a=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(a)}},l.restore2=function(t,e){var i;(t._renderKey=0)<l._mask&&l._mask--,0==l._mask?(i=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(i),t._curSubmit=er.RENDERBASE):(i=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(i),t._submits[t._submits._length++]=e,i=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(i))},l.create=function(t){var e=l._cache._length?l._cache[--l._cache._length]:new l;return 5==(e.step=t)&&++l._mask,e.level=l._mask,e},l._cache=((l._cache=[])._length=0,l._cache),l._mask=0,l}(),or=function(){function o(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}E(o,"laya.webgl.submit.SubmitTarget");var t=o.prototype;return S.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return t&&(this.shaderValue.texture=t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[t.width,t.height]),this.shaderValue.upload(),this.blend(),Cn.drawCall++,Cn.trianglesFaces+=this._numEle/3,mr.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(Bn.activeBlendFunction!==Bn.fns[this.blendType]){var t=mr.mainContext;t.enable(3042),Bn.fns[this.blendType](t),Bn.activeBlendFunction=Bn.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=o._cache;t[t._length++]=this},o.create=function(t,e,i,n,r,a){var s=o._cache._length?o._cache[--o._cache._length]:new o;return s._ib=e,s._vb=i,s.proName=a,s._startIdx=n*cr.BYTES_PIDX,s._numEle=0,s.blendType=t._nBlendType,s.shaderValue=r,s.shaderValue.setValue(t._shader2D),s},o._cache=((o._cache=[])._length=0,o._cache),o}(),lr=function(){function t(){this._sourceStr=null}E(t,"laya.webgl.text.CharSegment");var e=t.prototype;return S.imps(e,{"laya.webgl.text.ICharSegment":!0}),e.textToSpit=function(t){this._sourceStr=t},e.getChar=function(t){return this._sourceStr.charAt(t)},e.getCharCode=function(t){return this._sourceStr.charCodeAt(t)},e.length=function(){return this._sourceStr.length},t}(),hr=function(){var t;function A(){}return E(A,"laya.webgl.text.DrawText"),A.__init__=function(){A._charsTemp=new Array,A._drawValue=new t,A._charSeg=new lr},A.customCharSeg=function(t){A._charSeg=t},A.getChar=function(t,e,i){var n=Ks.createOneChar(t,i);return-1!=e&&(A._charsCache[e]=n),n},A._drawSlow=function(t,e,i,n,r,a,s,o,l,h,u,c,d,_,f){var m,p,g=A._drawValue.value(a,o,l,h,d,_,f),v=0,y=0,x=A._charsTemp,b=0,T=NaN;if(n)for(x.length=n.length,v=0,y=n.length;v<y;v++)T=(p=n[v]).charNum+g.txtID,x[v]=m=A._charsCache[T]||A.getChar(p.char,T,g),m.active();else{var S=i instanceof laya.utils.WordText?i.toString():i;if(Es.CharacterCache){A._charSeg.textToSpit(S);var E=A._charSeg.length();for(v=0,y=x.length=E;v<y;v++)T=A._charSeg.getCharCode(v)+g.txtID,x[v]=m=A._charsCache[T]||A.getChar(A._charSeg.getChar(v),T,g),m.active(),b+=m.cw}else x.length=0,(m=A.getChar(S,-1,g)).active(),b+=m.cw,x[0]=m}var R=0;null!==s&&"left"!==s&&(R=-("center"==s?b/2:b));var w,C,I=NaN,M=0;if(n)for(v=0,y=x.length;v<y;v++)(m=x[v]).isSpace||(p=n[v],I=m.borderSize,w=m.texture,e._drawText(w,u+R+p.x*d-I,c+p.y*_-I,w.width,w.height,r,0,0,0,0));else{for(v=0,y=x.length;v<y;v++)(m=x[v]).isSpace||(I=m.borderSize,w=m.texture,e._drawText(w,u+R-I,c-I,w.width,w.height,r,0,0,0,0),t&&((C=t[M++])||(C=t[M-1]=[]),C[0]=w,C[1]=R-I,C[2]=-I)),R+=m.cw;t&&(t.length=M)}},A._drawFast=function(t,e,i,n,r){for(var a,s,o=0,l=t.length;o<l;o++)(a=(s=t[o])[0]).active(),e._drawText(a,n+s[1],r+s[2],a.width,a.height,i,0,0,0,0)},A.drawText=function(t,e,i,n,r,a,s,o,l,h,u,c){if(void 0===c&&(c=0),!(e&&0===e.length||i&&0===i.length)){var d=n.a,_=n.d;(0!==n.b||0!==n.c)&&(d=_=1);var f=1!==d||1!==_;if(f&&S.stage.transform){var m=S.stage.transform;f=m.a===d&&m.d===_}else f=!1;if(f){var p=(n=n.copyTo(qr._tmpMatrix)).tx,g=n.ty;n.scale(1/d,1/_),n._checkTransform(),h*=d,u*=_,h+=p-n.tx,u+=g-n.ty}else d=_=1;if(i)A._drawSlow(null,t,e,i,n,r,a,s,o,l,h,u,d,_,c);else{if(null===e.toUpperCase){var v=d+1e5*_,y=e;return void(y.changed||y.id!==v?(y.id=v,y.changed=!1,A._drawSlow(y.save,t,e,i,n,r,a,s,o,l,h,u,d,_,c)):A._drawFast(y.save,t,n,h,u))}var x=e+r.toString()+s+o+l+d+_+a,b=A._textsCache[x];Es.CharacterCache?b?A._drawFast(b,t,n,h,u):(A._textsCache.__length||(A._textsCache.__length=0),A._textsCache.__length>T.WebGLTextCacheCount&&((A._textsCache={}).__length=0,A._curPoolIndex=0),A._textCachesPool[A._curPoolIndex]?(b=A._textsCache[x]=A._textCachesPool[A._curPoolIndex]).length=0:A._textCachesPool[A._curPoolIndex]=b=A._textsCache[x]=[],A._textsCache.__length++,A._curPoolIndex++,A._drawSlow(b,t,e,i,n,r,a,s,o,l,h,u,d,_,c)):A._drawSlow(b,t,e,i,n,r,a,s,o,l,h,u,d,_,c)}}},A._charsTemp=null,A._textCachesPool=[],A._curPoolIndex=0,A._charsCache={},A._textsCache={},A._drawValue=null,A.d=[],A._charSeg=null,A.__init$=function(){t=function(){function l(){}return E(l,""),l.prototype.value=function(t,e,i,n,r,a,s){this.font=t,this.fillColor=e,this.borderColor=i,this.lineWidth=n,this.scaleX=r,this.scaleY=a,this.underLine=s;var o=t.toString()+r+a+n+e+i+s;return this.txtID=l._keymap[o],this.txtID||(this.txtID=1e-7*++l._keymapCount,l._keymap[o]=this.txtID),this},l.clear=function(){l._keymap={},l._keymapCount=1},l._keymap={},l._keymapCount=1,l}()},A}(),ur=function(){function r(t){this._index=0,this._size=14,this._italic=-2,r._cache2=r._cache2||[],this.setFont(t||"14px Arial")}E(r,"laya.webgl.text.FontInContext");var t=r.prototype;return t.setFont=function(t){var e=r._cache2[t];if(e)this._words=e[0],this._size=e[1];else{this._words=t.split(" ");for(var i=0,n=this._words.length;i<n;i++)if(0<this._words[i].indexOf("px")){this._index=i;break}this._size=parseInt(this._words[this._index]),r._cache2[t]=[this._words,this._size]}this._text=null,this._italic=-2},t.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},t.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t)return e;return-1},t.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},t.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},t.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},v(0,t,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),r.create=function(t){var e=r._cache[t];return e||(e=r._cache[t]=new r(t))},r.EMPTY=new r,r._cache={},r._cache2=null,r}(),cr=function(){function t(){}return E(t,"laya.webgl.utils.CONST3D2D"),t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,m(t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),t}(),dr=function(){function f(){}return E(f,"laya.webgl.utils.GlUtils"),f.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},f.fillIBQuadrangle=function(t,e){if(65535/4<e)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),n=0,r=0;r<e;r++)i[n++]=4*r,i[n++]=4*r+2,i[n++]=4*r+1,i[n++]=4*r,i[n++]=4*r+3,i[n++]=4*r+2;return t.setNeedUpload(),!0},f.expandIBQuadrangle=function(t,e){t.bufferLength>=6*e*2||f.fillIBQuadrangle(t,e)},f.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},f.fillQuadrangleImgVb=function(t,e,i,n,r,a,s,o){var l=16+(t._byteLength>>2);t.byteLength=l<<2;var h=t.getFloat32Array();h[(l-=16)+2]=r[0],h[l+3]=r[1],h[l+6]=r[2],h[l+7]=r[3],h[l+10]=r[4],h[l+11]=r[5],h[l+14]=r[6],h[l+15]=r[7];var u=a.a,c=a.b,d=a.c,_=a.d;if(1!==u||0!==c||0!==d||1!==_){a.bTransform=!0;var f=a.tx+s,m=a.ty+o;h[l]=(n[0]+e)*u+(n[1]+i)*d+f,h[l+1]=(n[0]+e)*c+(n[1]+i)*_+m,h[l+4]=(n[2]+e)*u+(n[3]+i)*d+f,h[l+5]=(n[2]+e)*c+(n[3]+i)*_+m,h[l+8]=(n[4]+e)*u+(n[5]+i)*d+f,h[l+9]=(n[4]+e)*c+(n[5]+i)*_+m,h[l+12]=(n[6]+e)*u+(n[7]+i)*d+f,h[l+13]=(n[6]+e)*c+(n[7]+i)*_+m}else a.bTransform=!1,e+=a.tx+s,i+=a.ty+o,h[l]=e+n[0],h[l+1]=i+n[1],h[l+4]=e+n[2],h[l+5]=i+n[3],h[l+8]=e+n[4],h[l+9]=i+n[5],h[l+12]=e+n[6],h[l+13]=i+n[7];return t._upload=!0},f.fillTranglesVB=function(t,e,i,n,r,a,s){var o=(t._byteLength>>2)+n.length;t.byteLength=o<<2;var l=t.getFloat32Array();o-=n.length;for(var h=n.length,u=r.a,c=r.b,d=r.c,_=r.d,f=0;f<h;f+=4)if(l[o+f+2]=n[f+2],l[o+f+3]=n[f+3],1!==u||0!==c||0!==d||1!==_){r.bTransform=!0;var m=r.tx+a,p=r.ty+s;l[o+f]=(n[f]+e)*u+(n[f+1]+i)*d+m,l[o+f+1]=(n[f]+e)*c+(n[f+1]+i)*_+p}else r.bTransform=!1,e+=r.tx+a,i+=r.ty+s,l[o+f]=e+n[f],l[o+f+1]=i+n[f+1];return t._upload=!0},f.copyPreImgVb=function(t,e,i){var n=t._byteLength>>2;t.byteLength=n+16<<2;for(var r=t.getFloat32Array(),a=0,s=n-16;a<4;a++)r[n]=r[s]+e,++s,r[++n]=r[s]+i,++s,r[++n]=r[s],++s,r[++n]=r[s],++n,++s;t._upload=!0},f.fillRectImgVb=function(t,e,i,n,r,a,s,o,l,h,u,c,d){void 0===d&&(d=!1);var _,f,m,p,g,v,y,x,b,T,S,E,R,w,C,I,M=1,A=o.a,D=o.b,L=o.c,V=o.d,N=e&&e.width<99999999;if(1!==A||0!==D||0!==L||1!==V?(o.bTransform=!0,0===D&&0===L&&(M=23,b=r+i,T=a+n,_=A*i+(S=o.tx+l),m=A*b+S,f=V*n+(E=o.ty+h),p=V*T+E)):(M=23,o.bTransform=!1,m=(_=i+o.tx+l)+r,p=(f=n+o.ty+h)+a),N&&(g=e.x,v=e.y,y=e.width+g,x=e.height+v),1!==M){if(Math.min(_,m)>=y)return!1;if(Math.min(f,p)>=x)return!1;if(Math.max(m,_)<=g)return!1;if(Math.max(p,f)<=v)return!1}var P=t._byteLength>>2;t.byteLength=P+16<<2;var F=t.getFloat32Array();switch(F[P+2]=s[0],F[P+3]=s[1],F[P+6]=s[2],F[P+7]=s[3],F[P+10]=s[4],F[P+11]=s[5],F[P+14]=s[6],F[P+15]=s[7],M){case 1:S=o.tx+l,E=o.ty+h;var O=A*i,B=L*n,G=V*n,W=D*i,U=A*(b=r+i),Z=L*(T=a+n),k=V*T,H=D*b;F[P+13]=d?(R=O+B+S,C=Math.round(R)-R,w=G+W+E,I=Math.round(w)-w,F[P]=R+C,F[P+1]=w+I,F[P+4]=U+B+S+C,F[P+5]=G+H+E+I,F[P+8]=U+Z+S+C,F[P+9]=k+H+E+I,F[P+12]=O+Z+S+C,k+W+E+I):(F[P]=O+B+S,F[P+1]=G+W+E,F[P+4]=U+B+S,F[P+5]=G+H+E,F[P+8]=U+Z+S,F[P+9]=k+H+E,F[P+12]=O+Z+S,k+W+E);break;case 23:F[P+13]=d?(R=_+u,C=Math.round(R)-R,w=f,I=Math.round(w)-w,F[P]=R+C,F[P+1]=w+I,F[P+4]=m+u+C,F[P+5]=f+I,F[P+8]=m+C,F[P+9]=p+I,F[P+12]=_+C,p+I):(F[P]=_+u,F[P+1]=f,F[P+4]=m+u,F[P+5]=f,F[P+8]=m,F[P+9]=p,F[P+12]=_,p)}return t._upload=!0},f.fillLineVb=function(t,e,i,n,r,a,s,o){var l=.5*s,h=f._fillLineArray,u=-(n-a),c=i-r,d=Math.sqrt(u*u+c*c);u/=d,c/=d,u*=l,c*=l,h[0]=i-u,h[1]=n-c,h[4]=i+u,h[5]=n+c,h[8]=r+u,h[9]=a+c,h[12]=r-u,h[13]=a-c,o&&o.transformPointArray(h,h);var _=16+(t._byteLength>>2);return t.byteLength=_<<2,t.insertData(h,_-16),!0},f._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f}(),_r=(function(){function l(){}E(l,"laya.webgl.utils.MatirxArray"),l.ArrayMul=function(t,e,i){if(t)if(e)for(var n=NaN,r=NaN,a=NaN,s=NaN,o=0;o<4;o++)n=t[o],r=t[o+4],a=t[o+8],s=t[o+12],i[o]=n*e[0]+r*e[1]+a*e[2]+s*e[3],i[o+4]=n*e[4]+r*e[5]+a*e[6]+s*e[7],i[o+8]=n*e[8]+r*e[9]+a*e[10]+s*e[11],i[o+12]=n*e[12]+r*e[13]+a*e[14]+s*e[15];else l.copyArray(t,i);else l.copyArray(e,i)},l.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function e(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new Mo(t,35048),e&&this._vb._resizeBuffer(e,!1),this._ib=new Io,i&&this._ib._resizeBuffer(i,!1)}E(e,"laya.webgl.utils.Mesh2D");var t=e.prototype;return t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,n=0,r=0;r<t;r++)e[i++]=n,e[i++]=n+2,e[i++]=n+1,e[i++]=n,e[i++]=n+3,e[i++]=n+2,n+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},e._gvaoid=0,e}()),fr=function(){function r(){}return E(r,"laya.webgl.utils.RenderState2D"),r.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},r.mat2MatArray=function(t,e){var i=t,n=e;return n[0]=i.a,n[1]=i.b,n[2]=r.EMPTYMAT4_ARRAY[2],n[3]=r.EMPTYMAT4_ARRAY[3],n[4]=i.c,n[5]=i.d,n[6]=r.EMPTYMAT4_ARRAY[6],n[7]=r.EMPTYMAT4_ARRAY[7],n[8]=r.EMPTYMAT4_ARRAY[8],n[9]=r.EMPTYMAT4_ARRAY[9],n[10]=r.EMPTYMAT4_ARRAY[10],n[11]=r.EMPTYMAT4_ARRAY[11],n[12]=i.tx,n[13]=i.ty,n[14]=r.EMPTYMAT4_ARRAY[14],n[15]=r.EMPTYMAT4_ARRAY[15],e},r.restoreTempArray=function(){r.TEMPMAT4_ARRAY[0]=1,r.TEMPMAT4_ARRAY[1]=0,r.TEMPMAT4_ARRAY[4]=0,r.TEMPMAT4_ARRAY[5]=1,r.TEMPMAT4_ARRAY[12]=0,r.TEMPMAT4_ARRAY[13]=0},r.clear=function(){r.worldScissorTest=!1,r.worldShaderDefines=null,r.worldFilters=null,r.worldAlpha=1,r.worldClipRect.x=r.worldClipRect.y=0,r.worldClipRect.width=r.width,r.worldClipRect.height=r.height,r.curRenderTarget=null},r._MAXSIZE=99999999,r.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.worldMatrix4=r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.worldAlpha=1,r.worldScissorTest=!1,r.worldFilters=null,r.worldShaderDefines=null,r.curRenderTarget=null,r.width=0,r.height=0,m(r,["worldMatrix",function(){return this.worldMatrix=new tn},"worldClipRect",function(){return this.worldClipRect=new nn(0,0,99999999,99999999)}]),r}(),mr=function(){function s(){}return E(s,"laya.webgl.WebGL"),s._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},s._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},s._uint16ArraySlice=function(t){var e,i=arguments,n=0,r=0;if(0===i.length)for(n=this.length,e=new Uint16Array(n),r=0;r<n;r++)e[r]=this[r];else if(2===i.length){var a=i[0],s=i[1];if(a<s)for(n=s-a,e=new Uint16Array(n),r=a;r<s;r++)e[r-a]=this[r];else e=new Uint16Array(0)}return e},s.expandContext=function(){var t=dn.prototype,e=CanvasRenderingContext2D.prototype;e.fillTrangles=t.fillTrangles,Hs.__int__(null),e.setIBVB=function(t,e,i,n,r,a,s,o,l,h){void 0===l&&(l=0),void 0===h&&(h=0),null===i&&(this._ib=this._ib||Io.QuadrangleIB,i=this._ib,dr.expandIBQuadrangle(i,n._byteLength/64+8)),this._setIBVB(t,e,i,n,r,a,s,o,l,h)},e.fillTrangles=function(t,e,i,n,r){this._curMat=this._curMat||tn.create(),this._vb=this._vb||Mo.create(),this._ib||(this._ib=Io.create(),dr.fillIBQuadrangle(this._ib,s/4));var a=this._vb,s=n.length>>4;dr.fillTranglesVB(a,e,i,n,r||this._curMat,0,0),dr.expandIBQuadrangle(this._ib,a._byteLength/64+8);var o=new Qr(1,0);o.textureHost=t;var l=new wo("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");a._vertType=3,this._setIBVB(e,i,this._ib,a,6*s,r,l,o,0,0)}},s.enable=function(){if(vn.__init__(),hn.isConchApp&&!hn.isConchWebGL)return M.skinAniSprite=function(){return new Kn},s.expandContext(),!1;if(M.getWebGLContext=function(t){for(var e,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<i.length;n++){try{e=t.getContext(i[n],{stencil:T.isStencil,alpha:T.isAlpha,antialias:T.isAntialias,premultipliedAlpha:T.premultipliedAlpha,preserveDrawingBuffer:T.preserveDrawingBuffer})}catch(t){}if(e)return e}return null},null==(s.mainContext=M.getWebGLContext(hn._mainCanvas)))return!1;if(hn.isWebGL)return!0;Co.create=function(t,e){return new vl(t,e)},zs.create=function(t,e,i,n,r,a,s){return new qs(t,e,i,n,r,a,s)},hn.WebGL=s,hn.isWebGL=!0,hr.__init__(),M.createRenderSprite=function(t,e){return new $r(t,e)},M.createWebGLContext2D=function(t){return new qr(t)},M.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},M.createGraphics=function(){return new zr};var t=M.createFilterAction;return M.createFilterAction=t||function(t){return new Kr},M.clear=function(t){fr.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=hn.context.ctx,i=0==e._submits._length||T.preserveDrawingBuffer?Tn.create(t)._color:Ns._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),fr.clear()},M.addToAtlas=function(t,e){void 0===e&&(e=!1);var i=t.bitmap;hn.optimizeTextureMemory(t.url,t)?S.__typeof(i,"laya.webgl.resource.IMergeAtlasBitmap")&&i.allowMerageInAtlas&&i.on("recovered",t,t.addTextureToAtlas):i.enableMerageInAtlas=!1},M.isAtlas=function(t){return t instanceof laya.webgl.atlas.AtlasWebGLCanvas},Fn._enable(),M.beginFlush=function(){for(var t=Fn.instance,e=t.getAtlaserCount(),i=0;i<e;i++){var n=t.getAtlaserByIndex(i).texture;n._flashCacheImageNeedFlush&&M.flashFlushImage(n)}},M.drawToCanvas=function(t,e,i,n,r,a){(i<=0||n<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),i|=0,n|=0,r|=0,a|=0;var s=Ya.create(i,n,6408,5121,0,!1);s.start(),s.clear(0,0,0,0),hn.context.clear(),cn.renders[e]._fun(t,hn.context,r,fr.height-n+a),hn.context.flush(),s.end();var o=s.getData(0,0,i,n);if(s.recycle(),o.byteLength==i*n*4){var l=new Js;l._canvas=vn.createElement("canvas"),l.size(i,n);var h=l._canvas.getContext("2d");vn.canvas.size(i,n);var u=vn.context,c=u.createImageData(i,n);return c.data.set(new Uint8ClampedArray(o.buffer)),l._imgData=c,u.putImageData(c,0,0),h.save(),h.translate(0,n),h.scale(1,-1),h.drawImage(vn.canvas.source,0,0),h.restore(),l}console.log("drawToCanvas error: w:"+i+",h:"+n+",datalen:"+o.byteLength)},M.createFilterAction=function(t){var e;switch(t){case 32:e=new Kr}return e},M.addTextureToAtlas=function(t){t._uvID++,Fn._atlasRestore++,t.bitmap.enableMerageInAtlas&&Fn.instance.addToAtlas(t)},M.getTexturePixels=function(t,e,i,n,r){hn.context.ctx.clear();var a=new ya;a.graphics.drawTexture(t,-e,-i);var s=Ya.create(n,r);s.start(),s.clear(0,0,0,0),a.render(hn.context,0,0),hn.context.ctx.flush(),s.end();for(var o=s.getData(0,0,n,r),l=[],h=0,u=r-1;0<=u;u--)for(var c=0;c<n;c++)h=4*(u*n+c),l.push(o[h]),l.push(o[h+1]),l.push(o[h+2]),l.push(o[h+3]);return l},M.skinAniSprite=function(){return new Kn},Ys.create=function(t,e){var i=new Js;return i._imgData=e,i.flipY=!1,i},zi._filterStart=function(t,e,i,n,r){var a=t.getValue("bounds"),s=Ya.create(a.width,a.height);if(s.start(),s.clear(0,0,0,0),t.addValue("src",s),t.addValue("ScissorTest",fr.worldScissorTest),fr.worldScissorTest){var o=new nn;o.copyFrom(i.ctx._clipRect),t.addValue("clipRect",o),fr.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},zi._filterEnd=function(t,e,i,n,r){var a=t.getValue("bounds");t.getValue("src").end();var s=Ya.create(a.width,a.height);s.start(),s.clear(0,0,0,0),t.addValue("out",s),e._set$P("_filterCache",s),e._set$P("_isHaveGlowFilter",t.getValue("_isHaveGlowFilter"))},zi._EndTarget=function(t,e){if(t.getValue("src").recycle(),t.getValue("out").end(),t.getValue("ScissorTest")){fr.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save();var i=t.getValue("clipRect");e.ctx.clipRect(i.x,i.y,i.width,i.height)}},zi._useSrc=function(t){var e=t.getValue("out");e.end(),(e=t.getValue("src")).start(),e.clear(0,0,0,0)},zi._endSrc=function(t){t.getValue("src").end()},zi._useOut=function(t){var e=t.getValue("src");e.end(),(e=t.getValue("out")).start(),e.clear(0,0,0,0)},zi._endOut=function(t){t.getValue("out").end()},zi._recycleScope=function(t){t.recycle()},zi._filter=function(t,e,i,n){var r=this._next;if(r){var a,s,o=t.filters,l=o.length;if(1==l&&32==o[0].type)return e.ctx.save(),e.ctx.setFilters([o[0]]),r._fun.call(r,t,e,i,n),void e.ctx.restore();var h=nr.create(),u=en.TEMP,c=e.ctx._getTransformMatrix(),d=tn.create();c.copyTo(d);var _=0,f=0,m=!1,p=t._$P._filterCache?t._$P._filterCache:null;if(!p||t._repaint){m=t._isHaveGlowFilter(),h.addValue("_isHaveGlowFilter",m),m&&(_=50,f=25),(s=new nn).copyFrom(t.getSelfBounds()),s.x+=t.x,s.y+=t.y,s.x-=t.pivotX+4,s.y-=t.pivotY+4;var g=s.x,v=s.y;if(s.width+=_+8,s.height+=_+8,u.x=s.x*d.a+s.y*d.c,u.y=s.y*d.d+s.x*d.b,s.x=u.x,s.y=u.y,u.x=s.width*d.a+s.height*d.c,u.y=s.height*d.d+s.width*d.b,s.width=u.x,s.height=u.y,s.width<=0||s.height<=0)return;p&&p.recycle(),h.addValue("bounds",s);var y=ir.create([h,t,e,0,0],zi._filterStart);e.addRenderObject(y),e.ctx._renderKey=0,e.ctx._shader2D.glTexture=null;var x=t.x-g+f,b=t.y-v+f;r._fun.call(r,t,e,x,b),y=ir.create([h,t,e,0,0],zi._filterEnd),e.addRenderObject(y);for(var T=0;T<l;T++){0!=T&&(y=ir.create([h],zi._useSrc),e.addRenderObject(y),a=Qr.create(1,0),tn.TEMP.identity(),e.ctx.drawTarget(h,0,0,s.width,s.height,tn.TEMP,"out",a,null,Bn.TOINT.overlay),y=ir.create([h],zi._useOut),e.addRenderObject(y)),o[T].action.apply3d(h,t,e,0,0)}y=ir.create([h,e],zi._EndTarget),e.addRenderObject(y)}else{if((m=!!t._$P._isHaveGlowFilter&&t._$P._isHaveGlowFilter)&&(_=50,f=25),(s=t.getBounds()).width<=0||s.height<=0)return;s.width+=_,s.height+=_,u.x=s.x*d.a+s.y*d.c,u.y=s.y*d.d+s.x*d.b,s.x=u.x,s.y=u.y,u.x=s.width*d.a+s.height*d.c,u.y=s.height*d.d+s.width*d.b,s.width=u.x,s.height=u.y,h.addValue("out",p)}i=i-f-t.x,n=n-f-t.y,u.setTo(i,n),d.transformPoint(u),i=u.x+s.x,n=u.y+s.y,a=Qr.create(1,0),tn.TEMP.identity(),e.ctx.drawTarget(h,i,n,s.width,s.height,tn.TEMP,"out",a,null,Bn.TOINT.overlay),y=ir.create([h],zi._recycleScope),e.addRenderObject(y),d.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=s._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=s._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=s._uint8ArraySlice),!0},s.onStageResize=function(t,e){null!=s.mainContext&&(s.mainContext.viewport(0,0,t,e),fr.width=t,fr.height=e)},s.onInvalidGLRes=function(){Fn.instance.freeAll(),_n.releaseContentManagers(!0),s.doNodeRepaint(S.stage),s.mainContext.viewport(0,0,fr.width,fr.height),S.stage.event("devicelost")},s.doNodeRepaint=function(t){0==t.numChildren&&t.repaint();for(var e=0;e<t.numChildren;e++)s.doNodeRepaint(t.getChildAt(e))},s.init=function(t,e,i){s.mainCanvas=t,Ys._createContext=function(t){return new qr(t)},Js._createContext=function(t){return new qr(t)};var n=laya.webgl.WebGL.mainContext;if(null!=n.getShaderPrecisionFormat){var r=n.getShaderPrecisionFormat(35633,36338),a=n.getShaderPrecisionFormat(35632,36338);s.shaderHighPrecision=!(!r.precision||!a.precision)}else s.shaderHighPrecision=!1;if(s.compressAstc=n.getExtension("WEBGL_compressed_texture_astc"),s.compressAtc=n.getExtension("WEBGL_compressed_texture_atc"),s.compressEtc=n.getExtension("WEBGL_compressed_texture_etc"),s.compressEtc1=n.getExtension("WEBGL_compressed_texture_etc1"),s.compressPvrtc=n.getExtension("WEBGL_compressed_texture_pvrtc"),s.compressS3tc=n.getExtension("WEBGL_compressed_texture_s3tc"),s.compressS3tc_srgb=n.getExtension("WEBGL_compressed_texture_s3tc_srgb"),n.deleteTexture1=n.deleteTexture,n.deleteTexture=function(t){t==pr.curBindTexValue&&(pr.curBindTexValue=null),n.deleteTexture1(t)},s.onStageResize(e,i),null==s.mainContext)throw new Error("webGL getContext err!");fn.__init__(),Fn.__init__(),ea.__init__(),er.__init__(),qr.__init__(),Qr.__init__(),jn.__init__(),Hs.__int__(n),Bn._init_(n),hn.isConchApp&&conch.setOnInvalidGLRes(s.onInvalidGLRes)},s.compressAstc=null,s.compressAtc=null,s.compressEtc=null,s.compressEtc1=null,s.compressPvrtc=null,s.compressS3tc=null,s.compressS3tc_srgb=null,s.mainCanvas=null,s.mainContext=null,s.antialias=!0,s.shaderHighPrecision=!1,s._bg_null=[0,0,0,0],s}(),pr=function(){function n(){}return E(n,"laya.webgl.WebGLContext"),n.UseProgram=function(t){return n._useProgram!==t&&(mr.mainContext.useProgram(t),n._useProgram=t,!0)},n.setDepthTest=function(t,e){e!==n._depthTest&&((n._depthTest=e)?t.enable(2929):t.disable(2929))},n.setDepthMask=function(t,e){e!==n._depthMask&&(n._depthMask=e,t.depthMask(e))},n.setDepthFunc=function(t,e){e!==n._depthFunc&&(n._depthFunc=e,t.depthFunc(e))},n.setBlend=function(t,e){e!==n._blend&&((n._blend=e)?t.enable(3042):t.disable(3042))},n.setBlendFunc=function(t,e,i){(e!==n._sFactor||i!==n._dFactor)&&(n._sFactor=e,n._dFactor=i,t.blendFunc(e,i))},n.setCullFace=function(t,e){e!==n._cullFace&&((n._cullFace=e)?t.enable(2884):t.disable(2884))},n.setFrontFace=function(t,e){e!==n._frontFace&&(n._frontFace=e,t.frontFace(e))},n.bindTexture=function(t,e,i){t.bindTexture(e,i),n.curBindTexTarget=e,n.curBindTexValue=i},n.DEPTH_BUFFER_BIT=256,n.STENCIL_BUFFER_BIT=1024,n.COLOR_BUFFER_BIT=16384,n.POINTS=0,n.LINES=1,n.LINE_LOOP=2,n.LINE_STRIP=3,n.TRIANGLES=4,n.TRIANGLE_STRIP=5,n.TRIANGLE_FAN=6,n.ZERO=0,n.ONE=1,n.SRC_COLOR=768,n.ONE_MINUS_SRC_COLOR=769,n.SRC_ALPHA=770,n.ONE_MINUS_SRC_ALPHA=771,n.DST_ALPHA=772,n.ONE_MINUS_DST_ALPHA=773,n.DST_COLOR=774,n.ONE_MINUS_DST_COLOR=775,n.SRC_ALPHA_SATURATE=776,n.FUNC_ADD=32774,n.BLEND_EQUATION=32777,n.BLEND_EQUATION_RGB=32777,n.BLEND_EQUATION_ALPHA=34877,n.FUNC_SUBTRACT=32778,n.FUNC_REVERSE_SUBTRACT=32779,n.BLEND_DST_RGB=32968,n.BLEND_SRC_RGB=32969,n.BLEND_DST_ALPHA=32970,n.BLEND_SRC_ALPHA=32971,n.CONSTANT_COLOR=32769,n.ONE_MINUS_CONSTANT_COLOR=32770,n.CONSTANT_ALPHA=32771,n.ONE_MINUS_CONSTANT_ALPHA=32772,n.BLEND_COLOR=32773,n.ARRAY_BUFFER=34962,n.ELEMENT_ARRAY_BUFFER=34963,n.ARRAY_BUFFER_BINDING=34964,n.ELEMENT_ARRAY_BUFFER_BINDING=34965,n.STREAM_DRAW=35040,n.STATIC_DRAW=35044,n.DYNAMIC_DRAW=35048,n.BUFFER_SIZE=34660,n.BUFFER_USAGE=34661,n.CURRENT_VERTEX_ATTRIB=34342,n.FRONT=1028,n.BACK=1029,n.CULL_FACE=2884,n.FRONT_AND_BACK=1032,n.BLEND=3042,n.DITHER=3024,n.STENCIL_TEST=2960,n.DEPTH_TEST=2929,n.SCISSOR_TEST=3089,n.POLYGON_OFFSET_FILL=32823,n.SAMPLE_ALPHA_TO_COVERAGE=32926,n.SAMPLE_COVERAGE=32928,n.NO_ERROR=0,n.INVALID_ENUM=1280,n.INVALID_VALUE=1281,n.INVALID_OPERATION=1282,n.OUT_OF_MEMORY=1285,n.CW=2304,n.CCW=2305,n.LINE_WIDTH=2849,n.ALIASED_POINT_SIZE_RANGE=33901,n.ALIASED_LINE_WIDTH_RANGE=33902,n.CULL_FACE_MODE=2885,n.FRONT_FACE=2886,n.DEPTH_RANGE=2928,n.DEPTH_WRITEMASK=2930,n.DEPTH_CLEAR_VALUE=2931,n.DEPTH_FUNC=2932,n.STENCIL_CLEAR_VALUE=2961,n.STENCIL_FUNC=2962,n.STENCIL_FAIL=2964,n.STENCIL_PASS_DEPTH_FAIL=2965,n.STENCIL_PASS_DEPTH_PASS=2966,n.STENCIL_REF=2967,n.STENCIL_VALUE_MASK=2963,n.STENCIL_WRITEMASK=2968,n.STENCIL_BACK_FUNC=34816,n.STENCIL_BACK_FAIL=34817,n.STENCIL_BACK_PASS_DEPTH_FAIL=34818,n.STENCIL_BACK_PASS_DEPTH_PASS=34819,n.STENCIL_BACK_REF=36003,n.STENCIL_BACK_VALUE_MASK=36004,n.STENCIL_BACK_WRITEMASK=36005,n.VIEWPORT=2978,n.SCISSOR_BOX=3088,n.COLOR_CLEAR_VALUE=3106,n.COLOR_WRITEMASK=3107,n.UNPACK_ALIGNMENT=3317,n.PACK_ALIGNMENT=3333,n.MAX_TEXTURE_SIZE=3379,n.MAX_VIEWPORT_DIMS=3386,n.SUBPIXEL_BITS=3408,n.RED_BITS=3410,n.GREEN_BITS=3411,n.BLUE_BITS=3412,n.ALPHA_BITS=3413,n.DEPTH_BITS=3414,n.STENCIL_BITS=3415,n.POLYGON_OFFSET_UNITS=10752,n.POLYGON_OFFSET_FACTOR=32824,n.TEXTURE_BINDING_2D=32873,n.SAMPLE_BUFFERS=32936,n.SAMPLES=32937,n.SAMPLE_COVERAGE_VALUE=32938,n.SAMPLE_COVERAGE_INVERT=32939,n.NUM_COMPRESSED_TEXTURE_FORMATS=34466,n.COMPRESSED_TEXTURE_FORMATS=34467,n.DONT_CARE=4352,n.FASTEST=4353,n.NICEST=4354,n.GENERATE_MIPMAP_HINT=33170,n.BYTE=5120,n.UNSIGNED_BYTE=5121,n.SHORT=5122,n.UNSIGNED_SHORT=5123,n.INT=5124,n.UNSIGNED_INT=5125,n.FLOAT=5126,n.DEPTH_COMPONENT=6402,n.ALPHA=6406,n.RGB=6407,n.RGBA=6408,n.LUMINANCE=6409,n.LUMINANCE_ALPHA=6410,n.UNSIGNED_SHORT_4_4_4_4=32819,n.UNSIGNED_SHORT_5_5_5_1=32820,n.UNSIGNED_SHORT_5_6_5=33635,n.FRAGMENT_SHADER=35632,n.VERTEX_SHADER=35633,n.MAX_VERTEX_ATTRIBS=34921,n.MAX_VERTEX_UNIFORM_VECTORS=36347,n.MAX_VARYING_VECTORS=36348,n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,n.MAX_TEXTURE_IMAGE_UNITS=34930,n.MAX_FRAGMENT_UNIFORM_VECTORS=36349,n.SHADER_TYPE=35663,n.DELETE_STATUS=35712,n.LINK_STATUS=35714,n.VALIDATE_STATUS=35715,n.ATTACHED_SHADERS=35717,n.ACTIVE_UNIFORMS=35718,n.ACTIVE_ATTRIBUTES=35721,n.SHADING_LANGUAGE_VERSION=35724,n.CURRENT_PROGRAM=35725,n.NEVER=512,n.LESS=513,n.EQUAL=514,n.LEQUAL=515,n.GREATER=516,n.NOTEQUAL=517,n.GEQUAL=518,n.ALWAYS=519,n.KEEP=7680,n.REPLACE=7681,n.INCR=7682,n.DECR=7683,n.INVERT=5386,n.INCR_WRAP=34055,n.DECR_WRAP=34056,n.VENDOR=7936,n.RENDERER=7937,n.VERSION=7938,n.NEAREST=9728,n.LINEAR=9729,n.NEAREST_MIPMAP_NEAREST=9984,n.LINEAR_MIPMAP_NEAREST=9985,n.NEAREST_MIPMAP_LINEAR=9986,n.LINEAR_MIPMAP_LINEAR=9987,n.TEXTURE_MAG_FILTER=10240,n.TEXTURE_MIN_FILTER=10241,n.TEXTURE_WRAP_S=10242,n.TEXTURE_WRAP_T=10243,n.TEXTURE_2D=3553,n.TEXTURE=5890,n.TEXTURE_CUBE_MAP=34067,n.TEXTURE_BINDING_CUBE_MAP=34068,n.TEXTURE_CUBE_MAP_POSITIVE_X=34069,n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,n.MAX_CUBE_MAP_TEXTURE_SIZE=34076,n.TEXTURE0=33984,n.TEXTURE1=33985,n.TEXTURE2=33986,n.TEXTURE3=33987,n.TEXTURE4=33988,n.TEXTURE5=33989,n.TEXTURE6=33990,n.TEXTURE7=33991,n.TEXTURE8=33992,n.TEXTURE9=33993,n.TEXTURE10=33994,n.TEXTURE11=33995,n.TEXTURE12=33996,n.TEXTURE13=33997,n.TEXTURE14=33998,n.TEXTURE15=33999,n.TEXTURE16=34e3,n.TEXTURE17=34001,n.TEXTURE18=34002,n.TEXTURE19=34003,n.TEXTURE20=34004,n.TEXTURE21=34005,n.TEXTURE22=34006,n.TEXTURE23=34007,n.TEXTURE24=34008,n.TEXTURE25=34009,n.TEXTURE26=34010,n.TEXTURE27=34011,n.TEXTURE28=34012,n.TEXTURE29=34013,n.TEXTURE30=34014,n.TEXTURE31=34015,n.ACTIVE_TEXTURE=34016,n.REPEAT=10497,n.CLAMP_TO_EDGE=33071,n.MIRRORED_REPEAT=33648,n.FLOAT_VEC2=35664,n.FLOAT_VEC3=35665,n.FLOAT_VEC4=35666,n.INT_VEC2=35667,n.INT_VEC3=35668,n.INT_VEC4=35669,n.BOOL=35670,n.BOOL_VEC2=35671,n.BOOL_VEC3=35672,n.BOOL_VEC4=35673,n.FLOAT_MAT2=35674,n.FLOAT_MAT3=35675,n.FLOAT_MAT4=35676,n.SAMPLER_2D=35678,n.SAMPLER_CUBE=35680,n.VERTEX_ATTRIB_ARRAY_ENABLED=34338,n.VERTEX_ATTRIB_ARRAY_SIZE=34339,n.VERTEX_ATTRIB_ARRAY_STRIDE=34340,n.VERTEX_ATTRIB_ARRAY_TYPE=34341,n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,n.VERTEX_ATTRIB_ARRAY_POINTER=34373,n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,n.COMPILE_STATUS=35713,n.LOW_FLOAT=36336,n.MEDIUM_FLOAT=36337,n.HIGH_FLOAT=36338,n.LOW_INT=36339,n.MEDIUM_INT=36340,n.HIGH_INT=36341,n.FRAMEBUFFER=36160,n.RENDERBUFFER=36161,n.RGBA4=32854,n.RGB5_A1=32855,n.RGB565=36194,n.DEPTH_COMPONENT16=33189,n.STENCIL_INDEX=6401,n.STENCIL_INDEX8=36168,n.DEPTH_STENCIL=34041,n.RENDERBUFFER_WIDTH=36162,n.RENDERBUFFER_HEIGHT=36163,n.RENDERBUFFER_INTERNAL_FORMAT=36164,n.RENDERBUFFER_RED_SIZE=36176,n.RENDERBUFFER_GREEN_SIZE=36177,n.RENDERBUFFER_BLUE_SIZE=36178,n.RENDERBUFFER_ALPHA_SIZE=36179,n.RENDERBUFFER_DEPTH_SIZE=36180,n.RENDERBUFFER_STENCIL_SIZE=36181,n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,n.COLOR_ATTACHMENT0=36064,n.DEPTH_ATTACHMENT=36096,n.STENCIL_ATTACHMENT=36128,n.DEPTH_STENCIL_ATTACHMENT=33306,n.NONE=0,n.FRAMEBUFFER_COMPLETE=36053,n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,n.FRAMEBUFFER_UNSUPPORTED=36061,n.FRAMEBUFFER_BINDING=36006,n.RENDERBUFFER_BINDING=36007,n.MAX_RENDERBUFFER_SIZE=34024,n.INVALID_FRAMEBUFFER_OPERATION=1286,n.UNPACK_FLIP_Y_WEBGL=37440,n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,n.CONTEXT_LOST_WEBGL=37442,n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,n.BROWSER_DEFAULT_WEBGL=37444,n._useProgram=null,n._depthTest=!0,n._depthMask=!0,n._depthFunc=513,n._blend=!1,n._sFactor=1,n._dFactor=0,n._cullFace=!1,n._frontFace=2305,n.curBindTexTarget=null,n.curBindTexValue=null,n}(),gr=function(){function I(){}return E(I,"Laya3D"),I._cancelLoadByUrl=function(t){S.loader.cancelLoadByUrl(t),I._innerFirstLevelLoaderManager.cancelLoadByUrl(t),I._innerSecondLevelLoaderManager.cancelLoadByUrl(t),I._innerThirdLevelLoaderManager.cancelLoadByUrl(t),I._innerFourthLevelLoaderManager.cancelLoadByUrl(t)},I._changeWebGLSize=function(t,e){mr.onStageResize(t,e),z.clientWidth=t,z.clientHeight=e},I.__init__=function(){var t=Pr.createMap;t.lh=[ys,"SPRITE3DHIERARCHY"],t.ls=[vs,"SPRITE3DHIERARCHY"],t.lm=[xs,"MESH"],t.lmat=[us,"MATERIAL"],t.lpbr=[os,"MATERIAL"],t.ltc=[Ws,"TEXTURECUBE"],t.jpg=[Gs,"nativeimage"],t.jpeg=[Gs,"nativeimage"],t.png=[Gs,"nativeimage"],t.pkm=[Gs,"arraybuffer"],t.lsani=[xa,"arraybuffer"],t.lrani=[xa,"arraybuffer"],t.raw=[Ps,"arraybuffer"],t.mipmaps=[Ps,"arraybuffer"],t.thdata=[Oa,"arraybuffer"],t.lt=[Ba,"TERRAIN"],t.lani=[Ea,"arraybuffer"],t.lav=[Ra,"json"],t.ani=[xa,"arraybuffer"],kr.parserMap.SPRITE3DHIERARCHY=I._loadHierarchy,kr.parserMap.MESH=I._loadMesh,kr.parserMap.MATERIAL=I._loadMaterial,kr.parserMap.TEXTURECUBE=I._loadTextureCube,kr.parserMap.TERRAIN=I._loadTerrain,I._innerFirstLevelLoaderManager.on("error",null,I._eventLoadManagerError),I._innerSecondLevelLoaderManager.on("error",null,I._eventLoadManagerError),I._innerThirdLevelLoaderManager.on("error",null,I._eventLoadManagerError),I._innerFourthLevelLoaderManager.on("error",null,I._eventLoadManagerError)},I.READ_BLOCK=function(){return I._readData.pos+=4,!0},I.READ_DATA=function(){return I._DATA.offset=I._readData.getUint32(),I._DATA.size=I._readData.getUint32(),!0},I.READ_STRINGS=function(){var t=[],e={offset:0,size:0};e.offset=I._readData.getUint16(),e.size=I._readData.getUint16();I._readData.pos;I._readData.pos=e.offset+I._DATA.offset;for(var i=0;i<e.size;i++){var n=I._readData.readUTFString();-1===n.lastIndexOf(".lmat")&&-1===n.lastIndexOf(".lpbr")||t.push(n)}return t},I.formatRelativePath=function(t,e){var i;if("."===e.charAt(0)){for(var n=(t+e).split("/"),r=0,a=n.length;r<a;r++)if(".."==n[r]){var s=r-1;0<s&&".."!==n[s]&&(n.splice(s,2),r-=2)}i=n.join("/")}else i=t+e;return null!=on.customFormat&&(i=on.customFormat(i,null)),i},I._eventLoadManagerError=function(t){S.loader.event("error",t)},I._addHierarchyInnerUrls=function(t,e,i,n,r,a){var s=I.formatRelativePath(n,r);i&&(s+=i),t.push({url:s,clas:a}),e[r]=s},I._getSprite3DHierarchyInnerUrls=function(t,e,i,n,r,a,s){var o,l=0,h=0;switch(t.type){case"Scene":var u=t.customProps.lightmaps;for(l=0,h=u.length;l<h;l++){var c=u[l].replace(".exr",".png");I._addHierarchyInnerUrls(n,r,a,s,c,Gs)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var d;if(t.instanceParams)(d=t.instanceParams.loadPath)&&I._addHierarchyInnerUrls(e,r,a,s,d,xs);else{(d=(o=t.customProps).meshPath)&&I._addHierarchyInnerUrls(e,r,a,s,d,xs);var _=o.materials;if(_)for(l=0,h=_.length;l<h;l++){var f=_[l],m=f.type.split("."),p=vn.window;if(m.forEach(function(t){p=p[t]}),"function"!=typeof p)throw"_getSprite3DHierarchyInnerUrls 错误: "+f.type+" 不是类";I._addHierarchyInnerUrls(i,r,a,s,f.path,p)}}break;case"ShuriKenParticle3D":var g=(o=t.customProps).meshPath;g&&I._addHierarchyInnerUrls(e,r,a,s,g,xs);var v=o.material;if(v)m=v.type.split("."),p=vn.window,m.forEach(function(t){p=p[t]}),I._addHierarchyInnerUrls(i,r,a,s,v.path,p);else{var y=o.materialPath;if(y)I._addHierarchyInnerUrls(i,r,a,s,y,_s);else{var x=o.texturePath;x&&I._addHierarchyInnerUrls(n,r,a,s,x,Gs)}}break;case"Terrain":I._addHierarchyInnerUrls(n,r,a,s,t.customProps.dataPath,Ba)}var b=t.components;for(var T in b){var S=b[T];switch(T){case"Animator":var E=S.avatarPath;if(E)I._addHierarchyInnerUrls(n,r,a,s,E,Ra);else{var R=S.avatar;R&&I._addHierarchyInnerUrls(n,r,a,s,R.path,Ra)}var w=S.clipPaths;for(l=0,h=w.length;l<h;l++)I._addHierarchyInnerUrls(n,r,a,s,w[l],Ea)}}var C=t.child;for(l=0,h=C.length;l<h;l++)I._getSprite3DHierarchyInnerUrls(C[l],e,i,n,r,a,s)},I._loadHierarchy=function(t){t.on("loaded",null,I._onHierarchylhLoaded,[t,t._class._getGroup()]),t.load(t.url,"json",!1,null,!0)},I._onHierarchylhLoaded=function(t,e,i){if(t._class.destroyed)t.endLoad();else{var n=t.url,r=ke.getURLVerion(n),a=on.getPath(n),s=[],o=[],l=[],h={};I._getSprite3DHierarchyInnerUrls(i,s,o,l,h,r,a);var u=s.length+o.length+l.length,c=u+1,d=1/c;if(I._onProcessChange(t,0,d,1),0<l.length){var _=u/c,f=C.create(null,I._onProcessChange,[t,d,_],!1);I._innerFourthLevelLoaderManager.create(l,C.create(null,I._onHierarchyInnerForthLevResouLoaded,[t,e,f,i,h,s,o,d+_*l.length,_]),f,null,null,1,!0,e)}else I._onHierarchyInnerForthLevResouLoaded(t,e,null,i,h,s,o,d,_)}},I._onHierarchyInnerForthLevResouLoaded=function(t,e,i,n,r,a,s,o,l){if(t._class.destroyed)t.endLoad();else if(i&&i.recover(),0<s.length){var h=C.create(null,I._onProcessChange,[t,o,l],!1);I._innerSecondLevelLoaderManager.create(s,C.create(null,I._onHierarchyInnerSecondLevResouLoaded,[t,e,h,n,r,a,o+l*s.length,l]),i,null,null,1,!0,e)}else I._onHierarchyInnerSecondLevResouLoaded(t,e,null,n,r,a,o,l)},I._onHierarchyInnerSecondLevResouLoaded=function(t,e,i,n,r,a,s,o){if(t._class.destroyed)t.endLoad();else if(i&&i.recover(),0<a.length){var l=C.create(null,I._onProcessChange,[t,s,o],!1);I._innerFirstLevelLoaderManager.create(a,C.create(null,I._onHierarchyInnerFirstLevResouLoaded,[t,l,n,r]),i,null,null,1,!0,e)}else I._onHierarchyInnerFirstLevResouLoaded(t,null,n,r)},I._onHierarchyInnerFirstLevResouLoaded=function(t,e,i,n){e&&e.recover(),t.endLoad([i,n])},I._loadTerrain=function(t){t.on("loaded",null,I._onTerrainLtLoaded,[t,t._class._getGroup()]),t.load(t.url,"json",!1,null,!0)},I._onTerrainLtLoaded=function(t,e,i){if(t._class.destroyed)t.endLoad();else{var n,r,a=t.url,s=ke.getURLVerion(a),o=on.getPath(a),l=[],h={},u=0,c=0,d=i.heightData;n=d.url,r=I.formatRelativePath(o,n),s&&(r+=s),n=h[n]=r;var _=i.detailTexture;for(u=0,c=_.length;u<c;u++)l.push({url:_[u].diffuse});var f=i.normalMap;for(u=0,c=f.length;u<c;u++)l.push({url:f[u]});var m=i.alphaMap;for(u=0,c=m.length;u<c;u++)l.push({url:m[u],params:[!1,!1,6408,!0]});for(u=0,c=l.length;u<c;u++){var p=l[u].url;r=I.formatRelativePath(o,p),s&&(r+=s),l[u].url=r,h[p]=r}var g=l.length,v=g+2,y=1/v;I._onProcessChange(t,0,y,1);var x={heightMapLoaded:!1,texturesLoaded:!1},b=C.create(null,I._onProcessChange,[t,y,y],!1);I._innerFourthLevelLoaderManager.create(n,C.create(null,I._onTerrainHeightMapLoaded,[t,b,i,h,x]),b,null,[d.numX,d.numZ,d.bitType,d.value],1,!0,e);var T=C.create(null,I._onProcessChange,[t,2*y,g/v],!1);I._innerFourthLevelLoaderManager.create(l,C.create(null,I._onTerrainTexturesLoaded,[t,T,i,h,x]),T,null,null,1,!0,e)}},I._onTerrainHeightMapLoaded=function(t,e,i,n,r){r.heightMapLoaded=!0,r.texturesLoaded&&(t.endLoad([i,n]),e.recover())},I._onTerrainTexturesLoaded=function(t,e,i,n,r){r.texturesLoaded=!0,r.heightMapLoaded&&(t.endLoad([i,n]),e.recover())},I._loadMesh=function(t){t.on("loaded",null,I._onMeshLmLoaded,[t,t._class._getGroup()]),t.load(t.url,"arraybuffer",!1,null,!0)},I._onMeshLmLoaded=function(t,e,i){if(t._class.destroyed)t.endLoad();else{var n,r,a,s=t.url,o=ke.getURLVerion(s),l=on.getPath(s),h={},u=0,c=0;switch((I._readData=new yn(i)).pos=0,I._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var d=I._readData.getUint32();I._readData.pos=I._readData.pos+4,c=I._readData.getUint16(),I._readData.pos=I._readData.pos+8*c;var _=I._readData.getUint32();for(c=I._readData.getUint16(),I._readData.pos=d+_,n=[],u=0;u<c;u++){var f=I._readData.readUTFString();-1!==f.lastIndexOf(".lmat")&&n.push(f)}break;default:for(I.READ_BLOCK(),u=0;u<2;u++){var m=I._readData.getUint16(),p=I._strings[m],g=I["READ_"+p];if(null==g)throw new Error("model file err,no this function:"+m+" "+p);1===u?n=g.call():g.call()}}for(u=0,a=n.length;u<a;u++){var v=n[u];r=I.formatRelativePath(l,v),o&&(r+=o),n[u]=r,h[v]=r}if(0<n.length){I._onProcessChange(t,0,.5,1);var y=C.create(null,I._onProcessChange,[t,.5,.5],!1);I._innerSecondLevelLoaderManager.create(n,C.create(null,I._onMeshMateialLoaded,[t,y,i,h]),y,null,null,1,!0,e)}else t.endLoad([i,h])}},I._onMeshMateialLoaded=function(t,e,i,n){t.endLoad([i,n]),e.recover()},I._getMaterialTexturePath=function(t,e,i){var n=t.length-4;return t.indexOf(".dds")!=n&&t.indexOf(".tga")!=n&&t.indexOf(".exr")!=n&&t.indexOf(".DDS")!=n&&t.indexOf(".TGA")!=n&&t.indexOf(".EXR")!=n||(t=t.substr(0,n)+".png"),t=I.formatRelativePath(i,t),e&&(t+=e),t},I._loadMaterial=function(t){t.on("loaded",null,I._onMaterilLmatLoaded,[t,t._class._getGroup()]),t.load(t.url,"json",!1,null,!0)},I._onMaterilLmatLoaded=function(t,e,i){if(t._class.destroyed)t.endLoad();else{var n,r=t.url,a=ke.getURLVerion(r),s=on.getPath(r),o=[],l={},h=i.customProps,u=i.version;if(u)switch(u){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var c=i.props.textures,d=0,_=c.length;d<_;d++){var f=c[d],m=f.path;if(m){var p=m.length-4;m.indexOf(".exr")!=p&&m.indexOf(".EXR")!=p||(m=m.substr(0,p)+".png"),n=I.formatRelativePath(s,m),a&&(n+=a),o.push({url:n,params:f.params}),l[m]=n}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var g=h.diffuseTexture.texture2D;if(g&&(n=I._getMaterialTexturePath(g,a,s),o.push(n),l[g]=n),h.normalTexture){var v=h.normalTexture.texture2D;v&&(n=I._getMaterialTexturePath(v,a,s),o.push(n),l[v]=n)}if(h.specularTexture){var y=h.specularTexture.texture2D;y&&(n=I._getMaterialTexturePath(y,a,s),o.push(n),l[y]=n)}if(h.emissiveTexture){var x=h.emissiveTexture.texture2D;x&&(n=I._getMaterialTexturePath(x,a,s),o.push(n),l[x]=n)}if(h.ambientTexture){var b=h.ambientTexture.texture2D;b&&(n=I._getMaterialTexturePath(b,a,s),o.push(n),l[b]=n)}if(h.reflectTexture){var T=h.reflectTexture.texture2D;T&&(n=I._getMaterialTexturePath(T,a,s),o.push(n),l[T]=n)}}var S=o.length,E=S+1,R=1/E;if(I._onProcessChange(t,0,R,1),0<S){var w=C.create(null,I._onProcessChange,[t,R,S/E],!1);I._innerFourthLevelLoaderManager.create(o,C.create(null,I._onMateialTexturesLoaded,[t,w,i,l]),w,Gs,null,1,!0,e)}else I._onMateialTexturesLoaded(t,null,i,null)}},I._onMateialTexturesLoaded=function(t,e,i,n){t.endLoad([i,n]),e&&e.recover()},I._loadTextureCube=function(t){t.on("loaded",null,I._onTextureCubeLtcLoaded,[t]),t.load(t.url,"json",!1,null,!0)},I._onTextureCubeLtcLoaded=function(t,e){if(t._class.destroyed)t.endLoad();else{var i=on.getPath(t.url),n=[I.formatRelativePath(i,e.px),I.formatRelativePath(i,e.nx),I.formatRelativePath(i,e.py),I.formatRelativePath(i,e.ny),I.formatRelativePath(i,e.pz),I.formatRelativePath(i,e.nz)];I._onProcessChange(t,0,1/7,1);var r=C.create(null,I._onProcessChange,[t,1/7,6/7],!1);I._innerFourthLevelLoaderManager.load(n,C.create(null,I._onTextureCubeImagesLoaded,[t,n,r]),r,"nativeimage")}},I._onTextureCubeImagesLoaded=function(t,e,i){var n=[];n.length=6;for(var r=0;r<6;r++){var a=e[r];n[r]=kr.getRes(a),kr.clearRes(a)}t.endLoad(n),i.recover()},I._onProcessChange=function(t,e,i,n){(n=e+n*i)<1&&t.event("progress",n)},I.init=function(t,e,i,n,r,a){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===a&&(a=!0),M.update3DLoop=function(){xr._triggerCollision()},M.cancelLoadByUrl=function(t){I._cancelLoadByUrl(t)},T.isAntialias=i,T.isAlpha=n,T.premultipliedAlpha=r,T.isStencil=a,mr.enable()?(M.changeWebGLSize=I._changeWebGLSize,hn.is3DMode=!0,S.init(t,e),V.__init__(),Ge.__init__(),as.__init__(),Le.__init__(),Vo.__init__(),W.__init__(),I.__init__(),Fn.maxTextureCount=2,(I.debugMode||j.debugMode)&&(I._debugPhasorSprite=new k)):alert("Laya3D init error,must support webGL!")},I.HIERARCHY="SPRITE3DHIERARCHY",I.MESH="MESH",I.MATERIAL="MATERIAL",I.PBRMATERIAL="PBRMTL",I.TEXTURECUBE="TEXTURECUBE",I.TERRAIN="TERRAIN",I._readData=null,I._debugPhasorSprite=null,I.debugMode=!1,m(I,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new Pr},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new Pr},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new Pr},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new Pr}]),I}(),vr=function(){function t(){}return E(t,"UIConfig"),t.touchScrollEnable=!0,t.mouseWheelEnable=!0,t.showButtons=!0,t.popupBgColor="#000000",t.popupBgAlpha=.5,t.closeDialogOnSide=!0,t}(),yr=function(t){function e(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,e.__super.call(this),this._destroyed=!1,this._id=e._uniqueIDCounter,e._uniqueIDCounter++}E(e,"laya.d3.component.Component3D",l);var i=e.prototype;return S.imps(i,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),i._initialize=function(t){this._owner=t,this._enable=!0,this.started=!1,this._load(t)},i._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},i._load=function(t){},i._start=function(t){},i._update=function(t){},i._lateUpdate=function(t){},i._preRenderUpdate=function(t){},i._postRenderUpdate=function(t){},i._unload=function(t){this.offAll()},i._cloneTo=function(t){},v(0,i,"id",function(){return this._id}),v(0,i,"destroyed",function(){return this._destroyed}),v(0,i,"owner",function(){return this._owner}),v(0,i,"enable",function(){return this._enable},function(t){this._enable!==t&&(this._enable=t,this.event("enablechanged",this._enable))}),v(0,i,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!0,e._uniqueIDCounter=1,e}(),xr=function(t){function x(){x.__super.call(this)}return E(x,"laya.d3.utils.CollisionManager",l),x._onTrigger=function(t,e,i,n,r){var a=0,s=0,o=t.id,l=e.id;if(!t._ignoreCollisonMap[l]){var h=Ge.collisionManager,u=t._runtimeCollisonTestMap[l];if(null!=u)if(u)if(t._collisonTo(e))if(t._runtimeCollisonMap[l]){for(a=0,s=i.length;a<s;a++)i[a].onTriggerStay(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerStay(t);h.event("triggerstay",[t,e])}else{for(t._runtimeCollisonMap[l]=e,t._runtimeCollisonTestMap[l]=!1,e._runtimeCollisonMap[o]=t,r&&(e._runtimeCollisonTestMap[o]=!1),a=0,s=i.length;a<s;a++)i[a].onTriggerEnter(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerEnter(t);h.event("triggerenter",[t,e])}else{var c=t._runtimeCollisonMap;if(c[l]){for(delete c[l],delete t._runtimeCollisonTestMap[l],delete e._runtimeCollisonMap[o],r&&delete e._runtimeCollisonTestMap[o],a=0,s=i.length;a<s;a++)i[a].onTriggerExit(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerExit(t);h.event("triggerexit",[t,e])}}else{for(a=0,s=i.length;a<s;a++)i[a].onTriggerStay(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerStay(t);h.event("triggerstay",[t,e])}else if(t._collisonTo(e)){for(t._runtimeCollisonMap[l]=e,t._runtimeCollisonTestMap[l]=!1,e._runtimeCollisonMap[o]=t,r&&(e._runtimeCollisonTestMap[o]=!1),a=0,s=i.length;a<s;a++)i[a].onTriggerEnter(e);for(a=0,s=n.length;a<s;a++)n[a].onTriggerEnter(t);h.event("triggerenter",[t,e])}}},x._triggerCollision=function(){for(var t=V._collsionTestList,e=t.length,i=Ge._layerCollsionMatrix,n=0;n<e;n++)for(var r=t[n],a=V.getLayerByNumber(r),s=a._colliders,o=a._nonRigidbodyOffset,l=e-1;n<=l;l--){var h=t[l];if(i[r][30-h]){var u,c,d,_=0,f=0,m=0,p=0,g=V.getLayerByNumber(h),v=g._colliders,y=g._nonRigidbodyOffset;if(a!==g){for(_=0;_<o;_++)if((u=s[_]).enable){for(d=u.owner._scripts,m=0,p=y;m<p;m++)(c=v[m]).enable&&x._onTrigger(u,c,d,c.owner._scripts,!0);for(m=y,p=v.length;m<p;m++)(c=v[m]).enable&&x._onTrigger(u,c,d,c.owner._scripts,!1)}for(_=o,f=s.length;_<f;_++)if((u=s[_]).enable)for(d=u.owner._scripts,m=0,p=g._nonRigidbodyOffset;m<p;m++)(c=v[m]).enable&&x._onTrigger(c,u,d,c.owner._scripts,!1)}else for(_=0;_<o;_++)if((u=s[_]).enable){for(d=u.owner._scripts,m=_+1,p=o;m<p;m++)(c=v[m]).enable&&x._onTrigger(u,c,d,c.owner._scripts,!0);for(m=o,p=s.length;m<p;m++)(c=v[m]).enable&&x._onTrigger(u,c,d,c.owner._scripts,!1)}}}},x}(),br=function(t){function o(){o.__super.call(this),this._$1__id=++o._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(o._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,_n.currentResourceManager&&_n.currentResourceManager.addResource(this)}E(o,"laya.resource.Resource",l);var e=o.prototype;return S.imps(e,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),e._setUrl=function(t){var e;this._url!==t&&(this._url&&((e=o._urlResourcesMap[this._url]).splice(e.indexOf(this),1),0===e.length&&delete o._urlResourcesMap[this._url]),t&&((e=o._urlResourcesMap[t])||(o._urlResourcesMap[t]=e=[]),e.push(this)),this._url=t)},e._getGroup=function(){return this._group},e._setGroup=function(t){var e;this._group!==t&&(this._group&&((e=o._groupResourcesMap[this._group]).splice(e.indexOf(this),1),0===e.length&&delete o._groupResourcesMap[this._group]),t&&((e=o._groupResourcesMap[t])||(o._groupResourcesMap[t]=e=[]),e.push(this)),this._group=t)},e._addReference=function(){this._referenceCount++},e._removeReference=function(){this._referenceCount--},e._clearReference=function(){this._referenceCount=0},e._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},e.recreateResource=function(){this.completeCreate()},e.disposeResource=function(){},e.activeResource=function(t){void 0===t&&(t=!1),this._lastUseFrameCount=Cn.loopCount,!this._destroyed&&this.__loaded&&(this._released||t)&&this.recreateResource()},e.releaseResource=function(t){return void 0===t&&(t=!1),!(!t&&this.lock)&&(!(this._released&&!t)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},e.onAsynLoaded=function(t,e,i){throw new Error("Resource: must override this function!")},e.destroy=function(){var t;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete o._idResourcesMap[this.id],this._url&&((t=o._urlResourcesMap[this._url])&&(t.splice(t.indexOf(this),1),0===t.length&&delete o._urlResourcesMap[this.url]),kr.clearRes(this._url),this.__loaded||M.cancelLoadByUrl(this._url)),this._group&&((t=o._groupResourcesMap[this._group]).splice(t.indexOf(this),1),0===t.length&&delete o._groupResourcesMap[this.url]))},e.completeCreate=function(){this._released=!1,this.event("recovered",this)},e.dispose=function(){this.destroy()},v(0,e,"memorySize",function(){return this._memorySize},function(t){var e=t-this._memorySize;this._memorySize=t,this.resourceManager&&this.resourceManager.addSize(e)}),v(0,e,"_loaded",null,function(t){this.__loaded=t}),v(0,e,"loaded",function(){return this.__loaded}),v(0,e,"id",function(){return this._$1__id}),v(0,e,"destroyed",function(){return this._destroyed}),v(0,e,"group",function(){return this._getGroup()},function(t){this._setGroup(t)}),v(0,e,"resourceManager",function(){return this._resourceManager}),v(0,e,"url",function(){return this._url}),v(0,e,"released",function(){return this._released}),v(0,e,"referenceCount",function(){return this._referenceCount}),o.getResourceByID=function(t){return o._idResourcesMap[t]},o.getResourceByURL=function(t,e){return void 0===e&&(e=0),o._urlResourcesMap[t][e]},o.getResourceCountByURL=function(t){return o._urlResourcesMap[t].length},o.destroyUnusedResources=function(t){var e;if(t){var i=o._groupResourcesMap[t];if(i)for(var n=i.slice(),r=0,a=n.length;r<a;r++)(e=n[r]).lock||0!==e._referenceCount||e.destroy()}else for(var s in o._idResourcesMap)(e=o._idResourcesMap[s]).lock||0!==e._referenceCount||e.destroy()},o._uniqueIDCounter=0,o._idResourcesMap={},o._urlResourcesMap={},o._groupResourcesMap={},o}(),Tr=function(t){function s(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,s.__super.call(this),this._childs=s.ARRAY_EMPTY,this._$P=s.PROP_EMPTY,this.timer=S.scaleTimer,this.conchModel=hn.isConchNode?this.createConchModel():null}E(s,"laya.display.Node",l);var e=s.prototype;return e._setBit=function(t,e){1==t&&(this._getBit(t)!=e&&this._updateDisplayedInstage());e?this._bits|=t:this._bits&=~t},e._getBit=function(t){return 0!=(this._bits&t)},e._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},e._setUpNoticeType=function(t){var e=this;for(e._setBit(t,!0),e=e.parent;e;){if(e._getBit(t))return;e._setBit(t,!0),e=e.parent}},e.on=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,n,!1)},e.once=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,n,!0)},e.createConchModel=function(){return null},e.destroy=function(t){void 0===t&&(t=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(t?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},e.destroyChildren=function(){if(this._childs)for(var t=this._childs.length-1;-1<t;t--)this._childs[t].destroy(!0)},e.addChild=function(t){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===s.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged();return t},e.addChildren=function(t){for(var e=arguments,i=0,n=e.length;i<n;)this.addChild(e[i++])},e.addChildAt=function(t,e){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=e&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===s.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),t.parent=this;return t}throw new Error("appendChildAt:The index is out of bounds")},e.getChildIndex=function(t){return this._childs.indexOf(t)},e.getChildByName=function(t){var e=this._childs;if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.name===t)return r}return null},e._get$P=function(t){return this._$P[t]},e._set$P=function(t,e){return this.destroyed||(this._$P===s.PROP_EMPTY&&(this._$P={}),this._$P[t]=e),e},e.getChildAt=function(t){return this._childs[t]},e.setChildIndex=function(t,e){var i=this._childs;if(e<0||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var n=this.getChildIndex(t);if(n<0)throw new Error("setChildIndex:node is must child of this object.");return i.splice(n,1),i.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged(),t},e._childChanged=function(t){},e.removeChild=function(t){if(!this._childs)return t;var e=this._childs.indexOf(t);return this.removeChildAt(e)},e.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},e.removeChildByName=function(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e},e.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},e.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===t&&a<=e){var n=i;this._childs=s.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,a=n.length;r<a;r++)n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},e.replaceChild=function(t,e){var i=this._childs.indexOf(e);return-1<i?(this._childs.splice(i,1,t),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(t.conchModel,i)),e.parent=null,t.parent=this,t):null},e._updateDisplayedInstage=function(){var t;t=this;var e=S.stage;for(this._displayedInStage=!1;t;){if(t._getBit(1)){this._displayedInStage=t._displayedInStage;break}if(t==e||t._displayedInStage){this._displayedInStage=!0;break}t=t.parent}},e._setDisplay=function(t){this._displayedInStage!==t&&((this._displayedInStage=t)?this.event("display"):this.event("undisplay"))},e._displayChild=function(t,e){var i=t._childs;if(i)for(var n=0,r=i.length;n<r;n++){var a=i[n];a._getBit(1)&&(0<a._childs.length?this._displayChild(a,e):a._setDisplay(e))}t._setDisplay(e)},e.contains=function(t){if(t===this)return!0;for(;t;){if(t.parent===this)return!0;t=t.parent}return!1},e.timerLoop=function(t,e,i,n,r,a){void 0===r&&(r=!0),void 0===a&&(a=!1),this.timer.loop(t,e,i,n,r,a)},e.timerOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!1,!1,t,e,i,n,r)},e.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!0,!0,t,e,i,n,r)},e.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!0,!1,t,e,i,n,r)},e.clearTimer=function(t,e){this.timer.clear(t,e)},v(0,e,"numChildren",function(){return this._childs.length}),v(0,e,"destroyed",function(){return this._destroyed}),v(0,e,"parent",function(){return this._parent},function(t){this._parent!==t&&(t?(this._parent=t,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),t.displayedInStage&&this._displayChild(this,!0)),t._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=t))}),v(0,e,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),s.ARRAY_EMPTY=[],s.PROP_EMPTY={},s.NOTICE_DISPLAY=1,s.MOUSEENABLE=2,s}(),Sr=function(t){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}E(e,"laya.media.SoundChannel",l);var i=e.prototype;return i.play=function(){},i.stop=function(){},i.pause=function(){},i.resume=function(){},i.__runComplete=function(t){t&&t.run()},v(0,i,"volume",function(){return 1},function(t){}),v(0,i,"position",function(){return 0}),v(0,i,"duration",function(){return 0}),e}(),Er=function(t){function r(t){r.__super.call(this),this._owner=t,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}E(r,"laya.d3.animation.AnimationTransform3D",l);var e=r.prototype;return e._getlocalMatrix=function(){return this._localUpdate&&(ke._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},e._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldTransform()}},e._setWorldMatrixAndUpdate=function(t){if(this._worldMatrix=t,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var e=this._getlocalMatrix(),i=0;i<16;++i)this._worldMatrix[i]=e[i];else ke.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},e._setWorldMatrixNoUpdate=function(t){this._worldMatrix=t},e._setWorldMatrixIgnoreUpdate=function(t){this._worldMatrix=t,this._worldUpdate=!1},e.getLocalPosition=function(){return this._localPosition},e.setLocalPosition=function(t){if(this._parent)this._localPosition=t,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localPosition,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localPosition=i}},e.getLocalRotation=function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler;ke._quaternionCreateFromYawPitchRollArray(t[1]/r._angleToRandin,t[0]/r._angleToRandin,t[2]/r._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},e.setLocalRotation=function(t){if(this._parent)this._localRotation=t,ke.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localRotation,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],e.localRotation=i}},e.getLocalScale=function(){return this._localScale},e.setLocalScale=function(t){if(this._parent)this._localScale=t,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localScale,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localScale=i}},e.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){ke.getYawPitchRoll(this._localRotation,r._tempVector3);var t=r._tempVector3,e=this._localRotationEuler;e[0]=t[1]*r._angleToRandin,e[1]=t[0]*r._angleToRandin,e[2]=t[2]*r._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},e.setLocalRotationEuler=function(t){if(this._parent)ke._quaternionCreateFromYawPitchRollArray(t[1]/r._angleToRandin,t[0]/r._angleToRandin,t[2]/r._angleToRandin,this._localRotation),this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localRotationEuler,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localRotationEuler=i}},e.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)ke.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var t=this._getlocalMatrix(),e=0;e<16;++e)this._worldMatrix[e]=t[e];this._worldUpdate=!1}return this._worldMatrix},e.setParent=function(t){if(this._parent!==t){if(this._parent){var e=this._parent._childs,i=e.indexOf(this);e.splice(i,1)}t&&(t._childs.push(this),t&&this._onWorldTransform()),this._parent=t}},m(r,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),r}(),Rr=function(t){function n(){n.__super.call(this),this.mesh=new o}E(n,"laya.ani.bone.canvasmesh.SkinMeshCanvas",s);var e=n.prototype;return e.init2=function(t,e,i,n,r){var a;this.transform&&(this.transform=null),i?a=i:(a=[]).push(0,1,3,3,1,2),this.mesh.texture=t,this.mesh.indexes=a,this.mesh.vertices=n,this.mesh.uvs=r},e.render=function(t,e,i){this.mesh.texture&&(this.transform?(this.transform.translate(e,i),this.renderToContext(t),this.transform.translate(-e,-i)):(this.transform=n._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this.renderToContext(t),this.transform.translate(-e,-i),this.transform=null))},m(n,["_tempMatrix",function(){return this._tempMatrix=new tn}]),n}(),wr=function(t){function e(){this._destroyed=!1,e.__super.call(this),this._destroyed=!1}E(e,"laya.d3.core.GeometryFilter",l);var i=e.prototype;return S.imps(i,{"laya.resource.IDestroy":!0}),i._destroy=function(){this.offAll(),this._destroyed=!0},v(0,i,"_isAsyncLoaded",function(){return!0}),v(0,i,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),v(0,i,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),v(0,i,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),v(0,i,"destroyed",function(){return this._destroyed}),e}(),Cr=function(t){function n(t){n.__super.call(this),this._id=++n._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new _e(new we,new we),this._boundingBoxCenter=new we,this._boundingSphere=new me(new we,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=t,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}E(n,"laya.d3.core.render.BaseRender",l);var e=n.prototype;return S.imps(e,{"laya.resource.IDestroy":!0}),e._changeMaterialReference=function(t,e){t&&t._removeReference(),e._addReference()},e._getInstanceMaterial=function(t,e){var i=new t.constructor;return t.cloneTo(i),i.name=i.name+"(Instance)",this._materialsInstance[e]=!0,this._changeMaterialReference(this._materials[e],i),this._materials[e]=i},e._setShaderValuelightMap=function(t){this._setShaderValueTexture(3,t)},e._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},e._renderRenderableBoundBox=function(){var t=gr._debugPhasorSprite,e=this.boundingBox,i=n._tempBoundBoxCorners;e.getCorners(i),t.line(i[0],n._greenColor,i[1],n._greenColor),t.line(i[2],n._greenColor,i[3],n._greenColor),t.line(i[4],n._greenColor,i[5],n._greenColor),t.line(i[6],n._greenColor,i[7],n._greenColor),t.line(i[0],n._greenColor,i[3],n._greenColor),t.line(i[1],n._greenColor,i[2],n._greenColor),t.line(i[2],n._greenColor,i[6],n._greenColor),t.line(i[3],n._greenColor,i[7],n._greenColor),t.line(i[0],n._greenColor,i[4],n._greenColor),t.line(i[1],n._greenColor,i[5],n._greenColor),t.line(i[4],n._greenColor,i[7],n._greenColor),t.line(i[5],n._greenColor,i[6],n._greenColor)},e._calculateBoundingSphere=function(){throw"BaseRender: must override it."},e._calculateBoundingBox=function(){throw"BaseRender: must override it."},e._setShaderValueTexture=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueMatrix4x4=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},e._setShaderValueColor=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},e._setShaderValueBuffer=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueInt=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueBool=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueNumber=function(t,e){this._owner._shaderValues.setValue(t,e)},e._setShaderValueVector2=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},e._addShaderDefine=function(t){this._owner._shaderDefineValue|=t},e._removeShaderDefine=function(t){this._owner._shaderDefineValue&=~t},e._renderUpdate=function(t){return!0},e._applyLightMapParams=function(){if(0<=this._lightmapIndex){var t=this._owner.scene;if(t){var e=t.getlightmaps()[this._lightmapIndex];e?(this._addShaderDefine(ao.SAHDERDEFINE_LIGHTMAP),e.loaded?this._setShaderValuelightMap(e):e.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(ao.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(ao.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(ao.SAHDERDEFINE_LIGHTMAP)},e._updateOctreeNode=function(){var t=this._treeNode;t&&this._octreeNodeNeedChange&&(t.updateObject(this),this._octreeNodeNeedChange=!1)},e._destroy=function(){this.offAll();var t=0,e=0;for(t=0,e=this._renderElements.length;t<e;t++)this._renderElements[t]._destroy();for(t=0,e=this._materials.length;t<e;t++)this._materials[t]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},v(0,e,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),v(0,e,"id",function(){return this._id}),v(0,e,"material",function(){var t=this._materials[0];if(t&&!this._materialsInstance[0]){var e=this._getInstanceMaterial(t,0);this.event("materialchanged",[this,0,e])}return this._materials[0]},function(t){this.sharedMaterial=t}),v(0,e,"sharedMaterial",function(){return this._materials[0]},function(t){var e=this._materials[0];e!==t&&(this._materials[0]=t,this._materialsInstance[0]=!1,this._changeMaterialReference(e,t),this.event("materialchanged",[this,0,t]))}),v(0,e,"lightmapIndex",function(){return this._lightmapIndex},function(t){this._lightmapIndex=t,this._applyLightMapParams()}),v(0,e,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(t){this._lightmapScaleOffset=t,this._setShaderValueColor(2,t),this._addShaderDefine(ao.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),v(0,e,"enable",function(){return this._enable},function(t){this._enable=t,this.event("enablechanged",[this,t])}),v(0,e,"materials",function(){for(var t=0,e=this._materials.length;t<e;t++)if(!this._materialsInstance[t]){var i=this._getInstanceMaterial(this._materials[t],t);this.event("materialchanged",[this,t,i])}return this._materials.slice()},function(t){this.sharedMaterials=t}),v(0,e,"sharedMaterials",function(){return this._materials.slice()},function(t){if(!t)throw new Error("MeshRender: shadredMaterials value can't be null.");var e=t.length;this._materialsInstance.length=e;for(var i=0;i<e;i++){var n=this._materials[i];n!==t[i]&&(this._materialsInstance[i]=!1,this._changeMaterialReference(n,t[i]),this.event("materialchanged",[this,i,t[i]]))}this._materials=t}),v(0,e,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),v(0,e,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var t=this.boundingBox;we.add(t.min,t.max,this._boundingBoxCenter),we.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),v(0,e,"receiveShadow",function(){return this._receiveShadow},function(t){this._receiveShadow!==t&&((this._receiveShadow=t)?this._addShaderDefine(Ne.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(Ne.SHADERDEFINE_RECEIVE_SHADOW))}),v(0,e,"destroyed",function(){return this._destroyed}),n._uniqueIDCounter=0,m(n,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new we,new we,new we,new we,new we,new we,new we,new we]},"_greenColor",function(){return this._greenColor=new Ce(0,1,0,1)}]),n}(),Ir=function(t){function o(t){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,o.__super.call(this),this._localPosition=new we,this._localRotation=new Te(0,0,0,1),this._localScale=new we(1,1,1),this._localRotationEuler=new we,this._localMatrix=new ye,this._position=new we,this._rotation=new Te(0,0,0,1),this._scale=new we(1,1,1),this._worldMatrix=new ye,this._forward=new we,this._up=new we,this._right=new we,this._owner=t,this._childs=[]}E(o,"laya.d3.core.Transform3D",l);var e=o.prototype;return e._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)ye.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var t=o._tempVector30;we.multiply(this.pivot,this._localScale,t);var e=o._tempVector31;we.subtract(t,this.pivot,e);var i=o._tempVector32,n=this.localRotation;we.transformQuat(t,n,i),we.subtract(i,t,i);var r=o._tempVector33;we.subtract(this._localPosition,e,r),we.subtract(r,i,r),ye.createAffineTransformation(r,n,this._localScale,this._localMatrix)}},e._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionRotationTransform()}},e._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionScaleTransform()}},e._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionTransform()}},e._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionRotationTransform()}},e._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionScaleTransform()}},e._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldTransform()}},e.translate=function(t,e){void 0===e&&(e=!0),e?(ye.createFromQuaternion(this.localRotation,o._tempMatrix0),we.transformCoordinate(t,o._tempMatrix0,o._tempVector30),we.add(this.localPosition,o._tempVector30,this._localPosition),this.localPosition=this._localPosition):(we.add(this.position,t,this._position),this.position=this._position)},e.rotate=function(t,e,i){var n;void 0===e&&(e=!0),void 0===i&&(i=!0),n=i?t:(we.scale(t,Math.PI/180,o._tempVector30),o._tempVector30),Te.createFromYawPitchRoll(n.y,n.x,n.z,o._tempQuaternion0),e?(Te.multiply(this._localRotation,o._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(Te.multiply(o._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},e.lookAt=function(t,e,i){void 0===i&&(i=!1);var n,r=t.elements;if(i){if(n=this._localPosition.elements,Math.abs(n[0]-r[0])<ge.zeroTolerance&&Math.abs(n[1]-r[1])<ge.zeroTolerance&&Math.abs(n[2]-r[2])<ge.zeroTolerance)return;Te.lookAt(this._localPosition,t,e,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var a=this.position;if(n=a.elements,Math.abs(n[0]-r[0])<ge.zeroTolerance&&Math.abs(n[1]-r[1])<ge.zeroTolerance&&Math.abs(n[2]-r[2])<ge.zeroTolerance)return;Te.lookAt(a,t,e,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},v(0,e,"_isFrontFaceInvert",function(){var t=this.scale,e=t.x<0;return t.y<0&&(e=!e),t.z<0&&(e=!e),e}),v(0,e,"owner",function(){return this._owner}),v(0,e,"localRotation",function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler.elements;Te.createFromYawPitchRoll(t[1]/o._angleToRandin,t[0]/o._angleToRandin,t[2]/o._angleToRandin,this._localRotation)}return this._localRotation},function(t){this._localRotation=t,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),v(0,e,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?ye.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(t){null===this._parent?t.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),ye.multiply(this._localMatrix,t,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=t,this._worldUpdate=!1}),v(0,e,"worldNeedUpdate",function(){return this._worldUpdate}),v(0,e,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(t){this._localMatrix=t,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),v(0,e,"dummy",function(){return this._dummy},function(t){this._dummy!==t&&(this._dummy&&(this._dummy._entity=null),t&&(t._entity=this),this._dummy=t)}),v(0,e,"localPosition",function(){return this._localPosition},function(t){this._localPosition=t,this._localUpdate=!0,this._onWorldPositionTransform()}),v(0,e,"position",function(){if(this._positionUpdate){if(null!=this._parent){var t=this._parent.position;we.multiply(this._localPosition,this._parent.scale,o._tempVector30),we.transformQuat(o._tempVector30,this._parent.rotation,o._tempVector30),we.add(t,o._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(t){if(null!=this._parent){we.subtract(t,this._parent.position,this._localPosition);var e=this._parent.scale.elements,i=e[0],n=e[1],r=e[2];if(1!==i||1!==n||1!==r){var a=o._tempVector30,s=a.elements;s[0]=1/i,s[1]=1/n,s[2]=1/r,we.multiply(this._localPosition,a,this._localPosition)}this._parent.rotation.invert(o._tempQuaternion0),we.transformQuat(this._localPosition,o._tempQuaternion0,this._localPosition)}else t.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=t,this._positionUpdate=!1}),v(0,e,"localScale",function(){return this._localScale},function(t){this._localScale=t,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),v(0,e,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(o._tempVector30);var t=o._tempVector30.elements,e=this._localRotationEuler.elements;e[0]=t[1]*o._angleToRandin,e[1]=t[0]*o._angleToRandin,e[2]=t[2]*o._angleToRandin}return this._localRotationEuler},function(t){this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),v(0,e,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?Te.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(t){null!=this._parent?(this._parent.rotation.invert(o._tempQuaternion0),Te.multiply(t,o._tempQuaternion0,this._localRotation)):t.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=t,this._rotationUpdate=!1}),v(0,e,"scale",function(){return this._scaleUpdate&&(null!==this._parent?we.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(t){if(null!==this._parent){var e=this._parent.scale.elements,i=o._tempVector30.elements;i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],we.multiply(t,o._tempVector30,this._localScale)}else t.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=t,this._scaleUpdate=!1}),v(0,e,"rotationEuler",null,function(t){Te.createFromYawPitchRoll(t.y,t.x,t.z,this._rotation),this.rotation=this._rotation}),v(0,e,"forward",function(){var t=this.worldMatrix.elements;return this._forward.elements[0]=-t[8],this._forward.elements[1]=-t[9],this._forward.elements[2]=-t[10],this._forward}),v(0,e,"up",function(){var t=this.worldMatrix.elements;return this._up.elements[0]=t[4],this._up.elements[1]=t[5],this._up.elements[2]=t[6],this._up}),v(0,e,"right",function(){var t=this.worldMatrix.elements;return this._right.elements[0]=t[0],this._right.elements[1]=t[1],this._right.elements[2]=t[2],this._right}),v(0,e,"parent",function(){return this._parent},function(t){if(this._parent!==t){if(this._parent){var e=this._parent._childs,i=e.indexOf(this);e.splice(i,1)}t&&(t._childs.push(this),t&&this._onWorldTransform()),this._parent=t}}),m(o,["_tempVector30",function(){return this._tempVector30=new we},"_tempVector31",function(){return this._tempVector31=new we},"_tempVector32",function(){return this._tempVector32=new we},"_tempVector33",function(){return this._tempVector33=new we},"_tempQuaternion0",function(){return this._tempQuaternion0=new Te},"_tempMatrix0",function(){return this._tempMatrix0=new ye},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),o}(),Mr=(function(t){function e(){this._rotation=0,this._matNeedUpdte=!1,e.__super.call(this),this._matrix=new ye,this._offset=new Re,this._tiling=new Re(1,1)}E(e,"laya.d3.core.TransformUV",l);var i=e.prototype;S.imps(i,{"laya.d3.core.IClone":!0}),i._updateMatrix=function(){e._tempOffsetV3.elements[0]=this._offset.x,e._tempOffsetV3.elements[1]=this._offset.y,Te.createFromYawPitchRoll(0,0,this._rotation,e._tempRotationQua),e._tempTitlingV3.elements[0]=this._tiling.x,e._tempTitlingV3.elements[1]=this._tiling.y,ye.createAffineTransformation(e._tempOffsetV3,e._tempRotationQua,e._tempTitlingV3,this._matrix)},i.cloneTo=function(t){t._matrix=this._matrix.clone(),t._offset=this._offset.clone(),t._rotation=this._rotation,t._tiling=this._tiling.clone()},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,i,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),v(0,i,"tiling",function(){return this._tiling},function(t){this._tiling=t,this._matNeedUpdte=!0}),v(0,i,"offset",function(){return this._offset},function(t){this._offset=t,this._matNeedUpdte=!0}),v(0,i,"rotation",function(){return this._rotation},function(t){this._rotation=t,this._matNeedUpdte=!0}),m(e,["_tempOffsetV3",function(){return this._tempOffsetV3=new we(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new Te},"_tempTitlingV3",function(){return this._tempTitlingV3=new we(1,1,1)}])}(),function(i){function t(){this.x=NaN,this.y=NaN,this.z=NaN,t.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}E(t,"laya.d3.core.particleShuriKen.module.shape.BoxShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=.5*-this.x,e[1]=.5*-this.y,e[2]=.5*-this.z;var i=t.max.elements;i[0]=.5*this.x,i[1]=.5*this.y,i[2]=.5*this.z},e._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=0,e[1]=0,e[2]=0;var i=t.max.elements;i[0]=0,i[1]=1,i[2]=0},e.generatePositionAndDirection=function(t,e,i,n){var r=t.elements,a=e.elements;i?(i.seed=n[16],B._randomPointInsideHalfUnitBox(t,i),n[16]=i.seed):B._randomPointInsideHalfUnitBox(t),r[0]=this.x*r[0],r[1]=this.y*r[1],r[2]=this.z*r[2],this.randomDirection?i?(i.seed=n[17],B._randomPointUnitSphere(e,i),n[17]=i.seed):B._randomPointUnitSphere(e):(a[0]=0,a[1]=0,a[2]=1)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.x=this.x,e.y=this.y,e.z=this.z,e.randomDirection=this.randomDirection},t}(O)),Ar=function(i){function s(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,s.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}E(s,"laya.d3.core.particleShuriKen.module.shape.CircleShape",i);var t=s.prototype;return t._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[2]=-this.radius,e[1]=0;var i=t.max.elements;i[0]=i[2]=this.radius,i[1]=0},t._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=1,i[2]=0},t.generatePositionAndDirection=function(t,e,i,n){var r=t.elements,a=s._tempPositionPoint.elements;i?(i.seed=n[16],this.emitFromEdge?B._randomPointUnitArcCircle(this.arc,s._tempPositionPoint,i):B._randomPointInsideUnitArcCircle(this.arc,s._tempPositionPoint,i),n[16]=i.seed):this.emitFromEdge?B._randomPointUnitArcCircle(this.arc,s._tempPositionPoint):B._randomPointInsideUnitArcCircle(this.arc,s._tempPositionPoint),r[0]=-a[0],r[1]=a[1],r[2]=0,we.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],B._randomPointUnitSphere(e,i),n[17]=i.seed):B._randomPointUnitSphere(e):t.cloneTo(e)},t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.arc=this.arc,e.emitFromEdge=this.emitFromEdge,e.randomDirection=this.randomDirection},m(s,["_tempPositionPoint",function(){return this._tempPositionPoint=new Re}]),s}(O),Dr=function(i){function d(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,d.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}E(d,"laya.d3.core.particleShuriKen.module.shape.ConeShape",i);var t=d.prototype;return t._getShapeBoundBox=function(t){var e=this.radius+this.length*Math.sin(this.angle),i=this.length*Math.cos(this.angle),n=t.min.elements;n[0]=n[1]=-e,n[2]=0;var r=t.max.elements;r[0]=r[1]=e,r[2]=i},t._getSpeedBoundBox=function(t){var e=Math.sin(this.angle),i=t.min.elements;i[0]=i[1]=-e,i[2]=0;var n=t.max.elements;n[0]=i[1]=e,n[2]=1},t.generatePositionAndDirection=function(t,e,i,n){var r,a=t.elements,s=e.elements,o=d._tempPositionPoint.elements,l=NaN,h=NaN,u=Math.cos(this.angle),c=Math.sin(this.angle);switch(this.emitType){case 0:i?(i.seed=n[16],B._randomPointInsideUnitCircle(d._tempPositionPoint,i),n[16]=i.seed):B._randomPointInsideUnitCircle(d._tempPositionPoint),l=o[0],h=o[1],a[0]=l*this.radius,a[1]=h*this.radius,a[2]=0,this.randomDirection?(i?(i.seed=n[17],B._randomPointInsideUnitCircle(d._tempDirectionPoint,i),n[17]=i.seed):B._randomPointInsideUnitCircle(d._tempDirectionPoint),r=d._tempDirectionPoint.elements,s[0]=r[0]*c,s[1]=r[1]*c):(s[0]=l*c,s[1]=h*c),s[2]=u;break;case 1:i?(i.seed=n[16],B._randomPointUnitCircle(d._tempPositionPoint,i),n[16]=i.seed):B._randomPointUnitCircle(d._tempPositionPoint),l=o[0],h=o[1],a[0]=l*this.radius,a[1]=h*this.radius,a[2]=0,this.randomDirection?(i?(i.seed=n[17],B._randomPointInsideUnitCircle(d._tempDirectionPoint,i),n[17]=i.seed):B._randomPointInsideUnitCircle(d._tempDirectionPoint),r=d._tempDirectionPoint.elements,s[0]=r[0]*c,s[1]=r[1]*c):(s[0]=l*c,s[1]=h*c),s[2]=u;break;case 2:i?(i.seed=n[16],B._randomPointInsideUnitCircle(d._tempPositionPoint,i)):B._randomPointInsideUnitCircle(d._tempPositionPoint),l=o[0],h=o[1],a[0]=l*this.radius,a[1]=h*this.radius,s[a[2]=0]=l*c,s[1]=h*c,s[2]=u,we.normalize(e,e),i?(we.scale(e,this.length*i.getFloat(),e),n[16]=i.seed):we.scale(e,this.length*Math.random(),e),we.add(t,e,t),this.randomDirection&&(i?(i.seed=n[17],B._randomPointUnitSphere(e,i),n[17]=i.seed):B._randomPointUnitSphere(e));break;case 3:i?(i.seed=n[16],B._randomPointUnitCircle(d._tempPositionPoint,i)):B._randomPointUnitCircle(d._tempPositionPoint),l=o[0],h=o[1],a[0]=l*this.radius,a[1]=h*this.radius,s[a[2]=0]=l*c,s[1]=h*c,s[2]=u,we.normalize(e,e),i?(we.scale(e,this.length*i.getFloat(),e),n[16]=i.seed):we.scale(e,this.length*Math.random(),e),we.add(t,e,t),this.randomDirection&&(i?(i.seed=n[17],B._randomPointUnitSphere(e,i),n[17]=i.seed):B._randomPointUnitSphere(e));break;default:throw new Error("ConeShape:emitType is invalid.")}},t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.angle=this.angle,e.radius=this.radius,e.length=this.length,e.emitType=this.emitType,e.randomDirection=this.randomDirection},m(d,["_tempPositionPoint",function(){return this._tempPositionPoint=new Re},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new Re}]),d}(O),Lr=function(i){function t(){this.radius=NaN,this.emitFromShell=!1,t.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}E(t,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=this.radius,i[2]=0},e._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=i[2]=1},e.generatePositionAndDirection=function(t,e,i,n){var r=t.elements;i?(i.seed=n[16],this.emitFromShell?B._randomPointUnitSphere(t,i):B._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?B._randomPointUnitSphere(t):B._randomPointInsideUnitSphere(t),we.scale(t,this.radius,t);var a=r[2];a<0&&(r[2]=-1*a),this.randomDirection?i?(i.seed=n[17],B._randomPointUnitSphere(e,i),n[17]=i.seed):B._randomPointUnitSphere(e):t.cloneTo(e)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection},t}(O),Vr=function(i){function t(){this.radius=NaN,this.emitFromShell=!1,t.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}E(t,"laya.d3.core.particleShuriKen.module.shape.SphereShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=i[2]=this.radius},e._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-1;var i=t.max.elements;i[0]=i[1]=i[2]=1},e.generatePositionAndDirection=function(t,e,i,n){i?(i.seed=n[16],this.emitFromShell?B._randomPointUnitSphere(t,i):B._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?B._randomPointUnitSphere(t):B._randomPointInsideUnitSphere(t),we.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],B._randomPointUnitSphere(e,i),n[17]=i.seed):B._randomPointUnitSphere(e):t.cloneTo(e)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection},t}(O),Nr=function(t){function e(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,e.__super.call(this)}return E(e,"laya.d3.core.render.SubMeshRenderElement",X),e}(),Pr=function(t){var d;function _(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},_.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}E(_,"laya.net.LoaderManager",l);var e=_.prototype;return e.create=function(t,i,e,n,r,a,s,o){if(void 0===a&&(a=1),void 0===s&&(s=!0),t instanceof Array){var l=t,h=l.length,u=0;if(e)var c=C.create(e.caller,e.method,e.args,!1);for(var d=0;d<h;d++){var _=l[d];"string"==typeof _&&(_=l[d]={url:_}),_.progress=0}for(d=0;d<h;d++){_=l[d];var f=e?C.create(null,g,[_],!1):null,m=e||i?C.create(null,p,[_]):null;this._create(_.url,m,f,_.clas||n,_.params||r,_.priority||a,s,_.group||o)}function p(t,e){u++,t.progress=1,u===h&&i&&i.run()}function g(t,e){t.progress=e;for(var i=0,n=0;n<h;n++){i+=l[n].progress}var r=i/h;c.runWith(r)}return!0}return this._create(t,i,e,n,r,a,s,o)},e._create=function(e,i,t,n,r,a,s,o){void 0===a&&(a=1),void 0===s&&(s=!0);var l=on.formatURL(e),h=this.getRes(l);if(h)!h.hasOwnProperty("loaded")||h.loaded?(t&&t.runWith(1),i&&i.run()):i&&S.loader._createListener(e,i.caller,i.method,i.args,!0,!1);else{var u=Dn.getFileExtension(e),c=_.createMap[u];if(!c)throw new Error("LoaderManager:unknown file("+e+") extension with: "+u+".");n||(n=c[0]);var d=c[1];if("atlas"==u)this.load(e,i,t,d,a,s);else{n===Hr&&(d="htmlimage"),(h=n?new n:null).hasOwnProperty("_loaded")&&(h._loaded=!1),h._setUrl(e),o&&h._setGroup(o),this._createLoad(h,e,C.create(null,function(t){h&&!h.destroyed&&t&&h.onAsynLoaded.call(h,e,t,r),i&&i.run();S.loader.event(e)}),t,d,a,!1,o,!0),s&&this.cacheRes(l,h)}}return h},e.load=function(t,e,i,n,r,a,s,o){var l=this;if(void 0===r&&(r=1),void 0===a&&(a=!0),void 0===o&&(o=!1),t instanceof Array)return this._loadAssets(t,e,i,n,r,a,s);var h=kr.getRes(t);if(null!=h)S.timer.frameOnce(1,null,function(){i&&i.runWith(1),e&&e.runWith(h),l._loaderCount||l.event("complete")});else{var u=_._resMap[t];u?(e&&u._createListener("complete",e.caller,e.method,e.args,!1,!1),i&&u._createListener("progress",i.caller,i.method,i.args,!1,!1)):((u=this._infoPool.length?this._infoPool.pop():new d).url=t,u.type=n,u.cache=a,u.group=s,u.ignoreCache=o,e&&u.on("complete",e.caller,e.method,e.args),i&&u.on("progress",i.caller,i.method,i.args),_._resMap[t]=u,r=r<this._maxPriority?r:this._maxPriority-1,this._resInfos[r].push(u),this._next())}return this},e._createLoad=function(t,e,i,n,r,a,s,o,l){var h=this;if(void 0===a&&(a=1),void 0===s&&(s=!0),void 0===l&&(l=!1),e instanceof Array)return this._loadAssets(e,i,n,r,a,s,o);var u=kr.getRes(e);if(null!=u)S.timer.frameOnce(1,null,function(){n&&n.runWith(1),i&&i.runWith(u),h._loaderCount||h.event("complete")});else{var c=_._resMap[e];c?(i&&c._createListener("complete",i.caller,i.method,i.args,!1,!1),n&&c._createListener("progress",n.caller,n.method,n.args,!1,!1)):((c=this._infoPool.length?this._infoPool.pop():new d).url=e,c.clas=t,c.type=r,c.cache=s,c.group=o,c.ignoreCache=l,i&&c.on("complete",i.caller,i.method,i.args),n&&c.on("progress",n.caller,n.method,n.args),_._resMap[e]=c,a=a<this._maxPriority?a:this._maxPriority-1,this._resInfos[a].push(c),this._next())}return this},e._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++)for(var e=this._resInfos[t];0<e.length;){var i=e.shift();if(i)return this._doLoad(i)}this._loaderCount||this.event("complete")}},e._doLoad=function(e){this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new kr;i.on("complete",null,r),i.on("progress",null,function(t){e.event("progress",t)}),i.on("error",null,function(t){r(null)});var n=this;function r(t){i.offAll(),i._data=null,i._customParse=!1,n._loaders.push(i),n._endLoad(e,t instanceof Array?[t]:t),n._loaderCount--,n._next()}i._class=e.clas,i.load(e.url,e.type,e.cache,e.group,e.ignoreCache)},e._endLoad=function(t,e){var i=t.url;if(null==e){var n=this._failRes[i]||0;if(n<this.retryNum)return console.warn("[warn]Retry to load:",i),this._failRes[i]=n+1,void S.timer.once(this.retryDelay,this,this._addReTry,[t],!1);console.warn("[error]Failed to load:",i),this.event("error",i)}this._failRes[i]&&(this._failRes[i]=0),delete _._resMap[i],t.event("complete",e),t.offAll(),this._infoPool.push(t)},e._addReTry=function(t){this._resInfos[this._maxPriority-1].push(t),this._next()},e.clearRes=function(t,e){void 0===e&&(e=!1),kr.clearRes(t,e)},e.getRes=function(t){return kr.getRes(t)},e.cacheRes=function(t,e){kr.cacheRes(t,e)},e.clearTextureRes=function(t){kr.clearTextureRes(t)},e.setGroup=function(t,e){kr.setGroup(t,e)},e.clearResByGroup=function(t){kr.clearResByGroup(t)},e.clearUnLoaded=function(){for(var t=0;t<this._maxPriority;t++){for(var e=this._resInfos[t],i=e.length-1;-1<i;i--){var n=e[i];n&&(n.offAll(),this._infoPool.push(n))}e.length=0}this._loaderCount=0,_._resMap={}},e.cancelLoadByUrls=function(t){if(t)for(var e=0,i=t.length;e<i;e++)this.cancelLoadByUrl(t[e])},e.cancelLoadByUrl=function(t){for(var e=0;e<this._maxPriority;e++)for(var i=this._resInfos[e],n=i.length-1;-1<n;n--){var r=i[n];r&&r.url===t&&(i[n]=null,r.offAll(),this._infoPool.push(r))}_._resMap[t]&&delete _._resMap[t]},e._loadAssets=function(t,i,s,e,n,r,a){void 0===n&&(n=1),void 0===r&&(r=!0);for(var o=t.length,l=0,h=0,u=[],c=!0,d=0;d<o;d++){var _=t[d];"string"==typeof _&&(_={url:_,type:e,size:1,priority:n}),_.size||(_.size=1),_.progress=0,h+=_.size,u.push(_);var f=s?C.create(null,g,[_],!1):null,m=i||s?C.create(null,p,[_]):null;this.load(_.url,m,f,_.type,_.priority||1,r,_.group||a)}function p(t,e){l++,t.progress=1,e||(c=!1),l===o&&i&&i.runWith(c)}function g(t,e){if(null!=s){t.progress=e;for(var i=0,n=0;n<u.length;n++){var r=u[n];i+=r.size*r.progress}var a=i/h;s.runWith(a)}}return this},_.cacheRes=function(t,e){kr.cacheRes(t,e)},_._resMap={},m(_,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),_.__init$=function(){d=function(t){function e(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,e.__super.call(this)}return E(e,"",l),e}()},_}(),Fr=function(t){function a(){a.__super.call(this)}return E(a,"laya.debug.tools.Notice",l),a.notify=function(t,e){a.I.event(t,e)},a.listen=function(t,e,i,n,r){void 0===r&&(r=!1),r&&a.cancel(t,e,i),a.I.on(t,e,i,n)},a.cancel=function(t,e,i){a.I.off(t,e,i)},m(a,["I",function(){return this.I=new a}]),a}(),Or=function(t){function f(){f.__super.call(this)}E(f,"laya.d3.graphics.MeshSprite3DStaticBatchManager",at);var e=f.prototype;return e._getStaticBatch=function(t,e,i,n){var r,a;return a=t?t.id.toString()+i.id.toString()+e.id.toString()+n.toString():i.id.toString()+e.id.toString()+n.toString(),this._staticBatches[a]?r=this._staticBatches[a]:this._staticBatches[a]=r=new Br(a,this,t,e,i),r},e._initStaticBatchs=function(t){var e,i;this._initBatchRenderElements.sort(f._sortPrepareStaticBatch);for(var n,r=!1,a=0,s=0,o=this._initBatchRenderElements.length;s<o;s++){var l,h=this._initBatchRenderElements[s],u=h.renderObj._getVertexBuffer(0);h._sprite3D;if(i===u.vertexDeclaration&&e===h._material)if(r)n._addCombineBatchRenderObjTest(h)?(l=h._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(h),n._addCombineBatchRenderObj(h)):(r=!1,a++);else{var c=this._initBatchRenderElements[s-1],d=c.renderObj,_=h.renderObj;r=!(65535<d._getVertexBuffer().vertexCount+_._getVertexBuffer().vertexCount)&&(n=this._getStaticBatch(t,i,e,a),(l=c._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(c),n._addCombineBatchRenderObj(c)),(l=h._staticBatch)!==n&&(l&&l._deleteCombineBatchRenderObj(h),n._addCombineBatchRenderObj(h)),!0)}else r=!1,a=0;e=h._material,i=u.vertexDeclaration}},f._sortPrepareStaticBatch=function(t,e){var i=t._render,n=e._render,r=i.lightmapIndex-n.lightmapIndex;if(0!==r)return r;var a=i.receiveShadow-n.receiveShadow;if(0!==a)return a;var s=t._mainSortID-e._mainSortID;return 0===s?t.renderObj.triangleCount-e.renderObj.triangleCount:s},f}(),Br=function(t){function a(t,e,i,n,r){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,a.__super.call(this,t,e,i),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=n,this._material=r}E(a,"laya.d3.graphics.SubMeshStaticBatch",st);var e=a.prototype;return e._compareBatchRenderElement=function(t,e){return t._batchIndexStart>e._batchIndexStart},e._addCombineBatchRenderObjTest=function(t){var e=t.renderObj._vertexCount;return!(65535<(0<e?this._currentCombineVertexCount+e:this._currentCombineVertexCount+t.renderObj._getVertexBuffer().vertexCount))},e._addCombineBatchRenderObj=function(t){var e=t.renderObj,i=e._vertexCount;this._initBatchRenderElements.push(t),t._staticBatch=this,0<i?(this._currentCombineIndexCount+=e._indexCount,this._currentCombineVertexCount+=i):(this._currentCombineIndexCount=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount),this._needFinishCombine=!0},e._deleteCombineBatchRenderObj=function(t){var e=t.renderObj,i=this._initBatchRenderElements.indexOf(t);if(-1!==i){this._initBatchRenderElements.splice(i,1),t._staticBatch=null;var n=e._vertexCount;this._currentCombineVertexCount=0<n?(this._currentCombineIndexCount=this._currentCombineIndexCount-e._indexCount,this._currentCombineVertexCount-n):(this._currentCombineIndexCount=this._currentCombineIndexCount-e._getIndexBuffer().indexCount,this._currentCombineVertexCount-e._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},e._finishInit=function(){if(this._needFinishCombine){var t=0,e=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var i=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),n=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=ws.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=Rs.create("ushort",this._currentCombineIndexCount,35044);for(var r=0,a=this._initBatchRenderElements.length;r<a;r++){var s=this._initBatchRenderElements[r],o=s.renderObj,l=o._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,s._sprite3D),h=o.getIndices(),u=s._sprite3D.transform._isFrontFaceInvert,c=t/(this._vertexDeclaration.vertexStride/4)-o._vertexStart,d=e,_=d+h.length;s._batchIndexStart=d,s._batchIndexEnd=_,n.set(h,e);var f=0;if(u)for(f=d;f<_;f+=3){n[f]=c+n[f];var m=n[f+1],p=n[f+2];n[f+1]=c+p,n[f+2]=c+m}else for(f=d;f<_;f+=3)n[f]=c+n[f],n[f+1]=c+n[f+1],n[f+2]=c+n[f+2];e+=h.length,i.set(l,t),t+=l.length}this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this._needFinishCombine=!1}},e._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new Nr)},e._getRenderElement=function(t,e,i){for(var n,r,a=this._batchRenderElements.length,s=!0,o=0;o<a;o++){var l,h,u=(r=this._batchRenderElements[o])._sprite3D._render;if(0!==o&&(s=(l=(n=this._batchRenderElements[o-1])._sprite3D._render).lightmapIndex!==u.lightmapIndex||l.receiveShadow!==u.receiveShadow||n._batchIndexEnd!==r._batchIndexStart),s){(h=this._getCombineRenderElementFromPool()).renderObj=this,h._material=this._material,h._batchIndexStart=r._batchIndexStart,h._batchIndexEnd=r._batchIndexEnd;var c=u.lightmapIndex,d=c+1,_=this._batchOwnerIndices[d];_||(_=this._batchOwnerIndices[d]=[]);var f,m=_[r._render.receiveShadow?1:0];void 0===m?(_[u.receiveShadow?1:0]=this._batchOwners.length,(f=new Vo(null,"StaticBatchMeshSprite3D"))._scene=e,f._transform=this._rootOwner?this._rootOwner._transform:null,f._render.lightmapIndex=c,f._render.receiveShadow=r._render.receiveShadow,this._batchOwners.push(f)):f=this._batchOwners[m],f._render._renderUpdate(i),h._sprite3D=f,t.push(h)}else h._batchIndexEnd=r._batchIndexEnd}},e._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(t){var e=t.renderElement,i=e._batchIndexStart,n=e._batchIndexEnd-i;mr.mainContext.drawElements(4,n,5123,2*i),Cn.drawCall++,Cn.trianglesFaces+=n/3},e.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},e._getVertexBuffer=function(t){return void 0===t&&(t=0),this._vertexBuffer},a}(),Gr=function(t){function s(){this.url=null,this.audio=null,this.loaded=!1,s.__super.call(this)}E(s,"laya.media.h5audio.AudioSound",l);var e=s.prototype;return e.dispose=function(){var t=s._audioCache[this.url];t&&(t.src="",delete s._audioCache[this.url])},e.load=function(t){var e;if(t=on.formatURL(t),(this.url=t)==rn._tMusic?(s._initMusicAudio(),(e=s._musicAudio).src!=t&&(s._audioCache[e.src]=null,e=null)):e=s._audioCache[t],e&&2<=e.readyState)this.event("complete");else{e||(e=t==rn._tMusic?(s._initMusicAudio(),s._musicAudio):vn.createElement("audio"),(s._audioCache[t]=e).src=t),e.addEventListener("canplaythrough",n),e.addEventListener("error",r);var i=this;(this.audio=e).load?e.load():r()}function n(){a(),i.loaded=!0,i.event("complete")}function r(){e.load=null,a(),i.event("error")}function a(){e.removeEventListener("canplaythrough",n),e.removeEventListener("error",r)}},e.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),!this.url)return null;var i,n;if(!(i=this.url==rn._tMusic?s._musicAudio:s._audioCache[this.url]))return null;n=wn.getItem("audio:"+this.url),hn.isConchApp?n||((n=vn.createElement("audio")).src=this.url):this.url==rn._tMusic?(s._initMusicAudio(),(n=s._musicAudio).src=this.url):n=n||i.cloneNode(!0);var r=new ka(n);return r.url=this.url,r.loops=e,r.startTime=t,r.play(),rn.addChannel(r),r},v(0,e,"duration",function(){var t;return(t=s._audioCache[this.url])?t.duration:0}),s._initMusicAudio=function(){s._musicAudio||(s._musicAudio||(s._musicAudio=vn.createElement("audio")),hn.isConchApp||vn.document.addEventListener("mousedown",s._makeMusicOK))},s._makeMusicOK=function(){vn.document.removeEventListener("mousedown",s._makeMusicOK),s._musicAudio.src?s._musicAudio.play():(s._musicAudio.src="",s._musicAudio.load())},s._audioCache={},s._musicAudio=null,s}(),Wr=function(t){function e(){e.__super.call(this)}E(e,"laya.media.Sound",l);var i=e.prototype;return i.load=function(t){},i.play=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),null},i.dispose=function(){},v(0,i,"duration",function(){return 0}),e}(),Ur=function(t){function r(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,r.__super.call(this)}E(r,"laya.media.webaudio.WebAudioSound",l);var e=r.prototype;return e.load=function(t){var e=this;if(t=on.formatURL(t),this.url=t,this.audioBuffer=r._dataCache[t],this.audioBuffer)this._loaded(this.audioBuffer);else if(r.e.on("loaded:"+t,this,this._loaded),r.e.on("err:"+t,this,this._err),!r.__loadingSound[t]){r.__loadingSound[t]=!0;var i=new vn.window.XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e._disposed?e._removeLoadEvents():(e.data=i.response,r.buffs.push({buffer:e.data,url:e.url}),r.decode())},i.onerror=function(t){e._err()},i.send()}},e._err=function(){if(this._removeLoadEvents(),r.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var t,e,i,n=0;for(t=(e=this.__toPlays).length,n=0;n<t;n++)(i=e[n])[2]&&!i[2].isStopped&&i[2].event("error");this.__toPlays.length=0}},e._loaded=function(t){this._removeLoadEvents(),this._disposed||(this.audioBuffer=t,r._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete"))},e._removeLoadEvents=function(){r.e.off("loaded:"+this.url,this,this._loaded),r.e.off("err:"+this.url,this,this._err)},e.__playAfterLoaded=function(){if(this.__toPlays){var t,e,i,n=0;for(t=(e=this.__toPlays).length,n=0;n<t;n++)(i=e[n])[2]&&!i[2].isStopped&&this.play(i[0],i[1],i[2]);this.__toPlays.length=0}},e.play=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),i=i||new Ha,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=e,i.audioBuffer=this.audioBuffer,i.startTime=t,i.play(),rn.addChannel(i),i},e.dispose=function(){this._disposed=!0,delete r._dataCache[this.url],delete r.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},v(0,e,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),r.decode=function(){r.buffs.length<=0||r.isDecoding||(r.isDecoding=!0,r.tInfo=r.buffs.shift(),r.ctx.decodeAudioData(r.tInfo.buffer,r._done,r._fail))},r._done=function(t){r.e.event("loaded:"+r.tInfo.url,t),r.isDecoding=!1,r.decode()},r._fail=function(){r.e.event("err:"+r.tInfo.url,null),r.isDecoding=!1,r.decode()},r._playEmptySound=function(){if(null!=r.ctx){var t=r.ctx.createBufferSource();t.buffer=r._miniBuffer,t.connect(r.ctx.destination),t.start(0,0,0)}},r._unlock=function(){r._unlocked||(r._playEmptySound(),"running"==r.ctx.state&&(vn.document.removeEventListener("mousedown",r._unlock,!0),vn.document.removeEventListener("touchend",r._unlock,!0),vn.document.removeEventListener("touchstart",r._unlock,!0),r._unlocked=!0))},r.initWebAudio=function(){"running"!=r.ctx.state&&(r._unlock(),vn.document.addEventListener("mousedown",r._unlock,!0),vn.document.addEventListener("touchend",r._unlock,!0),vn.document.addEventListener("touchstart",r._unlock,!0))},r._dataCache={},r.buffs=[],r.isDecoding=!1,r._unlocked=!1,r.tInfo=null,r.__loadingSound={},m(r,["window",function(){return this.window=vn.window},"webAudioEnabled",function(){return this.webAudioEnabled=r.window.AudioContext||r.window.webkitAudioContext||r.window.mozAudioContext},"ctx",function(){return this.ctx=r.webAudioEnabled?new(r.window.AudioContext||r.window.webkitAudioContext||r.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=r.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new l}]),r}(),Zr=function(t){function e(){this._responseType=null,this._data=null,e.__super.call(this),this._http=new vn.window.XMLHttpRequest}E(e,"laya.net.HttpRequest",l);var i=e.prototype;return i.send=function(t,e,i,n,r){void 0===i&&(i="get"),void 0===n&&(n="text"),this._responseType=n,this._data=null;var a=this,s=this._http;if(s.open(i,t,!0),r)for(var o=0;o<r.length;o++)s.setRequestHeader(r[o++],r[o]);else hn.isConchApp||(e&&"string"!=typeof e?s.setRequestHeader("Content-Type","application/json"):s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));s.responseType="arraybuffer"!==n?"text":"arraybuffer",s.onerror=function(t){a._onError(t)},s.onabort=function(t){a._onAbort(t)},s.onprogress=function(t){a._onProgress(t)},s.onload=function(t){a._onLoad(t)},s.send(e)},i._onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)},i._onAbort=function(t){this.error("Request was aborted by user")},i._onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},i._onLoad=function(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)},i.error=function(t){this.clear(),this.event("error",t)},i.complete=function(){this.clear();var e=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=Dn.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(t){e=!1,this.error(t.message)}e&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null},v(0,i,"url",function(){return this._http.responseURL}),v(0,i,"http",function(){return this._http}),v(0,i,"data",function(){return this._data}),e}(),kr=function(t){function w(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,w.__super.call(this)}E(w,"laya.net.Loader",l);var e=w.prototype;return e.load=function(t,e,i,n,r){if(void 0===i&&(i=!0),void 0===r&&(r=!1),0===(this._url=t).indexOf("data:image")?this._type=e="image":(this._type=e||(e=this.getTypeFromUrl(t)),t=on.formatURL(t)),this._cache=i,this._data=null,!r&&w.loadedMap[t])return this._data=w.loadedMap[t],this.event("progress",1),void this.event("complete",this._data);if(n&&w.setGroup(t,n),null!=w.parserMap[e])return this._customParse=!0,void(w.parserMap[e]instanceof laya.utils.Handler?w.parserMap[e].runWith(this):w.parserMap[e].call(null,this));if("image"===e||"htmlimage"===e||"nativeimage"===e)return this._loadImage(t);if("sound"===e)return this._loadSound(t);if("ttf"===e)return this._loadTTF(t);var a;switch(e){case"atlas":case"plf":a="json";break;case"font":a="xml";break;case"pkm":a="arraybuffer";break;default:a=e}w.preLoadedMap[t]?this.onLoaded(w.preLoadedMap[t]):(this._http||(this._http=new Zr,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),this._http.send(t,null,"get",a))},e.getTypeFromUrl=function(t){var e=Dn.getFileExtension(t);return e?w.typeMap[e]:(console.warn("Not recognize the resources suffix",t),"text")},e._loadTTF=function(t){t=on.formatURL(t);var e=new sn;e.complete=C.create(this,this.onLoaded),e.load(t)},e._loadImage=function(e){e=on.formatURL(e);var i,t=this;function n(){i.onload=null,i.onerror=null,delete w.imgCache[e]}var r=function(){n(),t.onLoaded(i)},a=function(){n(),t.event("error","Load image failed")};"nativeimage"===this._type?((i=new vn.window.Image).crossOrigin="",i.onload=r,i.onerror=a,i.src=e,w.imgCache[e]=i):new Co.create(e,{onload:r,onerror:a,onCreate:function(t){i=t,w.imgCache[e]=t}})},e._loadSound=function(t){var e=new rn._soundClass,i=this;function n(){e.offAll()}e.on("complete",this,function(){n(),i.onLoaded(e)}),e.on("error",this,function(){n(),e.dispose(),i.event("error","Load sound failed")}),e.load(t)},e.onProgress=function(t){"atlas"===this._type?this.event("progress",.3*t):this.event("progress",t)},e.onError=function(t){this.event("error",t)},e.onLoaded=function(t){var e=this._type;if("plf"==e)this.parsePLFData(t),this.complete(t);else if("image"===e){var i=new Hr(t);i.url=this._url,this.complete(i)}else if("sound"===e||"htmlimage"===e||"nativeimage"===e)this.complete(t);else if("atlas"===e){if(!t.src&&!t._setContext){if(!this._data){if((this._data=t).meta&&t.meta.image)for(var n=t.meta.image.split(","),r=0<=this._url.indexOf("/")?"/":"\\",a=this._url.lastIndexOf(r),s=0<=a?this._url.substr(0,a+1):"",o=0,l=n.length;o<l;o++)n[o]=s+n[o];else n=[this._url.replace(".json",".png")];n.reverse(),t.toLoads=n,t.pics=[]}return this.event("progress",.3+1/n.length*.6),this._loadImage(n.pop())}if(this._data.pics.push(t),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var h=this._data.frames,u=this._url.split("?")[0],c=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:u.substring(0,u.lastIndexOf("."))+"/",d=this._data.pics,_=on.formatURL(this._url),f=w.atlasMap[_]||(w.atlasMap[_]=[]);f.dir=c;var m=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var p in m=parseFloat(this._data.meta.scale),h){var g,v=h[p],y=d[v.frame.idx?v.frame.idx:0],x=on.formatURL(c+p);y.scaleRate=m,g=Hr.create(y,v.frame.x,v.frame.y,v.frame.w,v.frame.h,v.spriteSourceSize.x,v.spriteSourceSize.y,v.sourceSize.w,v.sourceSize.h),w.cacheRes(x,g),g.url=x,f.push(x)}else for(p in h)y=d[(v=h[p]).frame.idx?v.frame.idx:0],x=on.formatURL(c+p),w.cacheRes(x,Hr.create(y,v.frame.x,v.frame.y,v.frame.w,v.frame.h,v.spriteSourceSize.x,v.spriteSourceSize.y,v.sourceSize.w,v.sourceSize.h)),w.loadedMap[x].url=x,f.push(x);delete this._data.pics,this.complete(this._data)}else if("font"==e){if(!t.src)return this._data=t,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var b=new Bi;b.parseFont(this._data,t);var T=this._url.split(".fnt")[0].split("/"),S=T[T.length-1];Es.registerBitmapFont(S,b),this._data=b,this.complete(this._data)}else if("pkm"==e){var E=Co.create(t,this._url),R=new Hr(E);R.url=this._url,this.complete(R)}else this.complete(t)},e.parsePLFData=function(t){var e,i,n;for(e in t)switch(n=t[e],e){case"json":case"text":for(i in n)w.preLoadedMap[on.formatURL(i)]=n[i];break;default:for(i in n)w.preLoadedMap[on.formatURL(i)]=n[i]}},e.complete=function(t){this._data=t,this._customParse?this.event("loaded",t instanceof Array?[t]:t):(w._loaders.push(this),w._isWorking||w.checkNext())},e.endLoad=function(t){t&&(this._data=t),this._cache&&w.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},v(0,e,"url",function(){return this._url}),v(0,e,"data",function(){return this._data}),v(0,e,"cache",function(){return this._cache}),v(0,e,"type",function(){return this._type}),w.checkNext=function(){w._isWorking=!0;for(var t=vn.now();w._startIndex<w._loaders.length;)if(vn.now(),w._loaders[w._startIndex].endLoad(),w._startIndex++,vn.now()-t>w.maxTimeOut)return console.warn("loader callback cost a long time:"+(vn.now()-t)+" url="+w._loaders[w._startIndex-1].url),void S.timer.frameOnce(1,null,w.checkNext);w._loaders.length=0,w._startIndex=0,w._isWorking=!1},w.clearRes=function(t,e){void 0===e&&(e=!1),t=on.formatURL(t);var i=w.getAtlas(t);if(i){for(var n=0,r=i.length;n<r;n++){var a=i[n],s=w.getRes(a);delete w.loadedMap[a],s&&s.destroy(e)}i.length=0,delete w.atlasMap[t],delete w.loadedMap[t]}else{var o=w.loadedMap[t];o&&(delete w.loadedMap[t],o instanceof laya.resource.Texture&&o.bitmap&&o.destroy(e))}},w.clearTextureRes=function(t){t=on.formatURL(t);var e=laya.net.Loader.getAtlas(t),i=e&&0<e.length?laya.net.Loader.getRes(e[0]):laya.net.Loader.getRes(t);i&&i.bitmap&&(hn.isConchApp&&!hn.isConchWebGL?i.bitmap.source.releaseTexture&&i.bitmap.source.releaseTexture():null==i.bitmap._atlaser&&i.bitmap.releaseResource(!0))},w.getRes=function(t){return w.loadedMap[on.formatURL(t)]},w.getAtlas=function(t){return w.atlasMap[on.formatURL(t)]},w.cacheRes=function(t,e){t=on.formatURL(t),null!=w.loadedMap[t]?console.warn("Resources already exist,is repeated loading:",t):w.loadedMap[t]=e},w.setGroup=function(t,e){w.groupMap[e]||(w.groupMap[e]=[]),w.groupMap[e].push(t)},w.clearResByGroup=function(t){if(w.groupMap[t]){var e=w.groupMap[t],i=0,n=e.length;for(i=0;i<n;i++)w.clearRes(e[i]);e.length=0}},w.TEXT="text",w.JSON="json",w.XML="xml",w.BUFFER="arraybuffer",w.IMAGE="image",w.SOUND="sound",w.ATLAS="atlas",w.FONT="font",w.TTF="ttf",w.PLF="plf",w.PKM="pkm",w.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf",ani:"json",sk:"arraybuffer"},w.parserMap={},w.groupMap={},w.maxTimeOut=100,w.loadedMap={},w.preLoadedMap={},w.atlasMap={},w._loaders=[],w._isWorking=!1,w._startIndex=0,w.imgCache={},w}(),Hr=function(t){function w(t,e){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,w.__super.call(this),t&&null!=t._addReference&&t._addReference(),this.setTo(t,e)}E(w,"laya.resource.Texture",l);var e=w.prototype;return e._setUrl=function(t){this.url=t},e.setTo=function(t,e){if(t instanceof d.HTMLElement){var i=Ys.create("2D",t);this.bitmap=i}else this.bitmap=t;if(this.uv=e||w.DEF_UV,t){this._w=t.width,this._h=t.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var n=this;if(this._loaded)M.addToAtlas&&M.addToAtlas(n);else{var r=t;r instanceof laya.resource.HTMLImage&&r.image&&r.image.addEventListener("load",function(t){M.addToAtlas&&M.addToAtlas(n)},!1)}}},e.active=function(){this.bitmap&&this.bitmap.activeResource()},e.destroy=function(t){if(void 0===t&&(t=!1),this.bitmap&&0<this.bitmap.referenceCount){var e=this.bitmap;t?(hn.isConchApp&&e.source&&e.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,e.dispose(),e._clearReference()):(e._removeReference(),0==e.referenceCount&&(hn.isConchApp&&e.source&&e.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,e.dispose())),this.url&&this===S.loader.getRes(this.url)&&S.loader.clearRes(this.url,t),this._loaded=!1}},e.load=function(t){var e=this;this._loaded=!1,t=on.customFormat(t);var i=this.bitmap||(this.bitmap=Co.create(t));i&&i._addReference();var n=this;i.onload=function(){i.onload=null,n._loaded=!0,e.sourceWidth=e._w=i.width,e.sourceHeight=e._h=i.height,n.event("loaded",this),M.addToAtlas&&M.addToAtlas(n)}},e.addTextureToAtlas=function(t){M.addTextureToAtlas(this)},e.getPixels=function(t,e,i,n){if(hn.isConchApp){var r=this.bitmap;if(r.source&&r.source.getImageData){var a=r.source.getImageData(t,e,i,n),s=new Uint8Array(a);return Array.from(s)}return null}return hn.isWebGL?M.getTexturePixels(this,t,e,i,n):(vn.canvas.size(i,n),vn.canvas.clear(),vn.context.drawTexture(this,-t,-e,this.width,this.height,0,0),vn.context.getImageData(0,0,i,n).data)},e.onAsynLoaded=function(t,e){e&&e._addReference(),this.setTo(e,this.uv)},v(0,e,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),v(0,e,"loaded",function(){return this._loaded}),v(0,e,"released",function(){return!this.bitmap||this.bitmap.released}),v(0,e,"width",function(){return this._w?this._w:this.uv&&this.uv!==w.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}),v(0,e,"repeat",function(){return!hn.isWebGL||!this.bitmap||this.bitmap.repeat},function(t){t&&hn.isWebGL&&this.bitmap&&(this.bitmap.repeat=t)&&(this.bitmap.enableMerageInAtlas=!1)}),v(0,e,"height",function(){return this._h?this._h:this.uv&&this.uv!==w.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}),v(0,e,"isLinearSampling",function(){return!hn.isWebGL||9728!=this.bitmap.minFifter},function(t){!t&&hn.isWebGL&&(t||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),w.moveUV=function(t,e,i){for(var n=0;n<8;n+=2)i[n]+=t,i[n+1]+=e;return i},w.create=function(t,e,i,n,r,a,s,o,l){void 0===a&&(a=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0);var h=t instanceof laya.resource.Texture,u=h?t.uv:w.DEF_UV,c=h?t.bitmap:t,d=M.isAtlas(c);if(d){var _=c._atlaser,f=t._atlasID;if(-1==f)throw new Error("create texture error");c=_._inAtlasTextureBitmapValue[f],u=_._inAtlasTextureOriUVValue[f]}var m=new w(c,null);c.width&&e+n>c.width&&(n=c.width-e),c.height&&i+r>c.height&&(r=c.height-i),m.width=n,m.height=r,m.offsetX=a,m.offsetY=s,m.sourceWidth=o||n,m.sourceHeight=l||r;var p=1/c.width,g=1/c.height;e*=p,i*=g,n*=p,r*=g;var v=m.uv[0],y=m.uv[1],x=m.uv[4],b=m.uv[5],T=x-v,S=b-y,E=w.moveUV(u[0],u[1],[e,i,e+n,i,e+n,i+r,e,i+r]);m.uv=[v+E[0]*T,y+E[1]*S,x-(1-E[2])*T,y+E[3]*S,x-(1-E[4])*T,b-(1-E[5])*S,v+E[6]*T,b-(1-E[7])*S],d&&m.addTextureToAtlas();var R=c.scaleRate;return R&&1!=R?(m.sourceWidth/=R,m.sourceHeight/=R,m.width/=R,m.height/=R,m.scaleRate=R,m.offsetX/=R,m.offsetY/=R):m.scaleRate=1,m},w.createFromTexture=function(t,e,i,n,r){var a=t.scaleRate;1!=a&&(e*=a,i*=a,n*=a,r*=a);var s=nn.TEMP.setTo(e-t.offsetX,i-t.offsetY,n,r),o=s.intersection(w._rect1.setTo(0,0,t.width,t.height),w._rect2);if(!o)return null;var l=w.create(t,o.x,o.y,o.width,o.height,o.x-s.x,o.y-s.y,n,r);return l.bitmap._removeReference(),l},w.DEF_UV=[0,0,1,0,1,1,0,1],w.INV_UV=[0,1,1,1,1,0,0,0],w._rect1=new nn,w._rect2=new nn,w}(),Xr=function(t){function g(t,e,i,n,r,a){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=t,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[Ne.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[ao.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[ao.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[Bo.SHADERDEFINE_BONE]="BONE",this._materialInt2name[va.SHADERDEFINE_ALPHATEST]="ALPHATEST";g.__super.call(this,t,e,i,null,{}),this._attributeMap=n;var s;for(s in r){var o=r[s];switch(o[1]){case 0:this._renderElementUniformMap[s]=o[0];break;case 1:this._materialUniformMap[s]=o[0];break;case 2:this._spriteUniformMap[s]=o[0];break;case 3:this._cameraUniformMap[s]=o[0];break;case 4:this._sceneUniformMap[s]=o[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}E(g,"laya.d3.shader.ShaderCompile3D",Ae);var e=g.prototype;return e._definesToNameDic=function(t,e){for(var i={},n=1,r=0;r<32&&!(t<(n=1<<r));r++)if(t&n){var a=e[n];a&&(i[a]="")}return i},e.withCompile=function(t,e,i){var n,r,a;if(r=this.sharders[t])if(a=r[e]){if(n=a[i])return n}else a=r[e]=[];else a=(r=this.sharders[t]=[])[e]=[];var s,o=this._definesToNameDic(t,g._globalInt2name),l=this._definesToNameDic(e,this._spriteInt2name),h=this._definesToNameDic(i,this._materialInt2name);if(laya.d3.shader.ShaderCompile3D.debugMode){var u="";for(s in o)u+=s+" ";var c="";for(s in l)c+=s+" ";var d="";for(s in h)d+=s+" ";console.log("ShaderCompile3DDebugMode---(Name:"+Us.nameKey.getName(this._name)+" PublicDefine:"+t+" SpriteDefine:"+e+" MaterialDefine:"+i+" PublicDefineGroup:"+u+" SpriteDefineGroup:"+c+"MaterialDefineGroup: "+d+")---ShaderCompile3DDebugMode")}var _={},f="";if(o)for(s in o)f+="#define "+s+"\n",_[s]=!0;if(l)for(s in l)f+="#define "+s+"\n",_[s]=!0;if(h)for(s in h)f+="#define "+s+"\n",_[s]=!0;var m=this._VS.toscript(_,[]),p=this._PS.toscript(_,[]);return n=Us.create(f+m.join("\n"),f+p.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap),a[i]=n},e.precompileShaderWithShaderDefine=function(t,e,i){this.withCompile(t,e,i)},e.addMaterialDefines=function(t){var e=t.defines;for(var i in e){var n=e[i],r=parseInt(i);this._materialInt2name[r]=n,this._materialName2Int[n]=r}},e.addSpriteDefines=function(t){var e=t.defines;for(var i in e){var n=e[i],r=parseInt(i);this._spriteInt2name[r]=n,this._spriteName2Int[n]=r}},e.getMaterialDefineByName=function(t){return this._materialName2Int[t]},e.registerMaterialDefine=function(t){var e=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[e]=t,this._materialName2Int[t]=e},e.registerSpriteDefine=function(t){var e=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[e]=t,this._spriteName2Int[t]=e},g._globalRegDefine=function(t,e){g._globalInt2name[e]=t},g.add=function(t,e,i,n,r){return laya.d3.shader.ShaderCompile3D._preCompileShader[t]=new g(t,e,i,n,r,Ae.includes)},g.get=function(t){return laya.d3.shader.ShaderCompile3D._preCompileShader[Us.nameKey.getID(t)]},g._preCompileShader={},g._globalInt2name=[],g.debugMode=!1,g.SHADERDEFINE_HIGHPRECISION=1,g.SHADERDEFINE_FOG=4,g.SHADERDEFINE_DIRECTIONLIGHT=8,g.SHADERDEFINE_POINTLIGHT=16,g.SHADERDEFINE_SPOTLIGHT=32,g.SHADERDEFINE_UV0=64,g.SHADERDEFINE_COLOR=128,g.SHADERDEFINE_UV1=256,g.SAHDERDEFINE_DEPTHFOG=131072,g}(),Yr=function(e){function f(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,f.__super.call(this)}E(f,"laya.ui.AutoBitmap",e);var t=f.prototype;return t.destroy=function(){e.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},t._setChanged=function(){this._isChanged||(this._isChanged=!0,S.timer.callLater(this,this.changeSource))},t.changeSource=function(){this._isChanged=!1;var t=this._source;if(t&&t.bitmap){var e=this.width,i=this.height,n=this._sizeGrid,r=t.sourceWidth,a=t.sourceHeight;if(!n||r===e&&a===i)this.clear(),this.drawTexture(t,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,e,i);else{t.$_GID||(t.$_GID=Dn.getGID());var s=t.$_GID+"."+e+"."+i+"."+n.join(".");if(Dn.isOKCmdList(Vn.I.get(s)))return void(this.cmds=Vn.I.get(s));this.clear();var o=n[0],l=n[1],h=n[2],u=n[3],c=n[4],d=!1;if(e==r&&(u=l=0),i==a&&(o=h=0),e<u+l){var _=e;d=!0,e=u+l,this.save(),this.clipRect(0,0,_,i)}u&&o&&this.drawTexture(f.getTexture(t,0,0,u,o),0,0,u,o),l&&o&&this.drawTexture(f.getTexture(t,r-l,0,l,o),e-l,0,l,o),u&&h&&this.drawTexture(f.getTexture(t,0,a-h,u,h),0,i-h,u,h),l&&h&&this.drawTexture(f.getTexture(t,r-l,a-h,l,h),e-l,i-h,l,h),o&&this.drawBitmap(c,f.getTexture(t,u,0,r-u-l,o),u,0,e-u-l,o),h&&this.drawBitmap(c,f.getTexture(t,u,a-h,r-u-l,h),u,i-h,e-u-l,h),u&&this.drawBitmap(c,f.getTexture(t,0,o,u,a-o-h),0,o,u,i-o-h),l&&this.drawBitmap(c,f.getTexture(t,r-l,o,l,a-o-h),e-l,o,l,i-o-h),this.drawBitmap(c,f.getTexture(t,u,o,r-u-l,a-o-h),u,o,e-u-l,i-o-h),d&&this.restore(),this.autoCacheCmd&&!hn.isConchApp&&Vn.I.set(s,this.cmds)}this._repaint()}},t.drawBitmap=function(t,e,i,n,r,a){void 0===r&&(r=0),void 0===a&&(a=0),r<.1||a<.1||(!t||e.width==r&&e.height==a?this.drawTexture(e,i,n,r,a):this.fillTexture(e,i,n,r,a))},t.clear=function(t){void 0===t&&(t=!0),e.prototype.clear.call(this,!1)},v(0,t,"sizeGrid",function(){return this._sizeGrid},function(t){this._sizeGrid=t,this._setChanged()}),v(0,t,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(t){this._width!=t&&(this._width=t,this._setChanged())}),v(0,t,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(t){this._height!=t&&(this._height=t,this._setChanged())}),v(0,t,"source",function(){return this._source},function(t){t?(this._source=t,this._setChanged()):(this._source=null,this.clear())}),f.getTexture=function(t,e,i,n,r){n<=0&&(n=1),r<=0&&(r=1),t.$_GID||(t.$_GID=Dn.getGID());var a=t.$_GID+"."+e+"."+i+"."+n+"."+r,s=Vn.I.get(a);return s&&s.source||(s=Hr.createFromTexture(t,e,i,n,r),Vn.I.set(a,s)),s},f}(f),zr=function(t){function e(){e.__super.call(this)}E(e,"laya.webgl.display.GraphicsGL",f);var i=e.prototype;return i.setShader=function(t){this._saveToCmd(hn.context._setShader,[t])},i.setIBVB=function(t,e,i,n,r,a){this._saveToCmd(hn.context._setIBVB,[t,e,i,n,r,a])},i.drawParticle=function(t,e,i){var n=M.createParticleTemplate2D(i);n.x=t,n.y=e,this._saveToCmd(hn.context._drawParticle,[n])},e}(),jr=function(t){function d(t){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,d.__super.call(this),this._padding=d._PADDING,this._spacing=d._SPACING,this._aligns=d._ALIGNS,this._font=Wi.EMPTY,this._ower=t}E(d,"laya.display.css.CSSStyle",t);var e=d.prototype;return e.destroy=function(){this._ower=null,this._font=null,this._rect=null},e.inherit=function(t){this._font=t._font,this._spacing=t._spacing===d._SPACING?d._SPACING:t._spacing.slice(),this.lineHeight=t.lineHeight},e._widthAuto=function(){return 0!=(262144&this._type)},e.widthed=function(t){return 0!=(8&this._type)},e._calculation=function(t,e){if(e.indexOf("%")<0)return!1;var n=this._ower,r=n.parent,a=this._rect;function s(t,e,i){return t*i[0]+e*i[1]+i[2]}function i(t){var e=r.width,i=n.width;a.width&&(n.width=s(e,i,a.width)),a.height&&(n.height=s(e,i,a.height)),a.left&&(n.x=s(e,i,a.left)),a.top&&(n.y=s(e,i,a.top))}null===a&&(r._getCSSStyle()._type|=524288,r.on("resize",this,i),this._rect=a={input:{}});var o=e.split(" ");return o[0]=parseFloat(o[0])/100,1==o.length?o[1]=o[2]=0:(o[1]=parseFloat(o[1])/100,o[2]=parseFloat(o[2])),a[t]=o,a.input[t]=e,i(),!0},e.heighted=function(t){return 0!=(8192&this._type)},e.size=function(t,e){var i=this._ower,n=!1;-1!==t&&t!=this._ower.width&&(this._type|=8,this._ower.width=t,n=!0),-1!==e&&e!=this._ower.height&&(this._type|=8192,this._ower.height=e,n=!0),n&&(i._layoutLater(),524288&this._type&&i.event("resize",this))},e._getAlign=function(){return this._aligns[0]},e._getValign=function(){return this._aligns[1]},e._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},e._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new Wi(this._font))},e.render=function(t,e,i,n){var r=t.width,a=t.height;i-=t.pivotX,n-=t.pivotY,this._bgground&&null!=this._bgground.color&&e.ctx.fillRect(i,n,r,a,this._bgground.color),this._border&&this._border.color&&e.drawRect(i,n,r,a,this._border.color.strColor,this._border.size)},e.getCSSStyle=function(){return this},e.cssText=function(t){this.attrs(d.parseOneCSS(t,";"))},e.attrs=function(t){if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];this[n[0]]=n[1]}},e.setTransform=function(t){"none"===t?this._tf=Gi._TF_EMPTY:this.attrs(d.parseOneCSS(t,","))},e.translate=function(t,e){this._tf===Gi._TF_EMPTY&&(this._tf=new Ui),this._tf.translateX=t,this._tf.translateY=e},e.scale=function(t,e){this._tf===Gi._TF_EMPTY&&(this._tf=new Ui),this._tf.scaleX=t,this._tf.scaleY=e},e._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},v(0,e,"block",t.prototype._$get_block,function(t){t?this._type|=1:this._type&=-2}),v(0,e,"valign",function(){return d._valigndef[this._aligns[1]]},function(t){this._aligns===d._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=d._valigndef[t]}),v(0,e,"height",null,function(t){if(this._type|=8192,"string"==typeof t){if(this._calculation("height",t))return;t=parseInt(t)}this.size(-1,t)}),v(0,e,"width",null,function(t){if(this._type|=8,"string"==typeof t){var e=t.indexOf("auto");if(0<=e&&(this._type|=262144,t=t.substr(0,e)),this._calculation("width",t))return;t=parseInt(t)}this.size(t,-1)}),v(0,e,"fontWeight",function(){return this._font.weight},function(t){this._createFont().weight=t}),v(0,e,"left",null,function(t){var e=this._ower;if("string"==typeof t){if("center"===t?t="50% -50% 0":"right"===t&&(t="100% -100% 0"),this._calculation("left",t))return;t=parseInt(t)}e.x=t}),v(0,e,"_translate",null,function(t){this.translate(t[0],t[1])}),v(0,e,"absolute",function(){return 0!=(4&this._type)}),v(0,e,"top",null,function(t){var e=this._ower;if("string"==typeof t){if("middle"===t?t="50% -50% 0":"bottom"===t&&(t="100% -100% 0"),this._calculation("top",t))return;t=parseInt(t)}e.y=t}),v(0,e,"align",function(){return d._aligndef[this._aligns[0]]},function(t){this._aligns===d._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=d._aligndef[t]}),v(0,e,"bold",function(){return this._font.bold},function(t){this._createFont().bold=t}),v(0,e,"padding",function(){return this._padding},function(t){this._padding=t}),v(0,e,"leading",function(){return this._spacing[1]},function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===d._SPACING&&(this._spacing=[0,0]),this._spacing[1]=t}),v(0,e,"lineElement",function(){return 0!=(65536&this._type)},function(t){t?this._type|=65536:this._type&=-65537}),v(0,e,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(t){this.lineElement=!1,"right"===t?this._type|=32768:this._type&=-32769}),v(0,e,"textDecoration",function(){return this._font.decoration},function(t){this._createFont().decoration=t}),v(0,e,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(t){"nowrap"===t&&(this._type|=131072),"none"===t&&(this._type&=-131073)}),v(0,e,"background",null,function(t){t?(this._bgground||(this._bgground={}),this._bgground.color=t,this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),v(0,e,"wordWrap",function(){return 0==(131072&this._type)},function(t){t?this._type&=-131073:this._type|=131072}),v(0,e,"color",function(){return this._font.color},function(t){this._createFont().color=t}),v(0,e,"password",function(){return this._font.password},function(t){this._createFont().password=t}),v(0,e,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(t){"none"===t?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=t),this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._ower._renderType|=256}),v(0,e,"font",function(){return this._font.toString()},function(t){this._createFont().set(t)}),v(0,e,"weight",null,function(t){this._createFont().weight=t}),v(0,e,"letterSpacing",function(){return this._spacing[0]},function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===d._SPACING&&(this._spacing=[0,0]),this._spacing[0]=t}),v(0,e,"fontSize",function(){return this._font.size},function(t){this._createFont().size=t}),v(0,e,"italic",function(){return this._font.italic},function(t){this._createFont().italic=t}),v(0,e,"fontFamily",function(){return this._font.family},function(t){this._createFont().family=t}),v(0,e,"stroke",function(){return this._font.stroke[0]},function(t){this._createFont().stroke===Wi._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=t}),v(0,e,"strokeColor",function(){return this._font.stroke[1]},function(t){this._createFont().stroke===Wi._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=t}),v(0,e,"border",function(){return this._border?this._border.value:""},function(t){if("none"!=t){this._border||(this._border={});var e=(this._border.value=t).split(" ");if(this._border.color=Tn.create(e[e.length-1]),1==e.length)return this._border.size=1,void(this._border.type="solid");var i=0;0<e[0].indexOf("px")?(this._border.size=parseInt(e[0]),i++):this._border.size=1,this._border.type=e[i],this._ower._renderType|=256}else this._border=null}),v(0,e,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(t){t?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==t?null:Tn.create(t),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),v(0,e,"position",function(){return 4&this._type?"absolute":""},function(t){"absolute"==t?this._type|=4:this._type&=-5}),v(0,e,"display",null,function(t){switch(t){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),v(0,e,"paddingLeft",function(){return this.padding[3]}),v(0,e,"paddingTop",function(){return this.padding[0]}),v(0,e,"_scale",null,function(t){this._ower.scale(t[0],t[1])}),v(0,e,"_rotate",null,function(t){this._ower.rotation=t}),d.parseOneCSS=function(t,e){for(var i,n=[],r=t.split(e),a=0,s=r.length;a<s;a++){var o=r[a],l=o.indexOf(":"),h=o.substr(0,l).replace(/^\s+|\s+$/g,"");if(0!=h.length){var u=o.substr(l+1).replace(/^\s+|\s+$/g,""),c=[h,u];switch(h){case"italic":case"bold":c[1]="true"==u;break;case"line-height":c[0]="lineHeight",c[1]=parseInt(u);break;case"font-size":c[0]="fontSize",c[1]=parseInt(u);break;case"padding":1<(i=u.split(" ")).length||(i[1]=i[2]=i[3]=i[0]),c[1]=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3])];break;case"rotate":c[0]="_rotate",c[1]=parseFloat(u);break;case"scale":i=u.split(" "),c[0]="_scale",c[1]=[parseFloat(i[0]),parseFloat(i[1])];break;case"translate":i=u.split(" "),c[0]="_translate",c[1]=[parseInt(i[0]),parseInt(i[1])];break;default:(c[0]=d._CSSTOVALUE[h])||(c[0]=h)}n.push(c)}}return n},d.parseCSS=function(t,e){for(var i;null!=(i=d._parseCSSRegExp.exec(t));)d.styleSheets[i[1]]=d.parseOneCSS(i[2],";")},d.EMPTY=new d(null),d._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},d._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),d._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},d._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},d.styleSheets={},d.ALIGN_CENTER=1,d.ALIGN_RIGHT=2,d.VALIGN_MIDDLE=1,d.VALIGN_BOTTOM=2,d._CSS_BLOCK=1,d._DISPLAY_NONE=2,d._ABSOLUTE=4,d._WIDTH_SET=8,d._PADDING=[0,0,0,0],d._RECT=[-1,-1,-1,-1],d._SPACING=[0,0],d._ALIGNS=[0,0,0],d.ADDLAYOUTED=512,d._NEWFONT=4096,d._HEIGHT_SET=8192,d._BACKGROUND_SET=16384,d._FLOAT_RIGHT=32768,d._LINE_ELEMENT=65536,d._NOWARP=131072,d._WIDTHAUTO=262144,d._LISTERRESZIE=524288,d}(Gi),Jr=function(t){function r(t){r.__super.call(this),t||(t=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var e=0,i=0,n=0;n<20;n++)n%5!=4?this._mat[e++]=t[n]:this._alpha[i++]=t[n];this._action=M.createFilterAction(32),this._action.data=this}E(r,"laya.filters.ColorFilter",zi);var e=r.prototype;return S.imps(e,{"laya.filters.IFilter":!0}),e.callNative=function(t){t._$P.cf=this;t.conchModel&&t.conchModel.setFilterMatrix&&t.conchModel.setFilterMatrix(this._mat,this._alpha)},v(0,e,"type",function(){return 32}),v(0,e,"action",function(){return this._action}),r}(),Kr=function(t){function e(){this.data=null,e.__super.call(this)}E(e,"laya.filters.webgl.ColorFilterActionGL",Ji);var i=e.prototype;return S.imps(i,{"laya.filters.IFilterActionGL":!0}),i.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},i.apply3d=function(t,e,i,n,r){var a=t.getValue("bounds"),s=Qr.create(1,0);s.setFilters([this.data]);var o=tn.TEMP;o.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,o,"src",s)},e}(),Qr=(function(t){function e(){e.__super.call(this)}E(e,"laya.ui.UIEvent",ki),e.SHOW_TIP="showtip",e.HIDE_TIP="hidetip"}(),function(t){function n(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,n.__super.call(this),this.defines=new ea,this.position=n._POSITION,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=n._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=n._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}E(n,"laya.webgl.shader.d2.value.Value2D",ln);var e=n.prototype;return e.setValue=function(t){},e.refresh=function(){var t=this.size;return t[0]=fr.width,t[1]=fr.height,this.alpha=this.ALPHA*fr.worldAlpha,this.mmat=fr.worldMatrix4,this},e._ShaderWithCompile=function(){return ks.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,wo.create)},e._withWorldShaderDefines=function(){var t=fr.worldShaderDefines,e=ks.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,n={};for(i in this.defines.toNameDic())n[i]="";for(i in t.toNameDic())n[i]="";e=ks.withCompile2D(0,this.mainID,n,this.mainID|this.defines._value|t.getValue(),wo.create)}var r=fr.worldFilters;if(!r)return e;for(var a,s=r.length,o=0;o<s;o++)(a=r[o])&&a.action.setValue(this);return e},e.upload=function(){var t=fr;this.alpha=this.ALPHA*t.worldAlpha,fr.worldMatrix4!==fr.TEMPMAT4_ARRAY&&this.defines.add(128),mr.shaderHighPrecision&&this.defines.add(1024);var e,i=t.worldShaderDefines?this._withWorldShaderDefines():ks.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=t.width,this.size[1]=t.height,this.mmat=t.worldMatrix4,Pa.activeShader!==i?i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick2||i._make2dQuick2():i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick1||i._make2dQuick1(),i.upload(this,e)},e.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,n=0;n<i;n++)(e=t[n])&&(this.defines.add(e.type),e.action.setValue(this))},e.clear=function(){this.defines.setValue(this.subID)},e.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.clear()},n._initone=function(t,e){n._typeClass[t]=e,n._cache[t]=[],n._cache[t]._length=0},n.__init__=function(){n._POSITION=[2,5126,!1,4*cr.BYTES_PE,0],n._TEXCOORD=[2,5126,!1,4*cr.BYTES_PE,2*cr.BYTES_PE],n._initone(2,ja),n._initone(4,Qa),n._initone(256,Ja),n._initone(512,za),n._initone(1,Ka),n._initone(65,$s),n._initone(9,Ka)},n.create=function(t,e){var i=n._cache[t|e];return i._length?i[--i._length]:new n._typeClass[t|e](e)},n._POSITION=null,n._TEXCOORD=null,n._cache=[],n._typeClass=[],n.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n}()),qr=function(t){var i;function G(t){this._x=0,this._y=0,this._id=++G._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,G.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=G.MAXCLIPRECT,this.mOutPoint,this._canvas=t,G._contextcount++,hn.isFlash?(this._ib=Io.create(35044),dr.fillIBQuadrangle(this._ib,16)):this._ib=Io.QuadrangleIB,this.clear()}E(G,"laya.webgl.canvas.WebGLContext2D",dn);var e=G.prototype;return e.setIsMainContext=function(){this._isMain=!0},e.clearBG=function(t,e,i,n){var r=mr.mainContext;r.clearColor(t,e,i,n),r.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},e.destroy=function(){--G._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas=null,this._ib&&this._ib!=Io.QuadrangleIB&&this._ib.releaseResource()},e.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=tn.create(),this._vb=Mo.create(-1),this._submits=[],this._save=[Hn.Create(this)],this._save.length=10,this._shader2D=new jn,this._triangleMesh=oa.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=i.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=G.MAXCLIPRECT,this._curSubmit=er.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=Gn.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){if(this._width!=t||this._height!=e)if(0==t||0==e){0!=this._vb._byteLength&&(this._width=t,this._height=e,this._vb.clear(),this._vb.upload());for(var i=0,n=this._submits._length;i<n;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas.memorySize-=this._canvas.memorySize;0===t&&0===e&&this._releaseMem()},e._getTransformMatrix=function(){return this._curMat},e.translate=function(t,e){0===t&&0===e||(Yn.save(this),this._curMat.bTransform&&(Xn.save(this),this._curMat.transformPointN(en.TEMP.setTo(t,e)),t=en.TEMP.x,e=en.TEMP.y),this._x+=t,this._y+=e)},e.save=function(){this._save[this._save._length++]=Hn.Create(this)},e.restore=function(){var t=this._save._length;if(!(t<1))for(var e=t-1;0<=e;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},e._fillText=function(t,e,i,n,r,a,s,o,l,h){void 0===h&&(h=0);var u=this._shader2D,c=this._curSubmit.shaderValue,d=r?ur.create(r):this._other.font;if(Fn.enabled)u.ALPHA!==c.ALPHA&&(u.glTexture=null),hr.drawText(this,t,e,this._curMat,d,l||this._other.textAlign,a,s,o,i,n,h);else{this._shader2D.defines.getValue();var _=a?Tn.create(a)._color:u.colorAdd;u.ALPHA===c.ALPHA&&_===u.colorAdd&&c.colorAdd===u.colorAdd||(u.glTexture=null,u.colorAdd=_),hr.drawText(this,t,e,this._curMat,d,l||this._other.textAlign,a,s,o,i,n,h)}},e.fillWords=function(t,e,i,n,r,a){this._fillText(null,t,e,i,n,r,null,-1,null,a)},e.fillBorderWords=function(t,e,i,n,r,a,s){this._fillBorderText(null,t,e,i,n,r,a,s,null)},e.fillText=function(t,e,i,n,r,a){this._fillText(t,null,e,i,n,r,null,-1,a)},e.strokeText=function(t,e,i,n,r,a,s){this._fillText(t,null,e,i,n,null,r,a||1,s)},e.fillBorderText=function(t,e,i,n,r,a,s,o){this._fillBorderText(t,null,e,i,n,r,a,s,o)},e._fillBorderText=function(t,e,i,n,r,a,s,o,l){if(!Fn.enabled)return this._fillText(t,e,i,n,r,null,s,o||1,l),void this._fillText(t,e,i,n,r,a,null,-1,l);var h=this._shader2D,u=this._curSubmit.shaderValue;h.ALPHA!==u.ALPHA&&(h.glTexture=null);var c=r?(G._fontTemp.setFont(r),G._fontTemp):this._other.font;hr.drawText(this,t,e,this._curMat,c,l||this._other.textAlign,a,s,o||1,i,n,0)},e.fillRect=function(t,e,i,n,r){var a=this._vb;if(dr.fillRectImgVb(a,this._clipRect,t,e,i,n,Hr.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var s=this._shader2D.fillStyle;r&&(this._shader2D.fillStyle=Gn.create(r));var o=this._shader2D,l=this._curSubmit.shaderValue;if(o.fillStyle!==l.fillStyle||o.ALPHA!==l.ALPHA){o.glTexture=null;var h=this._curSubmit=er.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,Qr.create(2,0));h.shaderValue.color=o.fillStyle._color._color,h.shaderValue.ALPHA=o.ALPHA,this._submits[this._submits._length++]=h}this._curSubmit._numEle+=6,this._shader2D.fillStyle=s}},e.fillTexture=function(t,e,i,n,r,a,s,o){if(t.loaded&&t.bitmap&&t.source){var l=this._vb,h=t.bitmap.width,u=t.bitmap.height,c=t.uv,d=s.x%t.width,_=s.y%t.height;if(h!=o.w||u!=o.h){if(!o.w&&!o.h)switch(o.oy=o.ox=0,a){case"repeat":o.width=n,o.height=r;break;case"repeat-x":o.width=n,_<0?t.height+_>r?o.height=r:o.height=t.height+_:(o.oy=_,t.height+_>r?o.height=r-_:o.height=t.height);break;case"repeat-y":d<0?t.width+d>n?o.width=n:o.width=t.width+d:(o.ox=d,t.width+d>n?o.width=n-d:o.width=t.width),o.height=r;break;case"no-repeat":d<0?t.width+d>n?o.width=n:o.width=t.width+d:(o.ox=d,t.width+d>n?o.width=n-d:o.width=t.width),_<0?t.height+_>r?o.height=r:o.height=t.height+_:(o.oy=_,t.height+_>r?o.height=r-_:o.height=t.height);break;default:o.width=n,o.height=r}o.w=h,o.h=u,o.uv=[0,0,o.width/h,0,o.width/h,o.height/u,0,o.height/u]}if(e+=o.ox,i+=o.oy,d-=o.ox,_-=o.oy,dr.fillRectImgVb(l,this._clipRect,e,i,o.width,o.height,o.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var f=sa.create(this,this._ib,l,(l._byteLength-64)/32*3,Qr.create(256,0)),m=(this._submits[this._submits._length++]=f).shaderValue;m.textureHost=t;var p=c[0]*h,g=c[1]*u,v=(c[2]-c[0])*h,y=(c[5]-c[3])*u,x=-d/h,b=-_/u;m.u_TexRange[0]=p/h,m.u_TexRange[1]=v/h,m.u_TexRange[2]=g/u,m.u_TexRange[3]=y/u,m.u_offset[0]=x,m.u_offset[1]=b,Fn.enabled&&!this._isMain&&f.addTexture(t,(l._byteLength>>2)-16),(this._curSubmit=f)._renderType=10017,f._numEle+=6}}else this.sprite&&S.timer.callLater(this,this._repaintSprite)},e.setShader=function(t){Un.save(this,1048576,this._shader2D,!0),this._shader2D.shader=t},e.setFilters=function(t){Un.save(this,2097152,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=er.RENDERBASE,this._renderKey=0,this._drawCount++},e.drawTexture=function(t,e,i,n,r,a,s){this._drawTextureM(t,e,i,n,r,a,s,null,1)},e.addTextureVb=function(t,e,i){var n=this._curSubmit._vb||this._vb,r=n._byteLength>>2;n.byteLength=r+16<<2;for(var a=n.getFloat32Array(),s=0;s<16;s+=4)a[r++]=t[s]+e,a[r++]=t[s+1]+i,a[r++]=t[s+2],a[r++]=t[s+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),n._upload=!0},e.willDrawTexture=function(t,e){if(!(t.loaded&&t.bitmap&&t.source))return this.sprite&&S.timer.callLater(this,this._repaintSprite),0;var i=t.bitmap,n=i.id+this._shader2D.ALPHA*e+10016;if(n==this._renderKey)return n;var r=this._shader2D,a=r.ALPHA,s=this._curSubmit.shaderValue;r.ALPHA*=e,this._renderKey=n,this._drawCount++,r.glTexture=i;var o=this._vb,l=null,h=o._byteLength/32*3;return l=sa.create(this,this._ib,o,h,Qr.create(1,0)),(this._submits[this._submits._length++]=l).shaderValue.textureHost=t,l._renderType=10016,l._preIsSameTextureShader=10016===this._curSubmit._renderType&&r.ALPHA===s.ALPHA,this._curSubmit=l,r.ALPHA=a,n},e.drawTextures=function(t,e,i,n){if(t.loaded&&t.bitmap&&t.source){var r=this._clipRect;if(this._clipRect=G.MAXCLIPRECT,this._drawTextureM(t,e[0],e[1],t.width,t.height,i,n,null,1)){if(this._clipRect=r,Cn.drawCall++,!(e.length<4)){for(var a=this._curSubmit._vb||this._vb,s=this._curMat.a,o=this._curMat.d,l=2,h=e.length;l<h;l+=2)dr.copyPreImgVb(a,(e[l]-e[l-2])*s,(e[l+1]-e[l-1])*o),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&S.timer.callLater(this,this._repaintSprite)},e._drawTextureM=function(t,e,i,n,r,a,s,o,l){if(!t.loaded||!t.source)return this.sprite&&S.timer.callLater(this,this._repaintSprite),!1;var h=this._curSubmit._vb||this._vb,u=t.bitmap;e+=a,i+=s,this._drawCount++;var c=u.id+this._shader2D.ALPHA*l+10016;if(c!=this._renderKey){this._renderKey=c;var d=this._curSubmit.shaderValue,_=this._shader2D,f=_.ALPHA;_.ALPHA*=l,_.glTexture=u;var m=this._vb,p=null,g=m._byteLength/32*3;p=sa.create(this,this._ib,m,g,Qr.create(1,0)),(this._submits[this._submits._length++]=p).shaderValue.textureHost=t,p._renderType=10016,p._preIsSameTextureShader=10016===this._curSubmit._renderType&&_.ALPHA===d.ALPHA,this._curSubmit=p,h=this._curSubmit._vb||this._vb,_.ALPHA=f}return!!dr.fillRectImgVb(h,this._clipRect,e,i,n||t.width,r||t.height,t.uv,o||this._curMat,this._x,this._y,0,0)&&(Fn.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(h._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e._drawText=function(t,e,i,n,r,a,s,o,l,h){var u=t.bitmap;this._drawCount++;var c=u.id+this._shader2D.ALPHA+10016;if(c!=this._renderKey){this._renderKey=c;var d=this._curSubmit.shaderValue,_=this._shader2D;_.glTexture=u;var f=this._vb,m=null,p=f._byteLength/32*3;(m=Fn.enabled?sa.create(this,this._ib,f,p,Qr.create(1,0)):sa.create(this,this._ib,f,p,$s.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&_.ALPHA===d.ALPHA,(this._submits[this._submits._length++]=m).shaderValue.textureHost=t,m._renderType=10016,this._curSubmit=m}t.active();var g=this._curSubmit._vb||this._vb;dr.fillRectImgVb(g,this._clipRect,e+s,i+o,n||t.width,r||t.height,t.uv,a||this._curMat,this._x,this._y,l,h,!0)&&(Fn.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(g._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},e.drawTextureWithTransform=function(t,e,i,n,r,a,s,o,l){if(a){var h=this._curMat,u=this._x,c=this._y;(0!==s||0!==o)&&(this._x=s*h.a+o*h.c,this._y=o*h.d+s*h.b),a&&h.bTransform?(tn.mul(a,h,G._tmpMatrix),(a=G._tmpMatrix)._checkTransform()):(this._x+=h.tx,this._y+=h.ty),this._drawTextureM(t,e,i,n,r,0,0,a,l),this._x=u,this._y=c}else this._drawTextureM(t,e,i,n,r,s,o,null,l)},e.fillQuadrangle=function(t,e,i,n,r){var a=this._curSubmit,s=this._vb,o=this._shader2D,l=a.shaderValue;if(this._renderKey=0,t.bitmap){var h=t.bitmap;o.glTexture==h&&o.ALPHA===l.ALPHA||(o.glTexture=h,(a=this._curSubmit=er.createSubmit(this,this._ib,s,s._byteLength/32*3,Qr.create(1,0))).shaderValue.glTexture=h,this._submits[this._submits._length++]=a),dr.fillQuadrangleImgVb(s,e,i,n,t.uv,r||this._curMat,this._x,this._y)}else a.shaderValue.fillStyle&&a.shaderValue.fillStyle.equal(t)&&o.ALPHA===l.ALPHA||(o.glTexture=null,(a=this._curSubmit=er.createSubmit(this,this._ib,s,s._byteLength/32*3,Qr.create(2,0))).shaderValue.defines.add(2),a.shaderValue.fillStyle=Gn.create(t),this._submits[this._submits._length++]=a),dr.fillQuadrangleImgVb(s,e,i,n,Hr.DEF_UV,r||this._curMat,this._x,this._y);a._numEle+=6},e.drawTexture2=function(t,e,i,n,r,a,s,o){if(0!=a){var l=this._curMat;if(this._x=t*l.a+e*l.c,this._y=e*l.d+t*l.b,r&&(r=l.bTransform||r.bTransform?(tn.mul(r,l,G._tmpMatrix),G._tmpMatrix):(this._x+=r.tx+l.tx,this._y+=r.ty+l.ty,tn.EMPTY)),1!==a||s){var h=this._shader2D.ALPHA,u=this._nBlendType;this._shader2D.ALPHA=a,s&&(this._nBlendType=Bn.TOINT(s)),this._drawTextureM(o[0],o[1]-i,o[2]-n,o[3],o[4],0,0,r,1),this._shader2D.ALPHA=h,this._nBlendType=u}else this._drawTextureM(o[0],o[1]-i,o[2]-n,o[3],o[4],0,0,r,1);this._x=this._y=0}},e.drawCanvas=function(t,e,i,n,r){var a=t.context;if(this._renderKey=0,a._targets)this._submits[this._submits._length++]=aa.create(a,0,null),this._curSubmit=er.RENDERBASE,a._targets.drawTo(this,e,i,n,r);else{var s=this._submits[this._submits._length++]=aa.create(a,this._shader2D.ALPHA,this._shader2D.filters),o=n/t.width,l=r/t.height,h=s._matrix;this._curMat.copyTo(h),1!=o&&1!=l&&h.scale(o,l);var u=h.tx,c=h.ty;h.tx=h.ty=0,h.transformPoint(en.TEMP.setTo(e,i)),h.translate(en.TEMP.x+u,en.TEMP.y+c),this._curSubmit=er.RENDERBASE}T.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=a._targets?"yellow":"green",this.strokeRect(e-1,i-1,n+2,r+2,1),this.strokeRect(e,i,n,r,1),this.restore())},e.drawTarget=function(t,e,i,n,r,a,s,o,l,h){void 0===h&&(h=-1);var u=this._vb;if(dr.fillRectImgVb(u,this._clipRect,e,i,n,r,l||Hr.DEF_UV,a||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var c=this._curSubmit=or.create(this,this._ib,u,(u._byteLength-64)/32*3,o,s);c.blendType=-1==h?this._nBlendType:h,c.scope=t,this._submits[this._submits._length++]=c,this._curSubmit._numEle+=6}},e.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},e.drawTriangles=function(t,e,i,n,r,a,s,o,l,h){if(!t.loaded||!t.source)return this.sprite&&S.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;t.bitmap;var u=this._mixRGBandAlpha(4294967295,o),c=(n.length,a.length);this._renderKey=-1;var d=this._curSubmit=sa.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,Qr.create(1,0));return d.shaderValue.textureHost=t,d._renderType=10016,this._submits[this._submits._length++]=d,s?(G._tmpMatrix.a=s.a,G._tmpMatrix.b=s.b,G._tmpMatrix.c=s.c,G._tmpMatrix.d=s.d,G._tmpMatrix.tx=s.tx+e,G._tmpMatrix.ty=s.ty+i,tn.mul(G._tmpMatrix,this._curMat,G._tmpMatrix)):(G._tmpMatrix.a=this._curMat.a,G._tmpMatrix.b=this._curMat.b,G._tmpMatrix.c=this._curMat.c,G._tmpMatrix.d=this._curMat.d,G._tmpMatrix.tx=this._curMat.tx+e,G._tmpMatrix.ty=this._curMat.ty+i),this._triangleMesh.addData(n,r,a,G._tmpMatrix,u,this),this._curSubmit._numEle+=c,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},e.transform=function(t,e,i,n,r,a){Xn.save(this),tn.mul(tn.TEMP.setTo(t,e,i,n,r,a),this._curMat,this._curMat),this._curMat._checkTransform()},e.setTransformByMatrix=function(t){t.copyTo(this._curMat)},e.transformByMatrix=function(t){Xn.save(this),tn.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},e.rotate=function(t){Xn.save(this),this._curMat.rotateEx(t)},e.scale=function(t,e){Xn.save(this),this._curMat.scaleEx(t,e)},e.clipRect=function(t,e,i,n){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var r=sr.create(4);this.addRenderObject(r);var a=this._vb,s=a._byteLength>>2;if(dr.fillRectImgVb(a,null,t,e,i,n,Hr.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var o=this._curSubmit=er.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,Qr.create(2,0));o.shaderValue.ALPHA=1,this._submits[this._submits._length++]=o,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var l=sr.create(5);this.addRenderObject(l);var h=a.getFloat32Array(),u=Math.min(Math.min(Math.min(h[s+0],h[s+4]),h[s+8]),h[s+12]),c=Math.max(Math.max(Math.max(h[s+0],h[s+4]),h[s+8]),h[s+12]),d=Math.min(Math.min(Math.min(h[s+1],h[s+5]),h[s+9]),h[s+13]),_=Math.max(Math.max(Math.max(h[s+1],h[s+5]),h[s+9]),h[s+13]);kn.save(this,l,t,e,i,n,u,d,c-u,_-d),this._curSubmit=er.RENDERBASE}else{i*=this._curMat.a,n*=this._curMat.d;var f=en.TEMP;this._curMat.transformPoint(f.setTo(t,e)),i<0&&(f.x=f.x+i,i=-i),n<0&&(f.y=f.y+n,n=-n),this._renderKey=0;var m=this._curSubmit=ar.create(this);(this._submits[this._submits._length++]=m).submitIndex=this._submits._length,m.submitLength=9999999,Zn.save(this,m);var p=this._clipRect,g=p.x,v=p.y,y=f.x+i,x=f.y+n;g<f.x&&(p.x=f.x),v<f.y&&(p.y=f.y),p.width=Math.min(y,g+p.width)-p.x,p.height=Math.min(x,v+p.height)-p.y,this._shader2D.glTexture=null,m.clipRect.copyFrom(p),this._curSubmit=er.RENDERBASE}},e.setIBVB=function(t,e,i,n,r,a,s,o,l,h,u){if(void 0===l&&(l=0),void 0===h&&(h=0),void 0===u&&(u=0),null===i){if(hn.isFlash){var c=n;c._selfIB||(c._selfIB=Io.create(35044)),c._selfIB.clear(),i=c._selfIB}else i=this._ib;dr.expandIBQuadrangle(i,n._byteLength/(4*n.vertexStride*4))}if(!o||!s)throw Error("setIBVB must input:shader shaderValues");var d=rr.create(this,n,i,r,s,o,l,h,u);a||(a=tn.EMPTY),a.translate(t,e),tn.mul(a,this._curMat,d._mat),a.translate(-t,-e),this._submits[this._submits._length++]=d,this._curSubmit=er.RENDERBASE,this._renderKey=0},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.fillTrangles=function(t,e,i,n,r){var a=this._curSubmit,s=this._vb,o=this._shader2D,l=a.shaderValue,h=n.length>>4,u=t.bitmap;this._renderKey=0,o.glTexture==u&&o.ALPHA===l.ALPHA||((a=this._curSubmit=er.createSubmit(this,this._ib,s,s._byteLength/32*3,Qr.create(1,0))).shaderValue.textureHost=t,this._submits[this._submits._length++]=a),dr.fillTranglesVB(s,e,i,n,r||this._curMat,this._x,this._y),a._numEle+=6*h},e.submitElement=function(t,e){var i=this._submits;for(e<0&&(e=i._length);t<e;)t+=i[t].renderSubmit()},e.finish=function(){mr.mainContext.finish()},e.flush=function(){var t=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(t>this._ib.bufferLength/12&&dr.expandIBQuadrangle(this._ib,t),!this._isMain&&Fn.enabled&&Fn._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=Fn._atlasRestore;for(var e=this._submits,i=0,n=e._length;i<n;i++){var r=e[i];10016===r.getRenderType()&&r.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),Qn.instance&&Qn.getInstance().reset();var a;for(i=0,a=this.meshlist.length;i<a;i++){var s=this.meshlist[i];s.canReuse?s.releaseMesh():s.destroy()}return this.meshlist.length=0,this._curSubmit=er.RENDERBASE,this._renderKey=0,this._triangleMesh=oa.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},e.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=Ln.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},e.movePath=function(t,e){var i=t,n=e;t=this._curMat.a*i+this._curMat.c*n+this._curMat.tx,e=this._curMat.b*i+this._curMat.d*n+this._curMat.ty,this.mX+=t,this.mY+=e},e.beginPath=function(){var t=this._getPath();t.tempArray.length=0,t.closePath=!1,this.mX=0,this.mY=0},e.closePath=function(){this._path.closePath=!0},e.fill=function(t){void 0===t&&(t=!1);var e=this._getPath();this.drawPoly(0,0,e.tempArray,this.fillStyle._color.numColor,0,0,t)},e.stroke=function(){var t=this._getPath();if(0<this.lineWidth){if(-1==this.mId)t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var e=Ln.getInstance().shapeLineDic[this.mId];e.rebuild(t.tempArray),t.setGeomtry(e)}else Ln.getInstance().addLine(this.mId,t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor));t.update();var i=[this.mX,this.mY],n=er.createShape(this,t.ib,t.vb,t.count,t.offset,Qr.create(4,0));n.shaderValue.ALPHA=this._shader2D.ALPHA,n.shaderValue.u_pos=i,n.shaderValue.u_mmat2=fr.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=n,this._renderKey=-1}},e.line=function(t,e,i,n,r,a){var s=this._curSubmit,o=this._vb;if(dr.fillLineVb(o,this._clipRect,t,e,i,n,r,a)){this._renderKey=0;var l=this._shader2D,h=s.shaderValue;l.strokeStyle===h.strokeStyle&&l.ALPHA===h.ALPHA||(l.glTexture=null,(s=this._curSubmit=er.createSubmit(this,this._ib,o,(o._byteLength-64)/32*3,Qr.create(2,0))).shaderValue.strokeStyle=l.strokeStyle,s.shaderValue.mainID=2,s.shaderValue.ALPHA=l.ALPHA,this._submits[this._submits._length++]=s),s._numEle+=6}},e.moveTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a,e=this._curMat.b*r+this._curMat.d*a}n.addPoint(t,e)},e.lineTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a,e=this._curMat.b*r+this._curMat.d*a}n.addPoint(t,e)},e.drawCurves=function(t,e,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],this.movePath(t,e),this.moveTo(n[0],n[1]);for(var r=2,a=n.length;r<a;)this.quadraticCurveTo(n[r++],n[r++],n[r++],n[r++]);this.stroke()},e.arcTo=function(t,e,i,n,r){if(-1==this.mId||!this.mHaveKey){var a=0,s=0,o=0,l=this._getPath();this._curMat.copyTo(G._tmpMatrix),G._tmpMatrix.tx=G._tmpMatrix.ty=0,G._tempPoint.setTo(l.getEndPointX(),l.getEndPointY()),G._tmpMatrix.invertTransformPoint(G._tempPoint);var h=G._tempPoint.x-t,u=G._tempPoint.y-e,c=Math.sqrt(h*h+u*u);if(!(c<=1e-6)){var d=h/c,_=u/c,f=i-t,m=n-e,p=f*f+m*m,g=Math.sqrt(p);if(!(g<=1e-6)){var v=f/g,y=m/g,x=d+v,b=_+y,T=Math.sqrt(x*x+b*b);if(!(T<=1e-6)){var S=x/T,E=b/T,R=Math.acos(S*d+E*_),w=Math.PI/2-R,C=(c=r/Math.tan(w))*d+t,I=c*_+e,M=Math.sqrt(c*c+r*r),A=t+S*M,D=e+E*M,L=0,V=0;if(0<=d*y-_*v){var N=2*w/G.SEGNUM;L=Math.sin(N),V=Math.cos(N)}else N=2*-w/G.SEGNUM,L=Math.sin(N),V=Math.cos(N);s=this._curMat.a*C+this._curMat.c*I,o=this._curMat.b*C+this._curMat.d*I,s==this._path.getEndPointX()&&o==this._path.getEndPointY()||l.addPoint(s,o);var P=C-A,F=I-D;for(a=0;a<G.SEGNUM;a++){var O=P*V+F*L,B=-P*L+F*V;s=O+A,o=B+D,t=this._curMat.a*s+this._curMat.c*o,o=e=this._curMat.b*s+this._curMat.d*o,(s=t)==this._path.getEndPointX()&&o==this._path.getEndPointY()||l.addPoint(s,o),P=O,F=B}}}}}},e.arc=function(t,e,i,n,r,a,s){if(void 0===a&&(a=!1),void 0===s&&(s=!0),-1!=this.mId){var o=Ln.getInstance().shapeDic[this.mId];if(o&&this.mHaveKey&&!o.needUpdate(this._curMat))return;e=t=0}var l,h=0,u=0,c=0,d=0,_=0,f=0,m=0;if(u=r-n,a)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;l=u/(m=i<101?Math.max(10,u*i/5):i<201?Math.max(10,u*i/20):Math.max(10,u*i/40))/2,c=Math.abs(4/3*(1-Math.cos(l))/Math.sin(l)),a&&(c=-c);var p=this._getPath(),g=NaN,v=NaN;for(f=0;f<=m;f++)h=n+u*(f/m),d=t+Math.cos(h)*i,_=e+Math.sin(h)*i,s&&(g=d,v=_,d=this._curMat.a*g+this._curMat.c*v,_=this._curMat.b*g+this._curMat.d*v),d==this._path.getEndPointX()&&_==this._path.getEndPointY()||p.addPoint(d,_);d=t+Math.cos(r)*i,_=e+Math.sin(r)*i,s&&(g=d,v=_,d=this._curMat.a*g+this._curMat.c*v,_=this._curMat.b*g+this._curMat.d*v),d==this._path.getEndPointX()&&_==this._path.getEndPointY()||p.addPoint(d,_)},e.quadraticCurveTo=function(t,e,i,n){var r=Qi.I,a=i,s=n;i=this._curMat.a*a+this._curMat.c*s,n=this._curMat.b*a+this._curMat.d*s,a=t,s=e,t=this._curMat.a*a+this._curMat.c*s,e=this._curMat.b*a+this._curMat.d*s;for(var o=r.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),t,e,i,n],30,2),l=0,h=o.length/2;l<h;l++)this.lineTo(o[2*l],o[2*l+1],!1);this.lineTo(i,n,!1)},e.rect=function(t,e,i,n){this._other=this._other.make(),this._other.path||(this._other.path=new Wn),this._other.path.rect(t,e,i,n)},e.strokeRect=function(t,e,i,n,r){var a=.5*r;this.line(t-a,e,t+i+a,e,r,this._curMat),this.line(t+i,e,t+i,e+n,r,this._curMat),this.line(t,e,t,e+n,r,this._curMat),this.line(t-a,e+n,t+i+a,e+n,r,this._curMat)},e.clip=function(){},e.drawPoly=function(t,e,i,n,r,a,s){void 0===s&&(s=!1),this._renderKey=0,this._shader2D.glTexture=null;var o=this._getPath();if(-1==this.mId)o.polygon(t,e,i,n,r||1,a);else if(this.mHaveKey){var l=Ln.getInstance().shapeDic[this.mId];l.setMatrix(this._curMat),l.rebuild(o.tempArray),o.setGeomtry(l)}else{var h=o.polygon(t,e,i,n,r||1,a);Ln.getInstance().addShape(this.mId,h),h.setMatrix(this._curMat)}o.update();var u,c=[this.mX,this.mY];if((u=er.createShape(this,o.ib,o.vb,o.count,o.offset,Qr.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,u.shaderValue.u_pos=c,u.shaderValue.u_mmat2=fr.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=u,0<r){if(this.mHaveLineKey){var d=Ln.getInstance().shapeLineDic[this.mId];d.rebuild(o.tempArray),o.setGeomtry(d)}else Ln.getInstance().addShape(this.mId,o.drawLine(t,e,i,r,a));o.update(),(u=er.createShape(this,o.ib,o.vb,o.count,o.offset,Qr.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,u.shaderValue.u_mmat2=fr.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=u}},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new Wn)},v(0,e,"globalCompositeOperation",function(){return Bn.NAMES[this._nBlendType]},function(t){var e=Bn.TOINT[t];null==e||this._nBlendType===e||(Un.save(this,65536,this,!0),this._curSubmit=er.RENDERBASE,this._renderKey=0,this._nBlendType=e)}),v(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(Un.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=Gn.create(t))}),v(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(Un.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)}),v(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new zn),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),v(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(Un.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=Gn.create(t))}),v(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),Un.save(this,32768,this._other,!1),this._other.textAlign=t)}),v(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),Un.save(this,256,this._other,!1),this._other.lineWidth=t)}),v(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),Un.save(this,16384,this._other,!1),this._other.textBaseline=t)}),v(0,e,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),Un.save(this,8,this._other,!1),this._other.font===ur.EMPTY?this._other.font=new ur(t):this._other.font.setFont(t))}),G.__init__=function(){i.DEFAULT=new i},G._tempPoint=new en,G._SUBMITVBSIZE=32e3,G._MAXSIZE=99999999,G._RECTVBSIZE=16,G.MAXCLIPRECT=new nn(0,0,99999999,99999999),G._COUNT=0,G._tmpMatrix=new tn,G.SEGNUM=32,G._contextcount=0,m(G,["_fontTemp",function(){return this._fontTemp=new ur},"_drawStyleTemp",function(){return this._drawStyleTemp=new Gn(null)}]),G.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=ur.EMPTY}E(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=ur.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},G}(),$r=function(t){function p(t,e){p.__super.call(this,t,e)}E(p,"laya.webgl.utils.RenderSprite3D",cn);var e=p.prototype;return e.onCreate=function(t){switch(t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},e._mask=function(t,e,i,n){var r,a,s=this._next,o=t.mask;if(o){e.ctx.save();var l=e.ctx.globalCompositeOperation,h=new nn;if(h.copyFrom(o.getBounds()),h.width=Math.round(h.width),h.height=Math.round(h.height),h.x=Math.round(h.x),h.y=Math.round(h.y),0<h.width&&0<h.height){var u=t._style._tf,c=nr.create();c.addValue("bounds",h),r=ir.create([c,e],laya.webgl.utils.RenderSprite3D.tmpTarget),e.addRenderObject(r),o.render(e,-h.x,-h.y),r=ir.create([c],laya.webgl.utils.RenderSprite3D.endTmpTarget),e.addRenderObject(r),e.ctx.save(),e.clipRect(i-u.translateX+h.x,n-u.translateY+h.y,h.width,h.height),s._fun.call(s,t,e,i,n),e.ctx.restore(),a=sr.create(6),l=e.ctx.globalCompositeOperation,a.blendMode="mask",e.addRenderObject(a),tn.TEMP.identity();var d=Qr.create(1,0),_=Hr.INV_UV,f=h.width,m=h.height;(h.width<32||h.height<32)&&((_=p.tempUV)[0]=0,_[1]=0,_[2]=32<=h.width?1:h.width/32,_[3]=0,_[4]=32<=h.width?1:h.width/32,_[5]=32<=h.height?1:h.height/32,_[6]=0,_[7]=32<=h.height?1:h.height/32,h.width=32<=h.width?h.width:32,h.height=32<=h.height?h.height:32,_[1]*=-1,_[3]*=-1,_[5]*=-1,_[7]*=-1,_[1]+=1,_[3]+=1,_[5]+=1,_[7]+=1),e.ctx.drawTarget(c,i+h.x-u.translateX,n+h.y-u.translateY,f,m,tn.TEMP,"tmpTarget",d,_,6),r=ir.create([c],laya.webgl.utils.RenderSprite3D.recycleTarget),e.addRenderObject(r),(a=sr.create(6)).blendMode=l,e.addRenderObject(a)}e.ctx.restore()}else s._fun.call(s,t,e,i,n)},e._blend=function(t,e,i,n){var r=t._style,a=this._next;r.blendMode?(e.ctx.save(),e.ctx.globalCompositeOperation=r.blendMode,a._fun.call(a,t,e,i,n),e.ctx.restore()):a._fun.call(a,t,e,i,n)},e._transform=function(t,e,i,n){var r=t.transform,a=this._next;if(r&&a!=cn.NORENDER){var s=e.ctx;t._style;r.tx=i,r.ty=n;var o=s._getTransformMatrix(),l=o.clone();tn.mul(r,o,o),o._checkTransform(),r.tx=r.ty=0,a._fun.call(a,t,e,0,0),l.copyTo(o),l.destroy()}else a._fun.call(a,t,e,i,n)},p.tmpTarget=function(t,e){var i=t.getValue("bounds"),n=Ya.create(i.width,i.height);n.start(),n.clear(0,0,0,0),t.addValue("tmpTarget",n)},p.endTmpTarget=function(t){t.getValue("tmpTarget").end()},p.recycleTarget=function(t){t.getValue("tmpTarget").recycle(),t.recycle()},m(p,["tempUV",function(){return this.tempUV=new Array(8)}]),p}(),ta=function(t){function a(t,e,i,n,r){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,a.__super.call(this,t,e,r),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new js,(this._atlasCanvas._atlaser=this)._atlasCanvas.width=i,this._atlasCanvas.height=n,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}E(a,"laya.webgl.atlas.Atlaser",Pn);var e=a.prototype;return e.computeUVinAtlasTexture=function(t,e,i,n){var r=Fn.atlasTextureWidth,a=Fn.atlasTextureHeight,s=i/r,o=n/a,l=(i+t.bitmap.width)/r,h=(n+t.bitmap.height)/a,u=t.bitmap.width/r,c=t.bitmap.height/a;t.uv=[s+e[0]*u,o+e[1]*c,l-(1-e[2])*u,o+e[3]*c,l-(1-e[4])*u,h-(1-e[5])*c,s+e[6]*u,h-(1-e[7])*c]},e.findBitmapIsExist=function(t){if(t instanceof laya.webgl.resource.WebGLImage){var e=t,i=e.url,n=this._InAtlasWebGLImagesKey[i||e.id];if(n)return n.offsetInfoID}return-1},e.addToAtlasTexture=function(t,e,i){if(t instanceof laya.webgl.resource.WebGLImage){var n=t,r=n.url;this._InAtlasWebGLImagesKey[r||n.id]={bitmap:t,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([e,i])}this._atlasCanvas.texSubImage2D(e,i,t.atlasImgData||t.atlasSource),t.clearAtlasSource()},e.addToAtlas=function(t,e,i){t._atlasID=this._inAtlasTextureKey.length;var n=t.uv.slice(),r=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(n),this._inAtlasTextureBitmapValue.push(r),this.computeUVinAtlasTexture(t,n,e,i),t.bitmap=this._atlasCanvas},e.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t]._atlasID=-1,this._inAtlasTextureKey[t].bitmap.lock=!1,this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},e.dispose=function(){this.clear(),this._atlasCanvas.destroy()},v(0,e,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),v(0,e,"texture",function(){return this._atlasCanvas}),v(0,e,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),a}(),ea=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return E(i,"laya.webgl.shader.d2.ShaderDefines2D",Jn),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("COLOR2D",2),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64),i.reg("WORLDMAT",128),i.reg("FILLTEXTURE",256),i.reg("FSHIGHPRECISION",1024)},i.reg=function(t,e){Jn._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return Jn._toText(t,e,i)},i.toInt=function(t){return Jn._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.COLOR2D=2,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.WORLDMAT=128,i.FILLTEXTURE=256,i.SKINMESH=512,i.SHADERDEFINE_FSHIGHPRECISION=1024,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),ia=function(t){function a(t,e,i,n,r){this._points=[],this.rebuild(i),a.__super.call(this,t,e,0,0,0,r,n,r,0)}E(a,"laya.webgl.shapes.Line",qn);var e=a.prototype;return e.rebuild=function(t){var e=t.length;e!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(e/2-1)),this.mFloat32Array=new Float32Array(5*e)),this._points.length=0;for(var i=NaN,n=NaN,r=-1,a=-1,s=t.length/2,o=0;o<s;o++)i=t[2*o],n=t[2*o+1],(.01<Math.abs(r-i)||.01<Math.abs(a-n))&&this._points.push(i,n),r=i,a=n},e.getData=function(t,e,i){var n=[],r=[];0<this.borderWidth&&this.createLine2(this._points,n,this.borderWidth,i,r,this._points.length/2),this.mUint16Array.set(n,0),this.mFloat32Array.set(r,0),t.append(this.mUint16Array),e.append(this.mFloat32Array)},a}(),na=function(t){function c(t,e,i,n,r){this._points=[];for(var a=NaN,s=NaN,o=-1,l=-1,h=i.length/2-1,u=0;u<h;u++)a=i[2*u],s=i[2*u+1],(.01<Math.abs(o-a)||.01<Math.abs(l-s))&&this._points.push(a,s),o=a,l=s;a=i[2*h],s=i[2*h+1],o=this._points[0],l=this._points[1],(.01<Math.abs(o-a)||.01<Math.abs(l-s))&&this._points.push(a,s),c.__super.call(this,t,e,0,0,this._points.length/2,0,n,r)}E(c,"laya.webgl.shapes.LoopLine",qn);var e=c.prototype;return e.getData=function(t,e,i){if(0<this.borderWidth){for(var n=this.color,r=(n>>16&255)/255,a=(n>>8&255)/255,s=(255&n)/255,o=[],l=0,h=0,u=[],c=Math.floor(this._points.length/2),d=0;d<c;d++)l=this._points[2*d],h=this._points[2*d+1],o.push(this.x+l,this.y+h,r,a,s);this.createLoopLine(o,u,this.borderWidth,i+o.length/5),t.append(new Uint16Array(u)),e.append(new Float32Array(o))}},e.createLoopLine=function(t,e,i,n,r,a){t.length;var s=t.concat(),o=r||t,l=this.borderColor,h=(l>>16&255)/255,u=(l>>8&255)/255,c=(255&l)/255,d=[s[0],s[1]],_=[s[s.length-5],s[s.length-4]],f=_[0]+.5*(d[0]-_[0]),m=_[1]+.5*(d[1]-_[1]);s.unshift(f,m,0,0,0),s.push(f,m,0,0,0);var p,g,v,y,x,b,T,S,E,R,w,C,I,M,A,D,L,V,N,P,F=s.length/5,O=n,B=i/2;v=s[0],y=s[1],R=v-(x=s[5]),E=(E=-(y-(b=s[6])))/(P=Math.sqrt(E*E+R*R))*B,R=R/P*B,o.push(v-E,y-R,h,u,c,v+E,y+R,h,u,c);for(var G=1;G<F-1;G++)v=s[5*(G-1)],y=s[5*(G-1)+1],x=s[5*G],b=s[5*G+1],T=s[5*(G+1)],S=s[5*(G+1)+1],R=v-x,C=x-T,A=(-(E=(E=-(y-b))/(P=Math.sqrt(E*E+R*R))*B)+v)*(-(R=R/P*B)+b)-(-E+x)*(-R+y),V=(-(w=(w=-(b-S))/(P=Math.sqrt(w*w+C*C))*B)+T)*(-(C=C/P*B)+b)-(-w+x)*(-C+S),N=(I=-R+y-(-R+b))*(L=-w+x-(-w+T))-(D=-C+S-(-C+b))*(M=-E+x-(-E+v)),Math.abs(N)<.1?(N+=10.1,o.push(x-E,b-R,h,u,c,x+E,b+R,h,u,c)):(((p=(M*V-L*A)/N)-x)*(p-x)+((g=(D*A-I*V)/N)-b)+(g-b),o.push(p,g,h,u,c,x-(p-x),b-(g-b),h,u,c));a&&(e=a);var W=this.edges+1;for(G=1;G<W;G++)e.push(O+2*(G-1),O+2*(G-1)+1,O+2*G+1,O+2*G+1,O+2*G,O+2*(G-1));return e.push(O+2*(G-1),O+2*(G-1)+1,O+1,O+1,O,O+2*(G-1)),o},c}(),ra=function(t){function s(t,e,i,n,r,a){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=tn.create(),this._points=i.slice(0,i.length),s.__super.call(this,t,e,0,0,this._points.length/2,n,r,a)}E(s,"laya.webgl.shapes.Polygon",qn);var e=s.prototype;return e.rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},e.setMatrix=function(t){t.copyTo(this._mat)},e.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},e.getData=function(t,e,i){var n,r=0,a=this._points,s=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,n=[],s=this.earcutTriangles.length,r=0;r<s;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n)}}else{this._start=i,n=[];var o=[],l=[],h=this.color,u=(h>>16&255)/255,c=(h>>8&255)/255,d=(255&h)/255;for(s=Math.floor(a.length/2),r=0;r<s;r++)o.push(this.x+a[2*r],this.y+a[2*r+1],u,c,d),l.push(this.x+a[2*r],this.y+a[2*r+1]);for(this.earcutTriangles=$n.earcut(l,null,2),s=this.earcutTriangles.length,r=0;r<s;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n),this.mFloat32Array=new Float32Array(o)}t.append(this.mUint16Array),e.append(this.mFloat32Array)},s}(),aa=function(t){function a(){this._matrix=new tn,this._matrix4=cr.defaultMatrix4.concat(),a.__super.call(this,1e4),this.shaderValue=new Qr(0,0)}E(a,"laya.webgl.submit.SubmitCanvas",er);var e=a.prototype;return e.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=fr.worldAlpha,e=fr.worldMatrix4,i=fr.worldMatrix,n=fr.worldFilters,r=fr.worldShaderDefines,a=this.shaderValue,s=this._matrix,o=this._matrix4,l=tn.TEMP;return tn.mul(s,i,l),o[0]=l.a,o[1]=l.b,o[4]=l.c,o[5]=l.d,o[12]=l.tx,o[13]=l.ty,fr.worldMatrix=l.clone(),fr.worldMatrix4=o,fr.worldAlpha=fr.worldAlpha*a.alpha,a.filters&&a.filters.length&&(fr.worldFilters=a.filters,fr.worldShaderDefines=a.defines),this._ctx_src.flush(),fr.worldAlpha=t,fr.worldMatrix4=e,fr.worldMatrix.destroy(),fr.worldMatrix=i,fr.worldFilters=n,fr.worldShaderDefines=r,1},e.releaseRender=function(){var t=a._cache;this._ctx_src=null,t[t._length++]=this},e.getRenderType=function(){return 10003},a.create=function(t,e,i){var n=a._cache._length?a._cache[--a._cache._length]:new a;n._ctx_src=t;var r=n.shaderValue;return r.alpha=e,r.defines.setValue(0),i&&i.length&&r.setFilters(i),n},a._cache=((a._cache=[])._length=0,a._cache),a}(),sa=function(t){function h(t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===t&&(t=1e4),h.__super.call(this,t)}E(h,"laya.webgl.submit.SubmitTexture",er);var e=h.prototype;return e.releaseRender=function(){var t=h._cache;(t[t._length++]=this).shaderValue.release(),this._preIsSameTextureShader=!1,this._vb=null,this._texs.length=0,this._vbPos.length=0,this._isSameTexture=!0},e.addTexture=function(t,e){this._texsID[this._texs.length]=t._uvID,this._texs.push(t),this._vbPos.push(e)},e.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var t=this.shaderValue.textureHost.bitmap;if(null!==t)for(var e=this._vb.getFloat32Array(),i=0,n=this._texs.length;i<n;i++){var r=this._texs[i];r.active();var a=r.uv;if(this._texsID[i]!==r._uvID){this._texsID[i]=r._uvID;var s=this._vbPos[i];e[s+2]=a[0],e[s+3]=a[1],e[s+6]=a[2],e[s+7]=a[3],e[s+10]=a[4],e[s+11]=a[5],e[s+14]=a[6],e[s+15]=a[7],this._vb.setNeedUpload()}r.bitmap!==t&&(this._isSameTexture=!1)}}},e.renderSubmit=function(){if(0===this._numEle)return h._shaderSet=!1,1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return h._shaderSet=!1,1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=mr.mainContext;if(Bn.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),Bn.activeBlendFunction=this._blendFn),Cn.drawCall++,Cn.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&Pa.activeShader&&h._shaderSet?Pa.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),h._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var n=t.bitmap,r=0,a=Pa.activeShader,s=0,o=this._texs.length;s<o;s++){var l=this._texs[s];l.bitmap===n&&s+1!==o||(a.uploadTexture2D(l.source),i.drawElements(4,6*(s-r+1),5123,this._startIdx+6*r*cr.BYTES_PIDX),n=l.bitmap,r=s)}else i.drawElements(4,this._numEle,5123,this._startIdx);return 1},h.create=function(t,e,i,n,r){var a=h._cache._length?h._cache[--h._cache._length]:new h;null==i&&((i=a._selfVb||(a._selfVb=Mo.create(-1))).clear(),n=0),a._ib=e,a._vb=i,a._startIdx=n*cr.BYTES_PIDX,a._numEle=0;var s=t._nBlendType;a._blendFn=t._targets?Bn.targetFns[s]:Bn.fns[s],a.shaderValue=r,a.shaderValue.setValue(t._shader2D);var o=t._shader2D.filters;return o&&a.shaderValue.setFilters(o),a},h._cache=((h._cache=[])._length=0,h._cache),h._shaderSet=!0,h}(),oa=function(t){function v(){v.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}E(v,"laya.webgl.utils.MeshTexture",_r);var e=v.prototype;return e.addData=function(t,e,i,n,r,a){for(var s=t.length/2,o=this._vb.needSize(s*v.const_stride)>>2,l=this._vb.getFloat32Array(),h=0,u=0;u<s;u++){var c=t[h],d=t[h+1],_=c*n.a+d*n.c+n.tx,f=c*n.b+d*n.d+n.ty;l[o++]=_,l[o++]=f,l[o++]=e[h],l[o++]=e[h+1],h+=2}this._vb.setNeedUpload();var m=this.vertNum;if(0<m){var p=i.length;p>v.tmpIdx.length&&(v.tmpIdx=new Uint16Array(p));for(var g=0;g<p;g++)v.tmpIdx[g]=i[g]+m;this._ib.appendU16Array(v.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=s,this.indexNum+=i.length},e.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy()},v.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new v},v.const_stride=16,v._POOL=[],m(v,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),v}(),la=function(t){function e(){this.noWalks=null,this.color=4294967295,this.distancePercent=100,this._transform=null,this._player=null,this._currentRends=null,this._lastRends=null,this.rayOffset=new we,e.__super.call(this)}E(e,"code.CameraTransparent",yr);var i=e.prototype;return i._start=function(t){this._transform=this._owner,this._player=b.Instance.playerLeader._transform,this._currentRends=[],this._lastRends=[]},i.OnGameStart=function(){this._player=b.Instance.playerLeader._transform},i.OnTriggerStay=function(t){this.SetAlpha(t.transform,!0)},i.OnTriggerExit=function(t){this.SetAlpha(t.transform,!1)},i.SetAlpha=function(t,e){t.albedoColor=e?(t.renderMode=13,new Ce(1,1,1,.3)):(t.renderMode=1,new Ce(1,1,1,1))},i._update=function(t){if(null!=this._player){var e=new we;we.add(this._player.transform.position,this.rayOffset,e);var i=new we;we.subtract(e,this._transform.transform.position,i);var n=we.distance(this._transform.transform.position,e),r=n/100*this.distancePercent,a=new we;a.x=r/n*i.x,a.y=r/n*i.y,a.z=r/n*i.z,we.add(this._transform.transform.position,a,a);var s=we.distance(this._transform.transform.position,a),o=this._player.transform.position,l=new we;we.subtract(o,this._transform.transform.position,l);var h=new Ee(this._transform.transform.position,l),u=new Ue;if(this.noWalks){var c,d=[];for(var _ in this.noWalks){if((c=this.noWalks[_]).getComponentByType(fs).raycast(h,u,s)){var f=c.meshRender.material;this.SetAlpha(f,!0),d.push(f)}}}for(var m=this._currentRends.length-1;0<=m;m--){var p=this._currentRends[m];-1==d.indexOf(p)&&p&&this.SetAlpha(p,!1)}this._currentRends=d}},e}(),ha=function(t){function e(){this.meshAnimator=null,e.__super.call(this)}E(e,"code.Role",yr);var i=e.prototype;return i.PlayAnimIdle=function(){},i.PlayAnimWalk=function(){},i.PlayAnimRun=function(){},e}(),ua=function(t){function e(){e.__super.call(this)}E(e,"laya.d3.component.Script",yr);var i=e.prototype;return i.onTriggerEnter=function(t){},i.onTriggerExit=function(t){},i.onTriggerStay=function(t){},v(0,i,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!1,e}(),ca=function(t){function e(){this._objectPool=[],this.followerPrefab=null,this.followerAnimMeshPrefab=null,this.fixedRadius=!0,this.spawnRadius=3,this.minSpawnTime=2,this.maxSpawnTime=5,this.maxSpawnCount=50,this._transform=null,this._currentFollowerCount=0,e.__super.call(this)}E(e,"code.FollowerGenerator",yr);var i=e.prototype;return i.AddToObjectPool=function(t){var e=code.FollowerGenerator.npcList.indexOf(t.parent);-1!=e&&code.FollowerGenerator.npcList.splice(e,1),-1==this._objectPool.indexOf(t)&&(t.active=!1,this._transform.addChild(t),this._objectPool.push(t),this._currentFollowerCount--)},i.Awake=function(){},i._start=function(t){this._transform=this._owner;for(var e=0;e<this.maxSpawnCount;e++)this.AddToObjectPool(ys.instantiate(this.followerAnimMeshPrefab));S.timer.loop(1e3*(this.minSpawnTime+Math.random()*(this.maxSpawnTime-this.minSpawnTime)),this,this.SpawnFollower)},i.OnDestroy=function(){this._objectPool=[],code.FollowerGenerator.npcList=[]},i.OnDrawGizmosSelected=function(){},i.SpawnFollower=function(){if(!(this._currentFollowerCount>=this.maxSpawnCount)){var t,e=ys.instantiate(this.followerPrefab,null,!1);0<this._objectPool.Count?(t=this._objectPool[this._objectPool.Count-1])&&(this._objectPool.pop(),t.active=!0):t=ys.instantiate(this.followerAnimMeshPrefab),t&&(e.addChild(t),t.transform.localPosition=new we,t.transform.localRotationEuler=new we,t.transform.localScale=this.followerAnimMeshPrefab.transform.localScale);var i=e.getComponentByType(qa);e.tag="Follower",i.PlayAnimWalk(),i.child=t,(i.belongFG=this)._transform.addChild(e),e.transform.position=this.GetSpawnPoint(),code.FollowerGenerator.npcList.push(e),this._currentFollowerCount++}},i.GetSpawnPoint=function(){var t=new we,e=c.GeneratePointInCycle(this.spawnRadius);return we.add(this._transform.transform.position,new we(e.x,0,e.y),t),t},e.npcList=[],e}(),da=function(t){function e(){this.target=null,this.offset=null,this.curOffset=null,this.distance=1,this.distanceMin=1,this.distanceMax=2.5,this.rate=NaN,this.MaxFollowers=300,this._transform=null,this.enabled=!1,e.__super.call(this)}E(e,"code.FollowTarget",yr);var i=e.prototype;return i._start=function(t){this._transform=this._owner,this.offset=new we,we.subtract(this._transform.transform.position,this.target.transform.position,this.offset),this.rate=(this.distanceMax-this.distanceMin)/this.MaxFollowers},i.GameStart=function(t){this.target=t,this.enabled=!0},i.GameOver=function(){this.enabled=!1},i.RefreshOffset=function(){we.subtract(this._transform.transform.position,this.target.transform.position,this.offset)},i._update=function(t){this.target&&this.enabled&&(b.Instance.playerLeader.followers.length<=0?this.distance=this.distanceMin:b.Instance.playerLeader.followers.length>=this.MaxFollowers?this.distance=this.distanceMax:this.distance=this.distanceMin+this.rate*b.Instance.playerLeader.followers.length,this.curOffset=new we,this.curOffset.x=this.offset.x*this.distance,this.curOffset.y=this.offset.y*this.distance,this.curOffset.z=this.offset.z*this.distance,we.add(this.target.transform.position,this.curOffset,this._transform.transform.position),this._transform.transform.position=this._transform.transform.position)},i.OnDestroy=function(){},e}(),_a=function(t){function e(){this.navMeshGroup=null,this.target=null,this.enabled=!1,this.updateRotation=!1,this.pathPending=!1,this._path=null,this.pathp=0,this.pathlen=0,this._remainingDistance=1,this.destination=null,this.speed=1,e.__super.call(this),this.steeringTarget=new we,this._velocity=new we,this.out=new we}E(e,"code.NavMeshAgent",yr);var i=e.prototype;return i._load=function(t){this.target=this._owner},i._update=function(t){if(this.enabled){var e=this.target.transform.position;if(this._path){for(var i=new we,n=null,r=this.pathp;r<this._path.length-1;r++){var a=this._path[r],s=this._path[r+1];this.pathlen=this.pathlen+this.speed/60;var o=we.distance(a,s);if(!(this.pathlen>o)){n=a.clone(),s.cloneTo(this.steeringTarget),we.subtract(s,a,i),we.normalize(i,i),we.scale(i,this.pathlen,i),we.add(a,i,n);break}this.pathlen-=o,this.pathp++}null==n&&(this.pathPending=!1,n=this._path[this._path.length-1],this._path[this._path.length-1].cloneTo(this.steeringTarget)),this.target.transform.position=n}else this.out.x=e.x+this.velocity.x*S.timer.delta/1e3,this.out.y=e.y+this.velocity.y*S.timer.delta/1e3,this.out.z=e.z+this.velocity.z*S.timer.delta/1e3,(null==this.navMeshGroup||vn.window.patrol.findPath(e,this.out,"level",this.navMeshGroup))&&(this.out.cloneTo(e),this.target.transform.position=e)}},v(0,i,"remainingDistance",function(){return this.destination&&this.target?we.distance(this.destination,this.target.transform.position):this._remainingDistance},function(t){this._remainingDistance=t}),v(0,i,"velocity",function(){return this._velocity},function(t){this._velocity=t,this.destination=null}),v(0,i,"path",function(){return this._path},function(t){this._path=t,this.pathPending=!!t,this.pathp=0,this.pathlen=0}),e}(),fa=function(t){function e(){this.leader=null,this.pause=!1,this._transform=null,this._rigidbody=null,this._lastMousePos=null,this.isMouseDown=!1,e.__super.call(this)}E(e,"code.PlayerController",yr);var i=e.prototype;return i._load=function(t){this._transform=this._owner,this._rigidbody=this._owner.getComponentByType(Sa),this.leader=this._owner.getComponentByType(ts),this.leader.isPlayerControll=!0,this.pause=!0},i._start=function(t){this.leader.agent.updateRotation=!1,this._lastMousePos=new we(.5*S.stage.width,.5*S.stage.height),S.stage.on("mousedown",this,this.onMouseDown),S.stage.on("mouseup",this,this.onMouseUp)},i.onMouseUp=function(){this.isMouseDown=!1},i.onMouseDown=function(){this.isMouseDown=!0,this._lastMousePos.x=S.stage.mouseX,this._lastMousePos.y=S.stage.mouseY},i._update=function(t){if(!this.pause){if(this.isMouseDown){var e=new we;e.x=S.stage.mouseX-this._lastMousePos.x,e.y=S.stage.mouseY-this._lastMousePos.y,0<we.scalarLength(e)&&this.OnJoystickMove(e)}this.leader.agent.enabled&&(we.normalize(this._transform.transform.forward,this.leader.agent.velocity),this.leader.agent.velocity.x*=this.leader.speed,this.leader.agent.velocity.y*=this.leader.speed,this.leader.agent.velocity.z*=this.leader.speed,this.leader.agent.velocity=this.leader.agent.velocity)}},i.OnJoystickMove=function(t){var e=57.29578*Math.atan2(t.x,t.y);e+=180,this._transform.transform.rotationEuler=new we(0,e*Math.PI/180,0)},e}(),ma=function(t){function S(){S.__super.call(this)}return E(S,"code.GridCollisionManager",xr),S._triggerCollision=function(){for(var t=V._collsionTestList,e=t.length,i=[],n=0;n<e;n++)for(var r=t[n],a=V.getLayerByNumber(r)._colliders,s=a.length,o=0;o<s;o++){if((f=a[o]).enable&&f._isRigidbody){var l=f.owner.transform.position,h=l.x,u=l.z,c=(h+1e3>>0)+1e3*(u+1e3>>0),d=i[c];null==d&&(d=i[c]=[]),d.push(f)}}for(var _ in i)for(s=(d=i[c=parseInt(_)]).length,o=0;o<s;o++){for(var f,m=(f=d[o]).owner._scripts,p=o+1;p<s;p++){var g=d[p],v=g.owner._scripts;if(m)for(var y in m)m[y].onTriggerStay(g);if(v)for(y in v)v[y].onTriggerStay(f)}var x=i[c+1],b=.5<(h=f.owner.transform.position.x)>>0-h,T=.5<(u=f.owner.transform.position.z)>>0-u;x&&b&&S.doC(f,x,h,u),(x=i[c+1e3])&&T&&S.doC(f,x,h,u),(x=i[c+1+1e3])&&b&&T&&S.doC(f,x,h,u)}},S.doC=function(t,e,i,n){var r,a=t.owner._scripts;for(var s in e)if((r=e[s]).owner.transform.position.x-i<1&&r.owner.transform.position.z-n<1){var o=r.owner._scripts;if(a)for(var l in a)a[l].onTriggerStay(r);if(o)for(l in o)o[l].onTriggerStay(t)}},S}(),pa=function(t){function e(){this.f=.004,this.friction=.9,this._sprite=null,e.__super.call(this),this.a=new en,this.v=new en}E(e,"code.Vehicle",yr);var i=e.prototype;return i._load=function(t){this._sprite=t},i._update=function(t){this._enable&&(this.v.x+=this.a.x*this.f,this.v.y+=this.a.y*this.f,this.v.x*=this.friction,this.v.y*=this.friction,this._sprite.transform.position.x+=this.v.x*S.timer.delta/1e3*60,this._sprite.transform.position.z+=this.v.y*S.timer.delta/1e3*60,this._sprite.transform.position=this._sprite.transform.position,this.a.setTo(0,0))},e}(),ga=function(t){function e(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,e.__super.call(this),this._boundingBoxCorners=R(8,null)}E(e,"laya.d3.resource.models.BaseMesh",br);var i=e.prototype;return i._getPositions=function(){throw new Error("未Override,请重载该属性！")},i._generateBoundingObject=function(){this._boundingSphere=new me(new we,0),me.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new _e(new we,new we),_e.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},i.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},i.getRenderElement=function(t){throw new Error("未Override,请重载该属性！")},v(0,i,"subMeshCount",function(){return this._subMeshCount}),v(0,i,"boundingBox",function(){return this._boundingBox}),v(0,i,"boundingBoxCorners",function(){return this._boundingBoxCorners}),v(0,i,"boundingSphere",function(){return this._boundingSphere}),e}(),va=function(n){function t(){t.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new Ve,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new Ce(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}E(t,"laya.d3.core.material.BaseMaterial",n);var e=t.prototype;return S.imps(e,{"laya.d3.core.IClone":!0}),e._addShaderDefine=function(t){this._shaderDefineValue|=t},e._removeShaderDefine=function(t){this._shaderDefineValue&=~t},e._addDisablePublicShaderDefine=function(t){this._disablePublicShaderDefine|=t},e._removeDisablePublicShaderDefine=function(t){this._disablePublicShaderDefine&=~t},e._setBuffer=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},e._getBuffer=function(t){return this._values[t]},e._setMatrix4x4=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},e._getMatrix4x4=function(t){return this._values[t]},e._setInt=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},e._getInt=function(t){return this._values[t]},e._setNumber=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},e._getNumber=function(t){return this._values[t]},e._setBool=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},e._getBool=function(t){return this._values[t]},e._setVector2=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},e._getVector2=function(t){return this._values[t]},e._setColor=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},e._getColor=function(t){return this._values[t]},e._setTexture=function(t,e){var i=this._values[t];this._values[t]=e,this._shaderValues.setValue(t,e),0<this.referenceCount&&(i&&i._removeReference(),e&&e._addReference())},e._getTexture=function(t){return this._values[t]},e._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},e._getShader=function(t,e,i){var n=(t|e)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(n,i,this._shaderDefineValue),this._shader},e._setRenderStateBlendDepth=function(){var t=mr.mainContext;switch(pr.setDepthMask(t,this.depthWrite),0===this.depthTest?pr.setDepthTest(t,!1):(pr.setDepthTest(t,!0),pr.setDepthFunc(t,this.depthTest)),this.blend){case 0:pr.setBlend(t,!1);break;case 1:pr.setBlend(t,!0),pr.setBlendFunc(t,this.srcBlend,this.dstBlend);break;case 2:pr.setBlend(t,!0)}},e._setRenderStateFrontFace=function(t,e){var i=mr.mainContext,n=0;switch(this.cull){case 0:pr.setCullFace(i,!1);break;case 1:pr.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2305:2304:e&&e._isFrontFaceInvert?2304:2305,pr.setFrontFace(i,n);break;case 2:pr.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2304:2305:e&&e._isFrontFaceInvert?2305:2304,pr.setFrontFace(i,n)}},e.onAsynLoaded=function(t,e,i){var n=e[0],r=e[1];switch(n.version){case"LAYAMATERIAL:01":var a=0,s=0,o=n.props;for(var l in o)switch(l){case"vectors":var h=o[l];for(a=0,s=h.length;a<s;a++){var u=h[a],c=u.value;switch(c.length){case 2:this[u.name]=new Re(c[0],c[1]);break;case 3:this[u.name]=new we(c[0],c[1],c[2]);break;case 4:this[u.name]=new Ce(c[0],c[1],c[2],c[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var d=o[l];for(a=0,s=d.length;a<s;a++){var _=d[a],f=_.path;f&&(this[_.name]=kr.getRes(r[f]))}break;case"defines":var m=o[l];for(a=0,s=m.length;a<s;a++){var p=this._shaderCompile.getMaterialDefineByName(m[a]);this._addShaderDefine(p)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[l]=o[l];break;case"renderQueue":switch(o[l]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[l]=o[l]}break;case"LAYAMATERIAL:02":for(l in o=n.props)switch(l){case"vectors":for(a=0,s=(h=o[l]).length;a<s;a++)switch((c=(u=h[a]).value).length){case 2:this[u.name]=new Re(c[0],c[1]);break;case 3:this[u.name]=new we(c[0],c[1],c[2]);break;case 4:this[u.name]=new Ce(c[0],c[1],c[2],c[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(a=0,s=(d=o[l]).length;a<s;a++)(f=(_=d[a]).path)&&(this[_.name]=kr.getRes(r[f]));break;case"defines":for(a=0,s=(m=o[l]).length;a<s;a++)p=this._shaderCompile.getMaterialDefineByName(m[a]),this._addShaderDefine(p);break;default:this[l]=o[l]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},e._addReference=function(){n.prototype._addReference.call(this);for(var t=0,e=this._values.length;t<e;t++){var i=this._values[t];i&&i instanceof laya.d3.resource.BaseTexture&&i._addReference()}},e._removeReference=function(){n.prototype._removeReference.call(this);for(var t=0,e=this._values.length;t<e;t++){var i=this._values[t];i&&i instanceof laya.d3.resource.BaseTexture&&i._removeReference()}},e.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null;for(var t=0,e=this._values.length;t<e;t++){var i=this._values[t];i&&i instanceof laya.d3.resource.BaseTexture&&i._removeReference()}this._values=null},e.setShaderName=function(t){var e=Us.nameKey.getID(t);if(-1===e)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=Xr._preCompileShader[e]},e.cloneTo=function(t){var e=t;e.name=this.name,e.cull=this.cull,e.blend=this.blend,e.srcBlend=this.srcBlend,e.dstBlend=this.dstBlend,e.srcBlendRGB=this.srcBlendRGB,e.dstBlendRGB=this.dstBlendRGB,e.srcBlendAlpha=this.srcBlendAlpha,e.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(e.blendConstColor),e.blendEquation=this.blendEquation,e.blendEquationRGB=this.blendEquationRGB,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.renderQueue=this.renderQueue,e._shader=this._shader,e._disablePublicShaderDefine=this._disablePublicShaderDefine,e._shaderDefineValue=this._shaderDefineValue;var i,n=0,r=e._shaderValues;e._shaderValues.data.length=this._shaderValues.data.length;var a=this._values.length,s=e._values;for(n=0,i=s.length=a;n<i;n++){var o=this._values[n];if(o)if("number"==typeof o)s[n]=o,r.data[n]=o;else if("number"==typeof o&&Math.floor(o)==o)s[n]=o,r.data[n]=o;else if("boolean"==typeof o)s[n]=o,r.data[n]=o;else if(o instanceof laya.d3.math.Vector2){var l=s[n]||(s[n]=new Re);o.cloneTo(l),r.data[n]=l.elements}else if(o instanceof laya.d3.math.Vector3){var h=s[n]||(s[n]=new we);o.cloneTo(h),r.data[n]=h.elements}else if(o instanceof laya.d3.math.Vector4){var u=s[n]||(s[n]=new Ce);o.cloneTo(u),r.data[n]=u.elements}else if(o instanceof laya.d3.math.Matrix4x4){var c=s[n]||(s[n]=new ye);o.cloneTo(c),r.data[n]=c.elements}else o instanceof laya.d3.resource.BaseTexture&&(s[n]=o,r.data[n]=o)}},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},v(0,e,"alphaTestValue",function(){return this._getNumber(0)},function(t){this._setNumber(0,t)}),v(0,e,"alphaTest",function(){return this._alphaTest},function(t){(this._alphaTest=t)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),t.__init__=function(){t.SHADERDEFINE_ALPHATEST=t.shaderDefines.registerDefine("ALPHATEST")},t.RENDERQUEUE_OPAQUE=2e3,t.RENDERQUEUE_ALPHATEST=2450,t.RENDERQUEUE_TRANSPARENT=3e3,t.CULL_NONE=0,t.CULL_FRONT=1,t.CULL_BACK=2,t.BLEND_DISABLE=0,t.BLEND_ENABLE_ALL=1,t.BLEND_ENABLE_SEPERATE=2,t.BLENDPARAM_ZERO=0,t.BLENDPARAM_ONE=1,t.BLENDPARAM_SRC_COLOR=768,t.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,t.BLENDPARAM_DST_COLOR=774,t.BLENDPARAM_ONE_MINUS_DST_COLOR=775,t.BLENDPARAM_SRC_ALPHA=770,t.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,t.BLENDPARAM_DST_ALPHA=772,t.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,t.BLENDPARAM_SRC_ALPHA_SATURATE=776,t.BLENDEQUATION_ADD=0,t.BLENDEQUATION_SUBTRACT=1,t.BLENDEQUATION_REVERSE_SUBTRACT=2,t.DEPTHTEST_OFF=0,t.DEPTHTEST_NEVER=512,t.DEPTHTEST_LESS=513,t.DEPTHTEST_EQUAL=514,t.DEPTHTEST_LEQUAL=515,t.DEPTHTEST_GREATER=516,t.DEPTHTEST_NOTEQUAL=517,t.DEPTHTEST_GEQUAL=518,t.DEPTHTEST_ALWAYS=519,t.SHADERDEFINE_ALPHATEST=1,t.ALPHATESTVALUE=0,m(t,["shaderDefines",function(){return this.shaderDefines=new De}]),t}(br),ya=function(r){function i(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,i.__super.call(this),this._style=Gi.EMPTY}E(i,"laya.display.Sprite",r);var t=i.prototype;return S.imps(t,{"laya.display.ILayout":!0}),t.createConchModel=function(){return new ConchNode},t.destroy=function(t){void 0===t&&(t=!0),this._releaseMem(),r.prototype.destroy.call(this,t),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},t.updateZOrder=function(){Dn.updateOrder(this._childs)&&this.repaint()},t.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},t.setBounds=function(t){this._set$P("uBounds",t)},t.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new nn),nn._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},t.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new nn),nn._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},t._boundPointsToParent=function(t){void 0===t&&(t=!1);var e=0,i=0;this._style&&(e=this._style._tf.translateX,i=this._style._tf.translateY,t=t||0!==this._style._tf.rotate,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var n=this._getBoundPointsM(t);if(!n||n.length<1)return n;if(8!=n.length&&(n=t?qi.scanPList(n):nn._getWrapRec(n,nn.TEMP)._getBoundPoints()),!this.transform)return Dn.transPointList(n,this._x-e,this._y-i),n;var r=en.TEMP,a=0,s=n.length;for(a=0;a<s;a+=2)r.x=n[a],r.y=n[a+1],this.toParentPoint(r),n[a]=r.x,n[a+1]=r.y;return n},t.getGraphicBounds=function(t){return void 0===t&&(t=!1),this._graphics?this._graphics.getBounds(t):nn.TEMP.setTo(0,0,0,0)},t._getBoundPointsM=function(t){if(void 0===t&&(t=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var e=Dn.clearArray(this._$P.temBM),i=nn.TEMP;return i.copyFrom(this.scrollRect),Dn.concatArray(e,i._getBoundPoints()),e}for(var n,r,a,s=this._graphics?this._graphics.getBoundPoints():Dn.clearArray(this._$P.temBM),o=0,l=(a=this._childs).length;o<l;o++)(n=a[o])instanceof laya.display.Sprite&&1==n.visible&&(r=n._boundPointsToParent(t))&&(s=s?Dn.concatArray(s,r):r);return s},t.getStyle=function(){return this._style===Gi.EMPTY&&(this._style=new Gi),this._style},t.setStyle=function(t){this._style=t},t._adjustTransform=function(){this._tfChanged=!1;var t,e=this._style._tf,i=e.scaleX,n=e.scaleY;if(e.rotate||1!==i||1!==n||e.skewX||e.skewY){(t=this._transform||(this._transform=tn.create())).bTransform=!0;var r=.0174532922222222*(e.rotate-e.skewX),a=.0174532922222222*(e.rotate+e.skewY),s=Math.cos(a),o=Math.sin(a),l=Math.sin(r),h=Math.cos(r);return t.a=i*s,t.b=i*o,t.c=-n*l,t.d=n*h,t.tx=t.ty=0,t}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,t},t.pos=function(t,e,i){if(void 0===i&&(i=!1),this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._x=t,this._y=e,this.conchModel&&this.conchModel.pos(this._x,this._y);var n=this._parent;n&&0===n._repaint&&(n._repaint=1,n.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=t,this.y=e}return this},t.pivot=function(t,e){return this.pivotX=t,this.pivotY=e,this},t.size=function(t,e){return this.width=t,this.height=e,this},t.scale=function(t,e,i){void 0===i&&(i=!1);var n=this.getStyle(),r=n._tf;if(r.scaleX!=t||r.scaleY!=e){if(this.destroyed)return this;if(i){n.setScale(t,e),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e),this._renderType|=4;var a=this._parent;a&&0===a._repaint&&(a._repaint=1,a.parentRepaint())}else this.scaleX=t,this.scaleY=e}return this},t.skew=function(t,e){return this.skewX=t,this.skewY=e,this},t.render=function(t,e,i){Cn.spriteCount++,cn.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},t.drawToCanvas=function(t,e,i,n){if(hn.isConchNode){var r=Ys.create("2D");return new un(t,e,r).ctx.setCanvasType(1),this.conchModel.drawToCanvas(r.source,i,n),r}return M.drawToCanvas(this,this._renderType,t,e,i,n)},t.customRender=function(t,e,i){this._renderType|=1024},t._applyFilters=function(){var t;if(!hn.isWebGL&&((t=this._$P.filters)&&!(t.length<1)))for(var e=0,i=t.length;e<i;e++)t[e].action.apply(this._$P.cacheCanvas)},t._isHaveGlowFilter=function(){var t,e=0;if(this.filters)for(e=0;e<this.filters.length;e++)if(8==this.filters[e].type)return!0;for(e=0,t=this._childs.length;e<t;e++)if(this._childs[e]._isHaveGlowFilter())return!0;return!1},t.localToGlobal=function(t,e){void 0===e&&(e=!1),!0===e&&(t=new en(t.x,t.y));for(var i=this;i&&i!=S.stage;)t=i.toParentPoint(t),i=i.parent;return t},t.globalToLocal=function(t,e){void 0===e&&(e=!1),e&&(t=new en(t.x,t.y));for(var i=this,n=[];i&&i!=S.stage;)n.push(i),i=i.parent;for(var r=n.length-1;0<=r;)t=(i=n[r]).fromParentPoint(t),r--;return t},t.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t},t.fromParentPoint=function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t},t.on=function(t,e,i,n){return 1!==this._mouseEnableState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,e,i,n,!1)):r.prototype.on.call(this,t,e,i,n)},t.once=function(t,e,i,n){return 1!==this._mouseEnableState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,e,i,n,!0)):r.prototype.once.call(this,t,e,i,n)},t._$2__onDisplay=function(){if(1!==this._mouseEnableState){var t=this;for(t=t.parent;t&&1!==t._mouseEnableState&&!t._getBit(2);)t.mouseEnabled=!0,t._setBit(2,!0),t=t.parent}},t.loadImage=function(t,e,i,n,r,a){var s=this;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.graphics.loadImage(t,e,i,n,r,function(t){s.destroyed||(s.size(e+(n||t.width),i+(r||t.height)),s.repaint(),a&&a.runWith(t))}),this},t.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},t._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},t._childChanged=function(t){this._childs.length?this._renderType|=2048:this._renderType&=-2049,t&&this._get$P("hasZorder")&&S.timer.callLater(this,this.updateZOrder),this.repaint()},t.parentRepaint=function(){var t=this._parent;t&&0===t._repaint&&(t._repaint=1,t.parentRepaint())},t.startDrag=function(t,e,i,n,r,a,s){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=300),void 0===a&&(a=!1),void 0===s&&(s=.92),this._$P.dragging||this._set$P("dragging",new Sn),this._$P.dragging.start(this,t,e,i,n,r,a,s)},t.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},t._releaseMem=function(){if(this._$P){var t=this._$P.cacheCanvas;t&&t.ctx&&(wn.recover("RenderContext",t.ctx),t.ctx.canvas.size(0,0),t.ctx=null);var e=this._$P._filterCache;e&&(e.destroy(),e.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},t._setDisplay=function(t){t||this._releaseMem(),r.prototype._setDisplay.call(this,t)},t.hitTestPoint=function(t,e){var i=this.globalToLocal(en.TEMP.setTo(t,e));return t=i.x,e=i.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?nn.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(t,e)},t.getMousePoint=function(){return this.globalToLocal(en.TEMP.setTo(S.stage.mouseX,S.stage.mouseY))},t._getWords=function(){return null},t._addChildsToLayout=function(n){var t=this._getWords();if(null==t&&0==this._childs.length)return!1;if(t)for(var e=0,i=t.length;e<i;e++)n.push(t[e]);return this._childs.forEach(function(t,e,i){t._style._enableLayout()&&t._addToLayout(n)}),!0},t._addToLayout=function(t){this._style.absolute||(this._style.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))},t._isChar=function(){return!1},t._getCSSStyle=function(){return this._style.getCSSStyle()},t._setAttributes=function(t,e){switch(t){case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}},t._layoutLater=function(){this.parent&&this.parent._layoutLater()},v(0,t,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(t){this._optimizeScrollRect!=t&&(this._optimizeScrollRect=t,this.conchModel&&this.conchModel.optimizeScrollRect(t))}),v(0,t,"customRenderEnable",null,function(t){if(t&&(this._renderType|=1024,hn.isConchNode)){i.CustomList.push(this);var e=new Ys("2d");e._setContext(new CanvasRenderingContext2D),this.customContext=new un(0,0,e),e.context.setCanvasType&&e.context.setCanvasType(2),this.conchModel.custom(e.context)}}),v(0,t,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(t){this.cacheAs=t?this._$P.hasFilter?"none":"normal":"none"}),v(0,t,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(t){var e=this._$P.cacheCanvas;if(t!==(e?e.type:"none")){if("none"!==t)this._getBit(1)||this._setUpNoticeType(1),e||(e=this._set$P("cacheCanvas",wn.getItemByClass("cacheCanvas",Object))),e.type=t,e.reCache=!0,this._renderType|=16,"bitmap"==t&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(e){var i=e;i&&i.ctx&&(wn.recover("RenderContext",i.ctx),i.ctx.canvas.size(0,0),i.ctx=null),wn.recover("cacheCanvas",e)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),v(0,t,"zOrder",function(){return this._zOrder},function(t){this._zOrder!=t&&(this._zOrder=t,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(t),this._parent&&(t&&this._parent._set$P("hasZorder",!0),S.timer.callLater(this._parent,this.updateZOrder)))}),v(0,t,"rotation",function(){return this._style._tf.rotate},function(t){var e=this.getStyle();if(e._tf.rotate!==t){e.setRotate(t),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),v(0,t,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(t){this._width!==t&&(this._width=t,this.conchModel&&this.conchModel.size(t,this._height),this.repaint())}),v(0,t,"x",function(){return this._x},function(t){if(this._x!==t){if(this.destroyed)return;this._x=t,this.conchModel&&this.conchModel.pos(t,this._y);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),v(0,t,"globalScaleY",function(){for(var t=1,e=this;e&&e!==S.stage;)t*=e.scaleY,e=e.parent;return t}),v(0,t,"hitArea",function(){return this._$P.hitArea},function(t){this._set$P("hitArea",t)}),v(0,t,"staticCache",function(){return this._$P.staticCache},function(t){this._set$P("staticCache",t),t||this.reCache()}),v(0,t,"texture",function(){return this._texture},function(t){this._texture!=t&&(this._texture=t,this.graphics.cleanByTexture(t,0,0))}),v(0,t,"y",function(){return this._y},function(t){if(this._y!==t){if(this.destroyed)return;this._y=t,this.conchModel&&this.conchModel.pos(this._x,t);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),v(0,t,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(t){this._height!==t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,t),this.repaint())}),v(0,t,"blendMode",function(){return this._style.blendMode},function(t){this.getStyle().blendMode=t,this.conchModel&&this.conchModel.blendMode(t),t&&"source-over"!=t?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),v(0,t,"scaleX",function(){return this._style._tf.scaleX},function(t){var e=this.getStyle();if(e._tf.scaleX!==t){e.setScaleX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e._tf.scaleY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),v(0,t,"scaleY",function(){return this._style._tf.scaleY},function(t){var e=this.getStyle();if(e._tf.scaleY!==t){e.setScaleY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(e._tf.scaleX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),v(0,t,"stage",function(){return S.stage}),v(0,t,"skewX",function(){return this._style._tf.skewX},function(t){var e=this.getStyle();if(e._tf.skewX!==t){e.setSkewX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(t,e._tf.skewY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),v(0,t,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t,this.repaint(),t?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(t.x,t.y,t.width,t.height)):(this._renderType&=-129,this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),v(0,t,"skewY",function(){return this._style._tf.skewY},function(t){var e=this.getStyle();if(e._tf.skewY!==t){e.setSkewY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(e._tf.skewX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),v(0,t,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=!1,(this._transform=t)&&(this._x=t.tx,this._y=t.ty,t.tx=t.ty=0,this.conchModel&&this.conchModel.transform(t.a,t.b,t.c,t.d,this._x,this._y)),t?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),v(0,t,"pivotX",function(){return this._style._tf.translateX},function(t){this.getStyle().setTranslateX(t),this.conchModel&&this.conchModel.pivot(t,this._style._tf.translateY),this.repaint()}),v(0,t,"pivotY",function(){return this._style._tf.translateY},function(t){this.getStyle().setTranslateY(t),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,t),this.repaint()}),v(0,t,"alpha",function(){return this._style.alpha},function(t){this._style&&this._style.alpha!==t&&(t=t<0?0:1<t?1:t,this.getStyle().alpha=t,this.conchModel&&this.conchModel.alpha(t),1!==t?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),v(0,t,"visible",function(){return this._style.visible},function(t){this._style&&this._style.visible!==t&&(this.getStyle().visible=t,this.conchModel&&this.conchModel.visible(t),this.parentRepaint())}),v(0,t,"graphics",function(){return this._graphics||(this.graphics=M.createGraphics())},function(t){this._graphics&&(this._graphics._sp=null),(this._graphics=t)?(this._renderType&=-2,this._renderType|=512,(t._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),v(0,t,"filters",function(){return this._$P.filters},function(t){t&&0===t.length&&(t=null),this._$P.filters!=t&&(this._set$P("filters",t?t.slice():null),hn.isConchApp&&(this.conchModel&&(i.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),hn.isWebGL&&(t&&t.length?this._renderType|=32:this._renderType&=-33),t&&0<t.length?(this._getBit(1)||this._setUpNoticeType(1),hn.isWebGL&&1==t.length&&t[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(hn.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),v(0,t,"parent",r.prototype._$get_parent,function(t){S.superSet(Tr,this,"parent",t),t&&this._getBit(2)&&this._$2__onDisplay()}),v(0,t,"mask",function(){return this._$P._mask},function(t){t&&this.mask&&this.mask._$P.maskParent||(t?(this.cacheAs="bitmap",this._set$P("_mask",t),t._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",t),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(t?t.conchModel:null),this._renderType|=64,this.parentRepaint())}),v(0,t,"mouseEnabled",function(){return 1<this._mouseEnableState},function(t){this._mouseEnableState=t?2:1}),v(0,t,"globalScaleX",function(){for(var t=1,e=this;e&&e!==S.stage;)t*=e.scaleX,e=e.parent;return t}),v(0,t,"mouseX",function(){return this.getMousePoint().x}),v(0,t,"mouseY",function(){return this.getMousePoint().y}),i.fromImage=function(t){return(new i).loadImage(t)},i.CustomList=[],m(i,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=d.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),i}(Tr),xa=function(t){function v(){this._aniMap={},this.unfixedLastAniIndex=-1,v.__super.call(this),this._anis=new Array}E(v,"laya.ani.AnimationTemplet",br);var e=v.prototype;return e.parse=function(t){var e=new yn(t);this._aniVersion=e.readUTFString(),r.parse(this,e)},e._calculateKeyFrame=function(t,e,i){var n=t.keyFrame;n[e]=n[0];for(var r=0;r<e;r++){var a=n[r];a.nextData=0===a.duration?a.data:n[r+1].data}n.length--},e.onAsynLoaded=function(t,e,i){var n=new yn(e);switch(this._aniVersion=n.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":a.parse(this,n);break;default:r.parse(this,n)}this._endLoaded()},e.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},e.getAnimationCount=function(){return this._anis.length},e.getAnimation=function(t){return this._anis[t]},e.getAniDuration=function(t){return this._anis[t].playTime},e.getNodes=function(t){return this._anis[t].nodes},e.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},e.getNodeCount=function(t){return this._anis[t].nodes.length},e.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframeDatasLength},e.getPublicExtData=function(){return this._publicExtData},e.getAnimationDataWithCache=function(t,e,i,n){var r=e[i];if(r){var a=r[t];return a?a[n]:null}return null},e.setAnimationDataWithCache=function(t,e,i,n,r){var a=e[i]||(e[i]={});(a[t]||(a[t]=[]))[n]=r},e.getOriginalData=function(t,e,i,n,r){for(var a=this._anis[t].nodes,s=0,o=0,l=a.length,h=0;o<l;o++){var u,c=a[o];u=c.keyFrame[i[o][n]],c.dataOffset=h;var d=r-u.startTime,_=c.lerpType;if(_)switch(_){case 0:case 1:for(s=0;s<c.keyframeWidth;)s+=c.interpolationMethod[s](c,s,e,h+s,u.data,d,null,u.duration,u.nextData);break;case 2:var f=u.interpolationData,m=f.length,p=0;for(s=0;s<m;){var g=f[s];switch(g){case 6:case 7:s+=v.interpolation[g](c,p,e,h+p,u.data,d,null,u.duration,u.nextData,f,s+1);break;default:s+=v.interpolation[g](c,p,e,h+p,u.data,d,null,u.duration,u.nextData)}p++}}else for(s=0;s<c.keyframeWidth;)s+=c.interpolationMethod[s](c,s,e,h+s,u.data,d,null,u.duration,u.nextData);h+=c.keyframeWidth}},e.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(i.length),this.unfixedCurrentTimes=new Float32Array(i.length),this.unfixedLastAniIndex=t);for(var n=0,r=i.length;n<r;n++){var a=i[n];for(e<this.unfixedCurrentTimes[n]&&(this.unfixedCurrentFrameIndexes[n]=0),this.unfixedCurrentTimes[n]=e;this.unfixedCurrentFrameIndexes[n]<a.keyFrame.length&&!(a.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n]);)this.unfixedCurrentFrameIndexes[n]++;this.unfixedCurrentFrameIndexes[n]--}return this.unfixedCurrentFrameIndexes},e.getOriginalDataUnfixedRate=function(t,e,i){var n=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(n.length),this.unfixedCurrentTimes=new Float32Array(n.length),this.unfixedKeyframes=R(n.length),this.unfixedLastAniIndex=t);for(var r=0,a=0,s=n.length,o=0;a<s;a++){var l=n[a];for(i<this.unfixedCurrentTimes[a]&&(this.unfixedCurrentFrameIndexes[a]=0),this.unfixedCurrentTimes[a]=i;this.unfixedCurrentFrameIndexes[a]<l.keyFrame.length&&!(l.keyFrame[this.unfixedCurrentFrameIndexes[a]].startTime>this.unfixedCurrentTimes[a]);)this.unfixedKeyframes[a]=l.keyFrame[this.unfixedCurrentFrameIndexes[a]],this.unfixedCurrentFrameIndexes[a]++;var h=this.unfixedKeyframes[a];l.dataOffset=o;var u=i-h.startTime;if(l.lerpType)switch(l.lerpType){case 0:case 1:for(r=0;r<l.keyframeWidth;)r+=l.interpolationMethod[r](l,r,e,o+r,h.data,u,null,h.duration,h.nextData);break;case 2:var c=h.interpolationData,d=c.length,_=0;for(r=0;r<d;){var f=c[r];switch(f){case 6:case 7:r+=v.interpolation[f](l,_,e,o+_,h.data,u,null,h.duration,h.nextData,c,r+1);break;default:r+=v.interpolation[f](l,_,e,o+_,h.data,u,null,h.duration,h.nextData)}_++}}else for(r=0;r<l.keyframeWidth;)r+=l.interpolationMethod[r](l,r,e,o+r,h.data,u,null,h.duration,h.nextData);o+=l.keyframeWidth}},v._LinearInterpolation_0=function(t,e,i,n,r,a,s,o,l,h){var u=0===o?0:a/o;return i[n]=(1-u)*r[e]+u*l[e],1},v._QuaternionInterpolation_1=function(t,e,i,n,r,a,s,o,l,h){var u=0===o?0:a/o;return $i.slerpQuaternionArray(r,e,l,e,u,i,n),4},v._AngleInterpolation_2=function(t,e,i,n,r,a,s,o,l,h){return 0},v._RadiansInterpolation_3=function(t,e,i,n,r,a,s,o,l,h){return 0},v._Matrix4x4Interpolation_4=function(t,e,i,n,r,a,s,o,l,h){for(var u=0;u<16;u++,e++)i[n+u]=r[e]+a*s[e];return 16},v._NoInterpolation_5=function(t,e,i,n,r,a,s,o,l,h){return i[n]=r[e],1},v._BezierInterpolation_6=function(t,e,i,n,r,a,s,o,l,h,u){return void 0===u&&(u=0),i[n]=r[e]+(l[e]-r[e])*_.getBezierRate(a/o,h[u],h[u+1],h[u+2],h[u+3]),5},v._BezierInterpolation_7=function(t,e,i,n,r,a,s,o,l,h,u){return void 0===u&&(u=0),i[n]=h[u+4]+h[u+5]*_.getBezierRate((.001*a+h[u+6])/h[u+7],h[u],h[u+1],h[u+2],h[u+3]),9},v.load=function(t){return S.loader.create(t,null,null,v)},v.interpolation=[v._LinearInterpolation_0,v._QuaternionInterpolation_1,v._AngleInterpolation_2,v._RadiansInterpolation_3,v._Matrix4x4Interpolation_4,v._NoInterpolation_5,v._BezierInterpolation_6,v._BezierInterpolation_7],v}(),ba=function(i){function u(){u.__super.call(this),this._clipNames=[],this._clips=[],this._playStartFrames=[],this._playEndFrames=[],this._cacheNodesSpriteOwners=[],this._cacheNodesAvatarOwners=[],this._cacheNodesDefaultlValues=[],this._cacheNodesToSpriteMap=[],this._cacheSpriteToNodesMap=[],this._cacheFullFrames=[],this._publicClipsDatas=[],this._playEventIndex=-1,this._updateTransformPropertyLoopCount=-1,this._lastFrameIndex=-1,this._defaultClipIndex=-1,this._cachePlayRate=1,this._currentPlayClip=null,this._currentFrameIndex=-1,this._currentTime=0,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this.isCache=!0,this.cacheFrameRate=60,this.playbackRate=1,this.playOnWake=!0}E(u,"laya.d3.component.Animator",i);var t=u.prototype;return S.imps(t,{"laya.resource.IDestroy":!0}),t._getAvatarOwnersByClip=function(t){var e=this._clips[t]._nodes,i=e.length,n=this._cacheNodesAvatarOwners[t];n.length=i;var r=this._cacheNodesDefaultlValues[t];r.length=i;for(var a=0;a<i;a++){for(var s=this._avatarNodes[0],o=e[a],l=o.path,h=0,u=l.length;h<u;h++){var c=l[h];if(""===c)break;if(!(s=s.getChildByName(c)))break}if(s){n[a]=s;var d=W._propertyGetFuncs[o.propertyNameID](s);if(d){var _=new Float32Array(o.keyFrameWidth);for(r[a]=_,h=0,u=d.length;h<u;h++)_[h]=d[h]}}}},t._handleSpriteOwnersByClip=function(t){var e=this._clips[t]._nodes,i=e.length,n=this._cacheNodesSpriteOwners[t];n.length=i;var r=this._cacheNodesDefaultlValues[t];r.length=i;for(var a=0;a<i;a++){var s=this._owner,o=e[a],l=o.path,h=0,u=0;for(h=0,u=l.length;h<u;h++){var c=l[h];if(""===c)break;if(!(s=s.getChildByName(c)))break}if(s){n[a]=s;var d=W._propertyGetFuncs[o.propertyNameID](null,s);if(d){var _=new Float32Array(o.keyFrameWidth);for(r[a]=_,h=0,u=d.length;h<u;h++)_[h]=d[h]}}}},t._offClipAndAvatarRelateEvent=function(t,e){t.loaded?e.loaded||e.off("loaded",this,this._getAvatarOwnersByClip):t.off("loaded",this,this._getAvatarOwnersAndInitDatasAsync)},t._getAvatarOwnersByClipAsync=function(t,e){e.loaded?this._getAvatarOwnersByClip(t):e.once("loaded",this,this._getAvatarOwnersByClip,[t])},t._offGetSpriteOwnersByClipAsyncEvent=function(t){t.loaded||t.off("loaded",this,this._getSpriteOwnersByClipAsync)},t._getSpriteOwnersByClipAsync=function(t,e){e.loaded?this._handleSpriteOwnersByClip(t):e.once("loaded",this,this._handleSpriteOwnersByClip,[t])},t._getAvatarOwnersAndInitDatasAsync=function(){for(var t=0,e=this._clips.length;t<e;t++)this._getAvatarOwnersByClipAsync(t,this._clips[t]);for(this._avatar._cloneDatasToAnimator(this),t=0,e=this._avatarNodes.length;t<e;t++)this._checkAnimationNode(this._avatarNodes[t],this._owner)},t._offGetClipCacheFullKeyframeIndicesEvent=function(t){t.loaded||t.off("loaded",this,this._computeCacheFullKeyframeIndices)},t._computeCacheFullKeyframeIndices=function(t){var e=this._clips[t],i=this._cacheFrameRateInterval*this._cachePlayRate,n=e._getFullKeyframeIndicesWithCache(i);if(n)this._cacheFullFrames[t]=n;else{n=this._cacheFullFrames[t]=[];var r=e._nodes,a=r.length;n.length=a;for(var s=Math.ceil(e._duration/i-1e-5)+1,o=0;o<a;o++){var l=r[o],h=new Int32Array(s);h.fill(-1);for(var u=l.keyFrames,c=0,d=u.length;c<d;c++)for(var _=u[c],f=_.startTime,m=f+_.duration;f<=m;){h[Math.ceil(f/i-1e-5)]=c,f+=i}n[o]=h}e._cacheFullKeyframeIndices(i,n)}},t._updateAnimtionPlayer=function(){this._updatePlayer(S.timer.delta/1e3)},t._onOwnerActiveHierarchyChanged=function(){this._owner.activeInHierarchy?(S.timer.frameLoop(1,this,this._updateAnimtionPlayer),this.playOnWake&&this.clip&&this.play()):(0!==this.playState&&(this._stoped=!0),S.timer.clear(this,this._updateAnimtionPlayer))},t._eventScript=function(t,e){for(var i=this._currentPlayClip._animationEvents,n=i.length;this._playEventIndex<n;this._playEventIndex++){var r=i[this._playEventIndex],a=r.time;if(!(t<=a&&a<e))break;for(var s=this._owner._scripts,o=0,l=s.length;o<l;o++){var h=s[o],u=h[r.eventName];u&&u.apply(h,r.params)}}},t._setPlayParams=function(t,e){var i=this._currentTime;this._currentTime=t,this._currentFrameIndex=Math.max(Math.floor(this.currentPlayTime/e-1e-5),0),this._currentFrameTime=this._currentFrameIndex*e,this._eventScript(i,t)},t._setPlayParamsWhenStop=function(t,e){var i=this._currentTime;this._currentTime=t,this._currentFrameIndex=Math.max(Math.floor(t/e-1e-5),0),this._currentFrameTime=this._currentFrameIndex*e,this._eventScript(i,t),this._currentPlayClip=null},t._revertKeyframeNodes=function(t,e){var i=this._cacheNodesDefaultlValues[e],n=t._nodes;if(this._avatar)for(var r=this._cacheNodesAvatarOwners[e],a=0,s=r.length;a<s;a++){var o=r[a];o&&W._propertySetFuncs[n[a].propertyNameID](o,null,i[a])}else{var l=this._cacheNodesSpriteOwners[e];for(a=0,s=l.length;a<s;a++){var h=l[a];h&&W._propertySetFuncs[n[a].propertyNameID](null,h,i[a])}}},t._onAnimationStop=function(){var t,e,i,n=0,r=0;this._lastFrameIndex=-1;var a=this._currentPlayClip._nodes;if(this._avatar){var s=this._cacheNodesAvatarOwners[this._currentPlayClipIndex];for(n=0,r=s.length;n<r;n++){var o=s[n];i=(e=(t=a[n]).keyFrames)[e.length-1].data,o&&W._propertySetFuncs[t.propertyNameID](o,null,i)}}else{var l=this._cacheNodesSpriteOwners[this._currentPlayClipIndex];for(n=0,r=l.length;n<r;n++){var h=l[n];i=(e=(t=a[n]).keyFrames)[e.length-1].data,h&&W._propertySetFuncs[t.propertyNameID](null,h,i)}}},t._setAnimationClipPropertyToAnimationNode=function(t,e,i){for(var n=0,r=e.length;n<r;n++){var a=e[n],s=t[a];if(s){var o=this._currentPlayClip._nodes[a],l=i[a];l&&W._propertySetFuncs[o.propertyNameID](s,null,l)}}},t._setAnimationClipPropertyToSprite3D=function(t,e){for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r){var a=this._currentPlayClip._nodes[i],s=e[i];s&&W._propertySetFuncs[a.propertyNameID](null,r,s)}}},t._handleSpriteOwnersBySprite=function(t,e,i,n){var r=this._clips[t],a=i.join("/"),s=r._nodesMap[a];if(s)for(var o=this._cacheNodesSpriteOwners[t],l=r._nodes,h=this._cacheNodesDefaultlValues[t],u=0,c=s.length;u<c;u++){var d=s[u],_=l.indexOf(d);if(e){o[_]=n;var f=W._propertyGetFuncs[d.propertyNameID](null,n);if(f){var m=h[_];m||(h[_]=m=new Float32Array(d.keyFrameWidth));for(var p=0,g=f.length;p<g;p++)m[p]=f[p]}}else o[_]=null}},t._evaluateAvatarNodesCacheMode=function(t,e,i,n,r){e._evaluateAnimationlDatasCacheMode(t,this._cacheFullFrames[this._currentPlayClipIndex],this,i,r),this._setAnimationClipPropertyToAnimationNode(t,r,i);for(var a=0,s=this._avatarNodes.length;a<s;a++){var o=this._avatarNodes[a].transform;if(o._worldUpdate){var l=new Float32Array(16);n[a]=l,o._setWorldMatrixAndUpdate(l)}else{var h=o.getWorldMatrix();n[a]=h||u.deafaultMatrix}}},t._evaluateAvatarNodesRealTime=function(t,e,i,n,r){e._evaluateAnimationlDatasRealTime(t,this.currentPlayTime,i,r),this._setAnimationClipPropertyToAnimationNode(t,r,i);for(var a=0,s=this._avatarNodes.length;a<s;a++){var o=this._avatarNodes[a].transform;o._worldUpdate?o._setWorldMatrixNoUpdate(n[a]):n[a]=u.deafaultMatrix}},t._updateAvatarNodesToSpriteCacheMode=function(t,e){for(var i=0,n=this._cacheSpriteToNodesMap.length;i<n;i++){var r=this._cacheSpriteToNodesMap[i],a=e[r];if(a!==u.deafaultMatrix){var s=this._avatarNodes[r].transform._entity,o=s.worldMatrix;ke.matrix4x4MultiplyMFM(this._owner._transform.worldMatrix,a,o),s.worldMatrix=o}}},t._updateAvatarNodesToSpriteRealTime=function(){for(var t=0,e=this._cacheSpriteToNodesMap.length;t<e;t++){var i=this._avatarNodes[this._cacheSpriteToNodesMap[t]],n=i.transform._entity,r=i.transform;if(r._worldUpdate){var a=u._tempMatrix4x40;r._setWorldMatrixAndUpdate(a);var s=n.worldMatrix;ke.matrix4x4MultiplyMFM(this._owner._transform.worldMatrix,a,s),n.worldMatrix=s}}},t._updatePlayer=function(t){if(null!=this._currentPlayClip&&!this._stoped&&this._currentPlayClip.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==Cn.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this._currentPlayClip._frameRate,r=this._playStartFrames[this._currentPlayClipIndex]/n,a=Math.min(this._playEndFrames[this._currentPlayClipIndex]/n,this._currentPlayClip._duration)-r;if(!this._currentPlayClip.islooping&&this._elapsedPlaybackTime>=a)return this._onAnimationStop(),this._setPlayParamsWhenStop(a,e),void this.event("stopped");if(i+=this._currentTime,0<a)if(a<=i)for(;(i-=a)<a&&(this._setPlayParams(i,e),this.event("complete")),this._playEventIndex=0,this._eventScript(0,i),a<=i;);else this._setPlayParams(i,e);else this._currentTime=this._currentFrameTime=this._currentFrameIndex=this._playEventIndex=0,this.event("complete")}},t._update=function(t){var e=this._currentPlayClip;if(2===this.playState&&e&&e.loaded){var i=this.playbackRate*S.timer.scale,n=this._cachePlayRate;this._canCache=this.isCache&&n<=i;var r,a=-1;if(this._canCache){if(a=this._currentFrameIndex,this._lastFrameIndex===a)return;if(r=e._getAnimationDataWithCache(n,a),this._avatar){var s=this._cacheNodesAvatarOwners[this._currentPlayClipIndex],o=e._cachePropertyMap,l=o.length;0<l&&(r||((r=[]).length=l,e._cacheAnimationData(n,a,r),e._evaluateAnimationlDatasCacheMode(s,this._cacheFullFrames[this._currentPlayClipIndex],this,r,o)),this._setAnimationClipPropertyToAnimationNode(s,o,r)),this._curAvatarNodeDatas=e._getAvatarDataWithCache(this._avatar,this._cachePlayRate,a),this._curAvatarNodeDatas||(this._curAvatarNodeDatas=[],this._curAvatarNodeDatas.length=this._avatarNodes.length,e._cacheAvatarData(this._avatar,this._cachePlayRate,a,this._curAvatarNodeDatas),this._evaluateAvatarNodesCacheMode(s,e,e._publicClipDatas,this._curAvatarNodeDatas,e._unCachePropertyMap)),this._updateAvatarNodesToSpriteCacheMode(e,this._curAvatarNodeDatas)}else{var h=this._cacheNodesSpriteOwners[this._currentPlayClipIndex];r||((r=[]).length=this._currentPlayClip._nodes.length,e._evaluateAnimationlDatasCacheMode(h,this._cacheFullFrames[this._currentPlayClipIndex],this,r,null),e._cacheAnimationData(n,a,r)),this._setAnimationClipPropertyToSprite3D(h,r)}}else if(r=e._publicClipDatas,this._avatar){if(e._evaluateAnimationlDatasRealTime(this._cacheNodesAvatarOwners[this._currentPlayClipIndex],this.currentPlayTime,r,e._cachePropertyMap),!this._publicAvatarNodeDatas){this._publicAvatarNodeDatas=[];var u=this._avatarNodes.length;this._publicAvatarNodeDatas.length=u;for(var c=1;c<u;c++)this._publicAvatarNodeDatas[c]=new Float32Array(16)}this._curAvatarNodeDatas=this._publicAvatarNodeDatas,this._evaluateAvatarNodesRealTime(this._cacheNodesAvatarOwners[this._currentPlayClipIndex],e,r,this._curAvatarNodeDatas,e._unCachePropertyMap),this._updateAvatarNodesToSpriteRealTime()}else e._evaluateAnimationlDatasRealTime(this._cacheNodesSpriteOwners[this._currentPlayClipIndex],this.currentPlayTime,r,null);this._lastFrameIndex=a}},t._checkAnimationNode=function(t,e){t.name!==e.name||e._transform.dummy||e._isLinkSpriteToAnimationNode(this,t,!0);for(var i=0,n=e._childs.length;i<n;i++)this._checkAnimationNode(t,e.getChildAt(i))},t._load=function(t){t.activeInHierarchy&&S.timer.frameLoop(1,this,this._updateAnimtionPlayer),this._owner.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)},t._unload=function(t){i.prototype._unload.call(this,t),t.activeInHierarchy&&S.timer.clear(this,this._updateAnimtionPlayer),this._owner.off("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged),this._curAvatarNodeDatas=null},t._destroy=function(){i.prototype._destroy.call(this);for(var t=0,e=this._clips.length;t<e;t++)this._clips[t]._removeReference();this._currentPlayClip=null,this._clipNames=null,this._cacheNodesSpriteOwners=null,this._cacheNodesAvatarOwners=null,this._cacheNodesDefaultlValues=null,this._clips=null,this._cacheFullFrames=null},t._cloneTo=function(t){var e=t;e.avatar=this.avatar;this._clips.length;for(var i=0,n=this._clips.length;i<n;i++)e.addClip(this._clips[i]);if(this.clip&&(e.clip=this.clip),this._linkSpritesData)for(var r in e._linkSpritesData={},this._linkSpritesData)e._linkSpritesData[r]=this._linkSpritesData[r].slice()},t.addClip=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=4294967295),e=e||t.name;var r=this._clipNames.indexOf(e);if(-1!==r){if(this._clips[r]!==t)throw new Error("Animation:this playName has exist with another clip.")}else{var a=this._clips.indexOf(t);if(i<0||n<0)throw new Error("Animator:startFrame and endFrame must large than zero.");if(n<i)throw new Error("Animator:startFrame must less than endFrame.");this._clipNames.push(e),this._clips.push(t),this._playStartFrames.push(i),this._playEndFrames.push(n),this._cacheNodesSpriteOwners.push([]),this._cacheNodesAvatarOwners.push([]),this._cacheNodesDefaultlValues.push([]),this._publicClipsDatas.push([]),t._addReference(),a=this._clips.length-1,this._avatar?this._avatar.loaded?this._getAvatarOwnersByClipAsync(a,t):this._avatar.once("loaded",this,this._getAvatarOwnersByClipAsync,[a,t]):this._getSpriteOwnersByClipAsync(a,t),t.loaded?this._computeCacheFullKeyframeIndices(a):t.once("loaded",this,this._computeCacheFullKeyframeIndices,[a])}},t.removeClip=function(t){var e=this._clips.indexOf(t);-1!==e&&(this._avatar?this._offClipAndAvatarRelateEvent(this._avatar,t):this._offGetSpriteOwnersByClipAsyncEvent(t),this._offGetClipCacheFullKeyframeIndicesEvent(t),this._clipNames.splice(e,1),this._clips.splice(e,1),this._playStartFrames.splice(e,1),this._playEndFrames.splice(e,1),this._cacheNodesSpriteOwners.splice(e,1),this._cacheNodesAvatarOwners.splice(e,1),this._cacheNodesDefaultlValues.splice(e,1),this._publicClipsDatas.splice(e,1),t._removeReference())},t.removeClipByName=function(t){var e=this._clipNames.indexOf(t);if(-1!==e){var i=this._clips[e];this._avatar?this._offClipAndAvatarRelateEvent(this._avatar,i):this._offGetSpriteOwnersByClipAsyncEvent(i),this._offGetClipCacheFullKeyframeIndicesEvent(i),this._clipNames.splice(e,1),this._clips.splice(e,1),this._playStartFrames.splice(e,1),this._playEndFrames.splice(e,1),this._cacheNodesSpriteOwners.splice(e,1),this._cacheNodesAvatarOwners.splice(e,1),this._cacheNodesDefaultlValues.splice(e,1),this._publicClipsDatas.splice(e,1)}},t.getClip=function(t){var e=this._clipNames.indexOf(t);return-1!==e?this._clips[e]:null},t.getClipCount=function(){return this._clips.length},t.play=function(t,e){if(void 0===e&&(e=1),!t&&-1==this._defaultClipIndex)throw new Error("Animator:must have  default clip value,please set clip property.");this._currentPlayClip=t?(this._currentPlayClipIndex=this._clipNames.indexOf(t),this._clips[this._currentPlayClipIndex]):(this._currentPlayClipIndex=this._defaultClipIndex,this._clips[this._defaultClipIndex]),this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this._playEventIndex=0,this.playbackRate=e,this._stoped=!1,this._currentFrameIndex=0,this._startUpdateLoopCount=Cn.loopCount,this._lastPlayAnimationClip&&this._lastPlayAnimationClip!==this._currentPlayClip&&this._revertKeyframeNodes(this._lastPlayAnimationClip,this._lastPlayAnimationClipIndex),this._updatePlayer(0),this._lastPlayAnimationClip=this._currentPlayClip,this._lastPlayAnimationClipIndex=this._currentPlayClipIndex},t.stop=function(){0!==this.playState&&(this._stoped=!0,this.event("stopped"))},t._getLinkSpritePath=function(t,e){e.unshift(t.name);var i=t._parent;i._hierarchyAnimator===this?this._getLinkSpritePath(i,e):e.shift()},t.linkSprite3DToAvatarNode=function(t,e){if(e._hierarchyAnimator!==this)throw"Animator:sprite3D must belong to this Animator";if(this._avatar){var i=this._avatarNodeMap[t];if(i){this._linkSpritesData=this._linkSpritesData||{};var n=[];return this._getLinkSpritePath(e,n),this._linkSpritesData[t]=n,e._isLinkSpriteToAnimationNode(this,i,!0),!0}return!1}return!1},t.unLinkSprite3DToAvatarNode=function(t){if(this._avatar){var e=t.transform.dummy;if(e){var i=this._avatarNodeMap[e._owner.name];return t._isLinkSpriteToAnimationNode(this,i,!1),!0}return!1}return!1},v(0,t,"playState",function(){return null==this._currentPlayClip?0:this._stoped?0:2}),v(0,t,"avatar",function(){return this._avatar},function(t){if(this._avatar!==t){var e=this._avatar;this._avatar=t;for(var i=this._clips.length,n=0;n<i;n++)this._offClipAndAvatarRelateEvent(e,this._clips[n]);t&&(t.loaded?this._getAvatarOwnersAndInitDatasAsync():t.once("loaded",this,this._getAvatarOwnersAndInitDatasAsync))}}),v(0,t,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){if(this._cacheFrameRate!==t){this._cacheFrameRate=t,this._cacheFrameRateInterval=1/this._cacheFrameRate;for(var e=0,i=this._clips.length;e<i;e++)this._clips[e].loaded&&this._computeCacheFullKeyframeIndices(e)}}),v(0,t,"clip",function(){return this._clips[this._defaultClipIndex]},function(t){var e=t?this._clips.indexOf(t):-1;this._defaultClipIndex!==e&&(-1!==this._defaultClipIndex&&this.removeClip(this._clips[this._defaultClipIndex]),-1!==e&&this.addClip(t,t.name),this._defaultClipIndex=e)}),v(0,t,"currentFrameIndex",function(){return this._currentFrameIndex}),v(0,t,"cachePlayRate",function(){return this._cachePlayRate},function(t){if(this._cachePlayRate!==t){this._cachePlayRate=t;for(var e=0,i=this._clips.length;e<i;e++)this._clips[e].loaded&&this._computeCacheFullKeyframeIndices(e)}}),v(0,t,"currentFrameTime",function(){return this._currentFrameTime}),v(0,t,"currentPlayClip",function(){return this._currentPlayClip}),v(0,t,"currentPlayTime",function(){return this._currentTime+this._playStartFrames[this._currentPlayClipIndex]/this._currentPlayClip._frameRate}),v(0,t,"playbackTime",null,function(t){if(null!=this._currentPlayClip&&this._currentPlayClip&&this._currentPlayClip.loaded){this._startUpdateLoopCount=Cn.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentFrameIndex=Math.floor(this.currentPlayTime/e),this._currentFrameTime=this._currentFrameIndex*e}}),v(0,t,"paused",function(){return this._stoped},function(t){(this._stoped=t)&&this.event("paused")}),m(u,["deafaultMatrix",function(){return this.deafaultMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new Float32Array(16)}]),u}(yr),Ta=function(t){function e(){e.__super.call(this),this._isRigidbody=!1,this._runtimeCollisonMap={},this._runtimeCollisonTestMap={},this._ignoreCollisonMap={},this.isTrigger=!0}E(e,"laya.d3.component.physics.Collider",t);var i=e.prototype;return i._clearCollsionMap=function(){for(var t in this._runtimeCollisonMap){var e=this._runtimeCollisonMap[t];delete e._runtimeCollisonMap[this.id],e._isRigidbody&&delete e._runtimeCollisonTestMap[this.id];var i=e.id;delete this._runtimeCollisonMap[i],this._isRigidbody&&delete this._runtimeCollisonTestMap[i]}},i._unload=function(t){for(var e in this._runtimeCollisonMap){var i=this._runtimeCollisonMap[e];delete i._runtimeCollisonMap[this.id],i._isRigidbody&&delete i._runtimeCollisonTestMap[this.id],delete this._ignoreCollisonMap[e]._ignoreCollisonMap[this.id]}},i._setIsRigidbody=function(t){if(this._isRigidbody!==t){this._isRigidbody=t;var e=this._owner;if(e.displayedInStage){var i=e.layer;i._removeCollider(this),i._addCollider(this)}}},i._getType=function(){return-1},i._collisonTo=function(t){return!1},i.raycast=function(t,e,i){throw void 0===i&&(i=179e306),new Error("Collider:Must override it.")},v(0,i,"enable",t.prototype._$get_enable,function(t){this._enable!==t&&(this._owner.displayedInStage&&(t||this._clearCollsionMap()),this._enable=t,this.event("enablechanged",this._enable))}),v(0,i,"isSingleton",function(){return e._isSingleton}),e._isSingleton=!1,e}(yr),Sa=function(t){function e(){e.__super.call(this)}return E(e,"laya.d3.component.Rigidbody",t),v(0,e.prototype,"enable",t.prototype._$get_enable,function(t){if(this._enable!==t){for(var e=this._owner._colliders,i=0,n=e.length;i<n;i++){var r=e[i];r._setIsRigidbody(t);var a=r._runtimeCollisonMap,s=r._runtimeCollisonTestMap;if(!t)for(var o in a)delete s[o]}this._enable=t,this.event("enablechanged",this._enable)}}),e}(yr),Ea=function(t){function e(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._avatarDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._cachePropertyMap=null,this._nodeToCachePropertyMap=null,this._unCachePropertyMap=null,this._duration=NaN,this._frameRate=0,this._animationEvents=null,this._publicClipDatas=null,this.islooping=!1,e.__super.call(this),this._fullKeyframeIndicesCache={},this._animationDatasCache=[],this._avatarDatasCache=[],this._skinnedDatasCache=[],this._animationEvents=[]}E(e,"laya.d3.animation.AnimationClip",br);var i=e.prototype;return i.duration=function(){return this._duration},i._hermiteInterpolate=function(t,e,i,n){for(var r=t.data,a=t.outTangent,s=t.next,o=s.data,l=s.inTangent,h=!1,u=NaN,c=NaN,d=NaN,_=NaN,f=0,m=n.length;f<m;f++){var p=a[f],g=l[f];if(Number.isFinite(p)&&Number.isFinite(g)){if(!h){var v=e*e,y=v*e;u=2*y-3*v+1,c=y-2*v+e,d=y-v,_=-2*y+3*v,h=!0}n[f]=u*r[f]+c*p*i+d*g*i+_*o[f]}else n[f]=r[f]}},i._getFullKeyframeIndicesWithCache=function(t){return this._fullKeyframeIndicesCache[t]},i._cacheFullKeyframeIndices=function(t,e){this._fullKeyframeIndicesCache[t]=e},i._getAnimationDataWithCache=function(t,e){var i=this._animationDatasCache[t];return i?i[e]:null},i._cacheAnimationData=function(t,e,i){(this._animationDatasCache[t]||(this._animationDatasCache[t]=[]))[e]=i},i._getAvatarDataWithCache=function(t,e,i){var n=this._avatarDatasCache[t.id];if(n){var r=n[e];return r?r[i]:null}return null},i._cacheAvatarData=function(t,e,i,n){var r=this._avatarDatasCache[t.id]||(this._avatarDatasCache[t.id]=[]);(r[e]||(r[e]=[]))[i]=n},i._evaluateAnimationlDatasCacheMode=function(t,e,i,n,r){for(var a=0,s=0,o=0,l=r?r.length:this._nodes.length;o<l;o++){var h=r?r[o]:o,u=this._nodes[h],c=u._cacheProperty;if(t[h]){var d,_=e[h],f=_[i.currentFrameIndex],m=0;if(-1!==f){var p=u.keyFrames[f];if(p.next){r&&!c?(d=n[h])||(d=n[h]=new Float32Array(u.keyFrameWidth)):(d=new Float32Array(u.keyFrameWidth),n[o]=d);var g=NaN,v=p.duration;g=0!==v?(i.currentFrameTime-p.startTime)/v:0,this._hermiteInterpolate(p,g,v,d)}else{if(r&&!c)(d=n[h])||(d=n[h]=new Float32Array(u.keyFrameWidth));else{if(-1!==(m=i._lastFrameIndex)&&_[m]===f)continue;d=new Float32Array(u.keyFrameWidth),n[o]=d}var y=p.data;for(a=0,s=d.length;a<s;a++)d[a]=y[a]}}else{if(r&&!c)(d=n[h])||(d=n[h]=new Float32Array(u.keyFrameWidth));else{if(-1!==(m=i._lastFrameIndex)&&_[m]===f)continue;d=new Float32Array(u.keyFrameWidth),n[o]=d}var x=u.keyFrames[0].data;for(a=0,s=d.length;a<s;a++)d[a]=x[a]}}}},i._evaluateAnimationlDatasRealTime=function(t,e,i,n){var r=0,a=0,s=this._nodes;if(!this._realTimeCurrentFrameIndexes){for(this._realTimeCurrentFrameIndexes=new Int32Array(s.length),r=0,a=s.length;r<a;r++)this._realTimeCurrentFrameIndexes[r]=-1;this._realTimeCurrentTimes=new Float32Array(s.length)}for(r=0,a=n?n.length:this._nodes.length;r<a;r++){var o=n?n[r]:r,l=s[o];e<this._realTimeCurrentTimes[o]&&(this._realTimeCurrentFrameIndexes[o]=-1),this._realTimeCurrentTimes[o]=e;for(var h=this._realTimeCurrentFrameIndexes[o]+1,u=l.keyFrames,c=u.length;h<c;){if(u[h].startTime>e){this._realTimeCurrentFrameIndexes[o]=h-1;break}h++}h===c&&(this._realTimeCurrentFrameIndexes[o]=c-1);var d=0,_=0,f=i[o];f||(f=i[o]=new Float32Array(l.keyFrameWidth));var m=u[this._realTimeCurrentFrameIndexes[o]];if(m){if(m.next){var p=m.duration,g=NaN;g=0!==p?(e-m.startTime)/p:0,this._hermiteInterpolate(m,g,p,f)}else{var v=m.data;for(d=0,_=f.length;d<_;d++)f[d]=v[d]}}else{var y=l.keyFrames[0].data;for(d=0,_=f.length;d<_;d++)f[d]=y[d]}var x=t[o];x&&(n?W._propertySetFuncs[l.propertyNameID](x,null,f):W._propertySetFuncs[l.propertyNameID](null,x,f))}},i._binarySearchEventIndex=function(t){for(var e=0,i=this._animationEvents.length-1,n=0;e<=i;){n=Math.floor((e+i)/2);var r=this._animationEvents[n].time;if(r==t)return n;t<r?i=n-1:e=n+1}return e},i.addEvent=function(t){var e=this._binarySearchEventIndex(t.time);this._animationEvents.splice(e,0,t)},i.onAsynLoaded=function(t,e,i){var n=new yn(e);switch(this._version=n.readUTFString(),this._version){case"LAYAANIMATION:01":p.parse(this,n);break;case"LAYAANIMATION:02":g.parse(this,n)}this.completeCreate(),this._endLoaded()},i.disposeResource=function(){this._realTimeCurrentFrameIndexes=null,this._realTimeCurrentTimes=null,this._fullKeyframeIndicesCache=null,this._animationDatasCache=null,this._avatarDatasCache=null,this._skinnedDatasCache=null,this._version=null,this._nodes=null,this._nodesMap=null,this._cachePropertyMap=null,this._nodeToCachePropertyMap=null,this._unCachePropertyMap=null,this._publicClipDatas=null},e.load=function(t){return S.loader.create(t,null,null,e)},e}(),Ra=function(t){function e(){e.__super.call(this)}E(e,"laya.d3.core.Avatar",br);var i=e.prototype;return S.imps(i,{"laya.d3.core.IClone":!0}),i._initCloneToAnimator=function(t,e){e._avatarNodeMap[t.name]=t,e._avatarNodes.push(t);for(var i=0,n=t.getChildCount();i<n;i++)this._initCloneToAnimator(t.getChildByIndex(i),e)},i._parseNode=function(t,e){var i=t.props.name;if(e.name=i,e._parent){var n=t.customProps,r=e.transform;r._localRotationEuler=new Float32Array(3),r.setLocalPosition(new Float32Array(n.translate)),r.setLocalRotation(new Float32Array(n.rotation)),r.setLocalScale(new Float32Array(n.scale)),r._setWorldMatrixAndUpdate(new Float32Array(16))}for(var a=t.child,s=0,o=a.length;s<o;s++){var l=a[s],h=new W;e.addChild(h),this._parseNode(l,h)}},i.onAsynLoaded=function(t,e,i){if(this._rootNode=new W,e.version){this._version=e.version;var n=e.rootNode;n&&this._parseNode(n,this._rootNode)}else this._parseNode(e,this._rootNode);this._endLoaded()},i._cloneDatasToAnimator=function(t){var e=this._rootNode.clone();e.transform._setWorldMatrixIgnoreUpdate(null);t._avatarNodeMap={},t._avatarNodes=[],this._initCloneToAnimator(e,t)},i.cloneTo=function(t){var e=t,i=this._rootNode.clone();e._rootNode=i},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.load=function(t){return S.loader.create(t,null,null,e)},e}(),wa=function(t){function e(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,e.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}E(e,"laya.d3.core.ComponentNode",Tr);var i=e.prototype;return i.addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=bn.getInstance(t);return e.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},i._removeComponent=function(t,e){var i=this._typeComponentsIndices[t],n=i[e],r=this._components[n];this._components.splice(n,1),r instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(r),1),i.splice(e,1),0===i.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1));for(var a=0,s=this._componentsMap.length;a<s;a++)for(var o=(i=this._typeComponentsIndices[a]).length-1;0<=o;o--){var l=i[o];if(!(n<l))break;i[o]=--l}r._destroy()},i.getComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);return-1===i?null:this._components[this._typeComponentsIndices[i][e]]},i.getComponentsByType=function(t,e){var i=this._componentsMap.indexOf(t);if(-1!==i){var n=this._typeComponentsIndices[i],r=n.length;e.length=r;for(var a=0;a<r;a++)e[a]=this._components[n[a]]}else e.length=0},i.getComponentByIndex=function(t){return this._components[t]},i.removeComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);-1!==i&&this._removeComponent(i,e)},i.removeComponentsByType=function(t){var e=this._componentsMap.indexOf(t);if(-1!==e)for(var i=this._typeComponentsIndices[e],n=0,r=i.length;n<r;i.length<r?r--:n++)this._removeComponent(e,n)},i.removeAllComponent=function(){for(var t=0,e=this._componentsMap.length;t<e;this._componentsMap.length<e?e--:t++)this.removeComponentsByType(this._componentsMap[t])},i._updateComponents=function(t){for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.enable&&n._update(t)}},i._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._lateUpdate(t)}},i._preRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._preRenderUpdate(t)}},i._postRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._postRenderUpdate(t)}},e}(),Ca=(function(t){function n(){this.isCached=!1,this.canvas=null,this.tex=null,this.rec=null,n.__super.call(this)}E(n,"laya.ani.bone.canvasmesh.CacheAbleSkinMesh",Rr);var e=n.prototype;e.getCanvasPic=function(){var t,e=new Ys("2D"),i=e.getContext("2d");return this.rec=this.mesh.getBounds(),e.size(this.rec.width,this.rec.height),t=this.transform,this.transform=n.tempMt,this.transform.identity(),this.transform.translate(-this.rec.x,-this.rec.y),this.renderToContext(i),this.transform.translate(+this.rec.x,+this.rec.y),this.transform=t,new Hr(e)},e.render=function(t,e,i){this.mesh.texture&&(this.isCached||(this.isCached=!0,this.tex=this.getCanvasPic()),this.transform?(this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i)):(this.transform=Rr._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i),this.transform=null))},e._renderTextureToContext=function(t){var e;if(this.context=t.ctx||t,t.save(),e=this.tex,this.transform){var i=this.transform;t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}this.rec=this.mesh.getBounds(),t.translate(this.rec.x,this.rec.y),t.drawTexture(e,0,0,e.width,e.height,0,0),t.restore()},m(n,["tempMt",function(){return this.tempMt=new tn}])}(),function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),e._gl=mr.mainContext}E(e,"laya.webgl.utils.Buffer",br);var i=e.prototype;return i._bind=function(){this.activeResource(),e._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(e._bindVertexBuffer=this._glBuffer),e._gl.bindBuffer(this._bufferType,e._bindActive[this._bufferType]=this._glBuffer),Pa.activeShader=null)},i.recreateResource=function(){this._glBuffer||(this._glBuffer=e._gl.createBuffer()),this.completeCreate()},i.disposeResource=function(){this._glBuffer&&(mr.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},v(0,i,"bufferUsage",function(){return this._bufferUsage}),e._gl=null,e._bindActive={},e._bindVertexBuffer=null,e._enableAtributes=[],e}()),Ia=function(t){function e(t){e.__super.call(this,t)}E(e,"laya.d3.core.GlitterRender",Cr);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},i._renderUpdate=function(t){this._setShaderValueMatrix4x4(0,this._owner.transform.worldMatrix);var e=this._owner.getProjectionViewWorldMatrix(t);this._setShaderValueMatrix4x4(1,e);var i=this._owner.templet;return this._setShaderValueNumber(3,i.lifeTime),this._setShaderValueNumber(2,i._currentTime),!0},e}(),Ma=function(t){function e(t){this._owner=null,this._sharedMesh=null,e.__super.call(this),this._owner=t}E(e,"laya.d3.core.MeshFilter",t);var i=e.prototype;return i._sharedMeshLoaded=function(){this.event("loaded")},i._destroy=function(){t.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},v(0,i,"sharedMesh",function(){return this._sharedMesh},function(t){var e=this._sharedMesh;e&&e._removeReference(),(this._sharedMesh=t)._addReference(),this.event("meshchanged",[this,e,t]),t.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),v(0,i,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),v(0,i,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),v(0,i,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),v(0,i,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),e}(wr),Aa=function(t){function e(t){e.__super.call(this,t),t.meshFilter.on("meshchanged",this,this._onMeshChanged)}E(e,"laya.d3.core.MeshRender",Cr);var i=e.prototype;return i._onMeshChanged=function(t,e,i){i.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:i.once("loaded",this,this._onMeshLoaed)},i._onMeshLoaed=function(t,e){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},i._calculateBoundingSphereByInitSphere=function(t){var e=NaN,i=this._owner.transform,n=i.scale.elements,r=Math.abs(n[0]),a=Math.abs(n[1]),s=Math.abs(n[2]);e=a<=r&&s<=r?r:s<=a?a:s,we.transformCoordinate(t.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*e},i._calculateBoundBoxByInitCorners=function(t){for(var e=this._owner.transform.worldMatrix,i=0;i<8;i++)we.transformCoordinate(t[i],e,Cr._tempBoundBoxCorners[i]);_e.createfromPoints(Cr._tempBoundBoxCorners,this._boundingBox)},i._calculateBoundingSphere=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(t.boundingSphere)},i._calculateBoundingBox=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(t.boundingBoxCorners)},i._renderUpdate=function(t){var e=this._owner.transform;if(e){this._setShaderValueMatrix4x4(0,e.worldMatrix);var i=this._owner.getProjectionViewWorldMatrix(t);this._setShaderValueMatrix4x4(1,i)}else this._setShaderValueMatrix4x4(0,ye.DEFAULT),this._setShaderValueMatrix4x4(1,t);return gr.debugMode&&this._renderRenderableBoundBox(),!0},e}(),Da=function(t){function j(t){j.__super.call(this),this._tempRotationMatrix=new ye,this._uvLength=new Re,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._owner=t,this._ownerRender=t.particleRender,this._boundingBoxCorners=R(8,null),this._boundingSphere=new me(new we,Number.MAX_VALUE),this._boundingBox=new _e(new we(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new we(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this._currentTime=0,this._isEmitting=!1,this._isPlaying=!1,this._isPaused=!1,this._burstsIndex=0,this._frameRateTime=0,this._emissionTime=0,this._totalDelayTime=0,this._simulateUpdate=!1,this._bufferMaxParticles=1,this.duration=5,this.looping=!0,this.prewarm=!1,this.startDelayType=0,this.startDelay=0,this.startDelayMin=0,this.startDelayMax=0,this._startLifetimeType=0,this._startLifetimeConstant=5,this._startLifeTimeGradient=new F,this._startLifetimeConstantMin=0,this._startLifetimeConstantMax=5,this._startLifeTimeGradientMin=new F,this._startLifeTimeGradientMax=new F,this._maxStartLifetime=5,this.startSpeedType=0,this.startSpeedConstant=5,this.startSpeedConstantMin=0,this.startSpeedConstantMax=5,this.threeDStartSize=!1,this.startSizeType=0,this.startSizeConstant=1,this.startSizeConstantSeparate=new we(1,1,1),this.startSizeConstantMin=0,this.startSizeConstantMax=1,this.startSizeConstantMinSeparate=new we(0,0,0),this.startSizeConstantMaxSeparate=new we(1,1,1),this.threeDStartRotation=!1,this.startRotationType=0,this.startRotationConstant=0,this.startRotationConstantSeparate=new we(0,0,0),this.startRotationConstantMin=0,this.startRotationConstantMax=0,this.startRotationConstantMinSeparate=new we(0,0,0),this.startRotationConstantMaxSeparate=new we(0,0,0),this.randomizeRotationDirection=0,this.startColorType=0,this.startColorConstant=new Ce(1,1,1,1),this.startColorConstantMin=new Ce(1,1,1,1),this.startColorConstantMax=new Ce(1,1,1,1),this.gravityModifier=0,this.simulationSpace=1,this.scaleMode=0,this.playOnAwake=!0,this._rand=new Se(0),this.autoRandomSeed=!0,this.randomSeed=new Uint32Array(1),this._randomSeeds=new Uint32Array(j._RANDOMOFFSET.length),this.isPerformanceMode=!0,this._emission=new I,this._emission.enbale=!0,this._owner.on("activeinhierarchychanged",this,this._onOwnerActiveHierarchyChanged)}E(j,"laya.d3.core.particleShuriKen.ShurikenParticleSystem",t);var e=j.prototype;return S.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.d3.core.IClone":!0}),e._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._generateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},e._generateBoundingBox=function(){var t=this._owner.particleRender,e=this._boundingBox.min,i=this._boundingBox.max,n=0,r=0,a=NaN;switch(this.startLifetimeType){case 0:a=this.startLifetimeConstant;break;case 1:a=-Number.MAX_VALUE;var s=s;for(n=0,r=s.gradientCount;n<r;n++)a=Math.max(a,s.getValueByIndex(n));break;case 2:a=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:a=-Number.MAX_VALUE;var o=o;for(n=0,r=o.gradientCount;n<r;n++)a=Math.max(a,o.getValueByIndex(n));var l=l;for(n=0,r=l.gradientCount;n<r;n++)a=Math.max(a,l.getValueByIndex(n))}var h,u,c,d,_=NaN,f=NaN;switch(this.startSpeedType){case 0:_=f=this.startSpeedConstant;break;case 1:break;case 2:_=this.startLifetimeConstantMin,f=this.startLifetimeConstantMax}this._shape&&this._shape.enable||(h=u=we.ZERO,c=we.ZERO,d=we.UnitZ);var m,p,g=new we(c.x*_,c.y*_,c.z*_),v=new we(d.x*f,d.y*f,d.z*f);if(this._velocityOverLifetime&&this._velocityOverLifetime.enbale){var y=this._velocityOverLifetime.velocity;switch(y.type){case 0:y.constant;break;case 1:new we(y.gradientX.getAverageValue(),y.gradientY.getAverageValue(),y.gradientZ.getAverageValue());break;case 2:y.constantMin,y.constantMax;break;case 3:new we(y.gradientXMin.getAverageValue(),y.gradientYMin.getAverageValue(),y.gradientZMin.getAverageValue()),new we(y.gradientXMax.getAverageValue(),y.gradientYMax.getAverageValue(),y.gradientZMax.getAverageValue())}}var x,b,T=this._owner.transform,S=T.position,E=j._tempVector39,R=E.elements,w=t.renderMode;switch(this.scaleMode){case 0:var C=T.scale;m=C,R[0]=C.x,R[1]=C.z,R[2]=C.y,1===w&&(p=C);break;case 1:var I=T.localScale;m=I,R[0]=I.x,R[1]=I.z,R[2]=I.y,1===w&&(p=I);break;case 2:m=T.scale,R[0]=R[1]=R[2]=1,1===w&&(p=we.ONE)}switch(this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(x=new we(g.x*a,g.y*a,g.z*a),b=new we(v.x*a,v.y*a,v.z*a),2!=this.scaleMode?(we.add(h,x,e),we.multiply(m,e,e),we.add(u,b,i),we.multiply(m,i,i)):(we.multiply(m,h,e),we.add(e,x,e),we.multiply(m,u,i),we.add(i,b,i))),this.simulationSpace){case 0:break;case 1:we.add(e,S,e),we.add(i,S,i)}var M=NaN,A=NaN;switch(this.startSizeType){case 0:if(this.threeDStartSize){var D=D;M=Math.max(D.x,D.y),1===w&&(A=D.y)}else M=this.startSizeConstant,1===w&&(A=this.startSizeConstant);break;case 1:break;case 2:if(this.threeDStartSize){var L=L;M=Math.max(L.x,L.y),1===w&&(A=L.y)}else M=this.startSizeConstantMax,1===w&&(A=this.startSizeConstantMax)}if(this._sizeOverLifetime&&this._sizeOverLifetime.enbale){this._sizeOverLifetime.size;M*=this._sizeOverLifetime.size.getMaxSizeInGradient()}var V=j._tempVector30,N=V.elements,P=NaN,F=NaN;switch(w){case 0:P=M*j.halfKSqrtOf2,we.scale(E,M,V),we.subtract(e,V,e),we.add(i,V,i);break;case 1:var O=j._tempVector31,B=j._tempVector32,G=j._tempVector33,W=j._tempVector34;this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(we.multiply(p,v,B),we.multiply(p,g,G));var U=A*t.stretchedBillboardLengthScale,Z=we.scalarLength(B)*t.stretchedBillboardSpeedScale+U,k=we.scalarLength(G)*t.stretchedBillboardSpeedScale+U,H=j._tempVector35,X=j._tempVector36;we.normalize(B,H),we.scale(H,Z,W),we.subtract(b,W,W),we.normalize(G,X),we.scale(X,k,O),we.add(x,O,O),P=M*j.halfKSqrtOf2,we.scale(E,P,V);var Y=j._tempVector37,z=j._tempVector38;we.scale(H,.5,Y),we.scale(X,.5,z),we.multiply(Y,E,Y),we.multiply(z,E,z),we.add(e,z,e),we.min(e,W,e),we.subtract(e,V,e),we.subtract(i,Y,i),we.max(i,O,i),we.add(i,V,i);break;case 2:F=.5*(M*=Math.cos(.7853981633974483)),N[0]=E.x*F,N[1]=E.z*F,we.subtract(e,V,e),we.add(i,V,i);break;case 3:F=.5*(M*=Math.cos(.7853981633974483)),we.scale(E,F,V),we.subtract(e,V,e),we.add(i,V,i)}this._boundingBox.getCorners(this._boundingBoxCorners)},e._updateEmission=function(){if(S.stage.isVisibility&&this.isAlive)if(this._simulateUpdate)this._simulateUpdate=!1;else{var t=this._startUpdateLoopCount===Cn.loopCount||this._isPaused?0:S.timer.delta/1e3;t=Math.min(j._maxElapsedTime,t),this._updateParticles(t)}},e._updateParticles=function(t){(4!==this._ownerRender.renderMode||this._ownerRender.mesh)&&(this._currentTime+=t,this._retireActiveParticles(),this._freeRetiredParticles(),this._totalDelayTime+=t,this._totalDelayTime<this._playStartDelay||this._emission.enbale&&this._isEmitting&&!this._isPaused&&this._advanceTime(t,this._currentTime))},e._updateParticlesSimulationRestart=function(t){this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._burstsIndex=0,this._frameRateTime=t,this._emissionTime=0,this._totalDelayTime=0;var e=this._currentTime=t;e<this._playStartDelay?this._totalDelayTime=e:this._emission.enbale&&this._advanceTime(t,t)},e._addUpdateEmissionToTimer=function(){S.timer.frameLoop(1,this,this._updateEmission)},e._removeUpdateEmissionToTimer=function(){S.timer.clear(this,this._updateEmission)},e._onOwnerActiveHierarchyChanged=function(t){this._owner.displayedInStage&&(t?this._addUpdateEmissionToTimer():this._removeUpdateEmissionToTimer())},e._retireActiveParticles=function(){for(;this._firstActiveElement!=this._firstNewElement;){var t=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride,e=t+this._timeIndex;if(this._currentTime-this._vertices[e]+1e-4<this._vertices[t+this._startLifeTimeIndex])break;this._vertices[e]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this._bufferMaxParticles&&(this._firstActiveElement=0)}},e._freeRetiredParticles=function(){for(;this._firstRetiredElement!=this._firstActiveElement;){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];if(this.isPerformanceMode&&t<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this._bufferMaxParticles&&(this._firstRetiredElement=0)}},e._burst=function(t,e){for(var i=0,n=this._emission._bursts,r=n.length;this._burstsIndex<r;this._burstsIndex++){var a=n[this._burstsIndex],s=a.time;if(!(t<=s&&s<e))break;var o=0;this.autoRandomSeed?o=$i.lerp(a.minCount,a.maxCount,Math.random()):(this._rand.seed=this._randomSeeds[0],o=$i.lerp(a.minCount,a.maxCount,this._rand.getFloat()),this._randomSeeds[0]=this._rand.seed),i+=o}return i},e._advanceTime=function(t,e){var i=0,n=this._emissionTime;this._emissionTime+=t;var r=0;if(this._emissionTime>this.duration){if(!this.looping){for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);return this._isPlaying=!1,void this.stop()}r+=this._burst(n,this._emissionTime),this._emissionTime-=this.duration,this.event("complete"),this._burstsIndex=0,r+=this._burst(0,this._emissionTime)}else r+=this._burst(n,this._emissionTime);for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);var a=this.emission.emissionRate;if(0<a){var s=1/a;for(this._frameRateTime+=s,this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;this._frameRateTime<=e&&this.emit(this._frameRateTime);)this._frameRateTime+=s;this._frameRateTime=Math.floor(e/s)*s}},e._initBufferDatas=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy());var t=this._ownerRender,e=t.renderMode;if(-1!==e&&0<this.maxParticles){var i,n,r=0,a=0,s=0,o=0,l=0,h=t.mesh;if(4===e){if(h){if(1<h._vertexBuffers.length)throw new Error("ShurikenParticleSystem: submesh Count mesh be One or all subMeshes have the same vertexDeclaration.");n=le.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=12,this._timeIndex=16,this._vertexStride=h._vertexBuffers[0].vertexCount;var u=this._bufferMaxParticles*this._vertexStride,c=u%65535;if(1<Math.floor(u/65535)+1)throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.");this._vertexBuffer=ws.create(n,c,35048),this._vertices=new Float32Array(this._floatCountPerVertex*c),this._indexStride=h._indexBuffer.indexCount;var d=h._indexBuffer.getData(),_=this._bufferMaxParticles*this._indexStride;for(this._indexBuffer=Rs.create("ushort",_,35044),i=new Uint16Array(_),r=o=0;r<this._bufferMaxParticles;r++){var f=r*this._vertexStride;for(a=0,s=d.length;a<s;a++)i[o++]=f+d[a]}this._indexBuffer.setData(i)}}else{for(n=oe.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=7,this._timeIndex=11,this._vertexStride=4,this._vertexBuffer=ws.create(n,this._bufferMaxParticles*this._vertexStride,35048),this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride),r=0;r<this._bufferMaxParticles;r++)l=r*this._floatCountPerVertex*this._vertexStride,this._vertices[l]=-.5,this._vertices[l+1]=-.5,this._vertices[l+2]=0,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=-.5,this._vertices[l+2]=1,this._vertices[l+3]=1,l+=this._floatCountPerVertex,this._vertices[l]=.5,this._vertices[l+1]=.5,this._vertices[l+2]=1,this._vertices[l+3]=0,l+=this._floatCountPerVertex,this._vertices[l]=-.5,this._vertices[l+1]=.5,this._vertices[l+2]=0,this._vertices[l+3]=0;for(this._indexStride=6,this._indexBuffer=Rs.create("ushort",6*this._bufferMaxParticles,35044),i=new Uint16Array(6*this._bufferMaxParticles),r=0;r<this._bufferMaxParticles;r++){o=6*r;var m=r*this._vertexStride,p=m+2;i[o++]=m,i[o++]=p,i[o++]=m+1,i[o++]=m,i[o++]=m+3,i[o++]=p}this._indexBuffer.setData(i)}}},e._destroy=function(){t.prototype._destroy.call(this),this._owner.activeInHierarchy&&this._removeUpdateEmissionToTimer(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._emission._destroy(),this._owner=null,this._vertices=null,this._vertexBuffer=null,this._indexBuffer=null,this._emission=null,this._shape=null,this.startLifeTimeGradient=null,this.startLifeTimeGradientMin=null,this.startLifeTimeGradientMax=null,this.startSizeConstantSeparate=null,this.startSizeConstantMinSeparate=null,this.startSizeConstantMaxSeparate=null,this.startRotationConstantSeparate=null,this.startRotationConstantMinSeparate=null,this.startRotationConstantMaxSeparate=null,this.startColorConstant=null,this.startColorConstantMin=null,this.startColorConstantMax=null,this._velocityOverLifetime=null,this._colorOverLifetime=null,this._sizeOverLifetime=null,this._rotationOverLifetime=null,this._textureSheetAnimation=null},e.emit=function(t){var e=j._tempPosition,i=j._tempDirection;if(this._shape&&this._shape.enable)this.autoRandomSeed?this._shape.generatePositionAndDirection(e,i):this._shape.generatePositionAndDirection(e,i,this._rand,this._randomSeeds);else{var n=e.elements,r=i.elements;n[0]=n[1]=n[2]=0,r[0]=r[1]=0,r[2]=1}return this.addParticle(e,i,t)},e.addParticle=function(t,e,i){we.normalize(e,e);var n=this._firstFreeElement+1;if(n>=this._bufferMaxParticles&&(n=0),n===this._firstRetiredElement)return!1;if(H.create(this,this._ownerRender,this._owner.transform),this._currentTime-i>=H.startLifeTime)return!0;var r=NaN,a=NaN,s=NaN,o=NaN,l=NaN,h=NaN,u=NaN,c=this._velocityOverLifetime&&this._velocityOverLifetime.enbale;if(c){var d=this._velocityOverLifetime.velocity.type;2===d||3===d?this.autoRandomSeed?(r=Math.random(),a=Math.random(),s=Math.random()):(this._rand.seed=this._randomSeeds[9],r=this._rand.getFloat(),a=this._rand.getFloat(),s=this._rand.getFloat(),this._randomSeeds[9]=this._rand.seed):c=!1}else c=!1;var _=this._colorOverLifetime&&this._colorOverLifetime.enbale;_?3===this._colorOverLifetime.color.type?this.autoRandomSeed?o=Math.random():(this._rand.seed=this._randomSeeds[10],o=this._rand.getFloat(),this._randomSeeds[10]=this._rand.seed):_=!1:_=!1;var f=this._sizeOverLifetime&&this._sizeOverLifetime.enbale;f?3===this._sizeOverLifetime.size.type?this.autoRandomSeed?l=Math.random():(this._rand.seed=this._randomSeeds[11],l=this._rand.getFloat(),this._randomSeeds[11]=this._rand.seed):f=!1:f=!1;var m=this._rotationOverLifetime&&this._rotationOverLifetime.enbale;if(m){var p=this._rotationOverLifetime.angularVelocity.type;2===p||3===p?this.autoRandomSeed?h=Math.random():(this._rand.seed=this._randomSeeds[12],h=this._rand.getFloat(),this._randomSeeds[12]=this._rand.seed):m=!1}else m=!1;var g=this._textureSheetAnimation&&this._textureSheetAnimation.enable;g?3===this._textureSheetAnimation.frame.type?this.autoRandomSeed?u=Math.random():(this._rand.seed=this._randomSeeds[15],u=this._rand.getFloat(),this._randomSeeds[15]=this._rand.seed):g=!1:g=!1;var v,y=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride,x=H.startUVInfo[0],b=H.startUVInfo[1],T=H.startUVInfo[2],S=H.startUVInfo[3],E=t.elements,R=e.elements,w=0,C=0,I=0,M=0,A=0,D=this._ownerRender;if(4===D.renderMode){var L=D.mesh._vertexBuffers[0];v=L.getData();var V=L.vertexDeclaration;C=V.getVertexElementByUsage(0).offset/4;var N=V.getVertexElementByUsage(1);I=N?N.offset/4:-1;var P=V.getVertexElementByUsage(2);M=P?P.offset/4:-1,w=V.vertexStride/4,A=0}else{this._vertices[y+2]=T,this._vertices[y+3]=S+b;var F=y+this._floatCountPerVertex;this._vertices[F+2]=T+x,this._vertices[F+3]=S+b;var O=F+this._floatCountPerVertex;this._vertices[O+2]=T+x,this._vertices[O+3]=S;var B=O+this._floatCountPerVertex;this._vertices[B+2]=T,this._vertices[B+3]=S}for(var G=y,W=y+this._floatCountPerVertex*this._vertexStride;G<W;G+=this._floatCountPerVertex){var U=0;if(4===D.renderMode){U=G;var Z=w*A++,k=Z+C;this._vertices[U++]=v[k++],this._vertices[U++]=v[k++],this._vertices[U++]=v[k],this._vertices[U++]=-1===I?(this._vertices[U++]=1,this._vertices[U++]=1,this._vertices[U++]=1):(k=Z+I,this._vertices[U++]=v[k++],this._vertices[U++]=v[k++],this._vertices[U++]=v[k++],v[k]),this._vertices[U++]=-1===M?this._vertices[U++]=0:(k=Z+M,this._vertices[U++]=T+v[k++]*x,S+v[k]*b)}else U=G+4;switch(this._vertices[U++]=E[0],this._vertices[U++]=E[1],this._vertices[U++]=E[2],this._vertices[U++]=H.startLifeTime,this._vertices[U++]=R[0],this._vertices[U++]=R[1],this._vertices[U++]=R[2],this._vertices[U++]=i,this._vertices[U++]=H.startColor[0],this._vertices[U++]=H.startColor[1],this._vertices[U++]=H.startColor[2],this._vertices[U++]=H.startColor[3],this._vertices[U++]=H.startSize[0],this._vertices[U++]=H.startSize[1],this._vertices[U++]=H.startSize[2],this._vertices[U++]=H.startRotation[0],this._vertices[U++]=H.startRotation[1],this._vertices[U++]=H.startRotation[2],this._vertices[U++]=H.startSpeed,_&&(this._vertices[U+1]=o),f&&(this._vertices[U+2]=l),m&&(this._vertices[U+3]=h),g&&(this._vertices[U+4]=u),c&&(this._vertices[U+5]=r,this._vertices[U+6]=a,this._vertices[U+7]=s),this.simulationSpace){case 0:U+=8,this._vertices[U++]=H.simulationWorldPostion[0],this._vertices[U++]=H.simulationWorldPostion[1],this._vertices[U++]=H.simulationWorldPostion[2],this._vertices[U++]=H.simulationWorldRotation[0],this._vertices[U++]=H.simulationWorldRotation[1],this._vertices[U++]=H.simulationWorldRotation[2],this._vertices[U++]=H.simulationWorldRotation[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}}return this._firstFreeElement=n,!0},e.addNewParticlesToVertexBuffer=function(){var t=0;this._firstNewElement<this._firstFreeElement?(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._firstFreeElement-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex)):(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._bufferMaxParticles-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex),0<this._firstFreeElement&&this._vertexBuffer.setData(this._vertices,0,0,this._firstFreeElement*this._vertexStride*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},e._beforeRender=function(t){return this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement&&(this._vertexBuffer._bind(),this._indexBuffer._bind(),!0)},e._render=function(t){var e=0,i=mr.mainContext;this._firstActiveElement<this._firstFreeElement?(e=(this._firstFreeElement-this._firstActiveElement)*this._indexStride,i.drawElements(4,e,5123,2*this._firstActiveElement*this._indexStride),Cn.trianglesFaces+=e/3,Cn.drawCall++):(e=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride,i.drawElements(4,e,5123,2*this._firstActiveElement*this._indexStride),Cn.trianglesFaces+=e/3,Cn.drawCall++,0<this._firstFreeElement&&(e=this._firstFreeElement*this._indexStride,i.drawElements(4,e,5123,0),Cn.trianglesFaces+=e/3,Cn.drawCall++))},e.play=function(){if(this._burstsIndex=0,this._isEmitting=!0,this._isPlaying=!0,this._isPaused=!1,this._emissionTime=0,this._totalDelayTime=0,!this.autoRandomSeed)for(var t=0,e=this._randomSeeds.length;t<e;t++)this._randomSeeds[t]=this.randomSeed[0]+j._RANDOMOFFSET[t];switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:this.autoRandomSeed?this._playStartDelay=$i.lerp(this.startDelayMin,this.startDelayMax,Math.random()):(this._rand.seed=this._randomSeeds[2],this._playStartDelay=$i.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat()),this._randomSeeds[2]=this._rand.seed);break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay,this._startUpdateLoopCount=Cn.loopCount,this.event("played")},e.pause=function(){this._isPaused=!0,this.event("paused")},e.simulate=function(t,e){void 0===e&&(e=!0),this._simulateUpdate=!0,e?this._updateParticlesSimulationRestart(t):(this._isPaused=!1,this._updateParticles(t)),this.pause()},e.stop=function(){this._burstsIndex=0,this._isEmitting=!1,this._emissionTime=0,this.event("stopped")},e.cloneTo=function(t){var e=t;e.duration=this.duration,e.looping=this.looping,e.prewarm=this.prewarm,e.startDelayType=this.startDelayType,e.startDelay=this.startDelay,e.startDelayMin=this.startDelayMin,e.startDelayMax=this.startDelayMax,e._maxStartLifetime=this._maxStartLifetime,e.startLifetimeType=this.startLifetimeType,e.startLifetimeConstant=this.startLifetimeConstant,this.startLifeTimeGradient.cloneTo(e.startLifeTimeGradient),e.startLifetimeConstantMin=this.startLifetimeConstantMin,e.startLifetimeConstantMax=this.startLifetimeConstantMax,this.startLifeTimeGradientMin.cloneTo(e.startLifeTimeGradientMin),this.startLifeTimeGradientMax.cloneTo(e.startLifeTimeGradientMax),e.startSpeedType=this.startSpeedType,e.startSpeedConstant=this.startSpeedConstant,e.startSpeedConstantMin=this.startSpeedConstantMin,e.startSpeedConstantMax=this.startSpeedConstantMax,e.threeDStartSize=this.threeDStartSize,e.startSizeType=this.startSizeType,e.startSizeConstant=this.startSizeConstant,this.startSizeConstantSeparate.cloneTo(e.startSizeConstantSeparate),e.startSizeConstantMin=this.startSizeConstantMin,e.startSizeConstantMax=this.startSizeConstantMax,this.startSizeConstantMinSeparate.cloneTo(e.startSizeConstantMinSeparate),this.startSizeConstantMaxSeparate.cloneTo(e.startSizeConstantMaxSeparate),e.threeDStartRotation=this.threeDStartRotation,e.startRotationType=this.startRotationType,e.startRotationConstant=this.startRotationConstant,this.startRotationConstantSeparate.cloneTo(e.startRotationConstantSeparate),e.startRotationConstantMin=this.startRotationConstantMin,e.startRotationConstantMax=this.startRotationConstantMax,this.startRotationConstantMinSeparate.cloneTo(e.startRotationConstantMinSeparate),this.startRotationConstantMaxSeparate.cloneTo(e.startRotationConstantMaxSeparate),e.randomizeRotationDirection=this.randomizeRotationDirection,e.startColorType=this.startColorType,this.startColorConstant.cloneTo(e.startColorConstant),this.startColorConstantMin.cloneTo(e.startColorConstantMin),this.startColorConstantMax.cloneTo(e.startColorConstantMax),e.gravityModifier=this.gravityModifier,e.simulationSpace=this.simulationSpace,e.scaleMode=this.scaleMode,e.playOnAwake=this.playOnAwake,e.maxParticles=this.maxParticles,this._emission&&(e._emission=this._emission.clone()),this.shape&&(e.shape=this.shape.clone()),this.velocityOverLifetime&&(e.velocityOverLifetime=this.velocityOverLifetime.clone()),this.colorOverLifetime&&(e.colorOverLifetime=this.colorOverLifetime.clone()),this.sizeOverLifetime&&(e.sizeOverLifetime=this.sizeOverLifetime.clone()),this.rotationOverLifetime&&(e.rotationOverLifetime=this.rotationOverLifetime.clone()),this.textureSheetAnimation&&(e.textureSheetAnimation=this.textureSheetAnimation.clone()),e.isPerformanceMode=this.isPerformanceMode,e._isEmitting=this._isEmitting,e._isPlaying=this._isPlaying,e._isPaused=this._isPaused,e._playStartDelay=this._playStartDelay,e._frameRateTime=this._frameRateTime,e._emissionTime=this._emissionTime,e._totalDelayTime=this._totalDelayTime,e._burstsIndex=this._burstsIndex},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e._getVertexBuffers=function(){return null},v(0,e,"maxParticles",function(){return this._bufferMaxParticles-1},function(t){var e=t+1;e!==this._bufferMaxParticles&&(this._bufferMaxParticles=e,this._initBufferDatas())}),v(0,e,"isEmitting",function(){return this._isEmitting}),v(0,e,"isAlive",function(){return!!(this._isPlaying||0<this.aliveParticleCount)}),v(0,e,"shape",function(){return this._shape},function(t){this._shape!==t&&(t&&t.enable?this._ownerRender._addShaderDefine(Fo.SHADERDEFINE_SHAPE):this._ownerRender._removeShaderDefine(Fo.SHADERDEFINE_SHAPE),this._shape=t)}),v(0,e,"rotationOverLifetime",function(){return this._rotationOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.angularVelocity;if(!i)return;var n=i.separateAxes,r=i.type;if(t.enbale)switch(n?e._addShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE):e._addShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIME),r){case 0:e._addShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:e._addShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:e._addShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:e._addShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}else e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIME),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);switch(r){case 0:n?e._setShaderValueColor(35,i.constantSeparate):e._setShaderValueNumber(34,i.constant);break;case 1:n?(e._setShaderValueBuffer(37,i.gradientX._elements),e._setShaderValueBuffer(38,i.gradientY._elements),e._setShaderValueBuffer(39,i.gradientZ._elements),e._setShaderValueBuffer(40,i.gradientW._elements)):e._setShaderValueBuffer(36,i.gradient._elements);break;case 2:n?(e._setShaderValueColor(35,i.constantMinSeparate),e._setShaderValueColor(42,i.constantMaxSeparate)):(e._setShaderValueNumber(34,i.constantMin),e._setShaderValueNumber(41,i.constantMax));break;case 3:n?(e._setShaderValueBuffer(37,i.gradientXMin._elements),e._setShaderValueBuffer(44,i.gradientXMax._elements),e._setShaderValueBuffer(38,i.gradientYMin._elements),e._setShaderValueBuffer(45,i.gradientYMax._elements),e._setShaderValueBuffer(39,i.gradientZMin._elements),e._setShaderValueBuffer(46,i.gradientZMax._elements),e._setShaderValueBuffer(40,i.gradientWMin._elements),e._setShaderValueBuffer(47,i.gradientWMax._elements)):(e._setShaderValueBuffer(36,i.gradientMin._elements),e._setShaderValueBuffer(43,i.gradientMax._elements))}}else e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIME),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e._removeShaderDefine(Fo.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES),e._setShaderValueColor(35,null),e._setShaderValueColor(42,null),e._setShaderValueNumber(34,void 0),e._setShaderValueNumber(41,void 0),e._setShaderValueBuffer(37,null),e._setShaderValueBuffer(44,null),e._setShaderValueBuffer(38,null),e._setShaderValueBuffer(45,null),e._setShaderValueBuffer(39,null),e._setShaderValueBuffer(46,null),e._setShaderValueBuffer(40,null),e._setShaderValueBuffer(47,null),e._setShaderValueBuffer(36,null),e._setShaderValueBuffer(43,null);this._rotationOverLifetime=t}),v(0,e,"emission",function(){return this._emission}),v(0,e,"emissionTime",function(){return this._emissionTime>this.duration?this.duration:this._emissionTime}),v(0,e,"aliveParticleCount",function(){return this._firstNewElement>=this._firstRetiredElement?this._firstNewElement-this._firstRetiredElement:this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}),v(0,e,"isPlaying",function(){return this._isPlaying}),v(0,e,"isPaused",function(){return this._isPaused}),v(0,e,"startLifetimeType",function(){return this._startLifetimeType},function(t){var e=0,i=0;switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;var n=n;for(e=0,i=n.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,n.getValueByIndex(e));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var r=r;for(e=0,i=r.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(e));var a=a;for(e=0,i=a.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,a.getValueByIndex(e))}this._startLifetimeType=t}),v(0,e,"_originalBoundingSphere",function(){return this._boundingSphere}),v(0,e,"startLifetimeConstant",function(){return this._startLifetimeConstant},function(t){0===this._startLifetimeType&&(this._maxStartLifetime=t),this._startLifetimeConstant=t}),v(0,e,"startLifetimeConstantMin",function(){return this._startLifetimeConstantMin},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(t,this._startLifetimeConstantMax)),this._startLifetimeConstantMin=t}),v(0,e,"startLifeTimeGradient",function(){return this._startLifeTimeGradient},function(t){if(1===this._startLifetimeType){this._maxStartLifetime=-Number.MAX_VALUE;for(var e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradient=t}),v(0,e,"startLifetimeConstantMax",function(){return this._startLifetimeConstantMax},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,t)),this._startLifetimeConstantMax=t}),v(0,e,"startLifeTimeGradientMin",function(){return this._startLifeTimeGradientMin},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e));for(e=0,i=this._startLifeTimeGradientMax.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(e))}this._startLifeTimeGradientMin=t}),v(0,e,"startLifeTimeGradientMax",function(){return this._startLifeTimeGradientMax},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=this._startLifeTimeGradientMin.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(e));for(e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradientMax=t}),v(0,e,"velocityOverLifetime",function(){return this._velocityOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.velocity,n=i.type;if(t.enbale)switch(n){case 0:e._addShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:e._addShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:e._addShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:e._addShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}else e._removeShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e._removeShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e._removeShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e._removeShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);switch(n){case 0:e._setShaderValueColor(13,i.constant);break;case 1:e._setShaderValueBuffer(14,i.gradientX._elements),e._setShaderValueBuffer(15,i.gradientY._elements),e._setShaderValueBuffer(16,i.gradientZ._elements);break;case 2:e._setShaderValueColor(13,i.constantMin),e._setShaderValueColor(17,i.constantMax);break;case 3:e._setShaderValueBuffer(14,i.gradientXMin._elements),e._setShaderValueBuffer(18,i.gradientXMax._elements),e._setShaderValueBuffer(15,i.gradientYMin._elements),e._setShaderValueBuffer(19,i.gradientYMax._elements),e._setShaderValueBuffer(16,i.gradientZMin._elements),e._setShaderValueBuffer(20,i.gradientZMax._elements)}e._setShaderValueInt(21,t.space)}else e._removeShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e._removeShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e._removeShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e._removeShaderDefine(Fo.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE),e._setShaderValueColor(13,null),e._setShaderValueBuffer(14,null),e._setShaderValueBuffer(15,null),e._setShaderValueBuffer(16,null),e._setShaderValueColor(13,null),e._setShaderValueColor(17,null),e._setShaderValueBuffer(14,null),e._setShaderValueBuffer(18,null),e._setShaderValueBuffer(15,null),e._setShaderValueBuffer(19,null),e._setShaderValueBuffer(16,null),e._setShaderValueBuffer(20,null),e._setShaderValueInt(21,void 0);this._velocityOverLifetime=t}),v(0,e,"colorOverLifetime",function(){return this._colorOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.color;if(t.enbale)switch(i.type){case 1:e._addShaderDefine(Fo.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:e._addShaderDefine(Fo.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}else e._removeShaderDefine(Fo.SHADERDEFINE_COLOROVERLIFETIME),e._removeShaderDefine(Fo.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);switch(i.type){case 1:var n=i.gradient;e._setShaderValueBuffer(22,n._alphaElements),e._setShaderValueBuffer(23,n._rgbElements);break;case 3:var r=i.gradientMin,a=i.gradientMax;e._setShaderValueBuffer(22,r._alphaElements),e._setShaderValueBuffer(23,r._rgbElements),e._setShaderValueBuffer(24,a._alphaElements),e._setShaderValueBuffer(25,a._rgbElements)}}else e._removeShaderDefine(Fo.SHADERDEFINE_COLOROVERLIFETIME),e._removeShaderDefine(Fo.SHADERDEFINE_RANDOMCOLOROVERLIFETIME),e._setShaderValueBuffer(22,n._alphaElements),e._setShaderValueBuffer(23,n._rgbElements),e._setShaderValueBuffer(22,r._alphaElements),e._setShaderValueBuffer(23,r._rgbElements),e._setShaderValueBuffer(24,a._alphaElements),e._setShaderValueBuffer(25,a._rgbElements);this._colorOverLifetime=t}),v(0,e,"sizeOverLifetime",function(){return this._sizeOverLifetime},function(t){var e=this._ownerRender;if(t){var i=t.size,n=i.separateAxes,r=i.type;if(t.enbale)switch(r){case 0:n?e._addShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE):e._addShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:n?e._addShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE):e._addShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES)}else e._removeShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e._removeShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e._removeShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e._removeShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);switch(r){case 0:n?(e._setShaderValueBuffer(27,i.gradientX._elements),e._setShaderValueBuffer(28,i.gradientY._elements),e._setShaderValueBuffer(29,i.gradientZ._elements)):e._setShaderValueBuffer(26,i.gradient._elements);break;case 2:n?(e._setShaderValueBuffer(27,i.gradientXMin._elements),e._setShaderValueBuffer(31,i.gradientXMax._elements),e._setShaderValueBuffer(28,i.gradientYMin._elements),e._setShaderValueBuffer(32,i.gradientYMax._elements),e._setShaderValueBuffer(29,i.gradientZMin._elements),e._setShaderValueBuffer(33,i.gradientZMax._elements)):(e._setShaderValueBuffer(26,i.gradientMin._elements),e._setShaderValueBuffer(30,i.gradientMax._elements))}}else e._removeShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e._removeShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e._removeShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e._removeShaderDefine(Fo.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE),e._setShaderValueBuffer(27,null),e._setShaderValueBuffer(31,null),e._setShaderValueBuffer(28,null),e._setShaderValueBuffer(32,null),e._setShaderValueBuffer(29,null),e._setShaderValueBuffer(33,null),e._setShaderValueBuffer(26,null),e._setShaderValueBuffer(30,null);this._sizeOverLifetime=t}),v(0,e,"textureSheetAnimation",function(){return this._textureSheetAnimation},function(t){var e=this._ownerRender;if(t){var i=t.frame,n=i.type;if(t.enable)switch(n){case 1:e._addShaderDefine(Fo.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:e._addShaderDefine(Fo.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}else e._removeShaderDefine(Fo.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e._removeShaderDefine(Fo.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);if(1===n||3===n){e._setShaderValueInt(48,t.cycles);var r=t.tiles,a=this._uvLength.elements;a[0]=1/r.x,a[1]=1/r.y,e._setShaderValueVector2(49,this._uvLength)}switch(n){case 1:e._setShaderValueBuffer(50,i.frameOverTimeData._elements);break;case 3:e._setShaderValueBuffer(50,i.frameOverTimeDataMin._elements),e._setShaderValueBuffer(51,i.frameOverTimeDataMax._elements)}}else e._removeShaderDefine(Fo.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e._removeShaderDefine(Fo.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE),e._setShaderValueInt(48,void 0),e._setShaderValueVector2(49,null),e._setShaderValueBuffer(50,null),e._setShaderValueBuffer(51,null);this._textureSheetAnimation=t}),v(0,e,"_vertexBufferCount",function(){return 1}),v(0,e,"triangleCount",function(){return this._indexBuffer?this._indexBuffer.indexCount/3:0}),v(0,e,"_originalBoundingBox",function(){return this._boundingBox}),v(0,e,"_originalBoundingBoxCorners",function(){return this._boundingBoxCorners}),j.halfKSqrtOf2=.71,m(j,["_RANDOMOFFSET",function(){return this._RANDOMOFFSET=new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447])},"_maxElapsedTime",function(){return this._maxElapsedTime=1/3},"_tempVector30",function(){return this._tempVector30=new we},"_tempVector31",function(){return this._tempVector31=new we},"_tempVector32",function(){return this._tempVector32=new we},"_tempVector33",function(){return this._tempVector33=new we},"_tempVector34",function(){return this._tempVector34=new we},"_tempVector35",function(){return this._tempVector35=new we},"_tempVector36",function(){return this._tempVector36=new we},"_tempVector37",function(){return this._tempVector37=new we},"_tempVector38",function(){return this._tempVector38=new we},"_tempVector39",function(){return this._tempVector39=new we},"_tempPosition",function(){return this._tempPosition=new we},"_tempDirection",function(){return this._tempDirection=new we}]),j}(wr),La=function(t){function e(t){this._finalGravity=new we,this._tempRotationMatrix=new ye,e.__super.call(this,t),this._defaultBoundBox=new _e(new we,new we),this._renderMode=-1,this.stretchedBillboardCameraSpeedScale=0,this.stretchedBillboardSpeedScale=0,this.stretchedBillboardLengthScale=1}E(e,"laya.d3.core.particleShuriKen.ShurikenParticleRender",t);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._owner.particleSystem._boundingSphere,e=NaN,i=this._owner.transform,n=i.scale.elements,r=Math.abs(n[0]),a=Math.abs(n[1]),s=Math.abs(n[2]);e=a<=r&&s<=r?r:s<=a?a:s,we.transformCoordinate(t.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*e},i._renderUpdate=function(t){var e=this._owner.particleSystem;if(!S.stage.isVisibility||!e.isAlive)return!1;var i=this._owner.transform;switch(e.simulationSpace){case 0:break;case 1:this._setShaderValueColor(0,i.position),this._setShaderValueColor(1,i.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(e.scaleMode){case 0:var n=i.scale;this._setShaderValueColor(4,n),this._setShaderValueColor(5,n);break;case 1:var r=i.localScale;this._setShaderValueColor(4,r),this._setShaderValueColor(5,r);break;case 2:this._setShaderValueColor(4,i.scale),this._setShaderValueColor(5,we.ONE)}var a=this._finalGravity.elements,s=Ge.gravity.elements,o=e.gravityModifier;return a[0]=s[0]*o,a[1]=s[1]*o,a[2]=s[2]*o,this._setShaderValueBuffer(7,a),this._setShaderValueInt(11,e.simulationSpace),this._setShaderValueBool(8,e.threeDStartRotation),this._setShaderValueInt(6,e.scaleMode),this._setShaderValueInt(9,this.stretchedBillboardLengthScale),this._setShaderValueInt(10,this.stretchedBillboardSpeedScale),this._setShaderValueNumber(12,e._currentTime),gr.debugMode&&this._renderRenderableBoundBox(),!0},i._destroy=function(){t.prototype._destroy.call(this),this._mesh&&(this._mesh._removeReference(),this._mesh=null)},v(0,i,"boundingBox",function(){return this._owner.particleSystem.isAlive?(this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox):this._defaultBoundBox}),v(0,i,"renderMode",function(){return this._renderMode},function(t){if(this._renderMode!==t){switch(this._renderMode){case 0:this._removeShaderDefine(Fo.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:this._removeShaderDefine(Fo.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:this._removeShaderDefine(Fo.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:this._removeShaderDefine(Fo.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:this._removeShaderDefine(Fo.SHADERDEFINE_RENDERMODE_MESH)}switch(this._renderMode=t){case 0:this._addShaderDefine(Fo.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:this._addShaderDefine(Fo.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:this._addShaderDefine(Fo.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:this._addShaderDefine(Fo.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:this._addShaderDefine(Fo.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}this._owner.particleSystem._initBufferDatas()}}),v(0,i,"mesh",function(){return this._mesh},function(t){this._mesh!==t&&(this._mesh&&this._mesh._removeReference(),(this._mesh=t)&&t._addReference(),this._owner.particleSystem._initBufferDatas())}),e}(Cr),Va=function(t){function e(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,e.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}E(e,"laya.d3.resource.BaseTexture",br);var i=e.prototype;return v(0,i,"width",function(){return this._width}),v(0,i,"repeat",function(){return this._repeat},function(t){if(this._repeat!==t&&(this._repeat=t,this._source)){var e=mr.mainContext;pr.bindTexture(e,this._type,this._source),Ki.isPOT(this._width,this._height)&&this._repeat?(e.texParameteri(this._type,10242,10497),e.texParameteri(this._type,10243,10497)):(e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071))}}),v(0,i,"height",function(){return this._height}),v(0,i,"magFifter",function(){return this._magFifter},function(t){(this._magFifter=t)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(t)}),v(0,i,"wrapModeV",function(){return this._wrapModeV}),v(0,i,"size",function(){return this._size}),v(0,i,"wrapModeU",function(){return this._wrapModeU}),v(0,i,"mipmap",function(){return this._mipmap},function(t){this._mipmap=t,this._mipmap!=t&&this._conchTexture&&this._conchTexture.setMipMap(t)}),v(0,i,"minFifter",function(){return this._minFifter},function(t){this._minFifter=t,this._minFifter!=t&&this._conchTexture&&this._conchTexture.setMinFifter(t)}),v(0,i,"format",function(){return this._format}),v(0,i,"source",function(){return this.activeResource(),this._source}),v(0,i,"defaulteTexture",function(){return Os.grayTexture}),e.WARPMODE_REPEAT=0,e.WARPMODE_CLAMP=1,e}(),Na=function(e){function i(t){this._owner=null,this._trailRenderElements=null,this._minVertexDistance=NaN,this._widthMultiplier=NaN,this._time=NaN,this._widthCurve=null,this._colorGradient=null,this._textureMode=0,this._curtime=0,this._curSubTrailFinishCurTime=0,this._curSubTrailFinished=!1,this._hasLifeSubTrail=!1,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0,this._isStart=!1,this._trailRenderElementIndex=0,i.__super.call(this),this._curSubTrailFinishPosition=new we,this._curSubTrailFinishDirection=new we,this._owner=t,this._trailRenderElements=[],this.addRenderElement()}E(i,"laya.d3.core.trail.TrailFilter",e);var t=i.prototype;return t.getRenderElementsCount=function(){return this._trailRenderElements.length},t.addRenderElement=function(){for(var t=0;t<this._trailRenderElements.length;t++)if(1==this._trailRenderElements[t]._isDead)return this._trailRenderElements[t].reActivate(),t;var e=new tt(this);return this._trailRenderElements.push(e),this._trailRenderElements.length-1},t.getRenderElement=function(t){return this._trailRenderElements[t]},t._update=function(t){this._curtime+=t.elapsedTime/1e3,this._owner._render._setShaderValueNumber(3,this._curtime),this._curSubTrailFinished&&(this._curSubTrailFinished=!1,this._trailRenderElementIndex=this.addRenderElement(),this.event("trailfilterchange",[this._trailRenderElementIndex,this._trailRenderElements[this._trailRenderElementIndex]]))},t.reset=function(){for(var t=0;t<this._trailRenderElements.length;t++)this._trailRenderElements[t].reActivate();this._isStart=!1,this._hasLifeSubTrail=!1,this._curSubTrailFinished=!1,this._curSubTrailFinishCurTime=0,this._trailTotalLength=0,this._trailSupplementLength=0,this._trailDeadLength=0},t._destroy=function(){e.prototype._destroy.call(this);for(var t=0;t<this._trailRenderElements.length;t++)this._trailRenderElements[t]._destroy();this._trailRenderElements=null,this._widthCurve=null,this._colorGradient=null,this._curSubTrailFinishPosition=null,this._curSubTrailFinishDirection=null},v(0,t,"widthMultiplier",function(){return this._widthMultiplier},function(t){this._widthMultiplier=t}),v(0,t,"time",function(){return this._time},function(t){this._time=t,this._owner._render._setShaderValueNumber(4,t)}),v(0,t,"widthCurve",function(){return this._widthCurve},function(t){this._widthCurve=t;var e,i=new Float32Array(4*t.length),n=0,r=0;for(n=0,e=t.length;n<e;n++)i[r++]=t[n].time,i[r++]=t[n].inTangent,i[r++]=t[n].outTangent,i[r++]=t[n].value;this._owner._render._setShaderValueBuffer(5,i),this._owner._render._setShaderValueInt(6,t.length)}),v(0,t,"minVertexDistance",function(){return this._minVertexDistance},function(t){this._minVertexDistance=t}),v(0,t,"colorGradient",function(){return this._colorGradient},function(t){this._colorGradient=t,this._owner._render._setShaderValueBuffer(7,t._colorKeyData),this._owner._render._setShaderValueBuffer(8,t._alphaKeyData),0==t.mode?this._owner._render._addShaderDefine(Go.SHADERDEFINE_GRADIENTMODE_BLEND):this._owner._render._removeShaderDefine(Go.SHADERDEFINE_GRADIENTMODE_BLEND)}),v(0,t,"textureMode",function(){return this._textureMode},function(t){this._textureMode=t}),i}(wr),Pa=function(t){function e(){e.__super.call(this),this.lock=!0}return E(e,"laya.webgl.shader.BaseShader",br),e.activeShader=null,e.bindShader=null,e}(),Fa=function(t){function e(t){e.__super.call(this,t)}E(e,"laya.d3.core.trail.TrailRenderer",Cr);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._boundingBox.min.elements;t[0]=-Number.MAX_VALUE,t[1]=-Number.MAX_VALUE,t[2]=-Number.MAX_VALUE;var e=this._boundingBox.min.elements;e[0]=Number.MAX_VALUE,e[1]=Number.MAX_VALUE,e[2]=Number.MAX_VALUE},i._calculateBoundingSphere=function(){var t=this._boundingSphere.center.elements;t[0]=0,t[1]=0,t[2]=0,this._boundingSphere.radius=Number.MAX_VALUE},i._renderUpdate=function(t){return!0},e}(),Oa=function(t){function a(){this._terrainHeightData=null,this._width=0,this._height=0,this._bitType=0,this._value=NaN,a.__super.call(this)}return E(a,"laya.d3.terrain.TerrainHeightData",br),a.prototype.onAsynLoaded=function(t,e,i){var n;this._width=i[0],this._height=i[1],this._bitType=i[2],this._value=i[3];var r=NaN;8==this._bitType?(n=new Uint8Array(e),r=1/255):16==this._bitType&&(n=new Int16Array(e),r=1/32766),this._terrainHeightData=new Float32Array(this._height*this._width);for(var a=0,s=this._height*this._width;a<s;a++)this._terrainHeightData[a]=n[a]*r*this._value/2;this._endLoaded()},a.load=function(t,e,i,n,r){return S.loader.create(t,null,null,a,[e,i,n,r],1,!1)},a}(),Ba=function(t){function e(){this._version=NaN,this._cameraCoordinateInverse=!1,this._gridSize=NaN,this._chunkNumX=0,this._chunkNumZ=0,this._heightDataX=0,this._heightDataZ=0,this._heightDataBitType=0,this._heightDataValue=NaN,this._heightDataUrl=null,this._detailTextureInfos=null,this._chunkInfos=null,this._heightData=null,this._materialInfo=null,this._alphaMaps=null,this._normalMaps=null,e.__super.call(this)}E(e,"laya.d3.terrain.TerrainRes",br);var i=e.prototype;return i.parseData=function(t){var e=t[0],i=t[1];if(this._version=e.version,1==this._version){this._cameraCoordinateInverse=e.cameraCoordinateInverse,this._gridSize=e.gridSize,this._chunkNumX=e.chunkNumX,this._chunkNumZ=e.chunkNumZ;var n=e.heightData;if(this._heightDataX=n.numX,this._heightDataZ=n.numZ,this._heightDataBitType=n.bitType,this._heightDataValue=n.value,this._heightDataUrl=i[n.url],this._materialInfo=new Be,e.material){var r=e.material.ambient,a=e.material.diffuse,s=e.material.specular;this._materialInfo.ambientColor=new we(r[0],r[1],r[2]),this._materialInfo.diffuseColor=new we(a[0],a[1],a[2]),this._materialInfo.specularColor=new Ce(s[0],s[1],s[2],s[3])}var o=e.detailTexture;this._detailTextureInfos=R(o.length);for(var l=0;l<o.length;l++){var h=o[l],u=new Oe;u.diffuseTexture=i[h.diffuse],u.normalTexture=h.normal?i[h.normal]:null,h.scale?u.scale=new Re(h.scale[0],h.scale[1]):u.scale=new Re(1,1),h.offset?u.offset=new Re(h.offset[0],h.offset[1]):u.offset=new Re(0,0),this._detailTextureInfos[l]=u}var c=e.alphaMap;for(this._alphaMaps=R(c.length),l=0;l<this._alphaMaps.length;l++)this._alphaMaps[l]=e.alphaMap[l];var d=e.normalMap;for(this._normalMaps=R(d.length),l=0;l<this._normalMaps.length;l++)this._normalMaps[l]=e.normalMap[l];var _=e.chunkInfo;if(this._chunkNumX*this._chunkNumZ!=_.length)return alert("terrain data error"),!1;for(this._chunkInfos=R(_.length),l=0;l<_.length;l++){var f=_[l],m=new Fe,p=f.alphaMap.length,g=f.detailID.length;if(p!=g)return alert("terrain chunk data error"),!1;m.alphaMap=R(p),m.detailID=R(g),m.normalMap=i[this._normalMaps[f.normalMap]];for(var v=0;v<p;v++){m.alphaMap[v]=i[this._alphaMaps[f.alphaMap[v]]];var y=f.detailID[v],x=y.length;m.detailID[v]=new Uint8Array(x);for(var b=0;b<x;b++)m.detailID[v][b]=y[b]}this._chunkInfos[l]=m}this._heightData=kr.getRes(this._heightDataUrl),this.onLoadTerrainComplete(this._heightData)}return!0},i.onLoadTerrainComplete=function(t){this._endLoaded()},i.onAsynLoaded=function(t,e,i){this.parseData(e)},e.load=function(t){return S.loader.create(t,null,null,e,null,1,!1)},e}(),Ga=function(t){function e(t){this._floatCountPerVertex=6,this._owner=null,this._vertices=null,this._vertexBuffer=null,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=NaN,this._drawCounter=0,this.scLeft=null,this.scRight=null,this._numPositionMode=0,this._numPositionVelocityMode=0,this._lastTime=NaN,this._needPatch=!1,this._lastPatchAddPos0=null,this._lastPatchAddPos1=null,this._lastPatchAddTime=NaN,this.lifeTime=NaN,this.minSegmentDistance=NaN,this.minInterpDistance=NaN,this.maxSlerpCount=0,this._maxSegments=0,e.__super.call(this),this._tempVector0=new we,this._tempVector1=new we,this._tempVector2=new we,this._tempVector3=new we,this._posModeLastPosition0=new we,this._posModeLastPosition1=new we,this._posModePosition0=new we,this._posModePosition1=new we,this._posVelModePosition0=new we,this._posVelModeVelocity0=new we,this._posVelModePosition1=new we,this._posVelModeVelocity1=new we,this._owner=t,this._lastTime=0,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0,this._needPatch=!1,this._lastPatchAddPos0=new we,this._lastPatchAddPos1=new we,this.scLeft=new w,this.scRight=new w,this.lifeTime=.5,this.minSegmentDistance=.1,this.minInterpDistance=.6,this.maxSlerpCount=128,this._maxSegments=200,this._owner.on("activeinhierarchychanged",this,this._onActiveHierarchyChanged)}E(e,"laya.d3.resource.tempelet.GlitterTemplet",t);var i=e.prototype;return S.imps(i,{"laya.d3.core.render.IRenderable":!0}),i._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},i._getIndexBuffer=function(){return null},i._initialize=function(){this._vertexBuffer=ws.create(ht.vertexDeclaration,2*this.maxSegments,35048),this._vertices=new Float32Array(this.maxSegments*this._floatCountPerVertex*2)},i._onActiveHierarchyChanged=function(t){t||(this._numPositionMode=0,this._numPositionVelocityMode=0,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._currentTime=0,this._drawCounter=0)},i._updateTextureCoordinates=function(){this._firstActiveElement<this._firstFreeElement?this._updateSubTextureCoordinates(this._firstActiveElement,2*(this._firstFreeElement-this._firstActiveElement)):(this._updateSubTextureCoordinates(this._firstActiveElement,2*(this.maxSegments-this._firstActiveElement)),0<this._firstFreeElement&&this._updateSubTextureCoordinates(0,2*this._firstFreeElement))},i._updateSubTextureCoordinates=function(t,e){for(var i=2*t,n=0;n<e;n+=2){var r=i+n,a=r*this._floatCountPerVertex,s=(r+1)*this._floatCountPerVertex;this._vertices[a+3]=this._vertices[s+3]=(this._vertices[a+5]-this._currentTime)/this.lifeTime}},i._retireActiveGlitter=function(){for(var t=this.lifeTime,e=2*this._floatCountPerVertex;this._firstActiveElement!=this._firstNewElement;){var i=this._firstActiveElement*e+5;if(this._currentTime-this._vertices[i]<t)break;this._vertices[i]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this.maxSegments&&(this._firstActiveElement=0)}},i._freeRetiredGlitter=function(){for(var t=2*this._floatCountPerVertex;this._firstRetiredElement!=this._firstActiveElement;){if(this._drawCounter-this._vertices[this._firstRetiredElement*t+5]<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this.maxSegments&&(this._firstRetiredElement=0)}},i._calcVelocity=function(t,e,i){we.subtract(t,e,i),we.scale(i,.5,i)},i._addNewGlitterSegementToVertexBuffer=function(){var t=0;this._firstActiveElement<this._firstFreeElement?(t=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,2*(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex)):(t=2*this._firstActiveElement*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,2*(this.maxSegments-this._firstActiveElement)*this._floatCountPerVertex),0<this._firstFreeElement&&this._vertexBuffer.setData(this._vertices,0,0,2*this._firstFreeElement*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},i._addGlitter=function(t,e,i){this._needPatch&&(this._needPatch=!1,this._addGlitter(this._lastPatchAddPos0,this._lastPatchAddPos1,this._lastPatchAddTime));var n=this._firstFreeElement+1;n>=this.maxSegments&&(n=0,t.cloneTo(this._lastPatchAddPos0),e.cloneTo(this._lastPatchAddPos1),this._lastPatchAddTime=i,this._needPatch=!0),n===this._firstRetiredElement&&console.log("GlitterTemplet:current segement count have large than maxSegments,please adjust the  value of maxSegments or add Glitter Vertex Frequency.");var r=t.elements,a=e.elements,s=0,o=this._firstFreeElement*this._floatCountPerVertex*2;for(s=0;s<3;s++)this._vertices[o+s]=r[s];this._vertices[o+3]=0,this._vertices[o+4]=0,this._vertices[o+5]=i;var l=o+this._floatCountPerVertex;for(s=0;s<3;s++)this._vertices[l+s]=a[s];this._vertices[l+3]=0,this._vertices[l+4]=1,this._vertices[l+5]=i,this._firstFreeElement=n},i._update=function(t){this._currentTime+=t/1e3,this._retireActiveGlitter(),this._freeRetiredGlitter(),this._firstActiveElement==this._firstFreeElement&&(this._currentTime=0),this._firstRetiredElement==this._firstActiveElement&&(this._drawCounter=0),this._updateTextureCoordinates()},i._beforeRender=function(t){return this._firstNewElement!=this._firstFreeElement&&this._addNewGlitterSegementToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement&&(this._vertexBuffer.bindWithIndexBuffer(null),!0)},i._render=function(t){var e=0,i=mr.mainContext;this._firstActiveElement<this._firstFreeElement?(e=2*(this._firstFreeElement-this._firstActiveElement),i.drawArrays(5,2*this._firstActiveElement,e),Cn.trianglesFaces+=e-2,Cn.drawCall++):(e=2*(this.maxSegments-this._firstActiveElement),i.drawArrays(5,2*this._firstActiveElement,e),Cn.trianglesFaces+=e-2,Cn.drawCall++,0<this._firstFreeElement&&(e=2*this._firstFreeElement,i.drawArrays(5,0,e),Cn.trianglesFaces+=e-2,Cn.drawCall++))},i.addVertexPosition=function(t,e){if(this._owner.activeInHierarchy)if(this._numPositionMode<2)0===this._numPositionMode?(t.cloneTo(this._posModeLastPosition0),e.cloneTo(this._posModeLastPosition1)):(t.cloneTo(this._posModePosition0),e.cloneTo(this._posModePosition1)),this._numPositionMode++;else{var i=this._tempVector2;this._calcVelocity(t,this._posModeLastPosition0,i);var n=this._tempVector3;this._calcVelocity(e,this._posModeLastPosition1,n),this.addVertexPositionVelocity(this._posModePosition0,i,this._posModePosition1,n),this._posModePosition0.cloneTo(this._posModeLastPosition0),this._posModePosition1.cloneTo(this._posModeLastPosition1),t.cloneTo(this._posModePosition0),e.cloneTo(this._posModePosition1)}},i.addVertexPositionVelocity=function(t,e,i,n){if(this._owner.activeInHierarchy){if(0===this._numPositionVelocityMode)this._numPositionVelocityMode++;else{var r=this._tempVector0;we.subtract(t,this._posVelModePosition0,r);var a=we.scalarLength(r);we.subtract(i,this._posVelModePosition1,r);var s=we.scalarLength(r),o=0,l=l;if(a<l&&s<l)return;if(1===(o=1+Math.floor(Math.max(a,s)/this.minInterpDistance)))this._addGlitter(t,i,this._currentTime);else{o=Math.min(o,this.maxSlerpCount),this.scLeft.Init(this._posVelModePosition0,this._posVelModeVelocity0,t,e),this.scRight.Init(this._posVelModePosition1,this._posVelModeVelocity1,i,n);for(var h=1/o,u=h,c=this._currentTime-this._lastTime,d=1;d<=o;d++){var _=this._tempVector0;this.scLeft.Slerp(u,_);var f=this._tempVector1;this.scRight.Slerp(u,f);var m=this._lastTime+c*d/o;this._addGlitter(_,f,m),u+=h}}}this._lastTime=this._currentTime,t.cloneTo(this._posVelModePosition0),e.cloneTo(this._posVelModeVelocity0),i.cloneTo(this._posVelModePosition1),n.cloneTo(this._posVelModeVelocity1)}},i._destroy=function(){t.prototype._destroy.call(this),this._tempVector0=null,this._tempVector1=null,this._tempVector2=null,this._tempVector3=null,this._owner=null,this._vertices=null,this._vertexBuffer.destroy(),this._vertexBuffer=null,this.scLeft=null,this.scRight=null,this._posModeLastPosition0=null,this._posModeLastPosition1=null,this._posModePosition0=null,this._posModePosition1=null,this._posVelModePosition0=null,this._posVelModeVelocity0=null,this._posVelModePosition1=null,this._posVelModeVelocity1=null,this._lastPatchAddPos0=null,this._lastPatchAddPos1=null},i._getVertexBuffers=function(){return null},v(0,i,"maxSegments",function(){return this._maxSegments-1},function(t){var e=t+1;e!==this._maxSegments&&(this._maxSegments=e,this._vertexBuffer&&this._vertexBuffer.destroy(),this._initialize())}),v(0,i,"_vertexBufferCount",function(){return 1}),v(0,i,"triangleCount",function(){var t=0;return this._firstActiveElement<this._firstFreeElement?t=2*(this._firstFreeElement-this._firstActiveElement)-2:(t=2*(this.maxSegments-this._firstActiveElement)-2,t+=2*this._firstFreeElement-2),t}),v(0,i,"_originalBoundingSphere",function(){return S.superGet(wr,this,"_originalBoundingSphere")}),v(0,i,"_originalBoundingBox",function(){return S.superGet(wr,this,"_originalBoundingBox")}),e}(wr),Wa=function(t){function h(t,e,i,n,r,a,s,o){this._owner=null,this._gridSize=NaN,this.memorySize=0,this._numberVertices=0,this._maxNumberIndices=0,this._currentNumberIndices=0,this._numberTriangle=0,this._vertexBuffer=null,this._indexBuffer=null,this._boundingSphere=null,this._boundingBox=null,this._indexArrayBuffer=null,this._boundingBoxCorners=null,this._leafs=null,this._leafNum=0,this._terrainHeightData=null,this._terrainHeightDataWidth=0,this._terrainHeightDataHeight=0,this._chunkOffsetX=0,this._chunkOffsetZ=0,this._cameraCoordinateInverse=!1,this._cameraPos=null,this._currentLOD=0,this._perspectiveFactor=NaN,this._LODTolerance=0,h.__super.call(this),this._owner=t,this._cameraPos=new we,this._chunkOffsetX=e,this._chunkOffsetZ=i,this._gridSize=n,this._terrainHeightData=r,this._terrainHeightDataWidth=a,this._terrainHeightDataHeight=s,this._leafNum=Pe.CHUNK_GRID_NUM/Pe.LEAF_GRID_NUM*(Pe.CHUNK_GRID_NUM/Pe.LEAF_GRID_NUM),this._leafs=R(this._leafNum),this._cameraCoordinateInverse=o;for(var l=0;l<this._leafNum;l++)this._leafs[l]=new Pe;this.recreateResource()}E(h,"laya.d3.terrain.TerrainFilter",t);var e=h.prototype;return S.imps(e,{"laya.d3.core.render.IRenderable":!0}),e._destroy=function(){t.prototype._destroy.call(this),this._owner=null,this._vertexBuffer&&this._vertexBuffer.destroy(),this._indexBuffer&&this._indexBuffer.destroy()},e.recreateResource=function(){this._currentNumberIndices=0,this._numberTriangle=0;var t=Pe.LEAF_VERTEXT_COUNT,e=Pe.LEAF_MAX_INDEX_COUNT;this._numberVertices=t*this._leafNum,this._maxNumberIndices=e*this._leafNum,this._indexArrayBuffer=new Uint16Array(this._maxNumberIndices);var i=ae.vertexDeclaration,n=i.vertexStride/4,r=new Float32Array(this._numberVertices*n),a=Pe.CHUNK_GRID_NUM/Pe.LEAF_GRID_NUM,s=0,o=0,l=0;for(s=0;s<this._leafNum;s++)o=s%a,l=Math.floor(s/a),this._leafs[s].calcVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*Pe.LEAF_GRID_NUM,l*Pe.LEAF_GRID_NUM,this._gridSize,r,s*Pe.LEAF_PLANE_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight,this._cameraCoordinateInverse);for(s=0;s<this._leafNum;s++)o=s%a,l=Math.floor(s/a),this._leafs[s].calcSkirtVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*Pe.LEAF_GRID_NUM,l*Pe.LEAF_GRID_NUM,this._gridSize,r,this._leafNum*Pe.LEAF_PLANE_VERTEXT_COUNT+s*Pe.LEAF_SKIRT_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight);this.assembleIndexInit(),this._vertexBuffer=new ws(i,this._numberVertices,35044,!1),this._indexBuffer=new Rs("ushort",this._maxNumberIndices,35044,!1),this._vertexBuffer.setData(r),this._indexBuffer.setData(this._indexArrayBuffer),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.calcOriginalBoudingBoxAndSphere()},e.setLODLevel=function(t){if(4!=t.length)return!0;var e=(t[0]+1<<24)+(t[1]+1<<16)+(t[2]+1<<8)+(t[3]+1);return this._currentLOD!=e&&(this._currentLOD=e,!0)},e.assembleIndexInit=function(){this._currentNumberIndices=0;for(var t=this._numberTriangle=0,e=0;e<this._leafNum;e++){var i=Pe.getPlaneLODIndex(e,0);this._indexArrayBuffer.set(i,t),t+=i.length;var n=Pe.getSkirtLODIndex(e,0);this._indexArrayBuffer.set(n,t),t+=n.length,this._currentNumberIndices+=i.length+n.length}this._numberTriangle=this._currentNumberIndices/3},e.isNeedAssemble=function(t,e){var i=Math.min(t.viewport.width,t.viewport.height)/(2*Math.tan(Math.PI*t.fieldOfView/180));return this._perspectiveFactor!=i?(this._perspectiveFactor=i,1):this._LODTolerance!=co.LOD_TOLERANCE_VALUE?(this._LODTolerance=co.LOD_TOLERANCE_VALUE,1):0==we.equals(e,this._cameraPos)?(this._cameraPos.x=e.x,this._cameraPos.y=e.y,this._cameraPos.z=e.z,2):0},e.assembleIndex=function(t,e){var i=this.isNeedAssemble(t,e);if(0<i){for(var n=0;n<this._leafNum;n++)h._TEMP_ARRAY_BUFFER[n]=this._leafs[n].determineLod(e,this._perspectiveFactor,co.LOD_TOLERANCE_VALUE,1==i);if(this.setLODLevel(h._TEMP_ARRAY_BUFFER)){this._currentNumberIndices=0;var r=this._numberTriangle=0;for(n=0;n<this._leafNum;n++){var a=h._TEMP_ARRAY_BUFFER[n],s=Pe.getPlaneLODIndex(n,a);this._indexArrayBuffer.set(s,r),r+=s.length;var o=Pe.getSkirtLODIndex(n,a);this._indexArrayBuffer.set(o,r),r+=o.length,this._currentNumberIndices+=s.length+o.length}return this._numberTriangle=this._currentNumberIndices/3,!0}}return!1},e.calcOriginalBoudingBoxAndSphere=function(){for(var t=new Re(2147483647,-2147483647),e=0;e<this._leafNum;e++)t.x=this._leafs[e]._sizeOfY.x<t.x?this._leafs[e]._sizeOfY.x:t.x,t.y=this._leafs[e]._sizeOfY.y>t.y?this._leafs[e]._sizeOfY.y:t.y;var i=new we(this._chunkOffsetX*Pe.CHUNK_GRID_NUM*this._gridSize,t.x,this._chunkOffsetZ*Pe.CHUNK_GRID_NUM*this._gridSize),n=new we((this._chunkOffsetX+1)*Pe.CHUNK_GRID_NUM*this._gridSize,t.y,(this._chunkOffsetZ+1)*Pe.CHUNK_GRID_NUM*this._gridSize);Pe.__ADAPT_MATRIX__&&(we.transformV3ToV3(i,Pe.__ADAPT_MATRIX__,i),we.transformV3ToV3(n,Pe.__ADAPT_MATRIX__,n)),this._boundingBox=new _e(i,n);var r=new we;we.subtract(n,i,r),we.scale(r,.5,r);var a=new we;we.add(i,r,a),this._boundingSphere=new me(a,we.scalarLength(r)),this._boundingBoxCorners=R(8,null),this._boundingBox.getCorners(this._boundingBoxCorners)},e.calcLeafBoudingBox=function(t){for(var e=0;e<this._leafNum;e++)this._leafs[e].calcLeafBoudingBox(t)},e.calcLeafBoudingSphere=function(t,e){for(var i=0;i<this._leafNum;i++)this._leafs[i].calcLeafBoudingSphere(t,e)},e._getVertexBuffer=function(t){return void 0===t&&(t=0),0==t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._beforeRender=function(t){if(this._vertexBuffer._bind(),this._indexBuffer._bind(),0==t.renderElement._material.blend){var e=t.camera;this.assembleIndex(e,e.position)&&this._indexBuffer.setData(this._indexArrayBuffer)}return!0},e._getVertexBuffers=function(){return null},e._render=function(t){mr.mainContext.drawElements(co.RENDER_LINE_MODEL?1:4,this._currentNumberIndices,5123,0),Cn.trianglesFaces+=this._numberTriangle,Cn.drawCall++},v(0,e,"_originalBoundingSphere",function(){return this._boundingSphere}),v(0,e,"_originalBoundingBox",function(){return this._boundingBox}),v(0,e,"_vertexBufferCount",function(){return this._numberVertices}),v(0,e,"triangleCount",function(){return this._numberTriangle}),m(h,["_TEMP_ARRAY_BUFFER",function(){return this._TEMP_ARRAY_BUFFER=new Uint32Array(Pe.CHUNK_GRID_NUM/Pe.LEAF_GRID_NUM*Pe.CHUNK_GRID_NUM/Pe.LEAF_GRID_NUM)}]),h}(wr),Ua=function(t){function e(t){this._terrainSprite3DOwner=null,e.__super.call(this,t),this._terrainSprite3DOwner=t}E(e,"laya.d3.terrain.TerrainRender",t);var i=e.prototype;return i._calculateBoundingSphere=function(){var t=this._terrainSprite3DOwner.terrainFilter;if(null==t)this._boundingSphere.toDefault();else{var e=t._originalBoundingSphere,i=NaN,n=this._terrainSprite3DOwner.transform,r=n.scale;i=r.x>=r.y&&r.x>=r.z?r.x:r.y>=r.z?r.y:r.z,we.transformCoordinate(e.center,n.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=e.radius*i,t.calcLeafBoudingSphere(n.worldMatrix,i)}},i._calculateBoundingBox=function(){var t=this._terrainSprite3DOwner.terrainFilter;if(null==t)this._boundingBox.toDefault();else{for(var e=this._terrainSprite3DOwner.transform.worldMatrix,i=t._boundingBoxCorners,n=0;n<8;n++)we.transformCoordinate(i[n],e,Cr._tempBoundBoxCorners[n]);_e.createfromPoints(Cr._tempBoundBoxCorners,this._boundingBox),t.calcLeafBoudingBox(e)}},i._renderUpdate=function(t){this._setShaderValueMatrix4x4(0,this._owner.transform.worldMatrix);var e=this._owner.getProjectionViewWorldMatrix(t);return this._setShaderValueMatrix4x4(1,e),!0},i._destroy=function(){t.prototype._destroy.call(this),this._terrainSprite3DOwner=null},e}(Cr),Za=function(t){function e(){e.__super.call(this),this._w=0,this._h=0}E(e,"laya.resource.Bitmap",br);var i=e.prototype;return v(0,i,"width",function(){return this._w}),v(0,i,"height",function(){return this._h}),v(0,i,"source",function(){return this._source}),e}(),ka=function(t){function e(t){this._audio=null,this._onEnd=null,this._resumePlay=null,e.__super.call(this),this._onEnd=Dn.bind(this.__onEnd,this),this._resumePlay=Dn.bind(this.__resumePlay,this),t.addEventListener("ended",this._onEnd),this._audio=t}E(e,"laya.media.h5audio.AudioSoundChannel",Sr);var i=e.prototype;return i.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(S.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i.__resumePlay=function(){if(this._audio&&this._audio.removeEventListener("canplay",this._resumePlay),!this.isStopped)try{this._audio.currentTime=this.startTime,vn.container.appendChild(this._audio),this._audio.play()}catch(t){this.event("error")}},i.play=function(){if(this.isStopped=!1,this._audio){try{this._audio.playbackRate=rn.playbackRate,this._audio.currentTime=this.startTime}catch(t){return void this._audio.addEventListener("canplay",this._resumePlay)}rn.addChannel(this),vn.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()}},i.stop=function(){this.isStopped=!0,rn.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&hn.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),vn.onIE||this._audio!=Gr._musicAudio&&wn.recover("audio:"+this.url,this._audio),vn.removeElement(this._audio),this._audio=null)},i.pause=function(){this.isStopped=!0,rn.removeChannel(this),"pause"in this._audio&&this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,rn.addChannel(this),"play"in this._audio&&this._audio.play())},v(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),v(0,i,"duration",function(){return this._audio?this._audio.duration:0}),v(0,i,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),e}(),Ha=function(t){function e(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=Ur.ctx,e.__super.call(this),this._onPlayEnd=Dn.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}E(e,"laya.media.webaudio.WebAudioSoundChannel",Sr);var i=e.prototype;return i.play=function(){if(rn.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var t=this.context,e=this.gain,i=t.createBufferSource();(this.bufferSource=i).buffer=this.audioBuffer,i.connect(e),e&&e.disconnect(),e.connect(t.destination),i.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=vn.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.001):this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.playbackRate.setTargetAtTime?i.playbackRate.setTargetAtTime(rn.playbackRate,this.context.currentTime,.001):i.playbackRate.value=rn.playbackRate,i.start(0,this.startTime),this._currentTime=0}},i.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(S.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null,e._tryCleanFailed||this._tryClearBuffer(t),this.bufferSource=null}},i._tryClearBuffer=function(t){if(vn.onMac)try{t.buffer=Ur._miniBuffer}catch(t){e._tryCleanFailed=!0}else try{t.buffer=null}catch(t){e._tryCleanFailed=!0}},i.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,rn.removeChannel(this),this.completeHandler=null,rn.autoReleaseSound&&S.timer.once(5e3,null,rn.disposeSoundIfNotUsed,[this.url],!1)},i.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,rn.removeChannel(this),rn.autoReleaseSound&&S.timer.once(5e3,null,rn.disposeSoundIfNotUsed,[this.url],!1)},i.resume=function(){this.startTime=this._pauseTime,this.play()},v(0,i,"position",function(){return this.bufferSource?(vn.now()-this._startTime)/1e3+this.startTime:0}),v(0,i,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),v(0,i,"volume",function(){return this._volume},function(t){this.isStopped||(this._volume=t,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(t,this.context.currentTime,.001):this.gain.gain.value=t)}),e._tryCleanFailed=!1,e.SetTargetDelay=.001,e}(),Xa=function(l){function i(){i.__super.call(this)}E(i,"laya.debug.tools.enginehook.LoaderHook",l);var t=i.prototype;return t.checkUrls=function(t){var e;e="string"==typeof t?t:t.url,i.preFails[e]},t.chekUrlList=function(t){var e,i=0;for(e=t.length,i=0;i<e;i++)this.checkUrls(t[i])},t.load=function(t,e,i,n,r,a,s,o){return void 0===r&&(r=1),void 0===a&&(a=!0),void 0===o&&(o=!1),t instanceof Array?this.chekUrlList(t):this.checkUrls(t),l.prototype.load.call(this,t,e,i,n,r,a,s,o)},i.init=function(){i.isInited||(i.isInited=!0,S.loader=new i,S.loader.on("error",null,i.onFail),(i.preFails=an.getJSON("LoadFailItems"))||(i.preFails={}))},i.onFail=function(t){nl.I.dTrace("LoadFail:"+t),i.nowFails[t]=!0,an.setJSON("LoadFailItems",i.nowFails)},i.resetFails=function(){i.nowFails={},an.setJSON("LoadFailItems",i.nowFails)},i.preFails={},i.nowFails={},i.enableFailDebugger=!0,i.FailSign="LoadFailItems",i.isInited=!1,i}(Pr),Ya=function(e){function u(t,e,i,n,r,a,s,o,l){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===r&&(r=34041),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1),this._type=1,this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=r,hn.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=a,this._repeat=s,this._minFifter=o,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0,u.__super.call(this,this.bitmap,Hr.INV_UV)}E(u,"laya.webgl.resource.RenderTarget2D",e);var t=u.prototype;return S.imps(t,{"laya.resource.IDispose":!0}),t.getType=function(){return this._type},t.getTexture=function(){return this},t.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},t.release=function(){this.destroy()},t.recycle=function(){u.POOL.push(this)},t.start=function(){var t=mr.mainContext;return this._preRenderTarget=fr.curRenderTarget,fr.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=fr.width,this._svHeight=fr.height,fr.width=this._w,fr.height=this._h,Pa.activeShader=null),this},t.clear=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1);var r=mr.mainContext;r.clearColor(t,e,i,n);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}r.clear(a)},t.end=function(){var t=mr.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,fr.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),fr.width=this._svWidth,fr.height=this._svHeight,Pa.activeShader=null):t.viewport(0,0,S.stage.width,S.stage.height)},t.getData=function(t,e,i,n){var r=mr.mainContext;if(r.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===r.checkFramebufferStatus(36160)))return r.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._w*this._h*4);return r.readPixels(t,e,i,n,this._surfaceFormat,this._surfaceType,a),r.bindFramebuffer(36160,null),a},t.destroy=function(t){void 0===t&&(t=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,e.prototype.destroy.call(this))},t.dispose=function(){},t._createWebGLRenderTarget=function(){this.bitmap=new Qs(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(t){this.event("recovered")})},v(0,t,"surfaceFormat",function(){return this._surfaceFormat}),v(0,t,"magFifter",function(){return this._magFifter}),v(0,t,"surfaceType",function(){return this._surfaceType}),v(0,t,"mipMap",function(){return this._mipMap}),v(0,t,"depthStencilFormat",function(){return this._depthStencilFormat}),v(0,t,"minFifter",function(){return this._minFifter}),v(0,t,"source",function(){return this._alreadyResolved?S.superGet(Hr,this,"source"):null}),u.create=function(t,e,i,n,r,a,s,o,l){void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===r&&(r=34041),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1);var h=u.POOL.pop();return h||(h=new u(t,e)),h.bitmap&&h._w==t&&h._h==e&&h._surfaceFormat==i&&h._surfaceType==n&&h._depthStencilFormat==r&&h._mipMap==a&&h._repeat==s&&h._minFifter==o&&h._magFifter==l||(h._w=t,h._h=e,h._surfaceFormat=i,h._surfaceType=n,h._depthStencilFormat=r,hn.isConchWebGL&&34041===h._depthStencilFormat&&(h._depthStencilFormat=33189),h._mipMap=a,h._repeat=s,h._minFifter=o,h._magFifter=l,h.release(),h._createWebGLRenderTarget()),h},u.TYPE2D=1,u.TYPE3D=2,u.POOL=[],u}(Hr),za=function(t){function i(t){this.texcoord=null,this.offsetX=300,this.offsetY=0,i.__super.call(this,512,0);var e=8*cr.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*cr.BYTES_PE],this.color=[4,5126,!1,e,4*cr.BYTES_PE]}return E(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",Qr),i}(),ja=function(t){function e(t){e.__super.call(this,2,0),this.color=[]}return E(e,"laya.webgl.shader.d2.value.Color2dSV",Qr),e.prototype.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color)},e}(),Ja=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=Qr._TEXCOORD,e.__super.call(this,256,0)}E(e,"laya.webgl.shader.d2.value.FillTextureSV",Qr);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),Ka=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=Qr._TEXCOORD,void 0===t&&(t=0),e.__super.call(this,1,t)}E(e,"laya.webgl.shader.d2.value.TextureSV",Qr);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),Qa=function(t){function e(t){this.a_color=null,this.u_pos=[0,0],e.__super.call(this,4,0),this.position=[2,5126,!1,5*cr.BYTES_PE,0],this.a_color=[3,5126,!1,5*cr.BYTES_PE,2*cr.BYTES_PE]}return E(e,"laya.webgl.shader.d2.value.PrimitiveSV",Qr),e}(),qa=function(t){function e(){this.target=null,this.child=null,this.vfx=null,this.speed=1,this.rotateSpeed=10,this.agent=null,this.collider=null,this.rigidbody=null,this.waypointDistance=1,this.speedMultiple=2,this.maxSpeed=5,this.behindDistance=1,this.pause=!1,this.belongFG=null,this.targetLeader=null,this._path=null,this._inTargetRange=!1,this._currentDest=null,this._walkArea=0,this._pathLength=NaN,this._transform=null,this._avgIndex=0,this._avgMove=null,this._collider=null,this._overlapColliders=null,this.vehicle=null,e.__super.call(this),this.offset=new Re}E(e,"code.Follower",ha);var i=e.prototype;return i._load=function(t){this._transform=this._owner,this.agent=this._owner.getComponentByType(_a),this.ChangeGoal(),this._currentDest=new we},i._start=function(t){this.vehicle=this._owner.getComponentByType(pa),this.collider=this._owner.getComponentByType(fs)},i.OnCollisionEnter=function(t){},i.OnTriggerEnter=function(t){if("Leader"==t.tag){var e=this.GetLeaderScript(t);if(e){if(this.target==t)return;if("Follower"==this._transform.tag)this.PlayVFX(),this.child&&this.belongFG&&this.belongFG.AddToObjectPool(this.child),this._transform.tag=t.tag,this.target=t,(this.targetLeader=e).SpawnChildFormObjectPool(this),e.AddFollower(this),this.pause=!1;else if("Leader"==this._transform.tag){var i=this.GetLeaderScript(this.target);i.followers.length<e.followers.length&&(this.PlayVFX(),i.RemoveFollower(this),this.child&&i.AddToObjectPool(this.child),this._transform.tag=t.tag,this.target=t,(this.targetLeader=e).SpawnChildFormObjectPool(this),e.AddFollower(this),this.pause=!1)}}else{var n=this.GetFollowerScript(t).targetLeader;if(this.target==n._transform)return;if("Leader"==this._transform.tag){var r=this.targetLeader;r.followers.length<n.followers.length&&(this.PlayVFX(),r.RemoveFollower(this),this.child&&r.AddToObjectPool(this.child),this.target=n._transform,(this.targetLeader=n).SpawnChildFormObjectPool(this),n.AddFollower(this),this.pause=!1)}else"Follower"==this._transform.tag&&(this.PlayVFX(),this.child&&this.belongFG&&this.belongFG.AddToObjectPool(this.child),this.target=n._transform,(this.targetLeader=n).SpawnChildFormObjectPool(this),n.AddFollower(this),this.pause=!1)}}},i.PlayVFX=function(){},i.StopVFX=function(){},i.GetLeaderScript=function(t){return t.getComponentByType(ts)},i.GetFollowerScript=function(t){return t.getComponentByType(e)},i.ChangeGoal=function(){var t=new we,e=b.Instance.allPoints;for(t=e[e.length*Math.random()>>0];this._transform&&we.distance(this._transform.transform.position,t)<=50;)t=e[e.length*Math.random()>>0];this.agent.destination=t},i.rePath=function(){var t=vn.window.patrol.findPath(this._transform.transform.position,this.agent.destination,"level",n.playerNavMeshGroup);this.agent.path=t?[this._transform.transform.position.clone()].concat(t):null},i._update=function(t){if(!this.pause)if(this.agent.enabled=!0,this.vehicle.enable=!1,null!=this.target){this.agent.enabled=!1,this.vehicle.enable=!0;var e=new we;if(null==this._currentDest&&(this._currentDest=new we),null!=this.target.transform){this.target.transform.position.cloneTo(this._currentDest);var i=this.target.transform.worldMatrix.elements;this._currentDest.x+=this.offset.x*i[0]+this.offset.y*i[8],this._currentDest.z+=this.offset.x*i[2]+this.offset.y*i[10],this.CalculateTargetRange(),this._inTargetRange||(this.CalculatePath(e),we.scale(e,this.CalculateCurrentSpeed(),e),this.vehicle.a.x+=e.x/5,this.vehicle.a.y+=e.z/5),this.target.transform.localRotationEuler.cloneTo(this._transform.transform.localRotationEuler),this._transform.transform.localRotationEuler=this._transform.transform.localRotationEuler}}else if(this.agent.enable&&!this.agent.pathPending&&(this.ChangeGoal(),this.rePath()),this._transform){var n=new we;if(we.subtract(this.agent.steeringTarget,this._transform.transform.position,n),we.normalize(n,n),0<we.scalarLength(n)){var r=new Te;Te.createFromAxisAngle(we.Up,Math.atan2(n.x,n.z)+Math.PI,r),Te.lerp(this._transform.transform.rotation,r,1,this._transform.transform.rotation),this._transform.transform.rotation=this._transform.transform.rotation}}},i.CalculateCurrentSpeed=function(){var t=this._transform.transform.position,e=this.target.transform.forward,i=new we(t.x-(this._currentDest.x-e.x*this.behindDistance),t.y-(this._currentDest.y-e.y*this.behindDistance),t.z-(this._currentDest.z-e.z*this.behindDistance)),n=we.distance(t,this.target.transform.position);we.normalize(i,i);var r=new we;return we.normalize(e,r),0<=we.dot(i,r)&&(n=0),Math.min(n*this.speedMultiple,this.maxSpeed)},i.CalculateTargetRange=function(){var t=we.distance(this._transform.transform.position,this._currentDest);this._inTargetRange=t<this.waypointDistance},i.CalculatePath=function(t){return we.subtract(this._currentDest,this._transform.transform.position,t),we.normalize(t,t),!0},i.ResetPosition=function(){if(b.Instance)for(var t=0;t<b.Instance.allPoints.length;t++){var e=b.Instance.allPoints[t];if(we.distanceSquared(e,this.target.transform.position)<=25){this._transform.transform.position=e;break}}},i.AddLocalAvoidance=function(t){t.y=0,we.normalize(t,t),this._avgMove[this._avgIndex]=t,this._avgIndex++,this._avgIndex>=this._avgMove.Length&&(this._avgIndex=0),t=this.GetAVG()},i.GetAVG=function(){for(var t=this._avgMove.Length,e=new we,i=0;i<t;i++){var n=this._avgMove[i];e.x+=n.x,e.y+=n.y,e.z+=n.z}return e.x/=t,e.y/=t,e.z/=t,e},i.Start=function(){},i.SuggestedDirectionFromEngine=function(t,e){return null},i.Flee=function(t){},e}(),$a=function(t){function e(){this.vehicle=null,e.__super.call(this)}E(e,"code.FollowerCollision",ua);var i=e.prototype;return i._start=function(t){this.vehicle=this._owner.getComponentByType(pa)},i.onTriggerEnter=function(t){},i.onTriggerExit=function(t){},i.onTriggerStay=function(t){var e=this.owner.getComponentByType(qa);if(e&&e.OnTriggerEnter(t.owner),null==this.vehicle&&this._start(null),this.vehicle.enable){var i=t.owner,n=this.owner,r=new we;we.subtract(n.transform.position,i.transform.position,r);var a=we.scalarLength(r);0==we.scalarLength(r)&&(r.x=Math.random()-.5,r.z=Math.random()-.5,a=1),we.normalize(r,r),we.scale(r,Math.max(0,2-a),r),this.vehicle.a.x+=r.x,this.vehicle.a.y+=r.z}},e}(),ts=function(t){function e(){this.target=null,this.crown=null,this.child=null,this.vfx=null,this.followerPrefab=null,this.speed=1.5,this.rotSpeed=10,this.isDead=!1,this.userName=null,this.level=1,this.attackIndex=1,this.attackRange=10,this.attackLimitTime=5,this.followers=[],this.objectPool=[],this.killLeaders=[],this.agent=null,this.isPlayerControll=!1,this._transform=null,this._collider=null,this._initFollowers=[],this._circleRadius=2,this.isFollowChanged=!1,e.__super.call(this),this.color=new Tn("#ffffff"),console.log("new leader")}E(e,"code.Leader",ha);var i=e.prototype;return i._load=function(t){this._transform=this._owner,this._transform.transform.localScale=new we(.8,.8,.8),this.agent=this._owner.getComponentByType(_a),this.agent.enabled=!1,this.agent.updateRotation=!1,code.Leader.disableAddFollower=!1},i._start=function(t){this.ChangeGoal(),S.timer.loop(this.attackLimitTime,this,this.AttackBehaviour)},i._destroy=function(){S.timer.clear(this,this.AttackBehaviour),this.followers=[],this.killLeaders=[],this.objectPool=[],this._initFollowers=[]},i.OnTriggerEnter=function(t){},i.PlayVFX=function(){},i.StopVFX=function(){},i.AttackBehaviour=function(){for(var t=new we,e=0;e<b.Instance.allLeaders.length;e++){var i=b.Instance.allLeaders[e],n=new we;we.subtract(i._transform.transform.position,this._transform.transform.position,n),i!=this&&we.scalarLengthSquared(n)<this.attackRange*this.attackRange&&this.followers.length<i.followers.length&&we.add(t,n,t)}if(0<we.scalarLengthSquared(t))return this.agent.destination=new we,we.normalize(t,t),we.scale(t,-1*this.attackRange,t),void we.add(this._transform.transform.position,t,this.agent.destination);var r=x.RobotKey(this.attackIndex),a=parseInt(r[0]),s=parseInt(r[1]),o=a+Math.random()*(s-a)>>0;if(o<=a){for(var l=10066329,h=null,u=0;u<b.Instance.allLeaders.Count;u++){var c=b.Instance.allLeaders[u],d=we.distanceSquared(c._transform.transform.position,this._transform.transform.position);c!=this&&d<l&&this.followers.length<c.followers.length&&(l=d,h=c)}if(l<=this.attackRange*this.attackRange&&h)return void(this.target=h._transform)}if(o<=s&&0<ca.npcList.Count){var _,f=10066329,m=null;for(var p in ca.npcList){_=ca.npcList[p];var g=we.distanceSquared(_.transform.position,this._transform.transform.position);g<f&&(f=g,m=_)}if(f<=this.attackRange*this.attackRange&&m)return void(this.target=m)}this.target=null},i.EnablePlayerCollider=function(){for(var t in this._initFollowers)this._initFollowers[t].layer="Role"},i.EnableControl=function(){var t;for(var e in this.agent.enabled=!0,this._initFollowers)(t=this._initFollowers[e]).layer="Role",t.pause=!1,t.agent.enabled=!0,t.agent.destination=this._transform.transform.position},i.SetMat=function(t){},i.InitFollowerCount=function(t){void 0===t&&(t=-1),-1==t&&(t=this._initFollowers.length);var e=this._initFollowers.length==t&&0<this._initFollowers.length;if(!e){for(var i=this._initFollowers.length-1;0<=i;i--)this._initFollowers[i].removeSelf();this._initFollowers=[],this.followers=[]}for(var n=0;n<t;n++){var r=new we;if(e)this._initFollowers[n].child.removeSelf(),this.SpawnChildFormObjectPool(this._initFollowers[n]);else{for(var a=!1;!a;){a=!0;var s,o=c.GeneratePointInCycle(this._circleRadius);for(var l in we.normalize(this._transform.transform.forward,r),we.scale(r,this._circleRadius+.5,r),we.subtract(this._transform.transform.position,r,r),we.add(r,new we(o.x,0,o.y),r),this._initFollowers)if(s=this._initFollowers[l],we.distanceSquared(r,s._transform.transform.position)<.25){a=!1;break}}var h=ys.instantiate(this.followerPrefab,null,!1,r).getComponentByType(qa);this.SpawnChildFormObjectPool(h),h.layer="RoleNotCollision",h.pause=!0,h.agent.enabled=!1,h.target=this._transform,(h.targetLeader=this).AddFollower(h),this._initFollowers.push(h)}}},i.ShowCrown=function(t){null==this.crown&&(this.crown=this._transform.getChildByName("Crown")),this.crown&&(this.crown.active=t)},i.rePath=function(){var t=vn.window.patrol.findPath(this._transform.transform.position,this.agent.destination,"level",n.playerNavMeshGroup);this.agent.path=t?[this._transform.transform.position.clone()].concat(t):null},i.resetFollowOffset=function(){if(this.isFollowChanged){this.isFollowChanged=!1;for(var t=1,e=0,i=2,n=0;n<this.followers.length;n++){var r=this.followers[n];r.offset.y=t,r.offset.x=-(i-1)/2+e,i<=++e&&(e=0,t++,i++)}}},i._update=function(t){if(this.isPlayerControll)this.resetFollowOffset();else{this.target&&this.target.tag==this._transform.tag&&this.AttackBehaviour(),this.target?(this.agent.destination=this.target.transform.position,this.rePath()):this.agent.enabled&&!this.agent.pathPending&&(this.ChangeGoal(),this.rePath());var e=new we;if(we.subtract(this.agent.steeringTarget,this._transform.transform.position,e),(e.y=0)!=e.x||0!=e.z){var i=new Te;Te.createFromAxisAngle(we.Up,Math.atan2(e.x,e.z)+Math.PI,i),this._transform.transform.rotation=i}this.resetFollowOffset()}},i.ChangeGoal=function(){for(var t=b.Instance.allPoints,e=t[Math.random()*t.length>>0];we.distance(this._transform.transform.position,e)<=50;)e=t[Math.random()*t.length>>0];this.agent.enabled&&(this.agent.destination=e)},i.AddToObjectPool=function(t){-1==this.objectPool.indexOf(t)&&(t.active=!1,this._transform.parent.addChild(t),this.objectPool.push(t))},i.ClearObjectPool=function(){for(var t=this.objectPool.length-1;0<=t;t--)this.objectPool[t].removeSelf();this.objectPool=[]},i.SpawnChildFormObjectPool=function(t){var e;if(0<this.objectPool.length?(e=this.objectPool.pop()).active=!0:e=ys.instantiate(this.child,null,!1),t._transform.addChild(e),e.transform.localPosition=new we,e.transform.localRotationEuler=new we,e.transform.localScale=this.child.transform.localScale,t.child=e,t._transform.transform){var i=new Te;t._transform.transform.rotation.cloneTo(i);var n=new we;t._transform.transform.position.cloneTo(n),this._transform.parent.addChild(t._transform),t._transform.transform.rotation=i,t._transform.transform.position=n}},i.AddFollower=function(t){code.Leader.disableAddFollower||(-1==this.followers.indexOf(t)&&(t.owner.tag="Leader",this.followers.push(t),this.isFollowChanged=!0),this.isPlayerControll,this.CleanNotFollower())},i.CleanNotFollower=function(){if(0<this.followers.length)for(var t=this.followers.length-1;0<=t;t--){var e=this.followers[t];e.target!=this._transform&&this.RemoveFollower(e)}},i.RemoveFollower=function(t){var e=this.followers.indexOf(t);-1!=e&&(this.followers.splice(e,1),this.isFollowChanged=!0)},e.disableAddFollower=!1,e}(),es=function(t){function e(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,e.__super.call(this)}E(e,"laya.d3.resource.models.PrimitiveMesh",ga);var i=e.prototype;return S.imps(i,{"laya.d3.core.render.IRenderable":!0}),i._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},i._getVertexBuffers=function(){return null},i._getIndexBuffer=function(){return this._indexBuffer},i._getPositions=function(){var t,e=[],i=this._vertexBuffer.vertexDeclaration.getVertexElements(),n=0;for(n=0;n<i.length;n++){var r=i[n];if("vector3"===r.elementFormat&&0===r.elementUsage){t=r;break}}var a=this._vertexBuffer.getData();for(n=0;n<a.length;n+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var s=n+t.offset/4,o=new we(a[s+0],a[s+1],a[s+2]);e.push(o)}return e},i.getRenderElement=function(t){return this},i.getRenderElementsCount=function(){return 1},i.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this.memorySize=0},i._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},i._render=function(t){mr.mainContext.drawElements(4,this._numberIndices,5123,0),Cn.drawCall++,Cn.trianglesFaces+=this._numberIndices/3},v(0,i,"_vertexBufferCount",function(){return 1}),v(0,i,"triangleCount",function(){return this._indexBuffer.indexCount/3}),e}(),is=function(t){function e(){e.__super.call(this),null==Xr.get("CustomShader")&&this.initShader(),this.setShaderName("CustomShader")}return E(e,"code.shader.CustomMaterial",va),e.prototype.initShader=function(){var t=Us.nameKey.add("CustomShader");Xr.add(t,"attribute vec4 a_Position;\n\nuniform mat4 u_MvpMatrix;\n//uniform mat4 u_WorldMat;\n\n//attribute vec3 a_Normal;\nvarying vec3 v_Normal;\n\nvoid main()\n{\n  gl_Position = u_MvpMatrix * a_Position;\n  \n // mat3 worldMat=mat3(u_WorldMat);\n  v_Normal=a_Position.xyz;\n}","#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec3 v_Normal;\n\nvoid main()\n{\n\tvec3 v=fract((v_Normal*0.5+0.5)*10.0);\n\tv=step(0.5,v);\n\tif((v.x!=v.z)){\n\t\tv=vec3(1.0);\n\t}else{\n\t\tv=vec3(0.0);\n\t}\n  gl_FragColor=vec4(v.zzz*v.xxx,1.0);\n}",{a_Position:0},{u_MvpMatrix:[1,2]})},e}(),ns=function(e){function t(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,t.__super.call(this),this._layout=mn.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}E(t,"laya.ui.Component",e);var i=t.prototype;return S.imps(i,{"laya.ui.IComponent":!0}),i.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},i.preinitialize=function(){},i.createChildren=function(){},i.initialize=function(){},i.callLater=function(t,e){S.timer.callLater(this,t,e)},i.runCallLater=function(t){S.timer.runCallLater(this,t)},i.commitMeasure=function(){},i.changeSize=function(){this.event("resize"),this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},i.getLayout=function(){return this._layout===mn.EMPTY&&(this._layout=new mn),this._layout},i._setLayoutEnabled=function(t){this._layout&&this._layout.enable!=t&&(this._layout.enable=t,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},i.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},i.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},i.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},i.resetLayoutX=function(){var t=this._layout;if(isNaN(t.anchorX)||(this.pivotX=t.anchorX*this.width),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerX)?isNaN(t.left)?isNaN(t.right)||(this.x=Math.round(e.width-this.displayWidth-t.right+this.pivotX*this.scaleX)):(this.x=Math.round(t.left+this.pivotX*this.scaleX),isNaN(t.right)||(this.width=(e._width-t.left-t.right)/(this.scaleX||.01))):this.x=Math.round(.5*(e.width-this.displayWidth)+t.centerX+this.pivotX*this.scaleX))}},i.resetLayoutY=function(){var t=this._layout;if(isNaN(t.anchorY)||(this.pivotY=t.anchorY*this.height),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerY)?isNaN(t.top)?isNaN(t.bottom)||(this.y=Math.round(e.height-this.displayHeight-t.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(t.top+this.pivotY*this.scaleY),isNaN(t.bottom)||(this.height=(e._height-t.top-t.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(e.height-this.displayHeight)+t.centerY+this.pivotY*this.scaleY))}},i.onMouseOver=function(t){S.stage.event("showtip",this._toolTip)},i.onMouseOut=function(t){S.stage.event("hidetip",this._toolTip)},i._childChanged=function(t){this.callLater(this.changeSize),e.prototype._childChanged.call(this,t)},v(0,i,"displayWidth",function(){return this.width*this.scaleX}),v(0,i,"width",function(){return this._width?this._width:this.measureWidth},function(t){this._width!=t&&(this._width=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),v(0,i,"measureWidth",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.x+i.width*i.scaleX,t))}return t}),v(0,i,"displayHeight",function(){return this.height*this.scaleY}),v(0,i,"height",function(){return this._height?this._height:this.measureHeight},function(t){this._height!=t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),v(0,i,"dataSource",function(){return this._dataSource},function(t){for(var e in this._dataSource=t,this._dataSource)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=this._dataSource[e])}),v(0,i,"scaleY",e.prototype._$get_scaleY,function(t){S.superGet(ya,this,"scaleY")!=t&&(S.superSet(ya,this,"scaleY",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),v(0,i,"measureHeight",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.y+i.height*i.scaleY,t))}return t}),v(0,i,"scaleX",e.prototype._$get_scaleX,function(t){S.superGet(ya,this,"scaleX")!=t&&(S.superSet(ya,this,"scaleX",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),v(0,i,"top",function(){return this._layout.top},function(t){t!=this._layout.top&&(this.getLayout().top=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),v(0,i,"bottom",function(){return this._layout.bottom},function(t){t!=this._layout.bottom&&(this.getLayout().bottom=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),v(0,i,"left",function(){return this._layout.left},function(t){t!=this._layout.left&&(this.getLayout().left=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),v(0,i,"right",function(){return this._layout.right},function(t){t!=this._layout.right&&(this.getLayout().right=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),v(0,i,"centerX",function(){return this._layout.centerX},function(t){t!=this._layout.centerX&&(this.getLayout().centerX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),v(0,i,"centerY",function(){return this._layout.centerY},function(t){t!=this._layout.centerY&&(this.getLayout().centerY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),v(0,i,"anchorX",function(){return this._layout.anchorX},function(t){t!=this._layout.anchorX&&(this.getLayout().anchorX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()}),v(0,i,"anchorY",function(){return this._layout.anchorY},function(t){t!=this._layout.anchorY&&(this.getLayout().anchorY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()}),v(0,i,"tag",function(){return this._tag},function(t){this._tag=t}),v(0,i,"toolTip",function(){return this._toolTip},function(t){this._toolTip!=t&&(null!=(this._toolTip=t)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),v(0,i,"comXml",function(){return this._comXml},function(t){this._comXml=t}),v(0,i,"gray",function(){return this._gray},function(t){t!==this._gray&&(this._gray=t,gn.gray(this,t))}),v(0,i,"disabled",function(){return this._disabled},function(t){t!==this._disabled&&(this.gray=this._disabled=t,this.mouseEnabled=!t)}),t}(ya),rs=function(i){function e(){e.__super.call(this),this.setShaderName("BLINNPHONG"),this._albedoIntensity=1,this._albedoColor=new Ce(1,1,1,1),this._setColor(6,new Ce(1,1,1,1)),this._setColor(8,new we(1,1,1)),this._setNumber(9,.078125),this._setColor(10,new we(1,1,1)),this._setNumber(0,.5),this._setColor(11,new Ce(1,1,0,0)),this._enableLighting=!0,this.renderMode=0}E(e,"laya.d3.core.material.BlinnPhongMaterial",i);var t=e.prototype;return t.disableLight=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_POINTLIGHT|Xr.SHADERDEFINE_SPOTLIGHT|Xr.SHADERDEFINE_DIRECTIONLIGHT)},t.disableFog=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_FOG)},t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e._enableLighting=this._enableLighting,e._albedoIntensity=this._albedoIntensity,this._albedoColor.cloneTo(e._albedoColor)},v(0,t,"renderMode",null,function(t){switch(t){case 0:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 1:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this.depthTest=513,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this.depthTest=513,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),v(0,t,"normalTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,t)}),v(0,t,"reflectColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),v(0,t,"tilingOffset",function(){return this._getColor(11)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(11,t)}),v(0,t,"specularColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),v(0,t,"albedoColor",function(){return this._albedoColor},function(t){var e=this._getColor(6);Ce.scale(t,this._albedoIntensity,e),this._albedoColor=t}),v(0,t,"albedoIntensity",function(){return this._albedoIntensity},function(t){if(this._albedoIntensity!==t){var e=this._getColor(6);Ce.scale(this._albedoColor,t,e),this._albedoIntensity=t}}),v(0,t,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),v(0,t,"shininess",function(){return this._getNumber(9)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(9,t)}),v(0,t,"specularTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,t)}),v(0,t,"reflectTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(5,t)}),v(0,t,"enableLighting",function(){return this._enableLighting},function(t){this._enableLighting!==t&&(t?this._removeDisablePublicShaderDefine(Xr.SHADERDEFINE_POINTLIGHT|Xr.SHADERDEFINE_SPOTLIGHT|Xr.SHADERDEFINE_DIRECTIONLIGHT):this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_POINTLIGHT|Xr.SHADERDEFINE_SPOTLIGHT|Xr.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSEMAP=e.shaderDefines.registerDefine("DIFFUSEMAP"),e.SHADERDEFINE_NORMALMAP=e.shaderDefines.registerDefine("NORMALMAP"),e.SHADERDEFINE_SPECULARMAP=e.shaderDefines.registerDefine("SPECULARMAP"),e.SHADERDEFINE_REFLECTMAP=e.shaderDefines.registerDefine("REFLECTMAP"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET"),e.SHADERDEFINE_ADDTIVEFOG=e.shaderDefines.registerDefine("ADDTIVEFOG")},e.load=function(t){return S.loader.create(t,null,null,e)},e.SPECULARSOURCE_DIFFUSEMAPALPHA=0,e.SPECULARSOURCE_SPECULARMAP=0,e.RENDERMODE_OPAQUE=0,e.RENDERMODE_CUTOUT=1,e.RENDERMODE_TRANSPARENT=2,e.RENDERMODE_ADDTIVE=3,e.SHADERDEFINE_DIFFUSEMAP=0,e.SHADERDEFINE_NORMALMAP=0,e.SHADERDEFINE_SPECULARMAP=0,e.SHADERDEFINE_REFLECTMAP=0,e.SHADERDEFINE_TILINGOFFSET=0,e.SHADERDEFINE_ADDTIVEFOG=0,e.ALBEDOTEXTURE=1,e.NORMALTEXTURE=2,e.SPECULARTEXTURE=3,e.EMISSIVETEXTURE=4,e.REFLECTTEXTURE=5,e.ALBEDOCOLOR=6,e.MATERIALSPECULAR=8,e.SHININESS=9,e.MATERIALREFLECT=10,e.TILINGOFFSET=11,m(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),e}(va),as=function(t){function e(){e.__super.call(this),this.setShaderName("ExtendTerrain"),this.renderMode=1}E(e,"laya.d3.core.material.ExtendTerrainMaterial",va);var i=e.prototype;return i._setDetailNum=function(t){switch(t){case 1:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._addShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4)}},i.disableLight=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_POINTLIGHT|Xr.SHADERDEFINE_SPOTLIGHT|Xr.SHADERDEFINE_DIRECTIONLIGHT)},v(0,i,"diffuseScaleOffset2",null,function(t){this._setColor(7,t)}),v(0,i,"splatAlphaTexture",function(){return this._getTexture(0)},function(t){this._setTexture(0,t)}),v(0,i,"diffuseScaleOffset3",null,function(t){this._setColor(8,t)}),v(0,i,"diffuseTexture1",null,function(t){this._setTexture(1,t),this._setDetailNum(1)}),v(0,i,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=2e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.depthTest=515;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),v(0,i,"diffuseTexture2",function(){return this._getTexture(2)},function(t){this._setTexture(2,t),this._setDetailNum(2)}),v(0,i,"diffuseScaleOffset1",null,function(t){this._setColor(6,t)}),v(0,i,"diffuseTexture3",function(){return this._getTexture(3)},function(t){this._setTexture(3,t),this._setDetailNum(3)}),v(0,i,"diffuseTexture4",function(){return this._getTexture(4)},function(t){this._setTexture(4,t),this._setDetailNum(4)}),v(0,i,"diffuseTexture5",function(){return this._getTexture(5)},function(t){this._setTexture(5,t),this._setDetailNum(5)}),v(0,i,"diffuseScaleOffset4",null,function(t){this._setColor(9,t)}),v(0,i,"diffuseScaleOffset5",null,function(t){this._setColor(10,t)}),v(0,i,"albedo",function(){return this._getColor(14)},function(t){this._setColor(14,t)}),v(0,i,"ambientColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),v(0,i,"diffuseColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),v(0,i,"specularColor",function(){return this._getColor(13)},function(t){this._setColor(13,t)}),e.__init__=function(){e.SHADERDEFINE_DETAIL_NUM1=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM1"),e.SHADERDEFINE_DETAIL_NUM2=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM2"),e.SHADERDEFINE_DETAIL_NUM3=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM3"),e.SHADERDEFINE_DETAIL_NUM4=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM4"),e.SHADERDEFINE_DETAIL_NUM5=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM5")},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_TRANSPARENT=2,e.SPLATALPHATEXTURE=0,e.DIFFUSETEXTURE1=1,e.DIFFUSETEXTURE2=2,e.DIFFUSETEXTURE3=3,e.DIFFUSETEXTURE4=4,e.DIFFUSETEXTURE5=5,e.DIFFUSESCALEOFFSET1=6,e.DIFFUSESCALEOFFSET2=7,e.DIFFUSESCALEOFFSET3=8,e.DIFFUSESCALEOFFSET4=9,e.DIFFUSESCALEOFFSET5=10,e.MATERIALAMBIENT=11,e.MATERIALDIFFUSE=12,e.MATERIALSPECULAR=13,e.MATERIALALBEDO=14,e.SHADERDEFINE_DETAIL_NUM1=0,e.SHADERDEFINE_DETAIL_NUM2=0,e.SHADERDEFINE_DETAIL_NUM3=0,e.SHADERDEFINE_DETAIL_NUM4=0,e.SHADERDEFINE_DETAIL_NUM5=0,m(e,["shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),e}(),ss=function(e){function i(){i.__super.call(this),this.setShaderName("GLITTER"),this.renderMode=1,this._setColor(3,new Ce(1,1,1,1)),this._setColor(2,new Ce(1,1,1,1))}E(i,"laya.d3.core.material.GlitterMaterial",e);var t=i.prototype;return t.setShaderName=function(t){e.prototype.setShaderName.call(this,t)},v(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1;break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),v(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),v(0,t,"albedo",function(){return this._getColor(2)},function(t){this._setColor(2,t)}),v(0,t,"color",function(){return this._getColor(3)},function(t){this._setColor(3,t)}),i.load=function(t){return S.loader.create(t,null,null,i)},i.RENDERMODE_OPAQUE=1,i.RENDERMODE_OPAQUEDOUBLEFACE=2,i.RENDERMODE_TRANSPARENT=13,i.RENDERMODE_TRANSPARENTDOUBLEFACE=14,i.RENDERMODE_ADDTIVE=15,i.RENDERMODE_ADDTIVEDOUBLEFACE=16,i.RENDERMODE_DEPTHREAD_TRANSPARENT=5,i.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,i.RENDERMODE_DEPTHREAD_ADDTIVE=7,i.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,i.RENDERMODE_NONDEPTH_TRANSPARENT=9,i.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,i.RENDERMODE_NONDEPTH_ADDTIVE=11,i.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,i.DIFFUSETEXTURE=1,i.ALBEDO=2,i.UNICOLOR=3,m(i,["defaultMaterial",function(){return this.defaultMaterial=new i}]),i}(va),os=function(n){function i(){if(this._transformUV=null,i.__super.call(this),!laya.d3.core.material.PBRMaterial.pbrlutTex){var t=vn.window.__pbrlutdata;if(!t)throw alert("no pbr lutdata, need pbrlut.js"),"no pbr lutdata, need pbrlut.js";var e=Ps.create(new Uint32Array(t).buffer,256,256,9728,9728,!1);laya.d3.core.material.PBRMaterial.pbrlutTex=e}this._setTexture(4,laya.d3.core.material.PBRMaterial.pbrlutTex),this.setShaderName("PBR"),this._setNumber(0,.5),this.use_groundtruth=!1}E(i,"laya.d3.core.material.PBRMaterial",n);var t=i.prototype;return t.disableLight=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_POINTLIGHT|Xr.SHADERDEFINE_SPOTLIGHT|Xr.SHADERDEFINE_DIRECTIONLIGHT)},t.disableFog=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_FOG)},t.onAsynLoaded=function(t,e,i){n.prototype.onAsynLoaded.call(this,t,e,i)},t.radicalInverse_VdC=function(t){var e,i=new Uint32Array(1);return e=(16711935&(e=(252645135&(e=(858993459&(e=(1431655765&(e=(e=t)<<16|e>>>16))<<1|(2863311530&e)>>>1))<<2|(3435973836&e)>>>2))<<4|(4042322160&e)>>>4))<<8|(4278255360&e)>>>8,i[0]=e,2.3283064365386963e-10*i[0]},t.createHammersleyTex=function(t,e){var i=new Uint8Array(t*e*4),n=0,r=0;for(r=0;r<t*e;r++){var a=this.radicalInverse_VdC(r);i[n++]=255*a,i[n++]=0,i[n++]=0,i[n++]=255}return i},v(0,t,"normalTexture",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),v(0,t,"has_tangent",null,function(t){this._addShaderDefine(i.SHADERDEFINE_HAS_TANGENT)}),v(0,t,"roughness",function(){return this._getNumber(6)},function(t){this._setNumber(6,t),this._addShaderDefine(i.SHADERDEFINE_FIX_ROUGHNESS)}),v(0,t,"metaless",function(){return this._getNumber(7)},function(t){this._setNumber(7,t),this._addShaderDefine(i.SHADERDEFINE_FIX_METALESS)}),v(0,t,"pbrlutTexture",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),v(0,t,"use_groundtruth",null,function(t){if(t){if(this._addShaderDefine(i.SHADERDEFINE_USE_GROUNDTRUTH),!laya.d3.core.material.PBRMaterial.HammersleyNoiseTex){var e=this.createHammersleyTex(32,32);laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=Ps.create(e.buffer,32,32,9728,9728,!1)}this._setTexture(15,i.HammersleyNoiseTex)}else laya.d3.core.material.PBRMaterial.HammersleyNoiseTex=null,this._removeShaderDefine(i.SHADERDEFINE_USE_GROUNDTRUTH)}),v(0,t,"transformUV",function(){return this._transformUV},function(t){this._transformUV=t,this._setMatrix4x4(8,t.matrix),this._conchMaterial&&this._conchMaterial.setShaderValue(8,t.matrix.elements,0)}),v(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),v(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1;break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),v(0,t,"pbrInfoTexture",function(){return this._getTexture(3)},function(t){this._setTexture(3,t),this._addShaderDefine(i.SHADERDEFINE_HAS_PBRINFO)}),v(0,t,"testClipZ",null,function(t){this._addShaderDefine(i.SHADERDEFINE_TEST_CLIPZ)}),i.__init__=function(){i.SHADERDEFINE_FIX_METALESS=i.shaderDefines.registerDefine("FIX_METALESS"),i.SHADERDEFINE_FIX_ROUGHNESS=i.shaderDefines.registerDefine("FIX_ROUGHNESS"),i.SHADERDEFINE_HAS_TANGENT=i.shaderDefines.registerDefine("HAS_TANGENT"),i.SHADERDEFINE_HAS_PBRINFO=i.shaderDefines.registerDefine("HAS_PBRINFO"),i.SHADERDEFINE_USE_GROUNDTRUTH=i.shaderDefines.registerDefine("USE_GROUNDTRUTH"),i.SHADERDEFINE_TEST_CLIPZ=i.shaderDefines.registerDefine("CLIPZ")},i.load=function(t){return S.loader.create(t,null,null,i)},i.DIFFUSETEXTURE=1,i.NORMALTEXTURE=2,i.PBRINFOTEXTURE=3,i.PBRLUTTEXTURE=4,i.UVANIAGE=5,i.MATERIALROUGHNESS=6,i.MATERIALMETALESS=7,i.UVMATRIX=8,i.UVAGE=9,i.AOOBJPOS=14,i.HSNOISETEXTURE=15,i.SHADERDEFINE_FIX_ROUGHNESS=0,i.SHADERDEFINE_FIX_METALESS=0,i.SHADERDEFINE_HAS_TANGENT=0,i.SHADERDEFINE_TEST_CLIPZ=0,i.SHADERDEFINE_HAS_PBRINFO=0,i.SHADERDEFINE_USE_GROUNDTRUTH=0,i.RENDERMODE_OPAQUE=1,i.RENDERMODE_OPAQUEDOUBLEFACE=2,i.RENDERMODE_CUTOUT=3,i.RENDERMODE_CUTOUTDOUBLEFACE=4,i.RENDERMODE_TRANSPARENT=13,i.pbrlutTex=null,i.HammersleyNoiseTex=null,m(i,["defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),i}(va),ls=function(t){function e(){e.__super.call(this),this.setShaderName("PBRSpecular"),this._setColor(7,new Ce(1,1,1,1)),this._setColor(9,new Ce(0,0,0,0)),this._setColor(8,new Ce(.2,.2,.2,.2)),this._setNumber(10,.5),this._setNumber(11,1),this._setNumber(12,0),this._setNumber(13,1),this._setNumber(14,1),this._setNumber(15,.001),this._setBool(16,!1),this._setNumber(0,.5)}E(e,"laya.d3.core.material.PBRSpecularMaterial",va);var i=e.prototype;return v(0,i,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),v(0,i,"specularTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE),this._setTexture(2,t)}),v(0,i,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),v(0,i,"occlusionTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._setTexture(5,t)}),v(0,i,"normalTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE),this._setTexture(3,t)}),v(0,i,"parallaxTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._setTexture(4,t)}),v(0,i,"emissionColor",function(){return this._getColor(9)},function(t){this._setColor(9,t)}),v(0,i,"normalTextureScale",function(){return this._getNumber(14)},function(t){this._setNumber(14,t)}),v(0,i,"parallaxTextureScale",function(){return this._getNumber(15)},function(t){t=Math.max(.005,Math.min(.08,t)),this._setNumber(15,t)}),v(0,i,"occlusionTextureStrength",function(){return this._getNumber(13)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(13,t)}),v(0,i,"specularColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),v(0,i,"smoothness",function(){return this._getNumber(10)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(10,t)}),v(0,i,"smoothnessTextureScale",function(){return this._getNumber(11)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(11,t)}),v(0,i,"smoothnessSource",function(){return this._getNumber(12)},function(t){1==t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),t=0),this._setNumber(12,t)}),v(0,i,"enableEmission",function(){return this._getBool(16)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION),this._setBool(16,t)}),v(0,i,"emissionTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._setTexture(6,t)}),v(0,i,"tilingOffset",function(){return this._getColor(17)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(17,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_SPECULARTEXTURE=e.shaderDefines.registerDefine("SPECULARTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_SPECULARTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.SPECULARTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.SPECULARCOLOR=8,e.EMISSIONCOLOR=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.TILINGOFFSET=17,m(e,["shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),e}(),hs=function(t){function e(){e.__super.call(this),this.setShaderName("PBRStandard"),this._setColor(7,new Ce(1,1,1,1)),this._setColor(8,new Ce(0,0,0,0)),this._setNumber(9,0),this._setNumber(10,.5),this._setNumber(11,1),this._setNumber(12,0),this._setNumber(13,1),this._setNumber(14,1),this._setNumber(15,.001),this._setBool(16,!1),this._setNumber(0,.5)}E(e,"laya.d3.core.material.PBRStandardMaterial",va);var i=e.prototype;return v(0,i,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),v(0,i,"albedoTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),v(0,i,"enableEmission",function(){return this._getBool(16)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION),this._setBool(16,t)}),v(0,i,"metallicGlossTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE),this._setTexture(2,t)}),v(0,i,"occlusionTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._setTexture(5,t)}),v(0,i,"normalTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE),this._setTexture(3,t)}),v(0,i,"parallaxTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._setTexture(4,t)}),v(0,i,"emissionColor",function(){return this._getColor(8)},function(t){this._setColor(8,t)}),v(0,i,"normalTextureScale",function(){return this._getNumber(14)},function(t){this._setNumber(14,t)}),v(0,i,"parallaxTextureScale",function(){return this._getNumber(15)},function(t){t=Math.max(.005,Math.min(.08,t)),this._setNumber(15,t)}),v(0,i,"occlusionTextureStrength",function(){return this._getNumber(13)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(13,t)}),v(0,i,"metallic",function(){return this._getNumber(9)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(9,t)}),v(0,i,"smoothness",function(){return this._getNumber(10)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(10,t)}),v(0,i,"smoothnessTextureScale",function(){return this._getNumber(11)},function(t){t=Math.max(0,Math.min(1,t)),this._setNumber(11,t)}),v(0,i,"smoothnessSource",function(){return this._getNumber(12)},function(t){1==t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA):(this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA),t=0),this._setNumber(12,t)}),v(0,i,"emissionTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._setTexture(6,t)}),v(0,i,"tilingOffset",function(){return this._getColor(17)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(17,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_METALLICGLOSSTEXTURE=e.shaderDefines.registerDefine("METALLICGLOSSTEXTURE"),e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=e.shaderDefines.registerDefine("SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE"),e.SHADERDEFINE_PARALLAXTEXTURE=e.shaderDefines.registerDefine("PARALLAXTEXTURE"),e.SHADERDEFINE_OCCLUSIONTEXTURE=e.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),e.SHADERDEFINE_EMISSION=e.shaderDefines.registerDefine("EMISSION"),e.SHADERDEFINE_EMISSIONTEXTURE=e.shaderDefines.registerDefine("EMISSIONTEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.SmoothnessSource_MetallicGlossTexture_Alpha=0,e.SmoothnessSource_DiffuseTexture_Alpha=1,e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,e.SHADERDEFINE_SMOOTHNESSSOURCE_DIFFUSETEXTURE_ALPHA=0,e.SHADERDEFINE_METALLICGLOSSTEXTURE=0,e.SHADERDEFINE_OCCLUSIONTEXTURE=0,e.SHADERDEFINE_PARALLAXTEXTURE=0,e.SHADERDEFINE_EMISSION=0,e.SHADERDEFINE_EMISSIONTEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.METALLICGLOSSTEXTURE=2,e.NORMALTEXTURE=3,e.PARALLAXTEXTURE=4,e.OCCLUSIONTEXTURE=5,e.EMISSIONTEXTURE=6,e.DIFFUSECOLOR=7,e.EMISSIONCOLOR=8,e.METALLIC=9,e.SMOOTHNESS=10,e.SMOOTHNESSSCALE=11,e.SMOOTHNESSSOURCE=12,e.OCCLUSIONSTRENGTH=13,e.NORMALSCALE=14,e.PARALLAXSCALE=15,e.ENABLEEMISSION=16,e.TILINGOFFSET=17,m(e,["shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),e}(),us=function(o){function l(){this._transformUV=null,l.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new we(.6,.6,.6)),this._setColor(10,new we(1,1,1)),this._setColor(11,new Ce(1,1,1,8)),this._setColor(12,new we(1,1,1)),this._setColor(7,new Ce(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new Ce(1,1,0,0)),this.renderMode=1}E(l,"laya.d3.core.material.StandardMaterial",o);var t=l.prototype;return t.disableLight=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_POINTLIGHT|Xr.SHADERDEFINE_SPOTLIGHT|Xr.SHADERDEFINE_DIRECTIONLIGHT)},t.disableFog=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_FOG)},t.onAsynLoaded=function(t,e,i){var n=e[0];if(n.version)o.prototype.onAsynLoaded.call(this,t,e,i);else{var r=e[1],a=n.props;for(var s in a)this[s]=a[s];l._parseStandardMaterial(r,this,n),this._endLoaded()}},t.cloneTo=function(t){o.prototype.cloneTo.call(this,t);var e=t;this._transformUV&&(e._transformUV=this._transformUV.clone())},v(0,t,"ambientColor",function(){return this._getColor(9)},function(t){this._setColor(9,t)}),v(0,t,"ambientTexture",function(){return this._getTexture(5)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,t)}),v(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),v(0,t,"reflectColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),v(0,t,"tilingOffset",function(){return this._getColor(15)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,t)}),v(0,t,"albedo",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),v(0,t,"diffuseColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),v(0,t,"albedoColor",function(){return this._getColor(7)},function(t){this._setColor(7,t)}),v(0,t,"specularColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),v(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),v(0,t,"normalTexture",function(){return this._getTexture(2)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,t)}),v(0,t,"specularTexture",function(){return this._getTexture(3)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,t)}),v(0,t,"emissiveTexture",function(){return this._getTexture(4)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,t)}),v(0,t,"reflectTexture",function(){return this._getTexture(6)},function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,t)}),v(0,t,"transformUV",function(){return this._transformUV},function(t){this._transformUV=t,this._setMatrix4x4(13,t.matrix),t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,t.matrix.elements,0)}),l.__init__=function(){l.SHADERDEFINE_DIFFUSEMAP=l.shaderDefines.registerDefine("DIFFUSEMAP"),l.SHADERDEFINE_NORMALMAP=l.shaderDefines.registerDefine("NORMALMAP"),l.SHADERDEFINE_SPECULARMAP=l.shaderDefines.registerDefine("SPECULARMAP"),l.SHADERDEFINE_EMISSIVEMAP=l.shaderDefines.registerDefine("EMISSIVEMAP"),l.SHADERDEFINE_AMBIENTMAP=l.shaderDefines.registerDefine("AMBIENTMAP"),l.SHADERDEFINE_REFLECTMAP=l.shaderDefines.registerDefine("REFLECTMAP"),l.SHADERDEFINE_UVTRANSFORM=l.shaderDefines.registerDefine("UVTRANSFORM"),l.SHADERDEFINE_TILINGOFFSET=l.shaderDefines.registerDefine("TILINGOFFSET"),l.SHADERDEFINE_ADDTIVEFOG=l.shaderDefines.registerDefine("ADDTIVEFOG")},l.load=function(t){return S.loader.create(t,null,null,l)},l._parseStandardMaterial=function(t,e,i){var n=i.customProps,r=n.ambientColor;e.ambientColor=new we(r[0],r[1],r[2]);var a=n.diffuseColor;e.diffuseColor=new we(a[0],a[1],a[2]);var s=n.specularColor;e.specularColor=new Ce(s[0],s[1],s[2],s[3]);var o=n.reflectColor;e.reflectColor=new we(o[0],o[1],o[2]);var l=n.albedoColor;l&&(e.albedo=new Ce(l[0],l[1],l[2],l[3]));var h=n.diffuseTexture.texture2D;h&&(e.diffuseTexture=kr.getRes(t[h]));var u=n.normalTexture.texture2D;u&&(e.normalTexture=kr.getRes(t[u]));var c=n.specularTexture.texture2D;c&&(e.specularTexture=kr.getRes(t[c]));var d=n.emissiveTexture.texture2D;d&&(e.emissiveTexture=kr.getRes(t[d]));var _=n.ambientTexture.texture2D;_&&(e.ambientTexture=kr.getRes(t[_]));var f=n.reflectTexture.texture2D;f&&(e.reflectTexture=kr.getRes(t[f]))},l.RENDERMODE_OPAQUE=1,l.RENDERMODE_OPAQUEDOUBLEFACE=2,l.RENDERMODE_CUTOUT=3,l.RENDERMODE_CUTOUTDOUBLEFACE=4,l.RENDERMODE_TRANSPARENT=13,l.RENDERMODE_TRANSPARENTDOUBLEFACE=14,l.RENDERMODE_ADDTIVE=15,l.RENDERMODE_ADDTIVEDOUBLEFACE=16,l.RENDERMODE_DEPTHREAD_TRANSPARENT=5,l.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,l.RENDERMODE_DEPTHREAD_ADDTIVE=7,l.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,l.RENDERMODE_NONDEPTH_TRANSPARENT=9,l.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,l.RENDERMODE_NONDEPTH_ADDTIVE=11,l.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,l.SHADERDEFINE_DIFFUSEMAP=0,l.SHADERDEFINE_NORMALMAP=0,l.SHADERDEFINE_SPECULARMAP=0,l.SHADERDEFINE_EMISSIVEMAP=0,l.SHADERDEFINE_AMBIENTMAP=0,l.SHADERDEFINE_REFLECTMAP=0,l.SHADERDEFINE_UVTRANSFORM=0,l.SHADERDEFINE_TILINGOFFSET=0,l.SHADERDEFINE_ADDTIVEFOG=0,l.DIFFUSETEXTURE=1,l.NORMALTEXTURE=2,l.SPECULARTEXTURE=3,l.EMISSIVETEXTURE=4,l.AMBIENTTEXTURE=5,l.REFLECTTEXTURE=6,l.ALBEDO=7,l.UVANIAGE=8,l.MATERIALAMBIENT=9,l.MATERIALDIFFUSE=10,l.MATERIALSPECULAR=11,l.MATERIALREFLECT=12,l.UVMATRIX=13,l.UVAGE=14,l.TILINGOFFSET=15,m(l,["defaultMaterial",function(){return this.defaultMaterial=new l},"shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),l}(va),cs=function(e){function i(){this._diffuseScale1=null,this._diffuseScale2=null,this._diffuseScale3=null,this._diffuseScale4=null,i.__super.call(this),this.setShaderName("Terrain"),this.renderMode=1,this._diffuseScale1=new Re,this._diffuseScale2=new Re,this._diffuseScale3=new Re,this._diffuseScale4=new Re,this.ambientColor=new we(.6,.6,.6),this.diffuseColor=new we(1,1,1),this.specularColor=new Ce(.2,.2,.2,32)}E(i,"laya.d3.core.material.TerrainMaterial",e);var t=i.prototype;return t.setDiffuseScale1=function(t,e){this._diffuseScale1.x=t,this._diffuseScale1.y=e,this._setColor(6,this._diffuseScale1)},t.setDiffuseScale2=function(t,e){this._diffuseScale2.x=t,this._diffuseScale2.y=e,this._setColor(7,this._diffuseScale2)},t.setDiffuseScale3=function(t,e){this._diffuseScale3.x=t,this._diffuseScale3.y=e,this._setColor(8,this._diffuseScale3)},t.setDiffuseScale4=function(t,e){this._diffuseScale4.x=t,this._diffuseScale4.y=e,this._setColor(9,this._diffuseScale4)},t.setDetailNum=function(t){switch(t){case 1:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 2:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 3:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 4:this._addShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._removeShaderDefine(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3)}},t.disableLight=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_POINTLIGHT|Xr.SHADERDEFINE_SPOTLIGHT|Xr.SHADERDEFINE_DIRECTIONLIGHT)},t.setShaderName=function(t){e.prototype.setShaderName.call(this,t)},v(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=2e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.depthTest=515;break;default:throw new Error("TerrainMaterial:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),v(0,t,"diffuseTexture2",function(){return this._getTexture(3)},function(t){this._setTexture(3,t)}),v(0,t,"ambientColor",function(){return this._getColor(10)},function(t){this._setColor(10,t)}),v(0,t,"diffuseTexture4",function(){return this._getTexture(5)},function(t){this._setTexture(5,t)}),v(0,t,"diffuseColor",function(){return this._getColor(11)},function(t){this._setColor(11,t)}),v(0,t,"diffuseTexture1",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),v(0,t,"specularColor",function(){return this._getColor(12)},function(t){this._setColor(12,t)}),v(0,t,"diffuseTexture3",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),v(0,t,"splatAlphaTexture",function(){return this._getTexture(0)},function(t){this._setTexture(0,t)}),v(0,t,"normalTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),i.__init__=function(){i.SHADERDEFINE_DETAIL_NUM1=i.shaderDefines.registerDefine("DETAIL_NUM1"),i.SHADERDEFINE_DETAIL_NUM2=i.shaderDefines.registerDefine("DETAIL_NUM2"),i.SHADERDEFINE_DETAIL_NUM4=i.shaderDefines.registerDefine("DETAIL_NUM4"),i.SHADERDEFINE_DETAIL_NUM3=i.shaderDefines.registerDefine("DETAIL_NUM3")},i.load=function(t){return S.loader.create(t,null,null,i)},i.RENDERMODE_OPAQUE=1,i.RENDERMODE_TRANSPARENT=2,i.SPLATALPHATEXTURE=0,i.NORMALTEXTURE=1,i.DIFFUSETEXTURE1=2,i.DIFFUSETEXTURE2=3,i.DIFFUSETEXTURE3=4,i.DIFFUSETEXTURE4=5,i.DIFFUSESCALE1=6,i.DIFFUSESCALE2=7,i.DIFFUSESCALE3=8,i.DIFFUSESCALE4=9,i.MATERIALAMBIENT=10,i.MATERIALDIFFUSE=11,i.MATERIALSPECULAR=12,i.SHADERDEFINE_DETAIL_NUM1=0,i.SHADERDEFINE_DETAIL_NUM2=0,i.SHADERDEFINE_DETAIL_NUM3=0,i.SHADERDEFINE_DETAIL_NUM4=0,m(i,["defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),i}(va),ds=function(n){function e(){this._useVertexDeep=!1,e.__super.call(this),this.setShaderName("Water")}E(e,"laya.d3.core.material.WaterMaterial",n);var t=e.prototype;return t.disableFog=function(){this._addDisablePublicShaderDefine(Xr.SHADERDEFINE_FOG)},t.onAsynLoaded=function(t,e,i){n.prototype.onAsynLoaded.call(this,t,e,i)},v(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){this._setTexture(1,t)}),v(0,t,"normalTexture",function(){return this._getTexture(2)},function(t){this._setTexture(2,t)}),v(0,t,"underWaterTexture",function(){return this._getTexture(3)},function(t){this._setTexture(3,t)}),v(0,t,"deepColorTexture",function(){return this._getTexture(10)},function(t){this._setTexture(10,t)}),v(0,t,"useFoam",null,function(t){t?this._addShaderDefine(e.SHADERDEFINE_USE_FOAM):this._removeShaderDefine(e.SHADERDEFINE_USE_FOAM)}),v(0,t,"skyTexture",function(){return this._getTexture(11)},function(t){this._setTexture(11,t)}),v(0,t,"deepScale",function(){return this._getNumber(20)},function(t){this._setNumber(20,t)}),v(0,t,"detailTexture",function(){return this._getTexture(9)},function(t){this._setTexture(9,t)}),v(0,t,"foamTexture",function(){return this._getTexture(17)},function(t){this._setTexture(17,t)}),v(0,t,"waterInfoTexture",function(){return this._getTexture(16)},function(t){this._setTexture(16,t)}),v(0,t,"vertexDispTexture",function(){return this._getTexture(4)},function(t){this._setTexture(4,t)}),v(0,t,"currentTm",function(){return this._getNumber(8)},function(t){this._setNumber(8,t)}),v(0,t,"waveInfo",function(){return this._getBuffer(12)},function(t){this._setBuffer(12,t)}),v(0,t,"waveInfoD",function(){return this._getBuffer(13)},function(t){this._setBuffer(13,t)}),v(0,t,"waveMainDir",function(){return this._getNumber(14)},function(t){this._setNumber(14,t*Math.PI/180)}),v(0,t,"geoWaveUVScale",function(){return this._getNumber(18)},function(t){this._setNumber(18,t)}),v(0,t,"windSpeed",function(){return 0},function(t){}),v(0,t,"scrsize",null,function(t){this._setBuffer(15,t)}),v(0,t,"seaColor",function(){return this._getBuffer(19)},function(t){this._setBuffer(19,t)}),v(0,t,"useVertexDeep",function(){return this._useVertexDeep},function(t){(this._useVertexDeep=t)?this._addShaderDefine(e.SHADERDEFINE_USEVERTEXHEIGHT):this._removeShaderDefine(e.SHADERDEFINE_USEVERTEXHEIGHT)}),v(0,t,"windDir",function(){return 0},function(t){}),v(0,t,"useRefractTexture",null,function(t){t?this._addShaderDefine(e.SHADERDEFINE_USE_REFRACT_TEX):this._removeShaderDefine(e.SHADERDEFINE_USE_REFRACT_TEX)}),v(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1;break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1;break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3;break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771;break;default:throw new Error("PBRMaterial:renderMode value error.")}}),e.__init__=function(){e.SHADERDEFINE_CUBE_ENV=e.shaderDefines.registerDefine("CUBE_ENV"),e.SHADERDEFINE_HDR_ENV=e.shaderDefines.registerDefine("HDR_ENV"),e.SHADERDEFINE_SHOW_NORMAL=e.shaderDefines.registerDefine("SHOW_NORMAL"),e.SHADERDEFINE_USEVERTEXHEIGHT=e.shaderDefines.registerDefine("USE_VERTEX_DEEPINFO"),e.SHADERDEFINE_USE_FOAM=e.shaderDefines.registerDefine("USE_FOAM"),e.SHADERDEFINE_USE_REFRACT_TEX=e.shaderDefines.registerDefine("USE_REFR_TEX")},e.load=function(t){return S.loader.create(t,null,null,e)},e.DIFFUSETEXTURE=1,e.NORMALTEXTURE=2,e.UNDERWATERTEXTURE=3,e.VERTEXDISPTEXTURE=4,e.UVANIAGE=5,e.UVMATRIX=6,e.UVAGE=7,e.CURTM=8,e.DETAILTEXTURE=9,e.DEEPCOLORTEXTURE=10,e.SKYTEXTURE=11,e.WAVEINFO=12,e.WAVEINFOD=13,e.WAVEMAINDIR=14,e.SCRSIZE=15,e.WATERINFO=16,e.FOAMTEXTURE=17,e.GEOWAVE_UV_SCALE=18,e.SEA_COLOR=19,e.WAVEINFODEEPSCALE=20,e.SHADERDEFINE_SHOW_NORMAL=0,e.SHADERDEFINE_CUBE_ENV=0,e.SHADERDEFINE_HDR_ENV=0,e.SHADERDEFINE_USE_FOAM=0,e.SHADERDEFINE_USE_REFRACT_TEX=0,e.SHADERDEFINE_USEVERTEXHEIGHT=0,e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,m(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),e}(va),_s=function(o){function l(){l.__super.call(this),this.setShaderName("PARTICLESHURIKEN"),this.renderMode=6}E(l,"laya.d3.core.particleShuriKen.ShurikenParticleMaterial",o);var t=l.prototype;return t.onAsynLoaded=function(t,e,i){var n=e[0];if(n.version)o.prototype.onAsynLoaded.call(this,t,e,i);else{var r=e[1],a=n.props;for(var s in a)this[s]=a[s];l._parseShurikenParticleMaterial(r,this,n),this._endLoaded()}},v(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(l.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)}),v(0,t,"tintColor",function(){return this._getColor(2)},function(t){t?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR),this._setColor(2,t)}),v(0,t,"tilingOffset",function(){return this._getColor(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(3,t)}),v(0,t,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)}),l.__init__=function(){l.SHADERDEFINE_DIFFUSEMAP=l.shaderDefines.registerDefine("DIFFUSEMAP"),l.SHADERDEFINE_TINTCOLOR=l.shaderDefines.registerDefine("TINTCOLOR"),l.SHADERDEFINE_ADDTIVEFOG=l.shaderDefines.registerDefine("ADDTIVEFOG"),l.SHADERDEFINE_TILINGOFFSET=l.shaderDefines.registerDefine("TILINGOFFSET")},l.load=function(t){return S.loader.create(t,null,null,l)},l._parseShurikenParticleMaterial=function(t,e,i){var n=i.customProps,r=n.diffuseTexture.texture2D;r&&(e.diffuseTexture=kr.getRes(t[r]));var a=n.tintColor;a&&(e.tintColor=new Ce(a[0],a[1],a[2],a[3]))},l.RENDERMODE_OPAQUE=1,l.RENDERMODE_OPAQUEDOUBLEFACE=2,l.RENDERMODE_CUTOUT=3,l.RENDERMODE_CUTOUTDOUBLEFACE=4,l.RENDERMODE_TRANSPARENT=13,l.RENDERMODE_TRANSPARENTDOUBLEFACE=14,l.RENDERMODE_ADDTIVE=15,l.RENDERMODE_ADDTIVEDOUBLEFACE=16,l.RENDERMODE_DEPTHREAD_TRANSPARENT=5,l.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,l.RENDERMODE_DEPTHREAD_ADDTIVE=7,l.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,l.RENDERMODE_NONDEPTH_TRANSPARENT=9,l.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,l.RENDERMODE_NONDEPTH_ADDTIVE=11,l.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,l.SHADERDEFINE_DIFFUSEMAP=0,l.SHADERDEFINE_TINTCOLOR=0,l.SHADERDEFINE_TILINGOFFSET=0,l.SHADERDEFINE_ADDTIVEFOG=0,l.DIFFUSETEXTURE=1,l.TINTCOLOR=2,l.TILINGOFFSET=3,m(l,["defaultMaterial",function(){return this.defaultMaterial=new l},"shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),l}(va),fs=function(t){function l(){this._size=null,this._transformOrientedBoundBox=null,this.center=null,l.__super.call(this),this._needUpdate=!1}E(l,"laya.d3.component.physics.BoxCollider",Ta);var e=l.prototype;return e._updateCollider=function(){if(this._needUpdate){var t=this._transformOrientedBoundBox.transformation,e=this._owner.transform,i=e.rotation,n=e.scale,r=this.center.elements;0===r[0]&&0===r[1]&&0===r[2]?ye.createAffineTransformation(e.position,i,we.ONE,t):(we.multiply(this.center,n,l._deviationV3),we.transformQuat(l._deviationV3,i,l._deviationV3),we.add(e.position,l._deviationV3,l._deviationV3),ye.createAffineTransformation(l._deviationV3,i,we.ONE,t)),this._transformOrientedBoundBox.transformation=t;var a=this._transformOrientedBoundBox.extents.elements,s=this._size.elements,o=n.elements;a[0]=.5*s[0]*o[0],a[1]=.5*s[1]*o[1],a[2]=.5*s[2]*o[2],this._needUpdate=!1}},e._onWorldMatrixChanged=function(){for(var t in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[t]=!0,this._runtimeCollisonMap[t]._runtimeCollisonTestMap[this.id]=!0},e._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),this._transformOrientedBoundBox=new xe(new we,new ye),this._size=new we,this.center=new we,t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},e._getType=function(){return 1},e._collisonTo=function(t){switch(t._getType()){case 0:return 0!==this.boundBox.containsSphere(t.boundSphere);case 1:return 0!==this.boundBox.containsOrientedBoundBox(t.boundBox);case 2:var e=t;if(0===this.boundBox.containsBoundBox(e._boundBox))return!1;for(var i=t.mesh._positions,n=0,r=i.length;n<r;n++)if(1===this.boundBox.containsPoint(i[n]))return!0;return!1;default:throw new Error("BoxCollider:unknown collider type.")}},e._cloneTo=function(t){var e=t,i=e.size;this.size.cloneTo(i),e.size=i,this.center.cloneTo(e.center)},e.raycast=function(t,e,i){void 0===i&&(i=179e306),this._updateCollider();var n=this._transformOrientedBoundBox.intersectsRay(t,e.position);return-1!==n&&n<=i?(e.distance=n,e.sprite3D=this._owner,!0):(e.distance=-1,e.sprite3D=null,!1)},e.setFromBoundBox=function(t){xe.createByBoundBox(t,this._transformOrientedBoundBox);var e=this._transformOrientedBoundBox.extents;this._size=new we(2*e.x,2*e.y,2*e.z),this.center=new we,we.add(t.min,t.max,this.center),we.scale(this.center,.5,this.center),this._needUpdate=!0},v(0,e,"boundBox",function(){return this._updateCollider(),this._transformOrientedBoundBox}),v(0,e,"size",function(){return this._size},function(t){this._size=t,this._needUpdate=!0}),m(l,["_deviationV3",function(){return this._deviationV3=new we},"_obbCenterV3",function(){return this._obbCenterV3=new we}]),l}(),ms=function(t){function b(){this._transformBoundingBox=null,this._mesh=null,b.__super.call(this),this._transformBoundingBox=new _e(new we,new we),this._needUpdate=!1}E(b,"laya.d3.component.physics.MeshCollider",Ta);var e=b.prototype;return e._updateBoundBoxCollider=function(){if(this._needUpdate){for(var t=this._owner.transform.worldMatrix,e=this._mesh.boundingBoxCorners,i=0;i<8;i++)we.transformCoordinate(e[i],t,b._tempBoundBoxCorners[i]);_e.createfromPoints(b._tempBoundBoxCorners,this._transformBoundingBox),this._needUpdate=!1}},e._raycastMesh=function(t,e,i,n){void 0===n&&(n=179e306);var r=e.transform.worldMatrix,a=b._tempMatrix4x40;r.invert(a);var s=t.origin,o=t.direction,l=b._tempRay0;we.transformCoordinate(s,a,l.origin),we.TransformNormal(o,a,l.direction);for(var h=Number.MAX_VALUE,u=0,c=this._mesh.getRenderElementsCount();u<c;u++){var d=this._mesh.getRenderElement(u),_=d._getVertexBuffer(0),f=_.getData(),m=d._getIndexBuffer().getData(),p=b._tempRaycastHit;if(We.rayIntersectsPositionsAndIndices(l,f,_.vertexDeclaration,m,p)){we.transformCoordinate(p.position,r,p.position);var g=b._tempVector30;we.subtract(s,p.position,g);var v=we.scalarLength(g);if(v<n&&v<h){p.distance=v,p.sprite3D=e;var y=p.trianglePositions;we.transformCoordinate(y[0],r,y[0]),we.transformCoordinate(y[1],r,y[1]),we.transformCoordinate(y[2],r,y[2]);var x=p.triangleNormals;return we.transformCoordinate(x[0],r,x[0]),we.transformCoordinate(x[1],r,x[1]),we.transformCoordinate(x[2],r,x[2]),h=v,p.cloneTo(i),!0}return!1}}return!1},e._onWorldMatrixChanged=function(){this._needUpdate=!0},e._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},e._getType=function(){return 2},e._collisonTo=function(t){var e=0,i=0,n=this.mesh._positions;switch(t._getType()){case 0:var r=t;if(0===pe.sphereContainsBox(r.boundSphere,this._boundBox))return!1;for(e=0,i=n.length;e<i;e++)if(1===pe.sphereContainsPoint(r.boundSphere,n[e]))return!0;return!1;case 1:var a=t;if(0===a.boundBox.containsBoundBox(this._boundBox))return!1;for(e=0,i=n.length;e<i;e++)if(1===a.boundBox.containsPoint(n[e]))return!0;return!1;case 2:var s=t;return 1!==pe.intersectsBoxAndBox(s._boundBox,this._boundBox);default:throw new Error("MeshCollider:unknown collider type.")}},e._cloneTo=function(t){t.mesh=this._mesh},e.raycast=function(t,e,i){if(void 0===i&&(i=179e306),null==this._mesh||!this._mesh.loaded)return!1;var n=pe.intersectsRayAndBoxRD(t,this._boundBox);return!!(-1!==n&&n<=i&&this._raycastMesh(t,this._owner,e,i))||(e.distance=-1,e.sprite3D=null,!1)},v(0,e,"_boundBox",function(){return this._updateBoundBoxCollider(),this._transformBoundingBox}),v(0,e,"mesh",function(){return this._mesh},function(t){this._mesh=t}),m(b,["_tempRay0",function(){return this._tempRay0=new Ee(new we,new we)},"_tempVector30",function(){return this._tempVector30=new we},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new ye},"_tempRaycastHit",function(){return this._tempRaycastHit=new Ue},"_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new we,new we,new we,new we,new we,new we,new we,new we]}]),b}(),ps=function(t){function e(){this._originalBoundSphere=null,this._transformBoundSphere=null,e.__super.call(this),this._needUpdate=!1}E(e,"laya.d3.component.physics.SphereCollider",Ta);var i=e.prototype;return i._updateCollider=function(){if(this._needUpdate){var t=NaN,e=this._owner.transform,i=e.scale;t=i.x>=i.y&&i.x>=i.z?i.x:i.y>=i.z?i.y:i.z,we.transformCoordinate(this._originalBoundSphere.center,e.worldMatrix,this._transformBoundSphere.center),this._transformBoundSphere.radius=this._originalBoundSphere.radius*t,this._needUpdate=!1}},i._onWorldMatrixChanged=function(){for(var t in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[t]=!0,this._runtimeCollisonMap[t]._runtimeCollisonTestMap[this.id]=!0},i._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),this._originalBoundSphere=new me(new we(0,0,0),.5),this._transformBoundSphere=new me(new we(0,0,0),.5),t.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},i._getType=function(){return 0},i._collisonTo=function(t){switch(t._getType()){case 0:return 0!==pe.sphereContainsSphere(this.boundSphere,t.boundSphere);case 1:return 0!==t.boundBox.containsSphere(this.boundSphere);case 2:var e=t;if(0===pe.sphereContainsBox(this.boundSphere,e._boundBox))return!1;for(var i=e.mesh._positions,n=0,r=i.length;n<r;n++)if(1===pe.sphereContainsPoint(this.boundSphere,i[n]))return!0;return!1;default:throw new Error("SphereCollider:unknown collider type.")}},i._cloneTo=function(t){var e=t;e.radius=this.radius;var i=e.center;this.center.cloneTo(i),e.center=i},i.raycast=function(t,e,i){void 0===i&&(i=179e306),this._updateCollider();var n=this._transformBoundSphere.intersectsRayPoint(t,e.position);return-1!==n&&n<=i?(e.distance=n,e.sprite3D=this._owner,!0):(e.distance=-1,e.sprite3D=null,!1)},v(0,i,"center",function(){return this._originalBoundSphere.center},function(t){this._originalBoundSphere.center=t}),v(0,i,"radius",function(){return this._originalBoundSphere.radius},function(t){this._originalBoundSphere.radius=t}),v(0,i,"boundSphere",function(){return this._updateCollider(),this._transformBoundSphere}),e}(),gs=function(t){function e(){e.__super.call(this),this.setShaderName("Trail"),this._setColor(2,new Ce(1,1,1,1))}E(e,"laya.d3.core.trail.TrailMaterial",va);var i=e.prototype;return v(0,i,"tintColor",function(){return this._getColor(2)},function(t){this._setColor(2,t)}),v(0,i,"diffuseTexture",function(){return this._getTexture(1)},function(t){t?this._addShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE):this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_DIFFUSETEXTURE),this._setTexture(1,t)}),v(0,i,"tilingOffset",function(){return this._getColor(3)},function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(3,t)}),e.__init__=function(){e.SHADERDEFINE_DIFFUSETEXTURE=e.shaderDefines.registerDefine("DIFFUSETEXTURE"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET")},e.load=function(t){return S.loader.create(t,null,null,e)},e.SHADERDEFINE_DIFFUSETEXTURE=0,e.SHADERDEFINE_TILINGOFFSET=0,e.DIFFUSETEXTURE=1,e.TINTCOLOR=2,e.TILINGOFFSET=3,m(e,["defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new De(va.shaderDefines)}]),e}(),vs=function(e){function n(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,n.__super.call(this),this._renderState=new z,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new Ve,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new nt,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new we(.7,.7,.7),this.ambientColor=new we(.212,.227,.259),mr.shaderHighPrecision&&this.addShaderDefine(Xr.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}E(n,"laya.d3.core.scene.Scene",e);var t=n.prototype;return S.imps(t,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),t._setUrl=function(t){this._url=t},t._getGroup=function(){return this._group},t._setGroup=function(t){this._group=t},t._display=function(){S.stage._scenes.push(this),S.stage._scenes.sort(n._sortScenes);for(var t=0,e=this._childs.length;t<e;t++){var i=this._childs[t];i.active&&i._activeHierarchy()}},t._unDisplay=function(){var t=S.stage._scenes;t.splice(t.indexOf(this),1);for(var e=0,i=this._childs.length;e<i;e++){var n=this._childs[e];n.active&&n._inActiveHierarchy()}},t._addChild3D=function(t){t.transform._onWorldTransform(),t._setBelongScene(this),this.displayedInStage&&t.active&&t._activeHierarchy()},t._removeChild3D=function(t){t.transform.parent=null,this.displayedInStage&&t.active&&t._inActiveHierarchy(),t._setUnBelongScene()},t.initOctree=function(t,e,i,n,r){void 0===r&&(r=6),this.treeSize=new we(t,e,i),this.treeLevel=r,this.treeRoot=new j(this,0),this.treeRoot.init(n,this.treeSize)},t._prepareUpdateToRenderState=function(t,e){e.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,e.scene=this},t._prepareSceneToRender=function(t){var e=this._lights.length;if(0<e)for(var i=0,n=0;n<e&&!(this._lights[n]._prepareToScene(t)&&++i>=this._enableLightCount);n++);},t._updateChilds=function(t){for(var e=0,i=this._childs.length;e<i;++e)this._childs[e]._update(t)},t._preRenderScene=function(t,e,i){var n,r=e._viewMatrix,a=e._projectionMatrix,s=e._projectionViewMatrix,o=0,l=e.camera;for(l.useOcclusionCulling?this.treeRoot?rt.renderObjectCullingOctree(i,this,l,r,a,s):rt.renderObjectCulling(i,this,l,r,a,s):rt.renderObjectCullingNoBoundFrustum(this,l,r,a,s),o=0,n=this._quenes.length;o<n;o++)this._quenes[o]&&this._quenes[o]._preRender(e)},t._clear=function(t,e){var i=e._viewport,n=e.camera,r=i.x,a=n.renderTargetSize.height-i.y-i.height,s=i.width,o=i.height;t.viewport(r,a,s,o);var l=256,h=n.renderTarget;switch(n.clearFlag){case 0:var u=n.clearColor;if(u){t.enable(3089),t.scissor(r,a,s,o);var c=u.elements;t.clearColor(c[0],c[1],c[2],c[3]),l|=16384}if(h)switch(u||(l=16384),h.depthStencilFormat){case 33189:l|=256;break;case 36168:l|=1024;break;case 34041:l|=256,l|=1024}t.clear(l),u&&t.disable(3089);break;case 1:case 2:if(h)switch(l=16384,h.depthStencilFormat){case 33189:l|=256;break;case 36168:l|=1024;break;case 34041:l|=256,l|=1024}t.clear(l);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},t._renderScene=function(t,e){var i,n,r=e.camera,a=0;for(a=0;a<2;a++)(n=this._quenes[a])&&(r.renderTarget?n._render(e,!0):n._render(e,!1));if(1===r.clearFlag){var s=r.sky;s&&(pr.setCullFace(t,!1),pr.setDepthFunc(t,515),pr.setDepthMask(t,!1),s._render(e),pr.setDepthFunc(t,513),pr.setDepthMask(t,!0))}for(a=2,i=this._quenes.length;a<i;a++)(n=this._quenes[a])&&(n._sortAlpha(e.camera.transform.position),r.renderTarget?n._render(e,!0):n._render(e,!1))},t._set3DRenderConfig=function(t){t.disable(3042),pr._blend=!1,t.blendFunc(770,771),pr._sFactor=770,pr._dFactor=771,t.disable(2929),pr._depthTest=!1,t.enable(2884),pr._cullFace=!0,t.depthMask(1),pr._depthMask=!0,t.frontFace(2304),pr._frontFace=2304},t._set2DRenderConfig=function(t){pr.setBlend(t,!0),pr.setBlendFunc(t,1,771),pr.setDepthTest(t,!1),pr.setCullFace(t,!1),pr.setDepthMask(t,!0),pr.setFrontFace(t,2305),t.viewport(0,0,fr.width,fr.height)},t._parseCustomProps=function(t,e,i,n){var r=n.customProps.lightmaps,a=r.length,s=this._lightmaps;s.length=a;for(var o=0;o<a;o++)s[o]=kr.getRes(e[r[o].replace(".exr",".png")]);this.setlightmaps(s);var l=n.customProps.ambientColor;l&&(this.ambientColor=new we(l[0],l[1],l[2]));var h=n.customProps.fogColor;h&&(this.fogColor=new we(h[0],h[1],h[2]))},t._addLight=function(t){this._lights.indexOf(t)<0&&this._lights.push(t)},t._removeLight=function(t){var e=this._lights.indexOf(t);0<=e&&this._lights.splice(e,1)},t._updateScene=function(){var t=this._renderState;this._prepareUpdateToRenderState(mr.mainContext,t),this._updateComponents(t),this._updateChilds(t),this._lateUpdateComponents(t),this._time+=t.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},t._updateSceneConch=function(){var t=this._renderState;this._prepareUpdateToRenderState(mr.mainContext,t),this._updateComponents(t),this._lateUpdateComponents(t),this._prepareSceneToRender(t);for(var e=0,i=this._cameraPool.length;e<i;e++){var n=this._cameraPool[e];(t.camera=n)._prepareCameraToRender()}},t._preRenderShadow=function(t,e,i,n,r){this.treeRoot?rt.renderShadowObjectCullingOctree(this,e,i,n,r):rt.renderShadowObjectCulling(this,e,i,n,r);for(var a=0,s=i.length;a<s;a++)i[a]&&i[a]._preRender(t)},t._renderShadowMap=function(t,e,i){var n=this.parallelSplitShadowMaps[0];n._calcAllLightCameraInfo(i);var r,a,s,o=n.PSSMNum;if(this._preRenderShadow(e,n._lightCulling,n._shadowQuenes,n._lightVPMatrix[0],o),this.addShaderDefine(Ne.SHADERDEFINE_CAST_SHADOW),1<o)for(var l=0;l<o;l++)r=n.getRenderTarget(l+1),n.beginRenderTarget(l+1),t.clearColor(1,1,1,1),t.clear(16640),t.viewport(0,0,r.width,r.height),e.camera=s=n.getLightCamera(l),s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix),e._projectionViewMatrix=n._lightVPMatrix[l+1],(a=n._shadowQuenes[l])._preRender(e),a._renderShadow(e,!1),n.endRenderTarget(l+1);else r=n.getRenderTarget(1),n.beginRenderTarget(1),t.clearColor(1,1,1,1),t.clear(16640),t.viewport(0,0,r.width,r.height),e.camera=s=n.getLightCamera(0),s._prepareCameraToRender(),s._prepareCameraViewProject(s.viewMatrix,s.projectionMatrix),e._projectionViewMatrix=n._lightVPMatrix[0],(a=n._shadowQuenes[0])._preRender(e),a._renderShadow(e,!0),n.endRenderTarget(1);this.removeShaderDefine(Ne.SHADERDEFINE_CAST_SHADOW)},t.addTreeNode=function(t){this.treeRoot.addTreeNode(t)},t.removeTreeNode=function(t){this.treeSize&&t._treeNode&&t._treeNode.removeObject(t)},t.setlightmaps=function(t){this._lightmaps=t;for(var e=0,i=this._renderableSprite3Ds.length;e<i;e++)this._renderableSprite3Ds[e]._render._applyLightMapParams()},t.getlightmaps=function(){return this._lightmaps},t.addChildAt=function(t,e){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=e&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===Tr.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),(t.parent=this)._addChild3D(t);return t}throw new Error("appendChildAt:The index is out of bounds")},t.addChild=function(t){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===Tr.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged(),this._addChild3D(t);return t},t.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._removeChild3D(e),this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},t.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===t&&a<=e){var n=i;this._childs=Tr.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,a=n.length;r<a;r++)this._removeChild3D(n[r]),n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},t.addFrustumCullingObject=function(t){this.treeRoot?this.addTreeNode(t):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(t):this._cullingRenders[this._cullingRendersLength]=t,t._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},t.removeFrustumCullingObject=function(t){if(this.treeRoot)this.removeTreeNode(t);else{this._cullingRendersLength--;var e=t._indexInSceneFrustumCullingObjects;if(e!==this._cullingRendersLength){var i=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[e]=i)._indexInSceneFrustumCullingObjects=e,t._indexInSceneFrustumCullingObjects=-1}}},t.getRenderQueue=function(t){return t<3e3?this._quenes[1]||(this._quenes[1]=new Y(this)):this._quenes[2]||(this._quenes[2]=new Y(this))},t.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new Y(this)},t.addShaderDefine=function(t){this._shaderDefineValue|=t},t.removeShaderDefine=function(t){this._shaderDefineValue&=~t},t.addScript=function(t){return this._addComponent(t)},t.getScriptByType=function(t,e){return void 0===e&&(e=0),this._getComponentByType(t,e)},t.getScriptsByType=function(t,e){this._getComponentsByType(t,e)},t.getScriptByIndex=function(t){return this._getComponentByIndex(t)},t.removeScriptByType=function(t,e){void 0===e&&(e=0),this._removeComponentByType(t,e)},t.removeScriptsByType=function(t){this._removeComponentByType(t)},t.removeAllScript=function(){this._removeAllComponent()},t.render=function(t,e,i){(hn._context.ctx._renderKey=0)<this._childs.length&&t.addRenderObject(this)},t.renderSubmit=function(){var t=mr.mainContext,e=this._renderState;this._set3DRenderConfig(t),this._prepareSceneToRender(this._renderState);var i,n=0,r=0;if(gr.debugMode||j.debugMode)for(n=0,r=this._cameraPool.length;n<r;n++)i=this._cameraPool[n],gr._debugPhasorSprite.begin(1,i),i.activeInHierarchy&&i._renderCamera(t,e,this),gr._debugPhasorSprite.end();else for(n=0,r=this._cameraPool.length;n<r;n++)(i=this._cameraPool[n]).activeInHierarchy&&i._renderCamera(t,e,this);return this._set2DRenderConfig(t),1},t.onAsynLoaded=function(t,e,i){var n=e[0];if("Scene"!==n.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var r=e[1];ke._createNodeByJson(this,n,this,r),this.event("hierarchyloaded",[this]),this.__loaded=!0},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,kr.clearRes(this.url),this.loaded||gr._cancelLoadByUrl(this.url))},t.getRenderType=function(){return 0},t.releaseRender=function(){},t._addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=bn.getInstance(t);e.push(this._components.length),this._components.push(n);return n._initialize(this),n},t._removeComponent=function(t,e){var i=this._typeComponentsIndices[t],n=i[e],r=this._components[n];this._components.splice(n,1),i.splice(e,1),0===i.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1));for(var a=0,s=this._componentsMap.length;a<s;a++)for(var o=(i=this._typeComponentsIndices[a]).length-1;0<=o;o--){var l=i[o];if(!(n<l))break;i[o]=--l}r._destroy()},t._getComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);return-1===i?null:this._components[this._typeComponentsIndices[i][e]]},t._getComponentsByType=function(t,e){var i=this._componentsMap.indexOf(t);if(-1!==i){var n=this._typeComponentsIndices[i],r=n.length;e.length=r;for(var a=0;a<r;a++)e[a]=this._components[n[a]]}else e.length=0},t._getComponentByIndex=function(t){return this._components[t]},t._removeComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);-1!==i&&this._removeComponent(i,e)},t._removeComponentsByType=function(t){var e=this._componentsMap.indexOf(t);if(-1!==e)for(var i=this._typeComponentsIndices[e],n=0,r=i.length;n<r;i.length<r?r--:n++)this._removeComponent(e,n)},t._removeAllComponent=function(){for(var t=0,e=this._componentsMap.length;t<e;this._componentsMap.length<e?e--:t++)this._removeComponentsByType(this._componentsMap[t])},t._updateComponents=function(t){for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.enable&&n._update(t)}},t._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._lateUpdate(t)}},t._preRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._preRenderUpdate(t)}},t._postRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._postRenderUpdate(t)}},v(0,t,"_loaded",null,function(t){this.__loaded=t}),v(0,t,"fogColor",function(){return this._fogColor},function(t){this._fogColor=t,this._shaderValues.setValue(0,t.elements)}),v(0,t,"enableFog",function(){return this._enableFog},function(t){this._enableFog!==t&&((this._enableFog=t)?(this.addShaderDefine(Xr.SHADERDEFINE_FOG),this.removeShaderDefine(Xr.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(Xr.SHADERDEFINE_FOG))}),v(0,t,"url",function(){return this._url}),v(0,t,"loaded",function(){return this.__loaded}),v(0,t,"enableDepthFog",function(){return this._enableDepthFog},function(t){this._enableDepthFog!=t&&((this._enableDepthFog=t)?(this.addShaderDefine(Xr.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(Xr.SHADERDEFINE_FOG)):this.removeShaderDefine(Xr.SAHDERDEFINE_DEPTHFOG))}),v(0,t,"fogStart",function(){return this._fogStart},function(t){this._fogStart=t,this._shaderValues.setValue(1,t)}),v(0,t,"fogRange",function(){return this._fogRange},function(t){this._fogRange=t,this._shaderValues.setValue(2,t)}),v(0,t,"ambientColor",function(){return this._ambientColor},function(t){this._ambientColor=t,this._shaderValues.setValue(21,t.elements)}),v(0,t,"scene",function(){return this}),v(0,t,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),n._sortScenes=function(t,e){if(t.parent!==S.stage||e.parent!==S.stage)return t.parent!==S.stage&&e.parent!==S.stage?n._sortScenes(t.parent,e.parent):t.parent===S.stage?-1:1;var i=S.stage._childs;return i.indexOf(t)-i.indexOf(e)},n.load=function(t){return S.loader.create(t,null,null,n)},n.FOGCOLOR=0,n.FOGSTART=1,n.FOGRANGE=2,n.LIGHTDIRECTION=3,n.LIGHTDIRCOLOR=4,n.POINTLIGHTPOS=5,n.POINTLIGHTRANGE=6,n.POINTLIGHTATTENUATION=7,n.POINTLIGHTCOLOR=8,n.SPOTLIGHTPOS=9,n.SPOTLIGHTDIRECTION=10,n.SPOTLIGHTSPOT=11,n.SPOTLIGHTRANGE=12,n.SPOTLIGHTATTENUATION=13,n.SPOTLIGHTCOLOR=14,n.SHADOWDISTANCE=15,n.SHADOWLIGHTVIEWPROJECT=16,n.SHADOWMAPPCFOFFSET=17,n.SHADOWMAPTEXTURE1=18,n.SHADOWMAPTEXTURE2=19,n.SHADOWMAPTEXTURE3=20,n.AMBIENTCOLOR=21,n.TIME=22,n}(ya),ys=function(t){function e(t){e.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new ye,this._shaderValues=new Ve,this._colliders=[],this._id=++e._uniqueIDCounter,this._transform=new Ir(this),this.name=t||"Sprite3D-"+e._nameNumberCounter++,this.layer=V.currentCreationLayer,this.active=!0}E(e,"laya.d3.core.Sprite3D",wa);var i=e.prototype;return S.imps(i,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),i._setUrl=function(t){this._url=t},i._getGroup=function(){return this._group},i._setGroup=function(t){this._group=t},i._addChild3D=function(t){t.transform.parent=this.transform,this._hierarchyAnimator&&(!t._hierarchyAnimator&&t._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(t,!0,[t.name])),this._scene&&(t._setBelongScene(this._scene),this._activeInHierarchy&&t._active&&t._activeHierarchy())},i._removeChild3D=function(t){t.transform.parent=null,this._scene&&(this._activeInHierarchy&&t._active&&t._inActiveHierarchy(),t._setUnBelongScene()),this._hierarchyAnimator&&(t._hierarchyAnimator==this._hierarchyAnimator&&t._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(t,!1,[t.name]))},i._parseBaseCustomProps=function(t){var e=this.transform.localPosition;e.fromArray(t.translate),this.transform.localPosition=e;var i=this.transform.localRotation;i.fromArray(t.rotation),this.transform.localRotation=i;var n=this.transform.localScale;n.fromArray(t.scale),this.transform.localScale=n;var r=t.layer;null!=r&&(this.layer=V.getLayerByNumber(r))},i._parseCustomComponent=function(t,e,i){for(var n in i){var r=i[n];switch(n){case"Animator":var a=this.addComponent(ba);if(r.avatarPath)a.avatar=kr.getRes(e[r.avatarPath]);else{var s=r.avatar;if(s){a.avatar=kr.getRes(e[s.path]);var o=s.linkSprites;o&&t.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[a,o])}}for(var l=r.clipPaths,h=l.length,u=0;u<h;u++)a.addClip(kr.getRes(e[l[u]]));a.clip=kr.getRes(e[l[0]]);var c=r.playOnWake;void 0!==c&&(a.playOnWake=c);break;case"Rigidbody":this.addComponent(Sa);break;case"SphereCollider":var d=this.addComponent(ps);d.isTrigger=r.isTrigger;var _=d.center;_.fromArray(r.center),d.center=_,d.radius=r.radius;break;case"BoxCollider":var f=this.addComponent(fs);f.isTrigger=r.isTrigger,f.center.fromArray(r.center);var m=f.size;m.fromArray(r.size),f.size=m;break;case"MeshCollider":this.addComponent(ms)}}},i._onRootNodeHierarchyLoaded=function(t,e){for(var i in e){for(var n=this,r=e[i],a=0,s=r.length;a<s;a++){var o=r[a];if(""===o)break;if(!(n=n.getChildByName(o)))break}n&&t.linkSprite3DToAvatarNode(i,n)}},i._setHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(t);for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i];r._hierarchyAnimator==e&&r._setHierarchyAnimator(t,e)}},i._clearHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(e);for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i];r._hierarchyAnimator==t&&r._clearHierarchyAnimator(t,e)}},i._getAnimatorToLinkSprite3D=function(t,e,i){var n=this.getComponentByType(ba);if(n&&(n.avatar?n.avatar._version||t._setAnimatorToLinkAvatar(n,e):t._setAnimatorToLinkSprite3DNoAvatar(n,e,i)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){i.unshift(this._parent.name);var r=this._parent;r._hierarchyAnimator&&r._getAnimatorToLinkSprite3D(t,e,i)}},i._setAnimatorToLinkSprite3DNoAvatar=function(t,e,i){var n=0,r=0;for(n=0,r=t.getClipCount();n<r;n++)t._handleSpriteOwnersBySprite(n,e,i,this);for(n=0,r=this._childs.length;n<r;n++){var a=this._childs[n],s=i.length;i.push(a.name),a._setAnimatorToLinkSprite3DNoAvatar(t,e,i),i.splice(s,1)}},i._changeHierarchyAnimator=function(t){this._hierarchyAnimator=t},i._isLinkSpriteToAnimationNode=function(t,e,i){var n=t._avatarNodes.indexOf(e),r=t._cacheSpriteToNodesMap;if(i)this._transform.dummy=e.transform,t._cacheNodesToSpriteMap[n]=r.length,r.push(n);else{this._transform.dummy=null;var a=t._cacheNodesToSpriteMap[n];t._cacheNodesToSpriteMap[n]=null,r.splice(a,1)}},i._setBelongScene=function(t){this._scene=t;for(var e=0,i=this._childs.length;e<i;e++)this._childs[e]._setBelongScene(t)},i._setUnBelongScene=function(){this._scene=null;for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._setUnBelongScene()},i._activeHierarchy=function(){var t=0,e=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),t=0,e=this._colliders.length;t<e;t++)this._layer._addCollider(this._colliders[t]);for(this.event("activeinhierarchychanged",!0),t=0,e=this._childs.length;t<e;t++){var i=this._childs[t];i._active&&i._activeHierarchy()}},i._inActiveHierarchy=function(){var t=0,e=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),t=0,e=this._colliders.length;t<e;t++){var i=this._colliders[t];i._clearCollsionMap(),this._layer._removeCollider(i)}for(this.event("activeinhierarchychanged",!1),t=0,e=this._childs.length;t<e;t++){var n=this._childs[t];n._active&&n._inActiveHierarchy()}},i.addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=bn.getInstance(t);if(e.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.physics.Collider)this.getComponentByType(Sa)&&(n._isRigidbody=!0),this._activeInHierarchy&&this._layer._addCollider(n),this._colliders.push(n);else if(n instanceof laya.d3.component.Animator){var r=n;this._setHierarchyAnimator(r,this._parent?this._parent._hierarchyAnimator:null),this._setAnimatorToLinkSprite3DNoAvatar(r,!0,[])}else if(n instanceof laya.d3.component.Rigidbody)for(var a=0,s=this._colliders.length;a<s;a++)this._colliders[a]._setIsRigidbody(!0);return n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},i._removeComponent=function(t,e){var i=0,n=0,r=this._typeComponentsIndices[t],a=r[e],s=this._components[a];if(s instanceof laya.d3.component.physics.Collider){var o=s;this._activeInHierarchy&&this._layer._removeCollider(o),this._colliders.splice(this._colliders.indexOf(o),1)}else if(s instanceof laya.d3.component.Animator){var l=s;this._clearHierarchyAnimator(l,this._parent?this._parent._hierarchyAnimator:null)}else if(s instanceof laya.d3.component.Rigidbody)for(i=0,n=this._colliders.length;i<n;i++){var h=this._colliders[i];h._setIsRigidbody(!1);var u=h._runtimeCollisonMap,c=h._runtimeCollisonTestMap;for(var d in u)delete c[d]}for(this._components.splice(a,1),s instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(s),1),r.splice(e,1),0===r.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1)),i=0,n=this._componentsMap.length;i<n;i++)for(var _=(r=this._typeComponentsIndices[i]).length-1;0<=_;_--){var f=r[_];if(!(a<f))break;r[_]=--f}s._destroy()},i._clearSelfRenderObjects=function(){},i._addSelfRenderObjects=function(){},i._parseCustomProps=function(t,e,i,n){},i._updateChilds=function(t){var e=this._childs.length;if(0!==e)for(var i=0;i<e;++i)this._childs[i]._update(t)},i._getSortID=function(t,e){return 1e3*e.id+t._getVertexBuffer().vertexDeclaration.id},i._update=function(t){(t.owner=this)._activeInHierarchy&&(this._updateComponents(t),this._lateUpdateComponents(t),Cn.spriteCount++,this._childs.length&&this._updateChilds(t))},i.getProjectionViewWorldMatrix=function(t){return ye.multiply(t,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},i.loadHierarchy=function(t){this.addChild(laya.d3.core.Sprite3D.load(t))},i.addChildAt=function(t,e){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=e&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===Tr.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),(t.parent=this)._addChild3D(t);return t}throw new Error("appendChildAt:The index is out of bounds")},i.addChild=function(t){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===Tr.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged(),this._addChild3D(t);return t},i.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._removeChild3D(e),this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},i.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===t&&a<=e){var n=i;this._childs=Tr.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,a=n.length;r<a;r++)this._removeChild3D(n[r]),n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},i.onAsynLoaded=function(t,e,i){var n=e[0];if("Sprite3D"!==n.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var r=e[1];ke._createNodeByJson(this,n,this,r),this.event("hierarchyloaded",[this]),this.__loaded=!0},i.cloneTo=function(t){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var e=t;e.name=this.name,e._destroyed=this._destroyed,e.timer=this.timer,e._$P=this._$P,e.active=this._active;var i=e.transform.localPosition;this.transform.localPosition.cloneTo(i),e.transform.localPosition=i;var n=e.transform.localRotation;this.transform.localRotation.cloneTo(n),e.transform.localRotation=n;var r=e.transform.localScale;this.transform.localScale.cloneTo(r),e.transform.localScale=r,e.isStatic=this.isStatic;var a=0,s=0;for(a=0,s=this._componentsMap.length;a<s;a++){var o=e.addComponent(this._componentsMap[a]);this._components[a]._cloneTo(o)}for(a=0,s=this._childs.length;a<s;a++)e.addChild(this._childs[a].clone());var l=e.getComponentByType(ba);if(l){var h=l._linkSpritesData;if(h)for(var u in h){for(var c=h[u],d=e,_=0,f=c.length;_<f&&(d=d.getChildByName(c[_]));_++);if(d){var m=l._avatarNodeMap[u];d._isLinkSpriteToAnimationNode(l,m,!0)}}}},i.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},i.destroy=function(t){if(void 0===t&&(t=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,t);var e,i=0;for(i=0,e=this._components.length;i<e;i++)this._components[i]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,kr.clearRes(this.url),this.loaded||gr._cancelLoadByUrl(this.url)}},i._handleSpriteToAvatar=function(t,e){t._avatarNodes;var i=t._avatarNodeMap[this.name];i&&i.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(t,i,e)},i._setAnimatorToLinkAvatar=function(t,e){this._handleSpriteToAvatar(t,e);for(var i=0,n=this._childs.length;i<n;i++){this._childs[i]._setAnimatorToLinkAvatar(t,e)}},v(0,i,"activeInHierarchy",function(){return this._activeInHierarchy}),v(0,i,"_loaded",null,function(t){this.__loaded=t}),v(0,i,"active",function(){return this._active},function(t){this._active!==t&&(this._active=t,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(t?this._activeHierarchy():this._inActiveHierarchy()))}),v(0,i,"componentsCount",function(){return this._components.length}),v(0,i,"loaded",function(){return this.__loaded}),v(0,i,"id",function(){return this._id}),v(0,i,"url",function(){return this._url}),v(0,i,"layer",function(){return this._layer},function(t){if(this._layer!==t){if(!t)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var e=0,i=this._colliders.length;if(this._layer)for(e=0;e<i;e++)this._layer._removeCollider(this._colliders[e]);for(e=0;e<i;e++)t._addCollider(this._colliders[e])}this._layer=t,this.event("layerchanged",t)}}),v(0,i,"scene",function(){return this._scene}),v(0,i,"transform",function(){return this._transform}),e.instantiate=function(t,e,i,n,r){void 0===i&&(i=!0);var a=t.clone();e&&e.addChild(a);var s=a.transform;if(i){var o=s.worldMatrix;t.transform.worldMatrix.cloneTo(o),s.worldMatrix=o}else n&&(s.position=n),r&&(s.rotation=r);return a},e.load=function(t){return S.loader.create(t,null,null,e)},e.WORLDMATRIX=0,e.MVPMATRIX=1,e._uniqueIDCounter=0,e._nameNumberCounter=0,e}(),xs=function(t){function e(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,e.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}E(e,"laya.d3.resource.models.Mesh",ga);var i=e.prototype;return i._getPositions=function(){var t,e,i,n,r,a=[],s=0,o=0,l=0;if(0!==this._vertexBuffers.length){var h=this._vertexBuffers.length;for(s=0;s<h;s++){for(i=(t=this._vertexBuffers[s]).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)l=o+e.offset/4,a.push(new we(r[l+0],r[l+1],r[l+2]))}}else{var u=this._subMeshes.length;for(s=0;s<u;s++){for(i=(t=this._subMeshes[s]._getVertexBuffer()).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)l=o+e.offset/4,a.push(new we(r[l+0],r[l+1],r[l+2]))}}return a},i._setSubMeshes=function(t){this._subMeshes=t,this._subMeshCount=t.length;for(var e=0;e<this._subMeshCount;e++)t[e]._indexInMesh=e;this._positions=this._getPositions(),this._generateBoundingObject()},i.onAsynLoaded=function(t,e,i){var n=e[0],r=e[1];de.read(n,this,this._materials,this._subMeshes,r),this.completeCreate(),this._endLoaded()},i.getSubMesh=function(t){return this._subMeshes[t]},i.getSubMeshCount=function(){return this._subMeshes.length},i.getRenderElementsCount=function(){return this._subMeshes.length},i.getRenderElement=function(t){return this._subMeshes[t]},i.disposeResource=function(){for(var t=0;t<this._subMeshes.length;t++)this._subMeshes[t].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},v(0,i,"materials",function(){return this._materials.slice()}),v(0,i,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),e.load=function(t){return S.loader.create(t,null,null,e)},e}(),bs=function(t){function e(t){this.lineLen=160,this.arrowLen=10,this.sign="Y",this._targetChanger=null,this._isMoving=!1,this.lenControl=new Ss,this.rotationControl=new Ss,this.lenChanger=Ai.create(this,"lineLen"),this.lenControlXChanger=Ai.create(this.lenControl,"x"),void 0===t&&(t="X"),e.__super.call(this),this.sign=t,this.addChild(this.lenControl),this.addChild(this.rotationControl),this.lenControl.on("mousedown",this,this.controlMouseDown),this.drawMe()}E(e,"laya.debug.tools.comps.ArrowLine",ya);var i=e.prototype;return i.drawMe=function(){var t;(t=this.graphics).clear(),t.drawLine(0,0,this.lineLen,0,"#ffff00"),t.drawLine(this.lineLen,0,this.lineLen-this.arrowLen,-this.arrowLen,"#ff0000"),t.drawLine(this.lineLen,0,this.lineLen-this.arrowLen,this.arrowLen,"#ff0000"),t.fillText(this.sign,50,-5,"","#ff0000","left"),this._isMoving&&this._targetChanger&&t.fillText(this._targetChanger.key+":"+this._targetChanger.value.toFixed(2),this.lineLen-15,-25,"","#ffff00","center"),this.lenControl.posTo(this.lineLen-15,0),this.rotationControl.posTo(this.lineLen+10,0),this.size(this.arrowLen,this.lineLen)},i.clearMoveEvents=function(){S.stage.off("mousemove",this,this.stageMouseMove),S.stage.off("mouseup",this,this.stageMouseUp)},i.controlMouseDown=function(t){this.clearMoveEvents(),this.lenControlXChanger.record(),this.lenChanger.record(),this.targetChanger&&this.targetChanger.record(),this._isMoving=!0,S.stage.on("mousemove",this,this.stageMouseMove),S.stage.on("mouseup",this,this.stageMouseUp)},i.stageMouseMove=function(t){this.lenControlXChanger.value=this.mouseX,this.lenChanger.showValueByScale(this.lenControlXChanger.scaleValue),this.targetChanger&&this.targetChanger.showValueByScale(this.lenControlXChanger.scaleValue),this.drawMe()},i.stageMouseUp=function(t){this._isMoving=!1,this.noticeChange(),this.clearMoveEvents(),this.lenControlXChanger.recover(),this.lenChanger.recover(),this.drawMe()},i.noticeChange=function(){var t;t=this.lenChanger.dValue,console.log("lenChange:",t)},v(0,i,"targetChanger",function(){return this._targetChanger},function(t){this._targetChanger&&this._targetChanger.dispose(),this._targetChanger=t}),e}(),Ts=function(t){function e(){this._target=null,this._lenType=[["width","height"],["scaleX","scaleY"]],this._type=1,this.xAxis=new bs("X"),this.yAxis=new bs("Y"),this.controlBox=new Ss,this._point=new en,this.oPoint=new en,this.myRotationChanger=Ai.create(this,"rotation"),this.targetRotationChanger=Ai.create(null,"rotation"),this.stageMouseRotationChanger=new Ai,e.__super.call(this),this.mouseEnabled=!0,this.size(1,1),this.initMe(),this.xAxis.rotationControl.on("mousedown",this,this.controlMouseDown),this.yAxis.rotationControl.on("mousedown",this,this.controlMouseDown),this.controlBox.on("mousedown",this,this.controlBoxMouseDown),this.on("dragmove",this,this.dragging)}E(e,"laya.debug.tools.comps.Axis",ya);var i=e.prototype;return i.updateChanges=function(){var t;this._target&&(t=this._lenType[this._type],this.xAxis.targetChanger=Ai.create(this._target,t[0]),this.yAxis.targetChanger=Ai.create(this._target,t[1]))},i.switchType=function(){this._type++,this._type=this._type%this._lenType.length,this.type=this._type},i.controlBoxMouseDown=function(t){this.startDrag()},i.dragging=function(){this._target&&(this._point.setTo(this.x,this.y),oi.transPoint(this.parent,this._target.parent,this._point),this._target.pos(this._point.x,this._point.y))},i.initMe=function(){this.addChild(this.xAxis),this.addChild(this.yAxis),this.yAxis.rotation=90,this.addChild(this.controlBox),this.controlBox.posTo(0,0)},i.clearMoveEvents=function(){S.stage.off("mousemove",this,this.stageMouseMove),S.stage.off("mouseup",this,this.stageMouseUp)},i.controlMouseDown=function(t){this.targetRotationChanger.target=this.target,this.clearMoveEvents(),this.oPoint.setTo(0,0),this.myRotationChanger.record(),this.oPoint=this.localToGlobal(this.oPoint),this.stageMouseRotationChanger.value=this.getStageMouseRatation(),this.stageMouseRotationChanger.record(),this.targetRotationChanger.record(),S.stage.on("mousemove",this,this.stageMouseMove),S.stage.on("mouseup",this,this.stageMouseUp)},i.getStageMouseRatation=function(){return $i.getRotation(this.oPoint.x,this.oPoint.y,S.stage.mouseX,S.stage.mouseY)},i.stageMouseMove=function(t){this.stageMouseRotationChanger.value=this.getStageMouseRatation();var e;e=-this.stageMouseRotationChanger.dValue,this.target?this.targetRotationChanger.showValueByAdd(e):this.myRotationChanger.showValueByAdd(e)},i.stageMouseUp=function(t){this.noticeChange(),this.clearMoveEvents()},i.noticeChange=function(){console.log("rotate:",-this.stageMouseRotationChanger.dValue)},v(0,i,"target",function(){return this._target},function(t){this._target=t,this.updateChanges()}),v(0,i,"type",function(){return this._type},function(t){this._type=t,this.updateChanges()}),e}(),Ss=function(t){function e(){this.recWidth=10,e.__super.call(this),this.drawMe()}E(e,"laya.debug.tools.comps.Rect",ya);var i=e.prototype;return i.drawMe=function(){var t;(t=this.graphics).clear(),t.drawRect(0,0,this.recWidth,this.recWidth,"#22ff22"),this.size(this.recWidth,this.recWidth)},i.posTo=function(t,e){this.x=t-.5*this.recWidth,this.y=e-.5*this.recWidth},e}(),Es=function(e){function _(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,_.__super.call(this),this.overflow=_.VISIBLE,this._style=new jr(this),this._style.wordWrap=!1}E(_,"laya.display.Text",e);var t=_.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._lines=null,this._words&&(this._words.length=0,this._words=null)},t._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=nn.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()},t.getGraphicBounds=function(t){void 0===t&&(t=!1);var e=nn.TEMP;return e.setTo(0,0,this.width,this.height),e},t._getCSSStyle=function(){return this._style},t.lang=function(t,e,i,n,r,a,s,o,l,h,u){if(t=_.langPacks&&_.langPacks[t]?_.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var c=0,d=arguments.length;c<d;c++)t=t.replace("{"+c+"}",arguments[c+1]);this._text=t}},t._isPassWordMode=function(){var t=this._style.password;return"prompt"in this&&this.prompt==this._text&&(t=!1),t},t._getPassWordTxt=function(t){var e;e="";for(var i=t.length;0<i;i--)e+="●";return e},t.renderText=function(t,e){var i=this.graphics;i.clear(!0);var n=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(vn.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);vn.context.font=n;var r=this.padding,a=r[3],s="left",o=this._lines,l=this.leading+this._charSize.height,h=this._currBitmapFont;h&&(l=this.leading+h.getMaxHeight());var u=r[0];if(!h&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(s="right",a=this._width-r[1]):"center"==this.align&&(s="center",a=.5*this._width+r[3]-r[1])),0<this._height){var c=this._textHeight>this._height?"top":this.valign;"middle"===c?u=.5*(this._height-e*l)+r[0]-r[2]:"bottom"===c&&(u=this._height-e*l-r[2])}var d=this._style;if(h&&h.autoScaleSize)var _=h.fontSize/this.fontSize;if(this._clipPoint)if(i.save(),h&&h.autoScaleSize){var f=0,m=0;f=this._width?this._width-r[3]-r[1]:this._textWidth,m=this._height?this._height-r[0]-r[2]:this._textHeight,f*=_,m*=_,i.clipRect(r[3],r[0],f,m)}else i.clipRect(r[3],r[0],this._width?this._width-r[3]-r[1]:this._textWidth,this._height?this._height-r[0]-r[2]:this._textHeight);var p=d.password;"prompt"in this&&this.prompt==this._text&&(p=!1);for(var g=0,v=0,y=Math.min(this._lines.length,e+t)||1,x=t;x<y;x++){var b,T=o[x];if(p){var S=T.length;T="";for(var E=S;0<E;E--)T+="●"}if(void 0===T&&(T=""),g=a-(this._clipPoint?this._clipPoint.x:0),v=u+l*x-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(s,g,v,x),h){var R=this.width;h.autoScaleSize&&(R=this.width*_),h.drawText(T,this,g,v,this.align,R)}else hn.isWebGL?(this._words||(this._words=[]),(b=this._words.length>x-t?this._words[x-t]:new Nn).setText(T)):b=T,d.stroke?i.fillBorderText(b,g,v,n,this.color,d.strokeColor,d.stroke,s):i.fillText(b,g,v,n,this.color,s)}if(h&&h.autoScaleSize){var w=1/_;this.scale(w,w)}this._clipPoint&&i.restore(),this._startX=a,this._startY=u},t.drawUnderline=function(t,e,i,n){var r=this._lineWidths[n];switch(t){case"center":e-=r/2;break;case"right":e-=r}i+=this._charSize.height,this._graphics.drawLine(e,i,e+r,i,this.underlineColor||this.color,1)},t.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);vn.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new en(0,0)):this._clipPoint=null;var t=this._lines.length;if(this.overflow!=_.VISIBLE){var e=this.overflow==_.HIDDEN?Math.floor:Math.ceil;t=Math.min(t,e((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var i=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(i,t),this.repaint()},t.evalTextSize=function(){var t,e=NaN;t=Math.max.apply(this,this._lineWidths),e=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],t==this._textWidth&&e==this._textHeight||(this._textWidth=t,this._textHeight=e,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},t.checkEnabledViewportOrNot=function(){return this.overflow==_.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},t.changeText=function(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},t.parseLines=function(t){var e=this.wordWrap||this.overflow==_.HIDDEN;if(e)var i=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var n=vn.context.measureText(_._testWord);hn.isConchApp&&0===n.width&&0===n.height&&(n=vn.context.measureText("W")),this._charSize.width=n.width,this._charSize.height=n.height||this.fontSize}for(var r=t.replace(/\r\n/g,"\n").split("\n"),a=0,s=r.length;a<s;a++){var o=r[a];e?this.parseLine(o,i):(this._lineWidths.push(this.getTextWidth(o)),this._lines.push(o))}},t.parseLine=function(t,e){vn.context;var i,n=this._lines,r=0,a=NaN,s=NaN,o=0;if((a=this.getTextWidth(t))<=e)return n.push(t),void this._lineWidths.push(a);a=this._charSize.width,0==(r=Math.floor(e/a))&&(r=1),s=a=this.getTextWidth(t.substring(0,r));for(var l=r,h=t.length;l<h;l++)if(e<(s+=a=this.getTextWidth(t.charAt(l))))if(this.wordWrap){var u=t.substring(o,l);if(u.charCodeAt(u.length-1)<255?(i=/(?:\w|-)+$/.exec(u))&&(l=i.index+o,0==i.index?l+=u.length:u=t.substring(o,l)):_.RightToLeft&&(i=/([\u0600-\u06FF])+$/.exec(u))&&(l=i.index+o,0==i.index?l+=u.length:u=t.substring(o,l)),n.push(u),this._lineWidths.push(s-a),!((o=l)+r<h)){n.push(t.substring(o,h)),this._lineWidths.push(this.getTextWidth(n[n.length-1])),o=-1;break}l+=r,s=a=this.getTextWidth(t.substring(o,l)),l--}else if(this.overflow==_.HIDDEN)return n.push(t.substring(0,l)),void this._lineWidths.push(this.getTextWidth(n[n.length-1]));this.wordWrap&&-1!=o&&(n.push(t.substring(o,h)),this._lineWidths.push(this.getTextWidth(n[n.length-1])))},t.getTextWidth=function(t){return this._currBitmapFont?this._currBitmapFont.getTextWidth(t):vn.context.measureText(t).width},t.getWordWrapWidth=function(){var t=this.padding,e=NaN;return(e=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(e=this.wordWrap?100:vn.width),e<=0&&(e=100),e-t[3]-t[1]},t.getCharPoint=function(t,e){this._isChanged&&S.timer.runCallLater(this,this.typeset);for(var i=0,n=this._lines,r=0,a=0,s=n.length;a<s;a++){if(t<(i+=n[a].length)){var o=a;break}r=i}var l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;vn.context.font=l;var h=this.getTextWidth(this._text.substring(r,t));return(e||new en).setTo(this._startX+h-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},v(0,t,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(t){t!=this._width&&(S.superSet(ya,this,"width",t),this.isChanged=!0)}),v(0,t,"textWidth",function(){return this._isChanged&&S.timer.runCallLater(this,this.typeset),this._textWidth}),v(0,t,"height",function(){return this._height?this._height:this.textHeight},function(t){t!=this._height&&(S.superSet(ya,this,"height",t),this.isChanged=!0)}),v(0,t,"textHeight",function(){return this._isChanged&&S.timer.runCallLater(this,this.typeset),this._textHeight}),v(0,t,"padding",function(){return this._getCSSStyle().padding},function(t){this._getCSSStyle().padding=t,this.isChanged=!0}),v(0,t,"bold",function(){return this._getCSSStyle().bold},function(t){this._getCSSStyle().bold=t,this.isChanged=!0}),v(0,t,"text",function(){return this._text||""},function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event("change"))}),v(0,t,"color",function(){return this._getCSSStyle().color},function(t){this._getCSSStyle().color!=t&&(this._getCSSStyle().color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),v(0,t,"font",function(){return this._getCSSStyle().fontFamily},function(t){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),_._bitmapFonts&&_._bitmapFonts[t]&&(this._currBitmapFont=_._bitmapFonts[t]),this._getCSSStyle().fontFamily=t,this.isChanged=!0}),v(0,t,"fontSize",function(){return this._getCSSStyle().fontSize},function(t){this._getCSSStyle().fontSize=t,this.isChanged=!0}),v(0,t,"italic",function(){return this._getCSSStyle().italic},function(t){this._getCSSStyle().italic=t,this.isChanged=!0}),v(0,t,"align",function(){return this._getCSSStyle().align},function(t){this._getCSSStyle().align=t,this.isChanged=!0}),v(0,t,"valign",function(){return this._getCSSStyle().valign},function(t){this._getCSSStyle().valign=t,this.isChanged=!0}),v(0,t,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(t){this._getCSSStyle().wordWrap=t,this.isChanged=!0}),v(0,t,"leading",function(){return this._getCSSStyle().leading},function(t){this._getCSSStyle().leading=t,this.isChanged=!0}),v(0,t,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(t){this._getCSSStyle().backgroundColor=t,this.isChanged=!0}),v(0,t,"borderColor",function(){return this._getCSSStyle().borderColor},function(t){this._getCSSStyle().borderColor=t,this.isChanged=!0}),v(0,t,"stroke",function(){return this._getCSSStyle().stroke},function(t){this._getCSSStyle().stroke=t,this.isChanged=!0}),v(0,t,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(t){this._getCSSStyle().strokeColor=t,this.isChanged=!0}),v(0,t,"isChanged",null,function(t){this._isChanged!==t&&(this._isChanged=t)&&S.timer.callLater(this,this.typeset)}),v(0,t,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(t){if(!(this.overflow!=_.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=e<t?e:t;var i=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=t,this.renderText(this._lastVisibleLineIndex,i)}}),v(0,t,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(t){if(!(this.overflow!=_.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height,i=(t=e<t?e:t)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=i;var n=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=t,this.renderText(i,n)}}),v(0,t,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),v(0,t,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),v(0,t,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),v(0,t,"underlineColor",function(){return this._underlineColor},function(t){this._underlineColor=t,this._isChanged=!0,this.typeset()}),_.registerBitmapFont=function(t,e){_._bitmapFonts||(_._bitmapFonts={}),_._bitmapFonts[t]=e},_.unregisterBitmapFont=function(t,e){if(void 0===e&&(e=!0),_._bitmapFonts&&_._bitmapFonts[t]){var i=_._bitmapFonts[t];e&&i.destroy(),delete _._bitmapFonts[t]}},_.setTextRightToLeft=function(){var t;(t=vn.canvas.source.style).display="none",t.position="absolute",t.direction="rtl",hn._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,vn.document.body.appendChild(vn.canvas.source)},_.supportFont=function(t){vn.context.font="10px sans-serif";var e=vn.context.measureText("abcji").width;vn.context.font="10px "+t;var i=vn.context.measureText("abcji").width;return console.log(e,i),e!==i},_._testWord="游",_.langPacks=null,_.VISIBLE="visible",_.SCROLL="scroll",_.HIDDEN="hidden",_.CharacterCache=!0,_.RightToLeft=!1,_._bitmapFonts=null,m(_,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),_}(ya),Rs=function(t){function a(t,e,i,n){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===i&&(i=35044),void 0===n&&(n=!1),a.__super.call(this),this._indexType=t,this._indexCount=e,this._bufferUsage=i,this._bufferType=34963,this._canRead=n;var r;if("ushort"==t)this._indexTypeByteCount=2;else{if("ubyte"!=t)throw new Error("unidentification index type.");this._indexTypeByteCount=1}r=this._indexTypeByteCount*e,this._byteLength=r,this._bind(),Ca._gl.bufferData(this._bufferType,r,this._bufferUsage),this.memorySize=n?("ushort"==t?this._buffer=new Uint16Array(e):"ubyte"==t&&(this._buffer=new Uint8Array(e)),2*r):r}E(a,"laya.d3.graphics.IndexBuffer3D",t);var e=a.prototype;return e.setData=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295);var r=0;if("ushort"==this._indexType?(r=2,0===i&&4294967295===n||(t=new Uint16Array(t.buffer,i*r,n))):"ubyte"==this._indexType&&(r=1,0===i&&4294967295===n||(t=new Uint8Array(t.buffer,i*r,n))),this._bind(),Ca._gl.bufferSubData(this._bufferType,e*r,t),this._canRead)if(0!==e||0!==i||4294967295!==n){var a=this._buffer.length-e;a<n&&(n=a);for(var s=0;s<n;s++)this._buffer[e+s]=t[s]}else this._buffer=t},e.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},e.disposeResource=function(){t.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},v(0,e,"indexType",function(){return this._indexType}),v(0,e,"indexTypeByteCount",function(){return this._indexTypeByteCount}),v(0,e,"indexCount",function(){return this._indexCount}),v(0,e,"canRead",function(){return this._canRead}),a.INDEXTYPE_UBYTE="ubyte",a.INDEXTYPE_USHORT="ushort",a.create=function(t,e,i,n){return void 0===i&&(i=35044),void 0===n&&(n=!1),new a(t,e,i,n)},a}(Ca),ws=function(a){function r(t,e,i,n){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===n&&(n=!1),r.__super.call(this),this._vertexDeclaration=t,this._vertexCount=e,this._bufferUsage=i,this._bufferType=34962,this._canRead=n,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*e,this._bind(),Ca._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),n&&(this._buffer=new Float32Array(this._byteLength/4))}E(r,"laya.d3.graphics.VertexBuffer3D",a);var t=r.prototype;return t.bindWithIndexBuffer=function(t){t&&t._bind(),this._bind()},t.setData=function(t,e,i,n){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295),0===i&&4294967295===n||(t=new Float32Array(t.buffer,4*i,n)),this._bind(),Ca._gl.bufferSubData(this._bufferType,4*e,t),this._canRead)if(0!==e||0!==i||4294967295!==n){var r=this._buffer.length-e;r<n&&(n=r);for(var a=0;a<n;a++)this._buffer[e+a]=t[a]}else this._buffer=t},t.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},t.disposeResource=function(){for(var t=mr.mainContext,e=this._vertexDeclaration.getVertexElements(),i=Ca._enableAtributes,n=0,r=e.length;n<r;n++)i[n]===this._glBuffer&&(t.disableVertexAttribArray(n),i[n]=null);a.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},v(0,t,"vertexDeclaration",function(){return this._vertexDeclaration}),v(0,t,"vertexCount",function(){return this._vertexCount}),v(0,t,"canRead",function(){return this._canRead}),r.create=function(t,e,i,n){return void 0===i&&(i=35044),void 0===n&&(n=!1),new r(t,e,i,n)},r}(Ca),Cs=function(n){function p(t){this._hasIndependentBound=!0,p.__super.call(this,t),this._owner.transform.off("worldmatrixneedchanged",this,this._onWorldMatNeedChange),this._cacheAnimationNodeIndex=[],this._cacheAnimationNode=[],this._localBoundingBoxCorners=R(8,null),this._owner.meshFilter.on("meshchanged",this,this._$3__onMeshChanged)}E(p,"laya.d3.core.SkinnedMeshRender",n);var t=p.prototype;return t._getCacheAnimationNodes=function(){var t=this._cacheMesh._boneNames,e=t.length;this._cacheAnimationNode.length=e,this._cacheAnimationNodeIndex.length=e;for(var i=this._cacheAnimator._avatarNodes,n=this._cacheAnimator._avatarNodeMap,r=0;r<e;r++){var a=n[t[r]];this._cacheAnimationNode[r]=a,this._cacheAnimationNodeIndex[r]=i.indexOf(a)}},t._offComputeBoneIndexToMeshEvent=function(t,e){t.loaded?e.loaded||e.off("loaded",this,this._getCacheAnimationNodes):t.off("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},t._computeBoneIndexToMeshWithAsyncAvatar=function(){this._cacheAvatar.loaded?this._computeBoneIndexToMeshWithAsyncMesh():this._cacheAvatar.once("loaded",this,this._computeBoneIndexToMeshWithAsyncMesh)},t._computeBoneIndexToMeshWithAsyncMesh=function(){this._cacheMesh.loaded?this._getCacheAnimationNodes():this._cacheMesh.on("loaded",this,this._getCacheAnimationNodes)},t._$3__onMeshChanged=function(t,e,i){this._cacheMesh=i,e&&!e.loaded&&i.off("loaded",this,this._onMeshLoaded),i.loaded?this._onMeshLoaded(i):i.on("loaded",this,this._onMeshLoaded),this._cacheAvatar&&(e&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,e),i&&this._computeBoneIndexToMeshWithAsyncAvatar())},t._onMeshLoaded=function(t){var e=t.subMeshCount;this._subSkinnedDatas=[],this._subSkinnedDatas.length=e;for(var i=0;i<e;i++)for(var n=this._subSkinnedDatas[i]=[],r=t.getSubMesh(i)._boneIndicesList,a=0,s=r.length;a<s;a++)n[a]=new Float32Array(16*r[a].length)},t._setCacheAnimator=function(t){this._cacheAnimator=t,this._rootBone&&(this._rootIndex=t._avatarNodes.indexOf(t._avatarNodeMap[this._rootBone]))},t._setRootBone=function(t){this._rootBone=t,this._cacheAnimator&&(this._rootIndex=this._cacheAnimator._avatarNodes.indexOf(this._cacheAnimator._avatarNodeMap[t]))},t._setCacheAvatar=function(t){this._cacheAvatar!==t&&(this._cacheMesh?(this._cacheAvatar&&this._offComputeBoneIndexToMeshEvent(this._cacheAvatar,this._cacheMesh),(this._cacheAvatar=t)&&(this._addShaderDefine(Bo.SHADERDEFINE_BONE),this._computeBoneIndexToMeshWithAsyncAvatar())):this._cacheAvatar=t)},t._calculateBoundingBox=function(){if(this._hasIndependentBound){if(this._cacheAnimator){var t=this._owner.transform,e=t.worldMatrix;if(this._cacheAnimator._canCache){var i=this._cacheAnimator._curAvatarNodeDatas;ke.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,i[this._rootIndex],e)}else ke.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheAnimator._avatarNodeMap[this._rootBone].transform.getWorldMatrix(),e);t.worldMatrix=e,null==this._cacheAnimator._avatarNodeMap[this._rootBone]||null==this._localBoundBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(this._localBoundingBoxCorners)}}else n.prototype._calculateBoundingBox.call(this)},t._calculateBoundingSphere=function(){if(this._hasIndependentBound){if(this._cacheAnimator){var t=this._owner.transform,e=t.worldMatrix;if(this._cacheAnimator._canCache){var i=this._cacheAnimator._curAvatarNodeDatas;ke.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,i[this._rootIndex],e)}else ke.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheAnimator._avatarNodeMap[this._rootBone].transform.getWorldMatrix(),e);t.worldMatrix=e,null==this._cacheAnimator._avatarNodeMap[this._rootBone]||null==this.localBoundSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(this.localBoundSphere)}}else n.prototype._calculateBoundingSphere.call(this)},t._updateOctreeNode=function(){var t=this._treeNode;t&&t.updateObject(this)},t._renderUpdate=function(t){var e,i=this._cacheAnimator,n=this._cacheMesh.subMeshCount,r=this._owner.transform;if(i){var a=i._canCache,s=this._cacheAnimator._curAvatarNodeDatas,o=i.owner;if(this._setShaderValueMatrix4x4(0,o._transform.worldMatrix),e=o.getProjectionViewWorldMatrix(t),this._setShaderValueMatrix4x4(1,e),this._cacheMesh&&this._cacheMesh.loaded&&this._cacheAvatar&&this._cacheAvatar.loaded){var l=0,h=0,u=this._cacheMesh._inverseBindPoses,c=this._cacheMesh._skinnedDatas;if(a)for(l=0,h=u.length;l<h;l++)ke._mulMatrixArray(s[this._cacheAnimationNodeIndex[l]],u[l],c,16*l);else for(l=0,h=u.length;l<h;l++)ke._mulMatrixArray(this._cacheAnimationNode[l].transform.getWorldMatrix(),u[l],c,16*l);for(l=0;l<n;l++){for(var d=this._cacheMesh.getSubMesh(l)._boneIndicesList,_=d.length,f=this._subSkinnedDatas[l],m=0;m<_;m++)p._splitAnimationDatas(d[m],c,f[m]);this._renderElements[l]._skinAnimationDatas=f}}}else this._setShaderValueMatrix4x4(0,r.worldMatrix),e=this._owner.getProjectionViewWorldMatrix(t),this._setShaderValueMatrix4x4(1,e);return gr.debugMode&&this._renderRenderableBoundBox(),!0},v(0,t,"localBoundBox",function(){return this._localBoundBox},function(t){(this._localBoundBox=t).getCorners(this._localBoundingBoxCorners)}),v(0,t,"boundingSphere",function(){return this._calculateBoundingSphere(),this._boundingSphere}),v(0,t,"boundingBox",function(){return this._calculateBoundingBox(),this._boundingBox}),v(0,t,"boundingBoxCenter",function(){var t=this.boundingBox;return we.add(t.min,t.max,this._boundingBoxCenter),we.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenter}),p._splitAnimationDatas=function(t,e,i){for(var n=0,r=t.length,a=0;n<r;n++)for(var s=t[n]<<4,o=0;o<16;o++,a++)i[a]=e[s+o]},p}(Aa),Is=function(t){function e(){this.nodeRecInfoLayer=null,this.lineLayer=null,this.txtLayer=null,this.popLayer=null,this.graphicLayer=null,this.cacheViewLayer=null,e.__super.call(this),this.nodeRecInfoLayer=new ya,this.lineLayer=new ya,this.txtLayer=new ya,this.popLayer=new ya,this.graphicLayer=new ya,this.cacheViewLayer=new ya,this.nodeRecInfoLayer.name="nodeRecInfoLayer",this.lineLayer.name="lineLayer",this.txtLayer.name="txtLayer",this.popLayer.name="popLayer",this.graphicLayer.name="graphicLayer",this.cacheViewLayer.name="cacheViewLayer",this.addChild(this.lineLayer),this.addChild(this.cacheViewLayer),this.addChild(this.nodeRecInfoLayer),this.addChild(this.txtLayer),this.addChild(this.popLayer),this.addChild(this.graphicLayer),(e.I=this).zOrder=999,S.stage.on("doubleclick",this,this.setTop)}E(e,"laya.debug.view.nodeInfo.DebugInfoLayer",ya);var i=e.prototype;return i.setTop=function(){oi.setTop(this)},i.isDebugItem=function(t){return oi.isInTree(this,t)},e.init=function(){e.I||(new e,S.stage.addChild(e.I))},e.I=null,e}(),Ms=function(t){function e(){this._stateDic={},this.isWorkState=!1,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.NodeInfoPanel",ya);var i=e.prototype;return i.showDisInfo=function(t){this.recoverNodes(),As.showDisInfos(t),this.showOnly(t),this.isWorkState=!0},i.showOnly=function(t){t&&(this.hideBrothers(t),this.showOnly(t.parent))},i.recoverNodes=function(){var t,e,i;for(t in As.hideAllInfos(),this._stateDic)if(i=(e=this._stateDic[t]).target)try{i.visible=e.visible}catch(t){}this.isWorkState=!1},i.hideOtherChain=function(t){if(t)for(;t;)this.hideBrothers(t),t=t.parent},i.hideChilds=function(t){if(t){var e,i,n,r=0;for(e=(i=t._childs).length,r=0;r<e;r++)(n=i[r])!=As.NodeInfoContainer&&(this.saveNodeInfo(n),n.visible=!1)}},i.hideBrothers=function(t){var e;if(t&&(e=t.parent)){var i,n,r,a=0;for(i=(n=e._childs).length,a=0;a<i;a++)(r=n[a])!=As.NodeInfoContainer&&r!=t&&(this.saveNodeInfo(r),r.visible=!1)}},i.saveNodeInfo=function(t){var e;(pi.idObj(t),this._stateDic.hasOwnProperty(pi.getObjID(t)))||((e={}).target=t,e.visible=t.visible,this._stateDic[pi.getObjID(t)]=e)},i.recoverNodeInfo=function(t){var e;(pi.idObj(t),this._stateDic.hasOwnProperty(pi.getObjID(t)))&&(e=this._stateDic[pi.getObjID(t)],t.visible=e.visible)},e.init=function(){e.I||(e.I=new e,As.init(),Ls.init())},e.I=null,e}(),As=function(t){function l(){this._infoTxt=null,this._tar=null,l.__super.call(this),this._infoTxt=new Es,this._infoTxt.color="#ff0000",this._infoTxt.bgColor="#00ff00",this._infoTxt.fontSize=12}E(l,"laya.debug.view.nodeInfo.NodeInfosItem",ya);var e=l.prototype;return e.removeSelf=function(){return this._infoTxt.removeSelf(),laya.display.Node.prototype.removeSelf.call(this)},e.showToUI=function(){l.NodeInfoContainer.nodeRecInfoLayer.addChild(this),this._infoTxt.removeSelf(),l.NodeInfoContainer.txtLayer.addChild(this._infoTxt),this.findOkPos()},e.randomAPos=function(t){this._infoTxt.x=this.x+S.stage.width*Math.random(),this._infoTxt.y=this.y+t*Math.random()},e.findOkPos=function(){var t=0;t=20,this.randomAPos(t)},e.isPosOk=function(){var t,e,i,n,r=0;if(t=(e=l.NodeInfoContainer.nodeRecInfoLayer._childs).length,(n=this._infoTxt.getBounds()).x<0)return!1;if(n.y<0)return!1;if(n.right>S.stage.width)return!1;for(r=0;r<t;r++)if((i=e[r])!=this._infoTxt&&n.intersects(i.getBounds()))return!1;return!0},e.showInfo=function(t){if(this._tar=t){var e,i,n,r=l._txts.length=0;for(e=l.showValues.length,t.name?l._txts.push($e.getClassName(t)+"("+t.name+")"):l._txts.push($e.getClassName(t)),r=0;r<e;r++)i=l.showValues[r],l._txts.push(i+":"+l.getNodeValue(t,i));this._infoTxt.text=l._txts.join("\n"),this.graphics.clear(),!(n=t._getBoundPointsM(!0))||n.length<1||(n=qi.pListToPointList(n,!0),Li.walkArr(n,t.localToGlobal,t),n=qi.pointListToPlist(n),l._disBoundRec=nn._getWrapRec(n,l._disBoundRec),this.graphics.drawRect(0,0,l._disBoundRec.width,l._disBoundRec.height,null,"#00ffff"),this.pos(l._disBoundRec.x,l._disBoundRec.y))}},e.fresh=function(){this.showInfo(this._tar)},e.clearMe=function(){this._tar=null},e.recover=function(){wn.recover("NodeInfosItem",this)},l.init=function(){l.NodeInfoContainer||(Is.init(),l.NodeInfoContainer=Is.I,S.stage.addChild(l.NodeInfoContainer))},l.getNodeInfoByNode=function(t){pi.idObj(t);var e;return e=pi.getObjID(t),l._nodeInfoDic[e]||(l._nodeInfoDic[e]=new l),l._nodeInfoDic[e]},l.hideAllInfos=function(){var t;for(t in l._nodeInfoDic)l._nodeInfoDic[t].removeSelf();l.clearRelations()},l.showNodeInfo=function(t){var e;(e=l.getNodeInfoByNode(t)).showInfo(t),e.showToUI()},l.showDisInfos=function(t){var e;if(e=t){for(;t;)l.showNodeInfo(t),t=t.parent;oi.setTop(l.NodeInfoContainer),l.apdtTxtInfoPoss(e),l.updateRelations()}},l.apdtTxtInfoPoss=function(t){var e;for(e=[];t;)e.push(t),t=t.parent;var i,n,r,a=0;i=e.length;var s=NaN;s=S.stage.width-150;var o=0;for(o=100,(t=e[0])&&(n=l.getNodeInfoByNode(t))&&(r=n._infoTxt,s=S.stage.width-r.width-10,o=r.height+10),e=e.reverse(),a=0;a<i;a++)t=e[a],(n=l.getNodeInfoByNode(t))&&(r=n._infoTxt).pos(s,o*a)},l.clearRelations=function(){l.NodeInfoContainer.lineLayer.graphics.clear()},l.updateRelations=function(){var t,e,i;for(e in(t=l.NodeInfoContainer.lineLayer.graphics).clear(),l._nodeInfoDic)(i=l._nodeInfoDic[e]).parent&&t.drawLine(i.x,i.y,i._infoTxt.x,i._infoTxt.y,"#0000ff")},l.getNodeValue=function(t,e){var i;switch(l._nodePoint.setTo(0,0),e){case"x":i=t.x+" (g:"+t.localToGlobal(l._nodePoint).x+")";break;case"y":i=t.y+" (g:"+t.localToGlobal(l._nodePoint).y+")";break;default:i=t[e]}return i},l.NodeInfoContainer=null,l._nodeInfoDic={},l._txts=[],m(l,["showValues",function(){return this.showValues=["x","y","scaleX","scaleY","width","height","visible","mouseEnabled"]},"_disBoundRec",function(){return this._disBoundRec=new nn},"_nodePoint",function(){return this._nodePoint=new en}]),l}(),Ds=function(t){function i(){this.txt=null,this._tar=null,this.recColor="#00ff00",i.__super.call(this),this.txt=new Es,this.txt.color="#ff0000",this.txt.bgColor="#00ff00",this.txt.fontSize=12,this.addChild(this.txt)}E(i,"laya.debug.view.nodeInfo.recinfos.NodeRecInfo",ya);var e=i.prototype;return e.setInfo=function(t){this.txt.text=t},e.setTarget=function(t){this._tar=t},e.showInfo=function(t){var e;(this._tar=t)&&(t._$P&&(this.graphics.clear(),!(e=t._getBoundPointsM(!0))||e.length<1||(e=qi.pListToPointList(e,!0),Li.walkArr(e,t.localToGlobal,t),e=qi.pointListToPlist(e),i._disBoundRec=nn._getWrapRec(e,i._disBoundRec),this.graphics.drawRect(0,0,i._disBoundRec.width,i._disBoundRec.height,null,ni.RECACHE_REC_COLOR,2),this.pos(i._disBoundRec.x,i._disBoundRec.y))))},e.fresh=function(){this.showInfo(this._tar)},e.clearMe=function(){this._tar=null},m(i,["_disBoundRec",function(){return this._disBoundRec=new nn}]),i}(),Ls=function(t){function i(){i.__super.call(this),He.base64.preLoad(C.create(this,this.showToolBar)),No.init(),Ei.init(),new lo}E(i,"laya.debug.view.nodeInfo.ToolPanel",ya);var e=i.prototype;return e.showToolBar=function(){zo.I.show()},e.createViews=function(){i.typeClassDic.Find=Ko,i.typeClassDic.Filter=jo,i.typeClassDic.TxtInfo=ol,i.typeClassDic.Tree=tl},e.switchShow=function(t){var e;(e=this.getView(t))&&e.switchShow()},e.getView=function(t){var e;return!(e=i.viewDic[t])&&i.typeClassDic[t]&&(e=i.viewDic[t]=new i.typeClassDic[t]),e},e.showTxtInfo=function(t){nl.I.showTxt(t)},e.showNodeTree=function(t){$l.I.setDis(t),zo.I.switchToTree()},e.showSelectInStage=function(t){$l.I.showSelectInStage(t),zo.I.switchToTree()},e.showSelectItems=function(t){zo.I.swichToSelect(),sl.I.setSelectList(t)},i.init=function(){i.I||(i.I=new i)},i.I=null,i.viewDic={},i.Find="Find",i.Filter="Filter",i.TxtInfo="TxtInfo",i.Tree="Tree",m(i,["typeClassDic",function(){return this.typeClassDic={}}]),i}(),Vs=function(e){function t(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,t.__super.call(this),this._interval=T.animationInterval,this._setUpNoticeType(1)}E(t,"laya.display.AnimationPlayerBase",e);var i=t.prototype;return i.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},i._getFrameByLabel=function(t){var e=0;for(e=0;e<this._count;e++)if(this._labels[e]&&0<=this._labels[e].indexOf(t))return e;return 0},i._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},i._setControlNode=function(t){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=t)&&t!=this&&(t.on("display",this,this._checkResumePlaying),t.on("undisplay",this,this._checkResumePlaying))},i._setDisplay=function(t){e.prototype._setDisplay.call(this,t),this._checkResumePlaying()},i._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},i.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},i.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]||(this._labels[e]=[]),this._labels[e].push(t)},i.removeLabel=function(t){if(t){if(this._labels)for(var e in this._labels)this._removeLabelFromLabelList(this._labels[e],t)}else this._labels=null},i._removeLabelFromLabelList=function(t,e){if(t)for(var i=t.length-1;0<=i;i--)t[i]==e&&t.splice(i,1)},i.gotoAndStop=function(t){this.index="string"==typeof t?this._getFrameByLabel(t):t,this.stop()},i._displayToIndex=function(t){},i.clear=function(){this.stop(),this._labels=null},v(0,i,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._frameRateChanged=!0,this._interval=t,this._isPlaying&&0<t&&this.timerLoop(t,this,this._frameLoop,null,!0,!0))}),v(0,i,"isPlaying",function(){return this._isPlaying}),v(0,i,"index",function(){return this._index},function(t){if(this._index=t,this._displayToIndex(t),this._labels&&this._labels[t])for(var e=this._labels[t],i=0,n=e.length;i<n;i++)this.event("label",e[i])}),v(0,i,"count",function(){return this._count}),t.WRAP_POSITIVE=0,t.WRAP_REVERSE=1,t.WRAP_PINGPONG=2,t}(ya),Ns=function(c){function s(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",s.__super.call(this),this.offset=new en,this._canvasTransform=new tn,this._previousOrientation=vn.window.orientation;var e=this;this.transform=tn.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var t=vn.window,i=this;t.addEventListener("focus",function(){e._isFocused=!0,i.event("focus"),i.event("focuschange")}),t.addEventListener("blur",function(){e._isFocused=!1,i.event("blur"),i.event("focuschange"),i._isInputting()&&(To.inputElement.target.focus=!1)});var n="visibilityState",r="visibilitychange",a=t.document;void 0!==a.hidden?(r="visibilitychange",n="visibilityState"):void 0!==a.mozHidden?(r="mozvisibilitychange",n="mozVisibilityState"):void 0!==a.msHidden?(r="msvisibilitychange",n="msVisibilityState"):void 0!==a.webkitHidden&&(r="webkitvisibilitychange",n="webkitVisibilityState"),t.document.addEventListener(r,function(){"hidden"==vn.document[n]?i._setStageVisible(!1):i._setStageVisible(!0)}),t.document.addEventListener("qbrowserVisibilityChange",function(t){i._setStageVisible(!t.hidden)}),t.addEventListener("resize",function(){var t=vn.window.orientation;null!=t&&t!=e._previousOrientation&&i._isInputting()&&(To.inputElement.target.focus=!1),e._previousOrientation=t,i._isInputting()||i._resetCanvas()}),t.addEventListener("orientationchange",function(t){i._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),vn.onMobile&&this.on("mousedown",this,this._onmouseMove)}E(s,"laya.display.Stage",c);var t=s.prototype;return t._setStageVisible=function(t){this._isVisibility!=t&&(this._isVisibility=t,this._isVisibility||this._isInputting()&&(To.inputElement.target.focus=!1),this.event("visibilitychange"))},t._isInputting=function(){return vn.onMobile&&To.isInputting},t._changeCanvasSize=function(){this.setScreenSize(vn.clientWidth*vn.pixelRatio,vn.clientHeight*vn.pixelRatio)},t._resetCanvas=function(){if(this.screenAdaptationEnabled){var t=hn._mainCanvas;t.source.style;t.size(1,1),S.timer.once(100,this,this._changeCanvasSize)}},t.setScreenSize=function(t,e){var i=!1;if("none"!==this._screenMode&&(i=(t/e<1?"vertical":"horizontal")!==this._screenMode)){var n=e;e=t,t=n}this.canvasRotation=i;var r=hn._mainCanvas,a=r.source.style,s=this._canvasTransform.identity(),o=this._scaleMode,l=t/this.designWidth,h=e/this.designHeight,u=this.designWidth,c=this.designHeight,d=t,_=e,f=vn.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,o){case"noscale":l=h=1,d=this.designWidth,_=this.designHeight;break;case"showall":l=h=Math.min(l,h),u=d=Math.round(this.designWidth*l),c=_=Math.round(this.designHeight*h);break;case"noborder":l=h=Math.max(l,h),d=Math.round(this.designWidth*l),_=Math.round(this.designHeight*h);break;case"full":l=h=1,this._width=u=t,this._height=c=e;break;case"fixedwidth":h=l,this._height=c=Math.round(e/l);break;case"fixedheight":l=h,this._width=u=Math.round(t/h);break;case"fixedauto":t/e<this.designWidth/this.designHeight?(h=l,this._height=c=Math.round(e/l)):(l=h,this._width=u=Math.round(t/h))}this.conchModel&&this.conchModel.size(this._width,this._height),l*=this.scaleX,h*=this.scaleY,1===l&&1===h?this.transform.identity():(this.transform.a=this._formatData(l/(d/u)),this.transform.d=this._formatData(h/(_/c)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),r.size(u,c),M.changeWebGLSize(u,c),s.scale(d/u/f,_/c/f),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(t-d)/f:this.offset.x=.5*(t-d)/f,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(e-_)/f:this.offset.y=.5*(e-_)/f,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),s.translate(this.offset.x,this.offset.y),this.canvasDegree=0,i&&("horizontal"===this._screenMode?(s.rotate(Math.PI/2),s.translate(e/f,0),this.canvasDegree=90):(s.rotate(-Math.PI/2),s.translate(0,t/f),this.canvasDegree=-90)),s.a=this._formatData(s.a),s.d=this._formatData(s.d),s.tx=this._formatData(s.tx),s.ty=this._formatData(s.ty),a.transformOrigin=a.webkitTransformOrigin=a.msTransformOrigin=a.mozTransformOrigin=a.oTransformOrigin="0px 0px 0px",a.transform=a.webkitTransform=a.msTransform=a.mozTransform=a.oTransform="matrix("+s.toString()+")",s.translate(parseInt(a.left)||0,parseInt(a.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},t._formatData=function(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?0<t?1:-1:t},t.getMousePoint=function(){return en.TEMP.setTo(this.mouseX,this.mouseY)},t.repaint=function(){this._repaint=1},t.parentRepaint=function(){},t._loop=function(){return this.render(hn.context,0,0),!0},t._onmouseMove=function(t){this._mouseMoveTime=vn.now()},t.getTimeFromFrameStart=function(){return vn.now()-this._frameStartTime},t.render=function(t,e,i){if("sleep"===this._frameRate&&!hn.isConchApp){var n=vn.now();if(!(1e3<=n-this._frameStartTime))return;this._frameStartTime=n}if(this._renderCount++,hn.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=vn.now();var r="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),a=this._renderCount%2==0;if(Cn.renderSlow=!r,r||a||hn.isConchApp){var s;Cn.loopCount++,Xi.instance.runEvent(),S.timer._update(),M.update3DLoop();var o=0,l=0;if(hn.isConchNode)for(o=0,l=this._scenes.length;o<l;o++)(s=this._scenes[o])&&s._updateSceneConch();else for(o=0,l=this._scenes.length;o<l;o++)(s=this._scenes[o])&&s._updateScene();if(hn.isConchNode){var h=ya.CustomList;for(o=0,l=h.length;o<l;o++){var u=h[o];u.customRender(u.customContext,0,0)}return}}hn.isConchNode||this.renderingEnabled&&(r||!a||hn.isConchWebGL)&&(hn.isWebGL?(t.clear(),c.prototype.render.call(this,t,e,i),Cn._show&&Cn._sp&&Cn._sp.render(t,e,i),M.clear(this._bgColor),M.beginFlush(),t.flush(),M.endFinish(),Ln.instance&&Ln.getInstance().endDispose()):(M.clear(this._bgColor),c.prototype.render.call(this,t,e,i),Cn._show&&Cn._sp&&Cn._sp.render(t,e,i)))}else this._renderCount%5==0&&(Cn.loopCount++,Xi.instance.runEvent(),S.timer._update())},t._requestFullscreen=function(){var t=vn.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},t._fullScreenChanged=function(){S.stage.event("fullscreenchange")},t.exitFullscreen=function(){var t=vn.document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},v(0,t,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),v(0,t,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),v(0,t,"frameRate",function(){return this._frameRate},function(t){if(this._frameRate=t,hn.isConchApp)switch(this._frameRate){case"slow":vn.window.conch&&vn.window.conchConfig.setSlowFrame&&vn.window.conchConfig.setSlowFrame(!0);break;case"fast":vn.window.conch&&vn.window.conchConfig.setSlowFrame&&vn.window.conchConfig.setSlowFrame(!1);break;case"mouse":vn.window.conch&&vn.window.conchConfig.setMouseFrame&&vn.window.conchConfig.setMouseFrame(2e3);break;case"sleep":vn.window.conch&&vn.window.conchConfig.setLimitFPS&&vn.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),v(0,t,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),v(0,t,"width",c.prototype._$get_width,function(t){this.designWidth=t,S.superSet(ya,this,"width",t),S.timer.callLater(this,this._changeCanvasSize)}),v(0,t,"alignH",function(){return this._alignH},function(t){this._alignH=t,S.timer.callLater(this,this._changeCanvasSize)}),v(0,t,"isFocused",function(){return this._isFocused}),v(0,t,"height",c.prototype._$get_height,function(t){this.designHeight=t,S.superSet(ya,this,"height",t),S.timer.callLater(this,this._changeCanvasSize)}),v(0,t,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||tn.create()},c.prototype._$set_transform),v(0,t,"isVisibility",function(){return this._isVisibility}),v(0,t,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),v(0,t,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t,S.timer.callLater(this,this._changeCanvasSize)}),v(0,t,"alignV",function(){return this._alignV},function(t){this._alignV=t,S.timer.callLater(this,this._changeCanvasSize)}),v(0,t,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this.conchModel&&this.conchModel.bgColor(t),hn.isWebGL&&(t?s._wgColor=Tn.create(t)._color:vn.onMiniGame||(s._wgColor=null)),vn.onLimixiu?s._wgColor=Tn.create(t)._color:hn.canvas.style.background=t||"none"}),v(0,t,"mouseX",function(){return Math.round(Xi.instance.mouseX/this.clientScaleX)}),v(0,t,"mouseY",function(){return Math.round(Xi.instance.mouseY/this.clientScaleY)}),v(0,t,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t}),v(0,t,"visible",c.prototype._$get_visible,function(t){this.visible!==t&&(S.superSet(ya,this,"visible",t),hn._mainCanvas.source.style.visibility=t?"visible":"hidden")}),v(0,t,"fullScreenEnabled",null,function(t){var e=vn.document,i=hn.canvas;t?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),e.addEventListener("fullscreenchange",this._fullScreenChanged),e.addEventListener("mozfullscreenchange",this._fullScreenChanged),e.addEventListener("webkitfullscreenchange",this._fullScreenChanged),e.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),e.removeEventListener("fullscreenchange",this._fullScreenChanged),e.removeEventListener("mozfullscreenchange",this._fullScreenChanged),e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),e.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),s.SCALE_NOSCALE="noscale",s.SCALE_EXACTFIT="exactfit",s.SCALE_SHOWALL="showall",s.SCALE_NOBORDER="noborder",s.SCALE_FULL="full",s.SCALE_FIXED_WIDTH="fixedwidth",s.SCALE_FIXED_HEIGHT="fixedheight",s.SCALE_FIXED_AUTO="fixedauto",s.ALIGN_LEFT="left",s.ALIGN_RIGHT="right",s.ALIGN_CENTER="center",s.ALIGN_TOP="top",s.ALIGN_MIDDLE="middle",s.ALIGN_BOTTOM="bottom",s.SCREEN_NONE="none",s.SCREEN_HORIZONTAL="horizontal",s.SCREEN_VERTICAL="vertical",s.FRAME_FAST="fast",s.FRAME_SLOW="slow",s.FRAME_MOUSE="mouse",s.FRAME_SLEEP="sleep",s.FRAME_MOUSE_THREDHOLD=2e3,m(s,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),s}(ya),Ps=function(t){function f(){this.simLodInfo=null,this._src=null,this._buffer=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,f.__super.call(this),this._type=3553}E(f,"laya.d3.resource.DataTexture2D",Va);var e=f.prototype;return e.genDebugMipmaps=function(){var t=[];return t.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),t.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),t.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),t.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),t.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),t.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),t.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),t.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),t.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),t.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),t},e._onTextureLoaded=function(t){},e._createWebGlTexture=function(){if(!this._buffer&&!this._mipmaps)throw"create GLTextur err:no data";var t=mr.mainContext;t.getExtension("EXT_shader_texture_lod");var e=this._source=t.createTexture(),i=this._width,n=this._height,r=pr.curBindTexTarget,a=pr.curBindTexValue;if(pr.bindTexture(t,this._type,e),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var s=0;t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var o=0;o<this._mipmaps.length;o++){if(this._mipmaps[o].byteLength!=l*h*4)throw"mipmap size error  level:"+o;t.texSubImage2D(this._type,0,f.simLodRect[s++],f.simLodRect[s++],f.simLodRect[s++],f.simLodRect[s++],6408,5121,new Uint8Array(this._mipmaps[o]))}this.minFifter=9729,this.magFifter=9729}else{var l=this._width,h=this._height;for(s=0,t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),o=0;o<this._mipmaps.length;o++){if(this._mipmaps[o].byteLength!=l*h*4)throw"mipmap size error  level:"+o;t.texImage2D(this._type,o,6408,l,h,0,6408,5121,new Uint8Array(this._mipmaps[o])),(l/=2)<1&&(l=1),(h/=2)<1&&(h=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else t.texImage2D(this._type,0,6408,i,n,0,6408,5121,new Uint8Array(this._buffer));var u=this._minFifter,c=this._magFifter,d=this._repeat?10497:33071,_=Ki.isPOT(i,n);if(!_)throw"data texture must be POT";this._mipmap||this._mipmaps?-1!==u||(u=9987):-1!==u||(u=9729),-1!==c||(c=9729),t.texParameteri(this._type,10241,u),t.texParameteri(this._type,10240,c),t.texParameteri(this._type,10242,d),this._mipmaps?t.texParameteri(this._type,10243,33071):t.texParameteri(this._type,10243,d),this._mipmap&&t.generateMipmap(this._type),r&&a&&pr.bindTexture(t,r,a),this.src&&0<this.src.length&&(this._buffer=null),this.memorySize=_?i*n*4*(1+1/3):i*n*4,this._recreateLock=!1},e.recreateResource=function(){if(this._buffer||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},e.onAsynLoaded=function(t,e,i){var n;i&&(n=i[0].call(this,e)),n&&(this._width=n.width,this._height=n.height,this._buffer=n.data),this._src=t,this._size=new Ze(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},e.getPixels=function(){return new Uint8Array(this._buffer)},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(mr.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this.memorySize=0)},v(0,e,"src",function(){return this._src}),f.create=function(t,e,i,n,r,a){if(void 0===n&&(n=9729),void 0===r&&(r=9729),void 0===a&&(a=!0),!t||t.byteLength<e*i*4)throw"DataTexture2D create error";var s=new f;return s._buffer=t,s._width=e,s._height=i,s._mipmap=a,s._magFifter=n,s._minFifter=r,s._size=new Ze(s._width,s._height),s._conchTexture?alert("怎么给runtime传递datatexture数据"):s.activeResource(),s},f.load=function(t,e,i,n,r){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=9729),void 0===r&&(r=9729),"mipmaps"===Dn.getFileExtension(t)){var a=S.loader.create(t,null,null,f,[function(t){this._mipmaps=[];var e=new Uint32Array(t);this._width=e[0];var i=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,i=1024),this._width!=i)throw console.error("现在只支持512x256的环境贴图。当前的是"+e[0]),"现在只支持512x256的环境贴图。当前的是"+e[0];this._height=e[1];for(var n=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,r=this._height,a=8;;){var s=n*r*4;if(a+s>t.byteLength)throw"load mipmaps data size error ";var o=new Uint8Array(t,a,s);if(this._mipmaps.push(o),a+=s,1==n&&1==r)break;(n/=2)<1&&(n=1),(r/=2)<1&&(r=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){a.simLodInfo=new Float32Array(40);for(var s=0;s<a.simLodInfo.length;)a.simLodInfo[s]=(f.simLodRect[s]+.5)/1024,s++,a.simLodInfo[s]=(f.simLodRect[s]+.5)/256,s++,a.simLodInfo[s]=Math.max(f.simLodRect[s]-1,.1)/1024,s++,a.simLodInfo[s]=Math.max(f.simLodRect[s]-1.5,.1)/256,s++}return a}if("number"==typeof e)return S.loader.create(t,null,null,f,[function(t){return this._width=e,this._height=i,this._buffer=t,null}]);if("function"==typeof e)return S.loader.create(t,null,null,f,[e]);throw new Error("unknown params.")},f.lodasatlas=!1,m(f,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),f}(),Fs=function(t){function h(t,e,i,n,r,a,s,o,l){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===r&&(r=33189),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=-1),h.__super.call(this),this._type=3553,this._width=t,this._height=e,this._size=new Ze(t,e),this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=r,hn.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=a,this._repeat=s,this._minFifter=o,this._magFifter=l,this.activeResource(),this._alreadyResolved=!0}E(h,"laya.d3.resource.RenderTexture",Va);var e=h.prototype;return e.recreateResource=function(){var t=mr.mainContext;this._frameBuffer=t.createFramebuffer(),this._source=t.createTexture();var e=pr.curBindTexTarget,i=pr.curBindTexValue;pr.bindTexture(t,this._type,this._source),t.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,r=this._magFifter,a=this._repeat?10497:33071;if(Ki.isPOT(this._width,this._height)?(this._mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(this._type,10241,n),t.texParameteri(this._type,10240,r),t.texParameteri(this._type,10242,a),t.texParameteri(this._type,10243,a),this._mipmap&&t.generateMipmap(this._type)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(this._type,10241,n),t.texParameteri(this._type,10240,r),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&pr.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),this.memorySize=this._width*this._height*4,this.completeCreate()},e.start=function(){mr.mainContext.bindFramebuffer(36160,this.frameBuffer),(h._currentRenderTarget=this)._alreadyResolved=!1},e.end=function(){mr.mainContext.bindFramebuffer(36160,null),h._currentRenderTarget=null,this._alreadyResolved=!0},e.getData=function(t,e,i,n){var r=mr.mainContext;if(r.bindFramebuffer(36160,this._frameBuffer),!(36053===r.checkFramebufferStatus(36160)))return r.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._width*this._height*4);return r.readPixels(t,e,i,n,this._surfaceFormat,this._surfaceType,a),r.bindFramebuffer(36160,null),a},e.disposeResource=function(){if(this._frameBuffer){var t=mr.mainContext;t.deleteTexture(this._source),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},v(0,e,"surfaceFormat",function(){return this._surfaceFormat}),v(0,e,"surfaceType",function(){return this._surfaceType}),v(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),v(0,e,"source",function(){return this._alreadyResolved?S.superGet(Va,this,"source"):null}),v(0,e,"depthStencilBuffer",function(){return this._depthStencilBuffer}),v(0,e,"frameBuffer",function(){return this._frameBuffer}),h._currentRenderTarget=null,h}(),Os=function(t){function e(t){this._color=null,this._pixels=null,e.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new Ze(this.width,this.height),this._color=t,this._pixels=new Uint8Array([255*t.x,255*t.y,255*t.z,255*t.w])}E(e,"laya.d3.resource.SolidColorTexture2D",Va);var i=e.prototype;return i._createWebGlTexture=function(){var t=mr.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=pr.curBindTexTarget,a=pr.curBindTexValue;pr.bindTexture(t,this._type,e),t.texImage2D(this._type,0,6408,i,n,0,6408,5121,this._pixels);var s=this._minFifter,o=this._magFifter,l=this._repeat?10497:33071,h=Ki.isPOT(i,n);h?(this._mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),this._mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&pr.bindTexture(t,r,a),this.memorySize=h?i*n*4*(1+1/3):i*n*4},i.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&(mr.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},m(e,["magentaTexture",function(){return this.magentaTexture=new e(new Ce(1,0,1,1))},"grayTexture",function(){return this.grayTexture=new e(new Ce(.5,.5,.5,1))}]),e}(),Bs=function(t){function e(t){this._color=null,this._pixels=null,this._texCount=6,e.__super.call(this),this._type=34067,this._width=1,this._height=1,this._size=new Ze(this.width,this.height),this._color=t,this._pixels=new Uint8Array([255*t.x,255*t.y,255*t.z,255*t.w])}E(e,"laya.d3.resource.SolidColorTextureCube",Va);var i=e.prototype;return i._createWebGlTexture=function(){var t=mr.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=pr.curBindTexTarget,a=pr.curBindTexValue;pr.bindTexture(t,this._type,e),t.texImage2D(34069,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34070,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34071,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34072,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34073,0,6408,i,n,0,6408,5121,this._pixels),t.texImage2D(34074,0,6408,i,n,0,6408,5121,this._pixels);var s=this.minFifter,o=this.magFifter,l=this._repeat?10497:33071,h=Ki.isPOT(i,n);h?(this.mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),this.mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&pr.bindTexture(t,r,a),this.memorySize=h?i*n*4*(1+1/3)*this._texCount:i*n*4*this._texCount},i.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&(mr.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},m(e,["magentaTexture",function(){return this.magentaTexture=new e(new Ce(1,0,1,1))},"grayTexture",function(){return this.grayTexture=new e(new Ce(.5,.5,.5,1))}]),e}(),Gs=function(t){function r(t,e,i,n){this._canRead=!1,this._image=null,this._pixels=null,void 0===t&&(t=!1),void 0===e&&(e=!0),void 0===i&&(i=6408),void 0===n&&(n=!0),r.__super.call(this),this._type=3553,this._repeat=e,this._canRead=t,this._format=i,this._mipmap=n}E(r,"laya.d3.resource.Texture2D",Va);var e=r.prototype;return e._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=mr.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=pr.curBindTexTarget,a=pr.curBindTexValue;switch(pr.bindTexture(t,this._type,e),this._format){case 6407:case 6408:this._canRead?t.texImage2D(this._type,0,this._format,i,n,0,this._format,5121,this._pixels):t.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case mr.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image)}var s=this._minFifter,o=this._magFifter,l=this._repeat?10497:33071,h=0==this._wrapModeU?10497:33071,u=0==this._wrapModeV?10497:33071,c=Ki.isPOT(i,n);c?(this._mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),t.texParameteri(this._type,10242,h),t.texParameteri(this._type,10243,u),this._mipmap&&t.generateMipmap(this._type)):(-1!==s||(s=9729),-1!==o||(o=9729),t.texParameteri(this._type,10241,s),t.texParameteri(this._type,10240,o),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&a&&pr.bindTexture(t,r,a),this._image.onload=null,this._image=null,this.memorySize=c?i*n*4*(1+1/3):i*n*4},e.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},e.onAsynLoaded=function(t,e,i){if(i){var n=i[0];void 0!==n&&(this._canRead=n);var r=i[1];void 0!==r&&(this._repeat=r);var a=i[2];void 0!==a&&(this._format=a);var s=i[3];void 0!==s&&(this._mipmap=s);var o=i.wrapModeU;void 0!==o&&(this._wrapModeU=o);var l=i.wrapModeV;void 0!==l&&(this._wrapModeV=l)}switch(this._format){case 6407:case 6408:var h=(this._image=e).width,u=e.height;this._width=h,this._height=u,this._size=new Ze(h,u),this._canRead&&(hn.isConchApp?e instanceof d.HTMLElement&&(this._pixels=new Uint8Array(e.getImageData(0,0,h,u))):(vn.canvas.size(h,u),vn.canvas.clear(),vn.context.drawImage(e,0,0,h,u),this._pixels=new Uint8Array(vn.context.getImageData(0,0,h,u).data.buffer)));break;case mr.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var c=new yn(e);c.readUTFBytes(4),c.readUTFBytes(2),c.getInt16();c.endian="bigEndian",this._width=c.getInt16(),this._height=c.getInt16(),this._size=new Ze(this._width,this._height);c.getInt16(),c.getInt16();this._image=new Uint8Array(e,c.pos)}this.recreateResource(),this._endLoaded()},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},e.disposeResource=function(){this._source&&(mr.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},v(0,e,"_src",function(){return this.url}),v(0,e,"src",function(){return this.url}),r.load=function(t){return S.loader.create(t,null,null,r)},r}(),Ws=function(t){function e(){e.__super.call(this),this._type=34067}E(e,"laya.d3.resource.TextureCube",Va);var i=e.prototype;return i._onTextureLoaded=function(t){this._images=t;for(var e=2147483647,i=2147483647,n=0;n<6;n++){var r=t[n];e=Math.min(e,r.width),i=Math.min(i,r.height)}this._width=e,this._height=i,this._size=new Ze(e,i)},i._createWebGlTexture=function(){var t=0;for(t=0;t<6;t++)if(!this._images[t])throw"create GLTextur err:no data:"+this._images[t];var e=mr.mainContext,i=this._source=e.createTexture(),n=this._width,r=this._height,a=pr.curBindTexTarget,s=pr.curBindTexValue;pr.bindTexture(e,this._type,i),e.texImage2D(34069,0,6408,6408,5121,this._images[0]),e.texImage2D(34070,0,6408,6408,5121,this._images[1]),e.texImage2D(34071,0,6408,6408,5121,this._images[2]),e.texImage2D(34072,0,6408,6408,5121,this._images[3]),e.texImage2D(34073,0,6408,6408,5121,this._images[4]),e.texImage2D(34074,0,6408,6408,5121,this._images[5]);var o=this.minFifter,l=this.magFifter,h=this._repeat?10497:33071,u=Ki.isPOT(n,r);for(u?(this.mipmap?-1!==o||(o=9987):-1!==o||(o=9729),-1!==l||(l=9729),e.texParameteri(this._type,10241,o),e.texParameteri(this._type,10240,l),e.texParameteri(this._type,10242,h),e.texParameteri(this._type,10243,h),this.mipmap&&e.generateMipmap(this._type)):(-1!==o||(o=9729),-1!==l||(l=9729),e.texParameteri(this._type,10241,o),e.texParameteri(this._type,10240,l),e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071)),a&&s&&pr.bindTexture(e,a,s),t=0;t<6;t++)this._images[t].onload=null,this._images[t]=null;this.memorySize=u?n*r*4*(1+1/3)*6:n*r*4*6},i.recreateResource=function(){null!=this._url&&(this._createWebGlTexture(),this.completeCreate())},i.onAsynLoaded=function(t,e,i){this._onTextureLoaded(e),this.activeResource(),this._endLoaded()},i.disposeResource=function(){this._source&&(mr.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},v(0,i,"defaulteTexture",function(){return Bs.grayTexture}),e.load=function(t){return S.loader.create(t,null,null,e)},e}(),Us=function(t){function h(t,e,i,n,r,a,s,o){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],h.__super.call(this),!t||!e)throw"Shader Error";this._id=++h._count,this._vs=t,this._ps=e,this._attributeMap=i,this._sceneUniformMap=n,this._cameraUniformMap=r,this._spriteUniformMap=a,this._materialUniformMap=s,this._renderElementUniformMap=o,this.recreateResource()}E(h,"laya.d3.shader.Shader3D",Pa);var e=h.prototype;return e.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){mr.mainContext.deleteShader(this._vshader),mr.mainContext.deleteShader(this._pshader),mr.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var t=[this._vs,this._ps],e=mr.mainContext;if(this._program=e.createProgram(),this._vshader=h._createShader(e,t[0],35633),this._pshader=h._createShader(e,t[1],35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader),e.linkProgram(this._program),!hn.isConchApp&&Xr.debugMode&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var i,n=0,r=0,a=0;for(a=hn.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35721):e.getProgramParameter(this._program,35721),n=0;n<a;n++){var s=null;i={vartype:"attribute",ivartype:0,attrib:s=hn.isConchApp?e.getActiveAttribEx(this._vs,this._ps,"",n):e.getActiveAttrib(this._program,n),location:e.getAttribLocation(this._program,s.name),name:s.name,type:s.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(i)}var o=0;for(o=hn.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35718):e.getProgramParameter(this._program,35718),n=0;n<o;n++){var l=null;l=hn.isConchApp?e.getActiveUniformEx(this._vs,this._ps,"",n):e.getActiveUniform(this._program,n),0<(i={vartype:"uniform",ivartype:1,attrib:s,location:e.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._uniformParams.push(i)}for(n=0,r=this._attributeParams.length;n<r;n++)(i=this._attributeParams[n]).indexOfParams=n,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=null!=this._attributeMap[i.codename]?this._attributeMap[i.codename]:i.codename,this._attributeParamsMap.push(i.name),this._attributeParamsMap.push(i),i._this=this,i.uploadedValue=[],i.fun=this._attribute;for(n=0,r=this._uniformParams.length;n<r;n++)switch((i=this._uniformParams[n]).indexOfParams=n,i.index=1,i.value=[i.location,null],i.codename=i.name,null!=this._sceneUniformMap[i.codename]?(i.name=this._sceneUniformMap[i.codename],this._sceneUniformParamsMap.push(i.name),this._sceneUniformParamsMap.push(i)):null!=this._cameraUniformMap[i.codename]?(i.name=this._cameraUniformMap[i.codename],this._cameraUniformParamsMap.push(i.name),this._cameraUniformParamsMap.push(i)):null!=this._spriteUniformMap[i.codename]?(i.name=this._spriteUniformMap[i.codename],this._spriteUniformParamsMap.push(i.name),this._spriteUniformParamsMap.push(i)):null!=this._materialUniformMap[i.codename]?(i.name=this._materialUniformMap[i.codename],this._materialUniformParamsMap.push(i.name),this._materialUniformParamsMap.push(i)):null!=this._renderElementUniformMap[i.codename]?(i.name=this._renderElementUniformMap[i.codename],this._renderElementUniformParamsMap.push(i.name),this._renderElementUniformParamsMap.push(i)):console.log("Shader:can't find uinform name:"+i.codename+" in shader file."),i._this=this,i.uploadedValue=[],i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:i.fun=this._uinformMatrix2fv;break;case 35675:i.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},e._attribute=function(t,e){var i=mr.mainContext,n=Ca._enableAtributes,r=t.location;return n[r]||i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e[0],e[1],e[2],e[3],e[4]),n[r]=Ca._bindVertexBuffer,1},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(mr.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mr.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return mr.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(mr.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mr.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return mr.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(mr.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return mr.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mr.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return mr.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return mr.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return mr.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return mr.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uinformMatrix2fv=function(t,e){return mr.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uinformMatrix3fv=function(t,e){return mr.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(mr.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return mr.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(mr.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return mr.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(mr.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return mr.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mr.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return mr.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=e.source||e.defaulteTexture.source,n=mr.mainContext,r=t.uploadedValue;if(null!=r[0])return n.activeTexture(h._TEXTURES[r[0]]),i&&pr.bindTexture(n,3553,i),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return r[0]=this._curActTexIndex,n.uniform1i(t.location,this._curActTexIndex),n.activeTexture(h._TEXTURES[this._curActTexIndex]),i&&pr.bindTexture(n,3553,i),this._curActTexIndex++,1},e._uniform_samplerCube=function(t,e){var i=e.source||e.defaulteTexture.source,n=mr.mainContext,r=t.uploadedValue;if(null!=r[0])return n.activeTexture(h._TEXTURES[r[0]]),i?pr.bindTexture(n,34067,i):pr.bindTexture(n,34067,Bs.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return r[0]=this._curActTexIndex,n.uniform1i(t.location,this._curActTexIndex),n.activeTexture(h._TEXTURES[this._curActTexIndex]),i?pr.bindTexture(n,34067,i):pr.bindTexture(n,34067,Bs.grayTexture.source),this._curActTexIndex++,1},e._noSetValue=function(t){console.log("no....:"+t.name)},e.bind=function(){return Pa.activeShader=this,(Pa.bindShader=this).activeResource(),pr.UseProgram(this._program)},e.uploadAttributes=function(t,e){for(var i,n,r=0,a=0,s=this._attributeParamsMap.length;a<s;a+=2)n=this._attributeParamsMap[a+1],null!=(i=t[this._attributeParamsMap[a]])&&(e&&e[n.name]&&e[n.name].bind(),r+=n.fun.call(this,n,i));Cn.shaderCall+=r},e.uploadAttributesX=function(t,e){for(var i,n,r=0,a=0,s=this._attributeParamsMap.length;a<s;a+=2)n=this._attributeParamsMap[a+1],null!=(i=t[this._attributeParamsMap[a]])&&(e._bind(),r+=n.fun.call(this,n,i));Cn.shaderCall+=r},e.uploadSceneUniforms=function(t){for(var e,i,n=0,r=0,a=this._sceneUniformParamsMap.length;r<a;r+=2)i=this._sceneUniformParamsMap[r+1],null!=(e=t[this._sceneUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));Cn.shaderCall+=n},e.uploadCameraUniforms=function(t){for(var e,i,n=0,r=0,a=this._cameraUniformParamsMap.length;r<a;r+=2)i=this._cameraUniformParamsMap[r+1],null!=(e=t[this._cameraUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));Cn.shaderCall+=n},e.uploadSpriteUniforms=function(t){for(var e,i,n=0,r=0,a=this._spriteUniformParamsMap.length;r<a;r+=2)i=this._spriteUniformParamsMap[r+1],null!=(e=t[this._spriteUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));Cn.shaderCall+=n},e.uploadMaterialUniforms=function(t){for(var e,i,n=0,r=0,a=this._materialUniformParamsMap.length;r<a;r+=2)i=this._materialUniformParamsMap[r+1],null!=(e=t[this._materialUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));Cn.shaderCall+=n},e.uploadRenderElementUniforms=function(t){for(var e,i,n=0,r=0,a=this._renderElementUniformParamsMap.length;r<a;r+=2)i=this._renderElementUniformParamsMap[r+1],null!=(e=t[this._renderElementUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));Cn.shaderCall+=n},h.create=function(t,e,i,n,r,a,s,o){return new h(t,e,i,n,r,a,s,o)},h.addInclude=function(t,e){Ae.addInclude(t,e)},h._createShader=function(t,e,i){var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),Xr.debugMode&&!t.getShaderParameter(n,35713))throw t.getShaderInfoLog(n);return n},h.PERIOD_RENDERELEMENT=0,h.PERIOD_MATERIAL=1,h.PERIOD_SPRITE=2,h.PERIOD_CAMERA=3,h.PERIOD_SCENE=4,h._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],h._count=0,m(h,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new In}]),h}(),Zs=function(t){function e(){this.lockLayer=null,this.popupEffect=function(t){t.scale(1,1),An.from(t,{x:S.stage.width/2,y:S.stage.height/2,scaleX:0,scaleY:0},300,En.backOut,C.create(this,this.doOpen,[t]))},this.closeEffect=function(t,e){An.to(t,{x:S.stage.width/2,y:S.stage.height/2,scaleX:0,scaleY:0},300,En.strongOut,C.create(this,this.doClose,[t,e]))},e.__super.call(this),this.maskLayer=new ya,this.popupEffectHandler=new C(this,this.popupEffect),this.closeEffectHandler=new C(this,this.closeEffect),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,S.stage.addChild(this),S.stage.on("resize",this,this._onResize),vr.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}E(e,"laya.ui.DialogManager",ya);var i=e.prototype;return i._closeOnSide=function(){var t=this.getChildAt(this.numChildren-1);t instanceof laya.ui.Dialog&&t.close("side")},i.setLockView=function(t){this.lockLayer||(this.lockLayer=new eo,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(S.stage.width,S.stage.height)),this.lockLayer.removeChildren(),t&&(t.centerX=t.centerY=0,this.lockLayer.addChild(t))},i._onResize=function(t){var e=this.maskLayer.width=S.stage.width,i=this.maskLayer.height=S.stage.height;this.lockLayer&&this.lockLayer.size(e,i),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,e,i,vr.popupBgColor),this.maskLayer.alpha=vr.popupBgAlpha;for(var n=this.numChildren-1;-1<n;n--){var r=this.getChildAt(n);r.popupCenter&&this._centerDialog(r)}},i._centerDialog=function(t){t.x=Math.round((S.stage.width-t.width>>1)+t.pivotX),t.y=Math.round((S.stage.height-t.height>>1)+t.pivotY)},i.open=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),e&&this._closeAll(),t.popupCenter&&this._centerDialog(t),this.addChild(t),(t.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),i&&null!=t.popupEffect?t.popupEffect.runWith(t):this.doOpen(t),this.event("open")},i.doOpen=function(t){t.onOpened()},i.lock=function(t){this.lockLayer&&(t?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},i.close=function(t,e,i){void 0===i&&(i=!1),i&&null!=t.closeEffect?t.closeEffect.runWith([t,e]):this.doClose(t,e),this.event("close")},i.doClose=function(t,e){t.removeSelf(),t.isModal&&this._checkMask(),t.closeHandler&&t.closeHandler.runWith(e),t.onClosed(e)},i.closeAll=function(){this._closeAll(),this.event("close")},i._closeAll=function(){for(var t=this.numChildren-1;-1<t;t--){var e=this.getChildAt(t);e&&null!=e.close&&this.doClose(e)}},i.getDialogsByGroup=function(t){for(var e=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===t&&e.push(n)}return e},i.closeByGroup=function(t){for(var e=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===t&&(n.close(),e.push(n))}return e},i._checkMask=function(){this.maskLayer.removeSelf();for(var t=this.numChildren-1;-1<t;t--){var e=this.getChildAt(t);if(e&&e.isModal)return void this.addChildAt(this.maskLayer,t)}},e}(),ks=function(t){function h(t,e,i,n){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,h.__super.call(this),!t||!e)throw"Shader Error";this._id=++h._count,this._vs=t,this._ps=e,this._nameMap=n||{},null!=i&&(h.sharders[i]=this)}E(h,"laya.webgl.shader.Shader",Pa);var e=h.prototype;return e.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){mr.mainContext.deleteShader(this._vshader),mr.mainContext.deleteShader(this._pshader),mr.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t=[this._vs,this._ps],e=mr.mainContext;if(this._program=e.createProgram(),this._vshader=h._createShader(e,t[0],35633),this._pshader=h._createShader(e,t[1],35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader),e.linkProgram(this._program),!hn.isConchApp&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var i,n,r=0,a=0;for(a=hn.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35721):e.getProgramParameter(this._program,35721),r=0;r<a;r++){var s=null;i={vartype:"attribute",glfun:null,ivartype:0,attrib:s=hn.isConchApp?e.getActiveAttribEx(this._vs,this._ps,"",r):e.getActiveAttrib(this._program,r),location:e.getAttribLocation(this._program,s.name),name:s.name,type:s.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(i)}var o=0;for(o=hn.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35718):e.getProgramParameter(this._program,35718),r=0;r<o;r++){var l=null;l=hn.isConchApp?e.getActiveUniformEx(this._vs,this._ps,"",r):e.getActiveUniform(this._program,r),0<(i={vartype:"uniform",glfun:null,ivartype:1,attrib:s,location:e.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._params.push(i)}for(r=0,n=this._params.length;r<n;r++)if((i=this._params[r]).indexOfParams=r,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,(this._paramsMap[i.name]=i)._this=this,i.uploadedValue=[],"attribute"!==i.vartype)switch(i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else i.fun=this._attribute}},e.getUniform=function(t){return this._paramsMap[t]},e._attribute=function(t,e){var i=mr.mainContext,n=Ca._enableAtributes,r=t.location;return n[r]||i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e[0],e[1],e[2],e[3],e[4]+this._offset),n[r]=Ca._bindVertexBuffer,1},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(mr.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mr.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return mr.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(mr.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mr.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return mr.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(mr.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return mr.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mr.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return mr.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return mr.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return mr.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return mr.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(mr.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return mr.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(mr.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return mr.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(mr.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return mr.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mr.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return mr.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=mr.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(h._TEXTURES[this._curActTexIndex]),pr.bindTexture(i,3553,e),this._curActTexIndex++,1):(i.activeTexture(h._TEXTURES[n[0]]),pr.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=mr.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(h._TEXTURES[this._curActTexIndex]),pr.bindTexture(i,34067,e),this._curActTexIndex++,1):(i.activeTexture(h._TEXTURES[n[0]]),pr.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){this.activeResource(),pr.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){Cn.shaderCall++;var e=mr.mainContext;e.activeTexture(33984),pr.bindTexture(e,3553,t)},e.upload=function(t,e){Pa.activeShader=Pa.bindShader=this,this._lastUseFrameCount===Cn.loopCount||this.activeResource(),pr.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;mr.mainContext;for(var i,n,r=e.length,a=0,s=0;s<r;s++)null!==(n=t[(i=e[s]).name])&&(a+=i.fun.call(this,i,n));Cn.shaderCall+=a},e.uploadArray=function(t,e,i){Pa.activeShader=this,(Pa.bindShader=this).activeResource(),pr.UseProgram(this._program);this._params;for(var n,r,a=0,s=e-2;0<=s;s-=2)(r=this._paramsMap[t[s]])&&null!=(n=t[s+1])&&(i&&i[r.name]&&i[r.name].bind(),a+=r.fun.call(this,r,n));Cn.shaderCall+=a},e.getParams=function(){return this._params},h.getShader=function(t){return h.sharders[t]},h.create=function(t,e,i,n){return new h(t,e,i,n)},h.withCompile=function(t,e,i,n){if(i&&h.sharders[i])return h.sharders[i];var r=h._preCompileShader[2e-4*t];if(!r)throw new Error("withCompile shader err!"+t);return r.createShader(e,i,n)},h.withCompile2D=function(t,e,i,n,r){if(n&&h.sharders[n])return h.sharders[n];var a=h._preCompileShader[2e-4*t+e];if(!a)throw new Error("withCompile shader err!"+t+" "+e);return a.createShader(i,n,r)},h.addInclude=function(t,e){Ae.addInclude(t,e)},h.preCompile=function(t,e,i,n){var r=2e-4*t;h._preCompileShader[r]=new Ae(r,e,i,n)},h.preCompile2D=function(t,e,i,n,r){var a=2e-4*t+e;h._preCompileShader[a]=new Ae(a,i,n,r)},h._createShader=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),n},h._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],h._count=0,h._preCompileShader={},h.SHADERNAME2ID=2e-4,h.sharders=((h.sharders=[]).length=32,h.sharders),m(h,["nameKey",function(){return this.nameKey=new In}]),h}(),Hs=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,e.__super.call(this),this.lock=!0}E(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._buffer.byteLength||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),Cn.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ca._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),Ca._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),Cn.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ca._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i){var n=this._buffer.slice(e,i);Ca._gl.bufferSubData(this._bufferType,t,n)}else Ca._gl.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this.memorySize=t,e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this},i.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),n=0;n<e;n++)i[n]=t[n];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,n){void 0===n&&(n=1),this._upload=!0;var r,a;r=i*n,this._resizeBuffer(this._byteLength+r,!0),a=new e(this._buffer,this._byteLength);var s=0;for(s=0;s<i;s++)a[s]=t[s];this._byteLength+=r,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return Ca._gl.bindBuffer(this._bufferType,null),Ca._bindActive[this._bufferType]=null,Pa.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this._bind_subUpload();return Ca._gl.bindBuffer(this._bufferType,null),Ca._bindActive[this._bufferType]=null,Pa.activeShader=null,n},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},v(0,i,"bufferLength",function(){return this._buffer.byteLength}),v(0,i,"byteLength",null,function(t){this._byteLength!==t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._byteLength=t)}),e.__int__=function(t){Io.QuadrangleIB=Io.create(35044),dr.fillIBQuadrangle(Io.QuadrangleIB,16)},e.FLOAT32=4,e.SHORT=2,e}(Ca),Xs=function(t){function e(){this._src=null,this._onload=null,this._onerror=null,e.__super.call(this)}E(e,"laya.resource.FileBitmap",Za);var i=e.prototype;return v(0,i,"src",function(){return this._src},function(t){this._src=t}),v(0,i,"onload",null,function(t){}),v(0,i,"onerror",null,function(t){}),e}(),Ys=function(t){function i(t,e){this._is2D=!1,i.__super.call(this);var n=this;if(this._source=this,"2D"===t||"AUTO"===t&&!hn.isWebGL){this._is2D=!0,this._source=e||vn.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var r=this;r.getContext=function(t,e){if(n._ctx)return n._ctx;var i=n._ctx=n._source.getContext(t,e);return i&&(i._canvas=r,hn.isFlash||vn.onLimixiu||(i.size=function(t,e){})),i}}this.lock=!0}E(i,"laya.resource.HTMLCanvas",Za);var e=i.prototype;return e.clear=function(){this._ctx&&this._ctx.clear()},e.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},e.release=function(){},e._setContext=function(t){this._ctx=t},e.getContext=function(t,e){return this._ctx?this._ctx:this._ctx=i._createContext(this)},e.getMemSize=function(){return 0},e.size=function(t,e){(this._w!=t||this._h!=e||this._source&&(this._source.width!=t||this._source.height!=e))&&(this._w=t,this._h=e,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t))},e.getCanvas=function(){return this._source},e.toBase64=function(t,e,i){if(this._source)if(hn.isConchApp&&this._source.toBase64)this._source.toBase64(t,e,i);else{var n=this._source.toDataURL(t,e);i.call(this,n)}},v(0,e,"context",function(){return this._ctx}),v(0,e,"asBitmap",null,function(t){}),i.create=function(t,e){return new i(t,e)},i.TYPE2D="2D",i.TYPE3D="3D",i.TYPEAUTO="AUTO",i._createContext=null,i}(),zs=function(t){function l(t,e,i,n,r,a,s,o){throw l.__super.call(this),new Error("不允许new！")}return E(l,"laya.resource.HTMLSubImage",Za),l.create=function(t,e,i,n,r,a,s,o){return void 0===o&&(o=!1),new l(t,e,i,n,r,a,s,o)},l}(),js=function(t){function e(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,e.__super.call(this)}E(e,"laya.webgl.atlas.AtlasWebGLCanvas",t);var i=e.prototype;return i.recreateResource=function(){var t=mr.mainContext,e=this._source=t.createTexture(),i=pr.curBindTexTarget,n=pr.curBindTexValue;pr.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&n&&pr.bindTexture(t,i,n),this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._source&&(mr.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i){if(hn.isFlash){this._flashCacheImage||(this._flashCacheImage=Co.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var n=i.bitmapdata;this._flashCacheImage._image.copyPixels(n,0,0,n.width,n.height,t,e),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var r=mr.mainContext,a=pr.curBindTexTarget,s=pr.curBindTexValue;pr.bindTexture(r,3553,this._source),hn.isConchWebGL?(i!==ConchTextCanvas&&(0<=t-1&&r.texSubImage2DEx(!0,3553,0,t-1,e,6408,5121,i),t+1<=this._w&&r.texSubImage2DEx(!0,3553,0,t+1,e,6408,5121,i),0<=e-1&&r.texSubImage2DEx(!0,3553,0,t,e-1,6408,5121,i),e+1<=this._h&&r.texSubImage2DEx(!0,3553,0,t,e+1,6408,5121,i)),r.texSubImage2DEx(!0,3553,0,t,e,6408,5121,i)):(r.pixelStorei(37441,!0),0<=t-1&&r.texSubImage2D(3553,0,t-1,e,6408,5121,i),t+1<=this._w&&r.texSubImage2D(3553,0,t+1,e,6408,5121,i),0<=e-1&&r.texSubImage2D(3553,0,t,e-1,6408,5121,i),e+1<=this._h&&r.texSubImage2D(3553,0,t,e+1,6408,5121,i),r.texSubImage2D(3553,0,t,e,6408,5121,i),r.pixelStorei(37441,!1)),a&&s&&pr.bindTexture(r,a,s)}},i.texSubImage2DPixel=function(t,e,i,n,r){var a=mr.mainContext,s=pr.curBindTexTarget,o=pr.curBindTexValue;pr.bindTexture(a,3553,this._source);var l=new Uint8Array(r.data);hn.isConchWebGL?a.texSubImage2DEx(!0,3553,0,t,e,i,n,6408,5121,l):(a.pixelStorei(37441,!0),a.texSubImage2D(3553,0,t,e,i,n,6408,5121,l),a.pixelStorei(37441,!1)),s&&o&&pr.bindTexture(a,s,o)},v(0,i,"width",t.prototype._$get_width,function(t){this._w=t}),v(0,i,"height",t.prototype._$get_height,function(t){this._h=t}),e}(Za),Js=function(t){function r(){this.flipY=!0,this.alwaysChange=!1,r.__super.call(this)}E(r,"laya.webgl.resource.WebGLCanvas",Za);var e=r.prototype;return e.getCanvas=function(){return this._canvas},e.clear=function(){this._ctx&&this._ctx.clear()},e.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},e._setContext=function(t){this._ctx=t},e.getContext=function(t,e){return this._ctx?this._ctx:this._ctx=r._createContext(this)},e.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},e.activeResource=function(t){void 0===t&&(t=!1),this._source||this.recreateResource()},e.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},e.disposeResource=function(){this._source&&!this.iscpuSource&&(mr.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.createWebGlTexture=function(){var t=mr.mainContext;this._canvas;var e=this._source=t.createTexture();this.iscpuSource=!1;var i=pr.curBindTexTarget,n=pr.curBindTexValue;pr.bindTexture(t,3553,e),t.pixelStorei(37440,this.flipY?1:0),hn.isConchWebGL?t.texImage2DEx(r.premulAlpha,3553,0,6408,6408,5121,this._imgData):(r.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),r.premulAlpha&&t.pixelStorei(37441,!1)),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,i&&n&&pr.bindTexture(t,i,n)},e.reloadCanvasData=function(){var t=mr.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var e=pr.curBindTexTarget,i=pr.curBindTexValue;pr.bindTexture(t,3553,this._source),hn.isConchWebGL?t.texImage2DEx(r.premulAlpha,3553,0,6408,6408,5121,this._imgData):(r.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),r.premulAlpha&&t.pixelStorei(37441,!1)),t.pixelStorei(37440,0),e&&i&&pr.bindTexture(t,e,i)},e.texSubImage2D=function(t,e,i){var n=mr.mainContext,r=pr.curBindTexTarget,a=pr.curBindTexValue;pr.bindTexture(n,3553,this._source),hn.isConchWebGL?n.texSubImage2DEx(!0,3553,0,e,i,6408,5121,t._source):(n.pixelStorei(37441,!0),n.texSubImage2D(3553,0,e,i,6408,5121,t._source),n.pixelStorei(37441,!1)),r&&a&&pr.bindTexture(n,r,a)},e.toBase64=function(t,e,i){var n=null;this._canvas&&(n=this._canvas.toDataURL(t,e)),i.call(this,n)},v(0,e,"context",function(){return this._ctx}),v(0,e,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),v(0,e,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)}),r._createContext=null,r.premulAlpha=!1,r}(),Ks=function(t){function a(t,e){this.CborderSize=12,a.__super.call(this),this.char=t,this.isSpace=" "===t,this.xs=e.scaleX,this.ys=e.scaleY,this.font=e.font.toString(),this.fontSize=e.font.size,this.fillColor=e.fillColor,this.borderColor=e.borderColor,this.lineWidth=e.lineWidth,this.underLine=e.underLine;var i,n=hn.isConchApp;n?((i=ConchTextCanvas)._source=ConchTextCanvas,i._source.canvas=ConchTextCanvas):i=vn.canvas.source,this.canvas=i,this._enableMerageInAtlas=!0,this._ctx=n?i:this.canvas.getContext("2d",void 0);var r=Dn.measureText(this.char,this.font);this.cw=r.width*this.xs,this.ch=(r.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new Hr(this)}E(a,"laya.webgl.resource.WebGLCharImage",Za);var e=a.prototype;return S.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.active=function(){this.texture.active()},e.recreateResource=function(){var t=hn.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),t){var e=this.fontSize;1==this.xs&&1==this.ys||(e=parseInt(e*(this.xs>this.ys?this.xs:this.ys)+""));var i="normal 100 "+this.font;i=i.replace(a._fontSizeReg,e),this.borderColor&&(i+=" 1 "+this.borderColor),this._ctx.font=i,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,Es.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var n=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(n,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},e.onresize=function(t,e){this._w=t,this._h=e,this._allowMerageInAtlas=!0},e.clearAtlasSource=function(){},v(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),v(0,e,"atlasSource",function(){return this.canvas}),v(0,e,"atlasImgData",function(){return!a.canUseCanvas&&this._ctx.getImageData?this._ctx.getImageData(0,0,this._w,this._h):null}),v(0,e,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t}),a.createOneChar=function(t,e){return new a(t,e)},a.canUseCanvas=!0,a._fontSizeReg=new RegExp("\\d+(?=px)","g"),a}(),Qs=function(t){function h(t,e,i,n,r,a,s,o,l){void 0===i&&(i=6408),void 0===n&&(n=5121),void 0===r&&(r=34041),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=-1),void 0===l&&(l=1),h.__super.call(this),this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=n,this._depthStencilFormat=r,hn.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=a,this._repeat=s,this._minFifter=o,this._magFifter=l}E(h,"laya.webgl.resource.WebGLRenderTarget",Za);var e=h.prototype;return e.recreateResource=function(){var t=mr.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture());var e=pr.curBindTexTarget,i=pr.curBindTexValue;pr.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,r=this._magFifter,a=this._repeat?10497:33071,s=Ki.isPOT(this._w,this._h);if(s?(this._mipMap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this._mipMap&&t.generateMipmap(3553)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&pr.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),s&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},e.disposeResource=function(){this._frameBuffer&&(mr.mainContext.deleteTexture(this._source),mr.mainContext.deleteFramebuffer(this._frameBuffer),mr.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},v(0,e,"depthStencilBuffer",function(){return this._depthStencilBuffer}),v(0,e,"frameBuffer",function(){return this._frameBuffer}),h}(),qs=function(t){function o(t,e,i,n,r,a,s){this.offsetX=0,this.offsetY=0,o.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=a,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=n,this._h=r,this.offsetX=e,this.offsetY=i,this.src=s,this._enableMerageInAtlas=!0,Fn.enabled&&this._w<Fn.atlasLimitWidth&&this._h<Fn.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}E(o,"laya.webgl.resource.WebGLSubImage",Za);var e=o.prototype;return S.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},e.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},e.createWebGlTexture=function(){var t=mr.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=pr.curBindTexTarget,n=pr.curBindTexValue;pr.bindTexture(t,3553,e),hn.isConchWebGL?t.texImage2DEx(!0,3553,0,6408,6408,5121,this.canvas):(t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this.canvas),t.pixelStorei(37441,!1));var r=this.minFifter,a=this.magFifter,s=this.repeat?10497:33071,o=Ki.isPOT(this.width,this.height);o?(this.mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10240,a),t.texParameteri(3553,10241,r),t.texParameteri(3553,10242,s),t.texParameteri(3553,10243,s),this.mipmap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&n&&pr.bindTexture(t,i,n),this.canvas=null,o&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},e.disposeResource=function(){Fn.enabled&&this._allowMerageInAtlas||!this._source||(mr.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.clearAtlasSource=function(){},v(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),v(0,e,"atlasSource",function(){return this.canvas}),v(0,e,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t}),o}(),$s=function(t){function e(t){e.__super.call(this,64),this.defines.add(64)}E(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;return i.release=function(){(e.pool[e._length++]=this).clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(Ka),to=function(t){function i(t,e){this.p=null,this.i=null,i.__super.call(this),this.i=e,this.p=t,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}return E(i,"code.NavMesh",es),i.prototype.recreateResource=function(){this._numberVertices=this.p.length/3,this._numberIndices=this.i.length;for(var t=Ht.vertexDeclaration,e=(t.vertexStride,[]),i=0;i<this.p.length;i+=3)e.push(this.p[this.i],this.p[this.i+1],this.p[this.i+2],1,1,1,1,1);var n=new Float32Array(e),r=new Uint16Array(this.i);this._vertexBuffer=new ws(t,this._numberVertices,35044,!0),this._indexBuffer=new Rs("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(r),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},i}(),eo=function(t){function e(){e.__super.call(this)}E(e,"laya.ui.Box",t);var i=e.prototype;return S.imps(i,{"laya.ui.IBox":!0}),v(0,i,"dataSource",t.prototype._$get_dataSource,function(t){for(var e in this._dataSource=t){var i=this.getChildByName(e);i?i.dataSource=t[e]:this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=t[e])}}),e}(ns),io=function(t){function n(t,e,i){this._long=NaN,this._width=NaN,this._height=NaN,void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),n.__super.call(this),this._long=t,this._width=e,this._height=i,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}E(n,"laya.d3.resource.models.BoxMesh",es);var e=n.prototype;return e.recreateResource=function(){this._numberVertices=24,this._numberIndices=36;var t=Ht.vertexDeclaration,e=(t.vertexStride,this._long/2),i=this._height/2,n=this._width/2,r=new Float32Array([-e,i,-n,0,1,0,0,0,e,i,-n,0,1,0,1,0,e,i,n,0,1,0,1,1,-e,i,n,0,1,0,0,1,-e,-i,-n,0,-1,0,0,1,e,-i,-n,0,-1,0,1,1,e,-i,n,0,-1,0,1,0,-e,-i,n,0,-1,0,0,0,-e,i,-n,-1,0,0,0,0,-e,i,n,-1,0,0,1,0,-e,-i,n,-1,0,0,1,1,-e,-i,-n,-1,0,0,0,1,e,i,-n,1,0,0,1,0,e,i,n,1,0,0,0,0,e,-i,n,1,0,0,0,1,e,-i,-n,1,0,0,1,1,-e,i,n,0,0,1,0,0,e,i,n,0,0,1,1,0,e,-i,n,0,0,1,1,1,-e,-i,n,0,0,1,0,1,-e,i,-n,0,0,-1,1,0,e,i,-n,0,0,-1,0,0,e,-i,-n,0,0,-1,0,1,-e,-i,-n,0,0,-1,1,1]),a=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new ws(t,this._numberVertices,35044,!0),this._indexBuffer=new Rs("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(r),this._indexBuffer.setData(a),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},v(0,e,"long",function(){return this._long},function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())}),v(0,e,"width",function(){return this._width},function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())}),v(0,e,"height",function(){return this._height},function(t){this._height!==t&&(this._height=t,this.releaseResource(),this.activeResource())}),n}(),no=function(t){function n(t,e,i){this._radius=NaN,this._slices=0,void(this._stacks=0)===t&&(t=.5),void 0===e&&(e=32),void 0===i&&(i=32),n.__super.call(this),this._radius=t,this._stacks=e,this._slices=i,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}E(n,"laya.d3.resource.models.SphereMesh",es);var e=n.prototype;return e.recreateResource=function(){this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=3*this._stacks*(this._slices+1)*2;for(var t=new Uint16Array(this._numberIndices),e=Ht.vertexDeclaration,i=e.vertexStride/4,n=new Float32Array(this._numberVertices*i),r=Math.PI/this._stacks,a=2*Math.PI/this._slices,s=0,o=0,l=0,h=0;h<this._stacks+1;h++)for(var u=Math.sin(h*r),c=Math.cos(h*r),d=0;d<this._slices+1;d++){var _=u*Math.sin(d*a+1*Math.PI/2),f=u*Math.cos(d*a+1*Math.PI/2);n[o+0]=_*this._radius,n[o+1]=c*this._radius,n[o+2]=f*this._radius,n[o+3]=_,n[o+4]=c,n[o+5]=f,n[o+6]=d/this._slices,n[o+7]=h/this._stacks,o+=i,h!=this._stacks-1&&(t[l++]=s+(this._slices+1),t[l++]=s,t[l++]=s+1,t[l++]=s+this._slices,t[l++]=s,t[l++]=s+(this._slices+1),s++)}this._vertexBuffer=new ws(e,this._numberVertices,35044,!0),this._indexBuffer=new Rs("ushort",this._numberIndices,35044,!0),this._vertexBuffer.setData(n),this._indexBuffer.setData(t),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},v(0,e,"radius",function(){return this._radius},function(t){this._radius!==t&&(this._radius=t,this.releaseResource(),this.activeResource())}),v(0,e,"slices",function(){return this._slices},function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())}),v(0,e,"stacks",function(){return this._stacks},function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this.activeResource())}),n}(),ro=function(e){function i(t,e){i.__super.call(this),void 0===t&&(t=.3),void 0===e&&(e=1e3),this._tempVector3=new we,this._position=new we,this._up=new we,this._forward=new we,this._right=new we,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=Ze.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=t,this._farPlane=e,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),S.stage.on("resize",this,this._onScreenSizeChanged)}E(i,"laya.d3.core.BaseCamera",e);var t=i.prototype;return t._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var t=this.scene._cameraPool,e=t.length-1,i=0;i<e;i++)if(t[i].renderingOrder>t[e].renderingOrder){var n=t[i];t[i]=t[e],t[e]=n}},t._calculateProjectionMatrix=function(){},t._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},t._prepareCameraToRender=function(){V._currentCameraCullingMask=this.cullingMask;var t=this._shaderValues;t.setValue(0,this.transform.position.elements),t.setValue(5,this.forward.elements),t.setValue(6,this.up.elements)},t._prepareCameraViewProject=function(t,e){var i=this._shaderValues;i.setValue(1,t.elements),i.setValue(2,e.elements)},t._renderCamera=function(t,e,i){},t.addLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask|t.mask)},t.removeLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask&~t.mask)},t.addAllLayers=function(){this.cullingMask=2147483647},t.removeAllLayers=function(){this.cullingMask=0|V.getLayerByNumber(29).mask|V.getLayerByNumber(30).mask},t.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},t.moveForward=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=t,this.transform.translate(this._tempVector3)},t.moveRight=function(t){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=t,this.transform.translate(this._tempVector3)},t.moveVertical=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=t,this.transform.translate(this._tempVector3,!1)},t._addSelfRenderObjects=function(){var t=this.scene._cameraPool,e=t.length;if(0<e){for(var i=e-1;0<=i;i--)if(this.renderingOrder<=t[i].renderingOrder){t.splice(i+1,0,this);break}}else t.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},t._clearSelfRenderObjects=function(){var t=this.scene._cameraPool;t.splice(t.indexOf(this),1)},t.destroy=function(t){void 0===t&&(t=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,S.stage.off("resize",this,this._onScreenSizeChanged),e.prototype.destroy.call(this,t)},v(0,t,"sky",function(){return this._sky},function(t){(this._sky=t)._ownerCamera=this}),v(0,t,"forward",function(){var t=this.transform.worldMatrix.elements,e=this._forward.elements;return e[0]=-t[8],e[1]=-t[9],e[2]=-t[10],this._forward}),v(0,t,"position",function(){var t=this.transform.worldMatrix.elements,e=this._position.elements;return e[0]=t[12],e[1]=t[13],e[2]=t[14],this._position}),v(0,t,"renderTarget",function(){return this._renderTarget},function(t){null!=(this._renderTarget=t)&&(this._renderTargetSize=t.size)}),v(0,t,"up",function(){var t=this.transform.worldMatrix.elements,e=this._up.elements;return e[0]=t[4],e[1]=t[5],e[2]=t[6],this._up}),v(0,t,"right",function(){var t=this.transform.worldMatrix.elements,e=this._right.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],this._right}),v(0,t,"renderTargetSize",function(){return this._renderTargetSize},function(t){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=t,this._calculateProjectionMatrix()}),v(0,t,"fieldOfView",function(){return this._fieldOfView},function(t){this._fieldOfView=t,this._calculateProjectionMatrix()}),v(0,t,"nearPlane",function(){return this._nearPlane},function(t){this._nearPlane=t,this._calculateProjectionMatrix()}),v(0,t,"farPlane",function(){return this._farPlane},function(t){this._farPlane=t,this._calculateProjectionMatrix()}),v(0,t,"orthographic",function(){return this._orthographic},function(t){this._orthographic=t,this._calculateProjectionMatrix()}),v(0,t,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(t){this._orthographicVerticalSize=t,this._calculateProjectionMatrix()}),v(0,t,"renderingOrder",function(){return this._renderingOrder},function(t){this._renderingOrder=t,this._sortCamerasByRenderingOrder()}),i.CAMERAPOS=0,i.VIEWMATRIX=1,i.PROJECTMATRIX=2,i.VPMATRIX=3,i.VPMATRIX_NO_TRANSLATE=4,i.CAMERADIRECTION=5,i.CAMERAUP=6,i.ENVIRONMENTDIFFUSE=7,i.ENVIRONMENTSPECULAR=8,i.SIMLODINFO=9,i.DIFFUSEIRRADMATR=10,i.DIFFUSEIRRADMATG=11,i.DIFFUSEIRRADMATB=12,i.HDREXPOSURE=13,i.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",i.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",i.CLEARFLAG_SOLIDCOLOR=0,i.CLEARFLAG_SKY=1,i.CLEARFLAG_DEPTHONLY=2,i.CLEARFLAG_NONE=3,m(i,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new ye(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new ye},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new ye}]),i}(ys),ao=function(i){function e(t){this._render=null,this._geometryFilter=null,e.__super.call(this,t)}E(e,"laya.d3.core.RenderableSprite3D",i);var t=e.prototype;return t._addToInitStaticBatchManager=function(){},t._setBelongScene=function(t){i.prototype._setBelongScene.call(this,t),t._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},t._setUnBelongScene=function(){var t=this._scene._renderableSprite3Ds,e=t.indexOf(this);t.splice(e,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),i.prototype._setUnBelongScene.call(this)},t._update=function(t){(t.owner=this)._activeInHierarchy&&(this._updateComponents(t),this._render._updateOctreeNode(),this._lateUpdateComponents(t),Cn.spriteCount++,this._childs.length&&this._updateChilds(t))},t.destroy=function(t){void 0===t&&(t=!0),i.prototype.destroy.call(this,t),this._render._destroy(),this._render=null},e.__init__=function(){e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=e.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),e.SAHDERDEFINE_LIGHTMAP=e.shaderDefines.registerDefine("LIGHTMAP")},e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,e.SAHDERDEFINE_LIGHTMAP=4,e.LIGHTMAPSCALEOFFSET=2,e.LIGHTMAP=3,m(e,["shaderDefines",function(){return this.shaderDefines=new De}]),e}(ys),so=function(t){function e(){this._intensityColor=null,this._intensity=NaN,this._shadow=!1,this._shadowFarPlane=0,this._shadowMapSize=0,this._shadowMapCount=0,this._shadowMapPCFType=0,this._parallelSplitShadowMap=null,this._lightmapBakedType=0,this.color=null,e.__super.call(this),this._intensity=1,this._intensityColor=new we,this.color=new we(1,1,1),this._shadow=!1,this._shadowFarPlane=8,this._shadowMapSize=512,this._shadowMapCount=1,this._shadowMapPCFType=0,this._lightmapBakedType=e.LIGHTMAPBAKEDTYPE_REALTIME}E(e,"laya.d3.core.light.LightSprite",ys);var i=e.prototype;return i._parseCustomProps=function(t,e,i,n){var r=i.color,a=this.color.elements;a[0]=r[0],a[1]=r[1],a[2]=r[2]},i._addSelfRenderObjects=function(){this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._addLight(this)},i._clearSelfRenderObjects=function(){this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._removeLight(this)},i._prepareToScene=function(t){return!1},v(0,i,"lightmapBakedType",function(){return this._lightmapBakedType},function(t){this._lightmapBakedType!==t&&(this._lightmapBakedType=t,this._activeInHierarchy&&(t!==e.LIGHTMAPBAKEDTYPE_BAKED?this._scene._addLight(this):this._scene._removeLight(this)))}),v(0,i,"shadowPCFType",function(){return this._shadowMapPCFType},function(t){this._shadowMapPCFType=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setPCFType(t)}),v(0,i,"intensity",function(){return this._intensity},function(t){this._intensity=t}),v(0,i,"shadow",function(){return this._shadow},function(t){throw new Error("LightSprite: must override it.")}),v(0,i,"shadowDistance",function(){return this._shadowFarPlane},function(t){this._shadowFarPlane=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setFarDistance(t)}),v(0,i,"shadowPSSMCount",function(){return this._shadowMapCount},function(t){this._shadowMapCount=t,this._parallelSplitShadowMap&&(this._parallelSplitShadowMap.PSSMNum=t)}),v(0,i,"shadowResolution",function(){return this._shadowMapSize},function(t){this._shadowMapSize=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setShadowMapTextureSize(t)}),v(0,i,"diffuseColor",function(){return console.log("LightSprite: discard property,please use color property instead."),this.color},function(t){console.log("LightSprite: discard property,please use color property instead."),this.color=t}),e.LIGHTMAPBAKEDTYPE_REALTIME=0,e.LIGHTMAPBAKEDTYPE_MIXED=1,e.LIGHTMAPBAKEDTYPE_BAKED=2,e}(),oo=function(e){function i(t){this.type=0,this.preX=NaN,this.preY=NaN,i.__super.call(this)}E(i,"laya.debug.tools.resizer.AutoFillRec",e);var t=i.prototype;return t.changeSize=function(){e.prototype.changeSize.call(this);var t=this.graphics;t.clear(),t.drawRect(0,0,this.width,this.height,"#33c5f5")},t.record=function(){this.preX=this.x,this.preY=this.y},t.getDx=function(){return this.x-this.preX},t.getDy=function(){return this.y-this.preY},i}(ns),lo=function(t){function i(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,i.__super.call(this),this._tipBox=new ns,this._tipBox.addChild(this._tipText=new Es),this._tipText.x=this._tipText.y=5,this._tipText.color=i.tipTextColor,this._defaultTipHandler=this.showDefaultTip,S.stage.on("showtip",this,this.onStageShowTip),S.stage.on("hidetip",this,this.onStageHideTip)}E(i,"laya.debug.tools.TipManagerForDebug",ns);var e=i.prototype;return e.onStageHideTip=function(t){S.timer.clear(this,this.showTip),this.closeAll(),this.removeSelf()},e.onStageShowTip=function(t){S.timer.once(i.tipDelay,this,this.showTip,[t],!0)},e.showTip=function(t){if("string"==typeof t){var e=String(t);Boolean(e)&&this._defaultTipHandler(e)}else t instanceof laya.utils.Handler?t.run():"function"==typeof t&&t.apply();S.stage.on("mousemove",this,this.onStageMouseMove),S.stage.on("mousedown",this,this.onStageMouseDown),this.onStageMouseMove(null)},e.onStageMouseDown=function(t){this.closeAll()},e.onStageMouseMove=function(t){this.showToStage(this,i.offsetX,i.offsetY)},e.showToStage=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.getBounds();t.x=S.stage.mouseX+e,t.y=S.stage.mouseY+i,t.x+n.width>S.stage.width&&(t.x-=n.width+e),t.y+n.height>S.stage.height&&(t.y-=n.height+i)},e.closeAll=function(){S.timer.clear(this,this.showTip),S.stage.off("mousemove",this,this.onStageMouseMove),S.stage.off("mousedown",this,this.onStageMouseDown),this.removeChildren()},e.showDisTip=function(t){this.addChild(t),this.showToStage(this),S.stage.addChild(this)},e.showDefaultTip=function(t){this._tipText.text=t;var e=this._tipBox.graphics;e.clear(),e.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,i.tipBackColor),this.addChild(this._tipBox),this.showToStage(this),S.stage.addChild(this)},v(0,e,"defaultTipHandler",function(){return this._defaultTipHandler},function(t){this._defaultTipHandler=t}),i.offsetX=10,i.offsetY=15,i.tipTextColor="#ffffff",i.tipBackColor="#111111",i.tipDelay=200,i}(),ho=function(e){function i(t,e){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,i.__super.call(this),this._labelColors=pn.buttonLabelColors,this._stateNum=pn.buttonStateNum,void 0===e&&(e=""),this.skin=t,this.label=e}E(i,"laya.ui.Button",e);var t=i.prototype;return S.imps(t,{"laya.ui.ISelect":!0}),t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(t),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},t.createChildren=function(){this.graphics=this._bitmap=new Yr},t.createText=function(){this._text||(this._text=new Es,this._text.overflow=Es.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},t.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},t.onMouse=function(t){if(!1!==this.toggle||!this._selected)return"click"===t.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=i.stateMap[t.type]))},t.changeClips=function(){var t=kr.getRes(this._skin);if(t){var e=t.sourceWidth,i=t.sourceHeight/this._stateNum;t.$_GID||(t.$_GID=Dn.getGID());var n=t.$_GID+"-"+this._stateNum,r=Vn.I.get(n);if(Dn.isOkTextureList(r)||(r=null),r)this._sources=r;else{if(this._sources=[],1===this._stateNum)this._sources.push(t);else for(var a=0;a<this._stateNum;a++)this._sources.push(Hr.createFromTexture(t,0,i*a,e,i));Vn.I.set(n,this._sources)}this._autoSize?(this._bitmap.width=this._width||e,this._bitmap.height=this._height||i,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=e)}else console.log("lose skin",this._skin)},t.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]),this.label&&(this._text.color=this._labelColors[t],this._strokeColors&&(this._text.strokeColor=this._strokeColors[t]))},t._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},v(0,t,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(t){this.createText(),this._text.strokeColor=t}),v(0,t,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),v(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.callLater(this.changeClips),this._setStateChanged())}),v(0,t,"state",function(){return this._state},function(t){this._state!=t&&(this._state=t,this._setStateChanged())}),v(0,t,"text",function(){return this.createText(),this._text}),v(0,t,"stateNum",function(){return this._stateNum},function(t){"string"==typeof t&&(t=parseInt(t)),this._stateNum!=t&&(this._stateNum=t<1?1:3<t?3:t,this.callLater(this.changeClips))}),v(0,t,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(t){this._strokeColors=gn.fillArray(pn.buttonLabelColors,t,String),this._setStateChanged()}),v(0,t,"labelColors",function(){return this._labelColors.join(",")},function(t){this._labelColors=gn.fillArray(pn.buttonLabelColors,t,String),this._setStateChanged()}),v(0,t,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),v(0,t,"label",function(){return this._text?this._text.text:null},function(t){(this._text||t)&&(this.createText(),this._text.text!=t&&(t&&!this._text.parent&&this.addChild(this._text),this._text.text=(t+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),v(0,t,"selected",function(){return this._selected},function(t){this._selected!=t&&(this._selected=t,this.state=this._selected?2:0,this.event("change"))}),v(0,t,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(t){this.createText(),this._text.padding=gn.fillArray(pn.labelPadding,t,Number)}),v(0,t,"labelSize",function(){return this.createText(),this._text.fontSize},function(t){this.createText(),this._text.fontSize=t}),v(0,t,"labelStroke",function(){return this.createText(),this._text.stroke},function(t){this.createText(),this._text.stroke=t}),v(0,t,"labelBold",function(){return this.createText(),this._text.bold},function(t){this.createText(),this._text.bold=t}),v(0,t,"labelFont",function(){return this.createText(),this._text.font},function(t){this.createText(),this._text.font=t}),v(0,t,"labelAlign",function(){return this.createText(),this._text.align},function(t){this.createText(),this._text.align=t}),v(0,t,"clickHandler",function(){return this._clickHandler},function(t){this._clickHandler=t}),v(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=gn.fillArray(pn.defaultSizeGrid,t,Number)}),v(0,t,"width",e.prototype._$get_width,function(t){S.superSet(ns,this,"width",t),this._autoSize&&(this._bitmap.width=t,this._text&&(this._text.width=t))}),v(0,t,"height",e.prototype._$get_height,function(t){S.superSet(ns,this,"height",t),this._autoSize&&(this._bitmap.height=t,this._text&&(this._text.height=t))}),v(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.label=t+"":S.superSet(ns,this,"dataSource",t)}),v(0,t,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(t){this._bitmap._offset=t?gn.fillArray([1,1],t,Number):[]}),m(i,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),i}(ns),uo=function(t){function e(){this.minHandler=null,this.maxHandler=null,this.isFirstShow=!0,this.dis=null,e.__super.call(this),(this.dis=this).minHandler=new C(this,this.close),this.maxHandler=new C(this,this.show),this.createPanel(),this.dis&&(this.dis.on("mousedown",this,this.bringToTop),this.dis.cacheAsBitmap=!0)}E(e,"laya.debug.view.nodeInfo.views.UIViewBase",ns);var i=e.prototype;return i.show=function(){Is.I.setTop(),Is.I.popLayer.addChild(this.dis),this.isFirstShow&&(this.firstShowFun(),this.isFirstShow=!1)},i.firstShowFun=function(){this.dis.x=.5*(S.stage.width-this.dis.width),this.dis.y=.5*(S.stage.height-this.dis.height),oi.intFyDisPos(this.dis)},i.bringToTop=function(){oi.setTop(this.dis)},i.switchShow=function(){this.dis.parent?this.close():this.show()},i.close=function(){this.dis.removeSelf()},i.createPanel=function(){},i.getInput=function(){var t;return(t=new ll).size(200,30),t.fontSize=30,t},i.getButton=function(){var t;return(t=new bo).size(40,30),t.fontSize=30,t},e}(),co=function(t){function h(t){this._terrainRes=null,this._lightmapScaleOffset=null,h.__super.call(this),this._lightmapScaleOffset=new Ce(1,1,0,0),t&&((this._terrainRes=t).loaded?this.buildTerrain(t):t.once("loaded",this,this.buildTerrain))}E(h,"laya.d3.terrain.Terrain",ys);var e=h.prototype;return e._parseCustomProps=function(t,e,i,n){this.terrainRes=kr.getRes(e[i.dataPath]);var r=i.lightmapIndex;null!=r&&this.setLightmapIndex(r);var a=i.lightmapScaleOffset;a&&this.setLightmapScaleOffset(new Ce(a[0],a[1],a[2],a[3]))},e.setLightmapIndex=function(t){for(var e=0;e<this._childs.length;e++){this._childs[e].terrainRender.lightmapIndex=t}},e.setLightmapScaleOffset=function(t){if(t){t.cloneTo(this._lightmapScaleOffset);for(var e=0;e<this._childs.length;e++){this._childs[e].terrainRender.lightmapScaleOffset=this._lightmapScaleOffset}}},e.disableLight=function(){for(var t=0,e=this._childs.length;t<e;t++)for(var i=this._childs[t],n=0,r=i._render.sharedMaterials.length;n<r;n++){i._render.sharedMaterials[n].disableLight()}},e.buildTerrain=function(t){for(var e=t._chunkNumX,i=t._chunkNumZ,n=t._heightData,r=0,a=0;a<i;a++)for(var s=0;s<e;s++){for(var o=new Wo(s,a,t._gridSize,n._terrainHeightData,n._width,n._height,t._cameraCoordinateInverse),l=t._chunkInfos[r++],h=0;h<l.alphaMap.length;h++){var u=l.detailID[h].length,c=0<u?t._detailTextureInfos[l.detailID[h][0]].diffuseTexture:null,d=1<u?t._detailTextureInfos[l.detailID[h][1]].diffuseTexture:null,_=2<u?t._detailTextureInfos[l.detailID[h][2]].diffuseTexture:null,f=3<u?t._detailTextureInfos[l.detailID[h][3]].diffuseTexture:null,m=0<u?t._detailTextureInfos[l.detailID[h][0]].scale:null,p=1<u?t._detailTextureInfos[l.detailID[h][1]].scale:null,g=2<u?t._detailTextureInfos[l.detailID[h][2]].scale:null,v=3<u?t._detailTextureInfos[l.detailID[h][3]].scale:null;o.buildRenderElementAndMaterial(u,l.normalMap,l.alphaMap[h],c,d,_,f,t._materialInfo.ambientColor,t._materialInfo.diffuseColor,t._materialInfo.specularColor,m?m.x:1,m?m.y:1,p?p.x:1,p?p.y:1,g?g.x:1,g?g.y:1,v?v.x:1,v?v.y:1)}o.terrainRender.receiveShadow=!0,o.terrainRender.lightmapScaleOffset=this._lightmapScaleOffset,this.addChild(o)}},e.width=function(){return this._terrainRes._chunkNumX*Pe.CHUNK_GRID_NUM*this._terrainRes._gridSize},e.depth=function(){return this._terrainRes._chunkNumZ*Pe.CHUNK_GRID_NUM*this._terrainRes._gridSize},e.getHeightXZ=function(t,e){if(!this._terrainRes||!this._terrainRes.loaded)return NaN;if(t-=this.transform.position.x,e-=this.transform.position.z,h.__VECTOR3__||(h.__VECTOR3__=new we),h.__VECTOR3__.elements[0]=t,h.__VECTOR3__.elements[1]=0,h.__VECTOR3__.elements[2]=e,we.transformV3ToV3(h.__VECTOR3__,Pe.__ADAPT_MATRIX_INV__,h.__VECTOR3__),t=h.__VECTOR3__.elements[0],e=h.__VECTOR3__.elements[2],t<0||t>this.width()||e<0||e>this.depth())return NaN;var i=this._terrainRes._gridSize,n=parseInt(""+t/i),r=parseInt(""+e/i),a=t-n*i,s=e-r*i,o=NaN,l=this._terrainRes._heightData;return i<a+s?(o=l._terrainHeightData[(r+1-1)*l._width+n+1])+(l._terrainHeightData[(r+1-1)*l._width+n]-o)*((i-a)/i)+(l._terrainHeightData[(r-1)*l._width+n+1]-o)*((i-s)/i):(o=l._terrainHeightData[Math.max(0,r-1)*l._width+n])+(l._terrainHeightData[Math.min(l._width*l._height-1,(r+1-1)*l._width+n)]-o)*(s/i)+(l._terrainHeightData[Math.min(l._width*l._height-1,Math.max(0,r-1)*l._width+n+1)]-o)*(a/i)},v(0,e,"terrainRes",null,function(t){t&&((this._terrainRes=t).loaded?this.buildTerrain(t):t.once("loaded",this,this.buildTerrain))}),h.load=function(t){return S.loader.create(t,null,null,h,null,1,!1)},h.RENDER_LINE_MODEL=!1,h.LOD_TOLERANCE_VALUE=4,h.LOD_DISTANCE_FACTOR=2,h.__VECTOR3__=null,h}(),_o=function(e){function i(t){this._bitmap=null,this._skin=null,this._group=null,i.__super.call(this),this.skin=t}E(i,"laya.ui.Image",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null},t.dispose=function(){this.destroy(!0),S.loader.clearRes(this._skin)},t.createChildren=function(){this.graphics=this._bitmap=new Yr,this._bitmap.autoCacheCmd=!1},t.setSource=function(t,e){t===this._skin&&e&&(this.source=e,this.onCompResize())},v(0,t,"source",function(){return this._bitmap.source},function(t){this._bitmap&&(this._bitmap.source=t,this.event("loaded"),this.repaint())}),v(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"string"==typeof(this._dataSource=t)?this.skin=t:S.superSet(ns,this,"dataSource",t)}),v(0,t,"measureHeight",function(){return this._bitmap.height}),v(0,t,"skin",function(){return this._skin},function(t){if(this._skin!=t)if(this._skin=t){var e=kr.getRes(t);e?(this.source=e,this.onCompResize()):S.loader.load(this._skin,C.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),v(0,t,"group",function(){return this._group},function(t){t&&this._skin&&kr.setGroup(this._skin,t),this._group=t}),v(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=gn.fillArray(pn.defaultSizeGrid,t,Number)}),v(0,t,"measureWidth",function(){return this._bitmap.width}),v(0,t,"width",e.prototype._$get_width,function(t){S.superSet(ns,this,"width",t),this._bitmap.width=0==t?1e-7:t}),v(0,t,"height",e.prototype._$get_height,function(t){S.superSet(ns,this,"height",t),this._bitmap.height=0==t?1e-7:t}),i}(ns),fo=function(e){function n(t,e,i){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,n.__super.call(this),void 0===e&&(e=1),void 0===i&&(i=1),this._clipX=e,this._clipY=i,this.skin=t}E(n,"laya.ui.Clip",e);var t=n.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},t.dispose=function(){this.destroy(!0),S.loader.clearRes(this._skin)},t.createChildren=function(){this.graphics=this._bitmap=new Yr},t._onDisplay=function(t){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},t.changeClip=function(){if(this._clipChanged=!1,this._skin){var t=kr.getRes(this._skin);t?this.loadComplete(this._skin,t):S.loader.load(this._skin,C.create(this,this.loadComplete,[this._skin]))}},t.loadComplete=function(t,e){if(t===this._skin&&e){var i=this._clipWidth||Math.ceil(e.sourceWidth/this._clipX),n=this._clipHeight||Math.ceil(e.sourceHeight/this._clipY),r=this._skin+i+n,a=Vn.I.get(r);if(Dn.isOkTextureList(a)||(a=null),a)this._sources=a;else{this._sources=[];for(var s=0;s<this._clipY;s++)for(var o=0;o<this._clipX;o++)this._sources.push(Hr.createFromTexture(e,i*o,n*s,i,n));Vn.I.set(r,this._sources)}this.index=this._index,this.event("loaded"),this.onCompResize()}},t.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),this._isPlaying=!0,this.index=t,this._toIndex=e,this._index++,S.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},t._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},t.stop=function(){this._isPlaying=!1,S.timer.clear(this,this._loop),this.event("complete")},t._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},v(0,t,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._interval=t,this._isPlaying&&this.play())}),v(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&((this._skin=t)?this._setClipChanged():this._bitmap.source=null)}),v(0,t,"sources",function(){return this._sources},function(t){this._sources=t,this.index=this._index,this.event("loaded")}),v(0,t,"clipX",function(){return this._clipX},function(t){this._clipX=t||1,this._setClipChanged()}),v(0,t,"clipY",function(){return this._clipY},function(t){this._clipY=t||1,this._setClipChanged()}),v(0,t,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),v(0,t,"clipWidth",function(){return this._clipWidth},function(t){this._clipWidth=t,this._setClipChanged()}),v(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=gn.fillArray(pn.defaultSizeGrid,t,Number)}),v(0,t,"group",function(){return this._group},function(t){t&&this._skin&&kr.setGroup(this._skin,t),this._group=t}),v(0,t,"clipHeight",function(){return this._clipHeight},function(t){this._clipHeight=t,this._setClipChanged()}),v(0,t,"width",e.prototype._$get_width,function(t){S.superSet(ns,this,"width",t),this._bitmap.width=t}),v(0,t,"height",e.prototype._$get_height,function(t){S.superSet(ns,this,"height",t),this._bitmap.height=t}),v(0,t,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),v(0,t,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),v(0,t,"index",function(){return this._index},function(t){this._index=t,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]),this.event("change")}),v(0,t,"autoPlay",function(){return this._autoPlay},function(t){this._autoPlay!=t&&((this._autoPlay=t)?this.play():this.stop())}),v(0,t,"isPlaying",function(){return this._isPlaying},function(t){this._isPlaying=t}),v(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.index=parseInt(t):S.superSet(ns,this,"dataSource",t)}),v(0,t,"bitmap",function(){return this._bitmap}),n}(ns),mo=function(e){function t(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,t.__super.call(this)}E(t,"laya.ui.ColorPicker",e);var i=t.prototype;return i.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._colorPanel&&this._colorPanel.destroy(t),this._colorButton&&this._colorButton.destroy(t),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},i.createChildren=function(){this.addChild(this._colorButton=new ho),this._colorPanel=new eo,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new ya),this._colorPanel.addChild(this._colorBlock=new ya),this._colorPanel.addChild(this._colorInput=new To)},i.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},i.onPanelMouseDown=function(t){t.stopPropagation()},i.changePanel=function(){this._panelChanged=!1;var t=this._colorPanel.graphics;t.clear(),t.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(t=this._colorTiles.graphics).clear();for(var e=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],i=0;i<12;i++)for(var n=0;n<20;n++){var r=0;r=0===n?e[i]:1===n?0:51*(((3*i+n/6)%3<<0)+3*(i/6<<0))<<16|n%6*51<<8|(i<<0)%6*51;var a=gn.toColor(r);this._colors.push(a);var s=n*this._gridSize,o=i*this._gridSize;t.drawRect(s,o,this._gridSize,this._gridSize,a,"#000000")}},i.onColorButtonClick=function(t){this._colorPanel.parent?this.close():this.open()},i.open=function(){var t=this.localToGlobal(new en),e=t.x+this._colorPanel.width<=S.stage.width?t.x:S.stage.width-this._colorPanel.width,i=t.y+this._colorButton.height;i=i+this._colorPanel.height<=S.stage.height?i:t.y-this._colorPanel.height,this._colorPanel.pos(e,i),this._colorPanel.zOrder=1001,S._currentStage.addChild(this._colorPanel),S.stage.on("mousedown",this,this.removeColorBox)},i.close=function(){S.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},i.removeColorBox=function(t){this.close()},i.onColorFieldKeyDown=function(t){13==t.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),t.stopPropagation())},i.onColorInputChange=function(t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},i.onColorTilesClick=function(t){this.selectedColor=this.getColorByMouse(),this.close()},i.onColorTilesMouseMove=function(t){this._colorInput.focus=!1;var e=this.getColorByMouse();this._colorInput.text=e,this.drawBlock(e)},i.getColorByMouse=function(){var t=this._colorTiles.getMousePoint(),e=Math.floor(t.x/this._gridSize),i=Math.floor(t.y/this._gridSize);return this._colors[20*i+e]},i.drawBlock=function(t){var e=this._colorBlock.graphics;e.clear();var i=t||"#ffffff";e.drawRect(0,0,50,20,i,this._borderColor),t||e.drawLine(0,0,50,20,"#ff0000")},i.changeColor=function(){var t=this.graphics;t.clear();var e=this._selectedColor||"#000000";t.drawRect(0,0,this._colorButton.width,this._colorButton.height,e)},i._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},v(0,i,"inputBgColor",function(){return this._inputBgColor},function(t){this._inputBgColor=t,this._setPanelChanged()}),v(0,i,"selectedColor",function(){return this._selectedColor},function(t){this._selectedColor!=t&&(this._selectedColor=this._colorInput.text=t,this.drawBlock(t),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",ki.EMPTY.setTo("change",this,this)))}),v(0,i,"skin",function(){return this._colorButton.skin},function(t){this._colorButton.skin=t,this.changeColor()}),v(0,i,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this._setPanelChanged()}),v(0,i,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t,this._setPanelChanged()}),v(0,i,"inputColor",function(){return this._inputColor},function(t){this._inputColor=t,this._setPanelChanged()}),t}(ns),po=function(e){function i(t,e){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,i.__super.call(this),this._itemColors=pn.comboBoxItemColors,this.skin=t,this.labels=e}E(i,"laya.ui.ComboBox",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._button&&this._button.destroy(t),this._list&&this._list.destroy(t),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},t.createChildren=function(){this.addChild(this._button=new ho),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},t._createList=function(){this._list=new Po,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},t._setListEvent=function(t){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=C.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},t.onListDown=function(t){t.stopPropagation()},t.onScrollBarDown=function(t){t.stopPropagation()},t.onButtonMouseDown=function(t){this.callLater(this.switchTo,[!this._isOpen])},t.changeList=function(){this._listChanged=!1;var t=this.width-2,e=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:e}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},t.onlistItemMouse=function(t,e){var i=t.type;if("mouseover"===i||"mouseout"===i){if(this._isCustomList)return;var n=this._list.getCell(e);if(!n)return;var r=n.getChildByName("label");r&&(r.color="mouseover"===i?(r.bgColor=this._itemColors[0],this._itemColors[1]):(r.bgColor=null,this._itemColors[2]))}else"click"===i&&(this.selectedIndex=e,this.isOpen=!1)},t.switchTo=function(t){this.isOpen=t},t.changeOpen=function(){this.isOpen=!this._isOpen},t.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var t=this._list.graphics;t.clear(),t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var e=this._list.array||[],i=e.length=0,n=this._labels.length;i<n;i++)e.push({label:this._labels[i]});this._list.height=this._listHeight,this._list.array=e},t.changeSelected=function(){this._button.label=this.selectedLabel},t._onStageMouseWheel=function(t){this._list&&!this._list.contains(t.target)&&this.removeList(null)},t.removeList=function(t){S.stage.off("mousedown",this,this.removeList),S.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},v(0,t,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[ki.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),v(0,t,"measureHeight",function(){return this._button.height}),v(0,t,"skin",function(){return this._button.skin},function(t){this._button.skin!=t&&(this._button.skin=t,this._listChanged=!0)}),v(0,t,"measureWidth",function(){return this._button.width}),v(0,t,"width",e.prototype._$get_width,function(t){S.superSet(ns,this,"width",t),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),v(0,t,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(t){this.selectedIndex=this._labels.indexOf(t)}),v(0,t,"labels",function(){return this._labels.join(",")},function(t){0<this._labels.length&&(this.selectedIndex=-1),t?this._labels=t.split(","):this._labels.length=0,this._itemChanged=!0}),v(0,t,"height",e.prototype._$get_height,function(t){S.superSet(ns,this,"height",t),this._button.height=this._height}),v(0,t,"selectHandler",function(){return this._selectHandler},function(t){this._selectHandler=t}),v(0,t,"visibleNum",function(){return this._visibleNum},function(t){this._visibleNum=t,this._listChanged=!0}),v(0,t,"labelBold",function(){return this._button.text.bold},function(t){this._button.text.bold=t}),v(0,t,"itemColors",function(){return String(this._itemColors)},function(t){this._itemColors=gn.fillArray(this._itemColors,t,String),this._listChanged=!0}),v(0,t,"itemSize",function(){return this._itemSize},function(t){this._itemSize=t,this._listChanged=!0}),v(0,t,"scrollBar",function(){return this.list.scrollBar}),v(0,t,"isOpen",function(){return this._isOpen},function(t){if(this._isOpen!=t)if(this._isOpen=t,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var e=this.localToGlobal(en.TEMP.setTo(0,0)),i=e.y+this._button.height;i=i+this._listHeight<=S.stage.height?i:e.y-this._listHeight,this._list.pos(e.x,i),this._list.zOrder=1001,S._currentStage.addChild(this._list),S.stage.once("mousedown",this,this.removeList),S.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),v(0,t,"scrollBarSkin",function(){return this._scrollBarSkin},function(t){this._scrollBarSkin=t}),v(0,t,"sizeGrid",function(){return this._button.sizeGrid},function(t){this._button.sizeGrid=t}),v(0,t,"button",function(){return this._button}),v(0,t,"list",function(){return this._list||this._createList(),this._list},function(t){t&&(t.removeSelf(),this._isCustomList=!0,this._list=t,this._setListEvent(t),this._itemHeight=t.getCell(0).height+t.spaceY)}),v(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):S.superSet(ns,this,"dataSource",t)}),v(0,t,"labelColors",function(){return this._button.labelColors},function(t){this._button.labelColors!=t&&(this._button.labelColors=t)}),v(0,t,"labelPadding",function(){return this._button.text.padding.join(",")},function(t){this._button.text.padding=gn.fillArray(pn.labelPadding,t,Number)}),v(0,t,"labelSize",function(){return this._button.text.fontSize},function(t){this._button.text.fontSize=t}),v(0,t,"labelFont",function(){return this._button.text.font},function(t){this._button.text.font=t}),v(0,t,"stateNum",function(){return this._button.stateNum},function(t){this._button.stateNum=t}),i}(ns),go=function(e){function i(t){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,i.__super.call(this),this._showButtons=vr.showButtons,this._touchScrollEnable=vr.touchScrollEnable,this._mouseWheelEnable=vr.mouseWheelEnable,this.skin=t,this.max=1}E(i,"laya.ui.ScrollBar",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),this.stopScroll(),this.target=null,e.prototype.destroy.call(this,t),this.upButton&&this.upButton.destroy(t),this.downButton&&this.downButton.destroy(t),this.slider&&this.slider.destroy(t),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},t.createChildren=function(){this.addChild(this.slider=new vo),this.addChild(this.upButton=new ho),this.addChild(this.downButton=new ho)},t.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},t.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},t.onButtonMouseDown=function(t){var e=t.currentTarget===this.upButton;this.slide(e),S.timer.once(pn.scrollBarDelayTime,this,this.startLoop,[e]),S.stage.once("mouseup",this,this.onStageMouseUp)},t.startLoop=function(t){S.timer.frameLoop(1,this,this.slide,[t])},t.slide=function(t){t?this.value-=this._scrollSize:this.value+=this._scrollSize},t.onStageMouseUp=function(t){S.timer.clear(this,this.startLoop),S.timer.clear(this,this.slide)},t.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},t.changeSize=function(){e.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},t.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},t.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},t.setScroll=function(t,e,i){this.runCallLater(this.changeSize),this.slider.setSlider(t,e,i),this.slider.bar.visible=0<e,!this._hide&&this.autoHide&&(this.visible=!1)},t.onTargetMouseWheel=function(t){this.value-=t.delta*this._scrollSize,this.target=this._target},t.onTargetMouseDown=function(t){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new en),this._lastPoint.setTo(S.stage.mouseX,S.stage.mouseY),S.timer.clear(this,this.tweenMove),An.clearTween(this),S.stage.once("mouseup",this,this.onStageMouseUp2),S.stage.once("mouseout",this,this.onStageMouseUp2),S.timer.frameLoop(1,this,this.loop)},t.loop=function(){var t=S.stage.mouseY,e=S.stage.mouseX;if(this._lastOffset=this.isVertical?t-this._lastPoint.y:e-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?S.stage._canvasTransform.getScaleY():S.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=e,this._lastPoint.y=t,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},t.onStageMouseUp2=function(t){if(S.stage.off("mouseup",this,this.onStageMouseUp2),S.stage.off("mouseout",this,this.onStageMouseUp2),S.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?An.to(this,{value:this.min},this.elasticBackTime,En.sineOut,C.create(this,this.elasticOver)):this._value>this.max&&An.to(this,{value:this.max},this.elasticBackTime,En.sineOut,C.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?S.stage.mouseY-this._lastPoint.y:S.stage.mouseX-this._lastPoint.x);for(var e=0,i=Math.min(this._offsets.length,3),n=0;n<i;n++)e+=this._offsets[this._offsets.length-1-n];if(this._lastOffset=e/i,(e=Math.abs(this._lastOffset))<2)return void this.event("end");60<e&&(this._lastOffset=0<this._lastOffset?60:-60);var r=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));S.timer.frameLoop(1,this,this.tweenMove,[r])}},t.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&An.to(this,{alpha:0},500),this.event("end")},t.tweenMove=function(t){this._lastOffset*=this.rollRatio;var e=NaN;if(0<t&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,e=.5*-(this.min-t-this.value),this._lastOffset>e&&(this._lastOffset=e)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,e=.5*-(this.max+t-this.value),this._lastOffset<e&&(this._lastOffset=e))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(S.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?An.to(this,{value:this.min},this.elasticBackTime,En.sineOut,C.create(this,this.elasticOver)):this._value>this.max?An.to(this,{value:this.max},this.elasticBackTime,En.sineOut,C.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&An.to(this,{alpha:0},500)}},t.stopScroll=function(){this.onStageMouseUp2(null),S.timer.clear(this,this.tweenMove),An.clearTween(this)},v(0,t,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),v(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),v(0,t,"max",function(){return this.slider.max},function(t){this.slider.max=t}),v(0,t,"showButtons",function(){return this._showButtons},function(t){this._showButtons=t,this.callLater(this.changeScrollBar)}),v(0,t,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),v(0,t,"min",function(){return this.slider.min},function(t){this.slider.min=t}),v(0,t,"value",function(){return this._value},function(t){t!==this._value&&(this._value=t,this._isElastic||(this.slider._value!=t&&(this.slider._value=t,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),v(0,t,"isVertical",function(){return this.slider.isVertical},function(t){this.slider.isVertical=t}),v(0,t,"sizeGrid",function(){return this.slider.sizeGrid},function(t){this.slider.sizeGrid=t}),v(0,t,"scrollSize",function(){return this._scrollSize},function(t){this._scrollSize=t}),v(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):S.superSet(ns,this,"dataSource",t)}),v(0,t,"thumbPercent",function(){return this._thumbPercent},function(t){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),t=1<=t?.99:t,this._thumbPercent=t,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*t,pn.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*t,pn.scrollBarMinNum))}),v(0,t,"target",function(){return this._target},function(t){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=t)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),v(0,t,"hide",function(){return this._hide},function(t){this._hide=t,this.visible=!t}),v(0,t,"touchScrollEnable",function(){return this._touchScrollEnable},function(t){this._touchScrollEnable=t,this.target=this._target}),v(0,t,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(t){this._mouseWheelEnable=t,this.target=this._target}),v(0,t,"tick",function(){return this.slider.tick},function(t){this.slider.tick=t}),i}(ns),vo=function(e){function i(t){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,i.__super.call(this),this.skin=t}E(i,"laya.ui.Slider",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(t),this._bar&&this._bar.destroy(t),this._progress&&this._progress.destroy(t),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},t.createChildren=function(){this.addChild(this._bg=new _o),this.addChild(this._bar=new ho)},t.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},t.onBarMouseDown=function(t){this._globalSacle||(this._globalSacle=new en),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=S.stage.mouseX,this._ty=S.stage.mouseY,S.stage.on("mousemove",this,this.mouseMove),S.stage.once("mouseup",this,this.mouseUp),S.stage.once("mouseout",this,this.mouseUp),this.showValueText()},t.showValueText=function(){if(this.showLabel){var t=laya.ui.Slider.label;this.addChild(t),t.textField.changeText(this._value+""),this.isVertical?(t.x=this._bar.x+20,t.y=.5*(this._bar.height-t.height)+this._bar.y):(t.y=this._bar.y-20,t.x=.5*(this._bar.width-t.width)+this._bar.x)}},t.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},t.mouseUp=function(t){S.stage.off("mousemove",this,this.mouseMove),S.stage.off("mouseup",this,this.mouseUp),S.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},t.mouseMove=function(t){var e=this._value;this.isVertical?(this._bar.y+=(S.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(S.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=S.stage.mouseX,this._ty=S.stage.mouseY;var i=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*i)/i,this._value!=e&&this.sendChangeEvent(),this.showValueText()},t.sendChangeEvent=function(t){void 0===t&&(t="change"),this.event(t),this.changeHandler&&this.changeHandler.runWith(this._value)},t.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},t.changeSize=function(){e.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},t.setSlider=function(t,e,i){this._value=-1,this._min=t,this._max=t<e?e:t,this.value=i<t?t:e<i?e:i},t.changeValue=function(){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var e=this._max-this._min;0===e&&(e=1),this.isVertical?(this._bar.y=(this._value-this._min)/e*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/e*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},t.onBgMouseDown=function(t){var e=this._bg.getMousePoint();this.isVertical?this.value=e.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=e.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},v(0,t,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),v(0,t,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var e=this._skin.replace(".png","$progress.png");kr.getRes(e)&&(this._progress||(this.addChild(this._progress=new _o),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=e),this.setBarPoint(),this.callLater(this.changeValue)}}),v(0,t,"allowClickBack",function(){return this._allowClickBack},function(t){this._allowClickBack!=t&&((this._allowClickBack=t)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),v(0,t,"max",function(){return this._max},function(t){this._max!=t&&(this._max=t,this.callLater(this.changeValue))}),v(0,t,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),v(0,t,"tick",function(){return this._tick},function(t){this._tick!=t&&(this._tick=t,this.callLater(this.changeValue))}),v(0,t,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=t,this._bar.sizeGrid=t,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),v(0,t,"min",function(){return this._min},function(t){this._min!=t&&(this._min=t,this.callLater(this.changeValue))}),v(0,t,"value",function(){return this._value},function(t){if(this._value!=t){var e=this._value;this._value=t,this.changeValue(),this._value!=e&&this.sendChangeEvent()}}),v(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):S.superSet(ns,this,"dataSource",t)}),v(0,t,"bar",function(){return this._bar}),m(i,["label",function(){return this.label=new yo}]),i}(ns),yo=function(e){function i(t){this._tf=null,i.__super.call(this),void 0===t&&(t=""),Wi.defaultColor=pn.labelColor,this.text=t}E(i,"laya.ui.Label",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._tf=null},t.createChildren=function(){this.addChild(this._tf=new Es)},t.changeText=function(t){this._tf.changeText(t)},v(0,t,"padding",function(){return this._tf.padding.join(",")},function(t){this._tf.padding=gn.fillArray(pn.labelPadding,t,Number)}),v(0,t,"bold",function(){return this._tf.bold},function(t){this._tf.bold=t}),v(0,t,"align",function(){return this._tf.align},function(t){this._tf.align=t}),v(0,t,"text",function(){return this._tf.text},function(t){this._tf.text!=t&&(t&&(t=gn.adptString(t+"")),this._tf.text=t,this.event("change"),this._width&&this._height||this.onCompResize())}),v(0,t,"italic",function(){return this._tf.italic},function(t){this._tf.italic=t}),v(0,t,"wordWrap",function(){return this._tf.wordWrap},function(t){this._tf.wordWrap=t}),v(0,t,"font",function(){return this._tf.font},function(t){this._tf.font=t}),v(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.text=t+"":S.superSet(ns,this,"dataSource",t)}),v(0,t,"color",function(){return this._tf.color},function(t){this._tf.color=t}),v(0,t,"valign",function(){return this._tf.valign},function(t){this._tf.valign=t}),v(0,t,"leading",function(){return this._tf.leading},function(t){this._tf.leading=t}),v(0,t,"fontSize",function(){return this._tf.fontSize},function(t){this._tf.fontSize=t}),v(0,t,"bgColor",function(){return this._tf.bgColor},function(t){this._tf.bgColor=t}),v(0,t,"borderColor",function(){return this._tf.borderColor},function(t){this._tf.borderColor=t}),v(0,t,"stroke",function(){return this._tf.stroke},function(t){this._tf.stroke=t}),v(0,t,"strokeColor",function(){return this._tf.strokeColor},function(t){this._tf.strokeColor=t}),v(0,t,"textField",function(){return this._tf}),v(0,t,"measureWidth",function(){return this._tf.width}),v(0,t,"measureHeight",function(){return this._tf.height}),v(0,t,"width",function(){return this._width||this._tf.text?S.superGet(ns,this,"width"):0},function(t){S.superSet(ns,this,"width",t),this._tf.width=t}),v(0,t,"height",function(){return this._height||this._tf.text?S.superGet(ns,this,"height"):0},function(t){S.superSet(ns,this,"height",t),this._tf.height=t}),v(0,t,"overflow",function(){return this._tf.overflow},function(t){this._tf.overflow=t}),v(0,t,"underline",function(){return this._tf.underline},function(t){this._tf.underline=t}),v(0,t,"underlineColor",function(){return this._tf.underlineColor},function(t){this._tf.underlineColor=t}),i}(ns),xo=function(e){function i(t){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,i.__super.call(this),this.skin=t}E(i,"laya.ui.ProgressBar",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(t),this._bar&&this._bar.destroy(t),this._bg=this._bar=null,this.changeHandler=null},t.createChildren=function(){this.addChild(this._bg=new _o),this.addChild(this._bar=new _o),this._bar._bitmap.autoCacheCmd=!1},t.changeValue=function(){if(this.sizeGrid){var t=this.sizeGrid.split(","),e=Number(t[3]),i=Number(t[1]),n=(this.width-e-i)*this._value;this._bar.width=e+i+n,this._bar.visible=this._bar.width>e+i}else this._bar.width=this.width*this._value},v(0,t,"measureHeight",function(){return this._bg.height}),v(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),v(0,t,"measureWidth",function(){return this._bg.width}),v(0,t,"height",e.prototype._$get_height,function(t){S.superSet(ns,this,"height",t),this._bg.height=this._height,this._bar.height=this._height}),v(0,t,"bar",function(){return this._bar}),v(0,t,"value",function(){return this._value},function(t){this._value!=t&&(t=1<t?1:t<0?0:t,this._value=t,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(t))}),v(0,t,"bg",function(){return this._bg}),v(0,t,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=this._bar.sizeGrid=t}),v(0,t,"width",e.prototype._$get_width,function(t){S.superSet(ns,this,"width",t),this._bg.width=this._width,this.callLater(this.changeValue)}),v(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):S.superSet(ns,this,"dataSource",t)}),i}(ns),bo=function(t){function e(){e.__super.call(this),this.bgColor="#ffff00",this.wordWrap=!1,this.mouseEnabled=!0}return E(e,"laya.debug.tools.debugUI.DButton",Es),e}(),To=function(e){function r(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",r.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=Es.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}E(r,"laya.display.Input",e);var t=r.prototype;return t.setSelection=function(t,e){this.focus=!0,laya.display.Input.inputElement.selectionStart=t,laya.display.Input.inputElement.selectionEnd=e},t._onUnDisplay=function(t){this.focus=!1},t._onMouseDown=function(t){this.focus=!0},t._syncInputTransform=function(){var t=this.nativeInput,e=Dn.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),i=this._width-this.padding[1]-this.padding[3],n=this._height-this.padding[0]-this.padding[2];hn.isConchApp?(t.setScale(e.scaleX,e.scaleY),t.setSize(i,n),t.setPos(e.x,e.y)):(r.inputContainer.style.transform=r.inputContainer.style.webkitTransform="scale("+e.scaleX+","+e.scaleY+") rotate("+S.stage.canvasDegree+"deg)",t.style.width=i+"px",t.style.height=n+"px",r.inputContainer.style.left=e.x+"px",r.inputContainer.style.top=e.y+"px")},t.select=function(){this.nativeInput.select()},t._setInputMethod=function(){r.input.parentElement&&r.inputContainer.removeChild(r.input),r.area.parentElement&&r.inputContainer.removeChild(r.area),r.inputElement=this._multiline?r.area:r.input,r.inputContainer.appendChild(r.inputElement),Es.RightToLeft&&(r.inputElement.style.direction="rtl")},t._focusIn=function(){laya.display.Input.isInputting=!0;var t=this.nativeInput;this._focus=!0;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),t.readOnly=!this._editable,hn.isConchApp&&(t.setType(this._type),t.setForbidEdit(!this._editable)),t.maxLength=this._maxChars;this.padding;if(t.type=this._type,t.value=this._content,t.placeholder=this._prompt,S.stage.off("keydown",this,this._onKeyDown),S.stage.on("keydown",this,this._onKeyDown),(S.stage.focus=this).event("focus"),vn.onPC&&t.focus(),!vn.onMiniGame){this._text;this._text=null}this.typeset(),t.setColor(this._originColor),t.setFontSize(this.fontSize),t.setFontFace(vn.onIPhone&&Es._fontFamilyMap[this.font]||this.font),hn.isConchApp&&t.setMultiAble&&t.setMultiAble(this._multiline),e.lineHeight=this.leading+this.fontSize+"px",e.fontStyle=this.italic?"italic":"normal",e.fontWeight=this.bold?"bold":"normal",e.textAlign=this.align,e.padding="0 0",this._syncInputTransform(),!hn.isConchApp&&vn.onPC&&S.timer.frameLoop(1,this,this._syncInputTransform)},t._setPromptColor=function(){(r.promptStyleDOM=vn.getElementById("promptStyle"))||((r.promptStyleDOM=vn.createElement("style")).setAttribute("id","promptStyle"),vn.document.head.appendChild(r.promptStyleDOM)),r.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},t._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(S.superSet(Es,this,"text",this._content),S.superSet(Es,this,"color",this._originColor)):(S.superSet(Es,this,"text",this._prompt),S.superSet(Es,this,"color",this._promptColor)),S.stage.off("keydown",this,this._onKeyDown),S.stage.focus=null,this.event("blur"),hn.isConchApp&&this.nativeInput.blur(),vn.onPC&&S.timer.clear(this,this._syncInputTransform)},t._onKeyDown=function(t){13===t.keyCode&&(vn.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},t.changeText=function(t){this._content=t,this._focus?(this.nativeInput.value=t||"",this.event("change")):e.prototype.changeText.call(this,t)},v(0,t,"color",e.prototype._$get_color,function(t){this._focus&&this.nativeInput.setColor(t),S.superSet(Es,this,"color",this._content?t:this._promptColor),this._originColor=t}),v(0,t,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),v(0,t,"multiline",function(){return this._multiline},function(t){this._multiline=t,this.valign=t?"top":"middle"}),v(0,t,"maxChars",function(){return this._maxChars},function(t){t<=0&&(t=1e5),this._maxChars=t}),v(0,t,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(t){S.superSet(Es,this,"color",this._originColor),t+="",this._focus?(this.nativeInput.value=t||"",this.event("change")):(this._multiline||(t=t.replace(/\r?\n/g,"")),(this._content=t)?S.superSet(Es,this,"text",t):(S.superSet(Es,this,"text",this._prompt),S.superSet(Es,this,"color",this.promptColor)))}),v(0,t,"nativeInput",function(){return this._multiline?r.area:r.input}),v(0,t,"prompt",function(){return this._prompt},function(t){!this._text&&t&&S.superSet(Es,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?S.superSet(Es,this,"text",this._text==this._prompt?t:this._text):S.superSet(Es,this,"text",t),this._prompt=Es.langPacks&&Es.langPacks[t]?Es.langPacks[t]:t}),v(0,t,"focus",function(){return this._focus},function(t){var e=this.nativeInput;this._focus!==t&&(t?(e.target?e.target._focusOut():this._setInputMethod(),(e.target=this)._focusIn()):(e.target=null,this._focusOut(),vn.document.body.scrollTop=0,e.blur(),hn.isConchApp?e.setPos(-1e4,-1e4):r.inputContainer.contains(e)&&r.inputContainer.removeChild(e)))}),v(0,t,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(t){this._restrictPattern=t?(-1<(t="[^"+t+"]").indexOf("^^")&&(t=t.replace("^^","")),new RegExp(t,"g")):null}),v(0,t,"editable",function(){return this._editable},function(t){this._editable=t,hn.isConchApp&&r.input.setForbidEdit(!t)}),v(0,t,"promptColor",function(){return this._promptColor},function(t){this._promptColor=t,this._content||S.superSet(Es,this,"color",t)}),v(0,t,"type",function(){return this._type},function(t){this._getCSSStyle().password="password"==t,this._type=t,hn.isConchApp&&this.nativeInput.setType(t)}),v(0,t,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),v(0,t,"asPassword",function(){return this._getCSSStyle().password},function(t){this._getCSSStyle().password=t,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),r.__init__=function(){r._createInputElement(),vn.onMobile&&hn.canvas.addEventListener(r.IOS_IFRAME?vn.onMiniGame?"touchend":"click":"touchend",r._popupInputMethod)},r._popupInputMethod=function(t){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},r._createInputElement=function(){r._initInput(r.area=vn.createElement("textarea")),r._initInput(r.input=vn.createElement("input")),(r.inputContainer=vn.createElement("div")).style.position="absolute",r.inputContainer.style.zIndex=1e5,vn.container.appendChild(r.inputContainer),r.inputContainer.setPos=function(t,e){r.inputContainer.style.left=t+"px",r.inputContainer.style.top=e+"px"}},r._initInput=function(e){var t=e.style;t.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",t.resize="none",t.backgroundColor="transparent",t.border="none",t.outline="none",t.zIndex=1,e.addEventListener("input",r._processInputting),e.addEventListener("mousemove",r._stopEvent),e.addEventListener("mousedown",r._stopEvent),e.addEventListener("touchmove",r._stopEvent),e.setFontFace=function(t){e.style.fontFamily=t},hn.isConchApp||(e.setColor=function(t){e.style.color=t},e.setFontSize=function(t){e.style.fontSize=t+"px"})},r._processInputting=function(t){var e=laya.display.Input.inputElement.target;if(e){var i=laya.display.Input.inputElement.value;e._restrictPattern&&(i=i.replace(/\u2006|\x27/g,""),e._restrictPattern.test(i)&&(i=i.replace(e._restrictPattern,""),laya.display.Input.inputElement.value=i)),e._text=i,e.event("input")}},r._stopEvent=function(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},r.TYPE_TEXT="text",r.TYPE_PASSWORD="password",r.TYPE_EMAIL="email",r.TYPE_URL="url",r.TYPE_NUMBER="number",r.TYPE_RANGE="range",r.TYPE_DATE="date",r.TYPE_MONTH="month",r.TYPE_WEEK="week",r.TYPE_TIME="time",r.TYPE_DATE_TIME="datetime",r.TYPE_DATE_TIME_LOCAL="datetime-local",r.TYPE_SEARCH="search",r.input=null,r.area=null,r.inputElement=null,r.inputContainer=null,r.confirmButton=null,r.promptStyleDOM=null,r.inputHeight=45,r.isInputting=!1,r.stageMatrix=null,m(r,["IOS_IFRAME",function(){return this.IOS_IFRAME=vn.onIOS&&vn.window.top!=vn.window.self}]),r}(Es),So=function(t){function e(){this.isWorking=!1,this.count=0,this.mTime=0,e.__super.call(this),this.txt.fontSize=12}E(e,"laya.debug.view.nodeInfo.recinfos.ReCacheRecInfo",Ds);var i=e.prototype;return i.addCount=function(t){void 0===t&&(t=0),this.count++,this.mTime+=t,this.isWorking||(this.working=!0)},i.updates=function(){this._tar.displayedInStage||(this.working=!1,this.removeSelf()),this.txt.text=$e.getNodeClassAndName(this._tar)+"\nreCache:"+this.count+"\ntime:"+this.mTime,0<this.count?(this.fresh(),S.timer.clear(this,this.removeSelfLater)):(this.working=!1,S.timer.once(3e3,this,this.removeSelfLater)),this.count=0,this.mTime=0},i.removeSelfLater=function(){this.working=!1,this.removeSelf()},v(0,i,"working",null,function(t){(this.isWorking=t)?S.timer.loop(1e3,this,this.updates):S.timer.clear(this,this.updates)}),e.showTime=3e3,e}(),Eo=function(t){function c(){this._frames=null,this._url=null,c.__super.call(this),this._setControlNode(this)}E(c,"laya.display.Animation",t);var e=c.prototype;return e.destroy=function(t){void 0===t&&(t=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,t),this._frames=null,this._labels=null},e.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),i&&this._setFramesFromCache(i,n),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},e._setFramesFromCache=function(t,e){var i;return void 0===e&&(e=!1),this._url&&(t=this._url+"#"+t),t&&c.framesMap[t]?((i=c.framesMap[t])instanceof Array?(this._frames=c.framesMap[t],this._count=this._frames.length):(i.nodeRoot&&(c.framesMap[t]=this._parseGraphicAnimationByData(i),i=c.framesMap[t]),this._frames=i.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=i.interval),this._labels=this._copyLabels(i.labels)),!0):(e&&console.log("ani not found:",t),!1)},e._copyLabels=function(t){if(!t)return null;var e,i;for(i in e={},t)e[i]=Dn.copyArray([],t[i]);return e},e._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&t.prototype._frameLoop.call(this)},e._displayToIndex=function(t){this._frames&&(this.graphics=this._frames[t])},e.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},e.loadImages=function(t,e){return void 0===e&&(e=""),this._url="",this._setFramesFromCache(e)||(this.frames=c.framesMap[e]?c.framesMap[e]:c.createFrames(t,e)),this},e.loadAtlas=function(e,i,n){void 0===n&&(n=""),this._url="";var r=this;function t(t){e===t&&(r.frames=c.framesMap[n]?c.framesMap[n]:c.createFrames(e,n),i&&i.run())}return r._setFramesFromCache(n)||(kr.getAtlas(e)?t(e):S.loader.load(e,C.create(null,t,[e]),null,"atlas")),this},e.loadAnimation=function(t,e,i){this._url=t;return this._actionName||(this._actionName=""),this._setFramesFromCache(this._actionName)?(this._setFramesFromCache(this._actionName,!0),this.index=0,e&&e.run()):!i||kr.getAtlas(i)?this._loadAnimationData(t,e,i):S.loader.load(i,C.create(this,this._loadAnimationData,[t,e,i]),null,"atlas"),this},e._loadAnimationData=function(o,l,t){var h=this;if(!t||kr.getAtlas(t)){var u=this;kr.getRes(o)?e(o):S.loader.load(o,C.create(null,e,[o]),null,"json"),kr.clearRes(o)}else console.warn("atlas load fail:"+t);function e(t){if(kr.getRes(t)&&o===t){var e;if(c.framesMap[o+"#"])u._setFramesFromCache(h._actionName,!0),h.index=0,h._checkResumePlaying();else{var i=u._parseGraphicAnimation(kr.getRes(o));if(!i)return;var n,r=i.animationList,a=0,s=r.length;for(a=0;a<s;a++)e=r[a],c.framesMap[o+"#"+e.name]=e,n||(n=e);n&&(c.framesMap[o+"#"]=n,u._setFramesFromCache(h._actionName,!0),h.index=0),h._checkResumePlaying()}l&&l.run()}}},e._parseGraphicAnimation=function(t){return gl.parseAnimationData(t)},e._parseGraphicAnimationByData=function(t){return gl.parseAnimationByData(t)},v(0,e,"frames",function(){return this._frames},function(t){(this._frames=t)&&(this._count=t.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),v(0,e,"autoPlay",null,function(t){t?this.play():this.stop()}),v(0,e,"source",null,function(t){-1<t.indexOf(".ani")?this.loadAnimation(t):-1<t.indexOf(".json")||-1<t.indexOf("als")||-1<t.indexOf("atlas")?this.loadAtlas(t):this.loadImages(t.split(","))}),v(0,e,"autoAnimation",null,function(t){this.play(0,!0,t,!1)}),c.createFrames=function(t,e){var i,n,r=0,a=0;if("string"==typeof t){var s=kr.getAtlas(t);if(s&&s.length)for(i=[],r=0,a=s.length;r<a;r++)(n=new M.createGraphics).drawTexture(kr.getRes(s[r]),0,0),i.push(n)}else if(t instanceof Array)for(i=[],r=0,a=t.length;r<a;r++)(n=new M.createGraphics).loadImage(t[r],0,0),i.push(n);return e&&(c.framesMap[e]=i),i},c.clearCache=function(t){var e,i=c.framesMap,n=t+"#";for(e in i)e!==t&&0!=e.indexOf(n)||delete c.framesMap[e]},c.framesMap={},c}(Vs),Ro=function(t){function a(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,a.__super.call(this),null==a._sortIndexFun&&(a._sortIndexFun=$i.sortByKey("index",!1,!0))}E(a,"laya.display.FrameAnimation",t);var e=a.prototype;return e._setUp=function(t,e){this._labels=null,this._animationNewFrames=null,this._targetDic=t,this._animationData=e,this.interval=1e3/e.frameRate,e.parsed?(this._count=e.count,this._labels=e.labels,this._animationNewFrames=e.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),e.parsed=!0,e.labels=this._labels,e.count=this._count,e.animationNewFrames=this._animationNewFrames},e.clear=function(){t.prototype.clear.call(this),this._targetDic=null,this._animationData=null},e._displayToIndex=function(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(i=0;i<n;i++)this._displayNodeToFrame(e[i],t)}},e._displayNodeToFrame=function(t,e,i){i||(i=this._targetDic);var n=i[t.target];if(n){var r,a,s,o=t.frames,l=t.keys,h=0,u=l.length;for(h=0;h<u;h++)s=(a=o[r=l[h]]).length>e?a[e]:a[a.length-1],n[r]=s}},e._calculateDatas=function(){if(this._animationData){var t,e=this._animationData.nodes,i=0,n=e.length;for(i=this._count=0;i<n;i++)t=e[i],this._calculateNodeKeyFrames(t);this._count+=1}},e._calculateNodeKeyFrames=function(t){var e,i,n=t.keyframes,r=t.target;for(e in t.frames||(t.frames={}),t.keys?t.keys.length=0:t.keys=[],t.initValues||(t.initValues={}),n)i=n[e],t.frames[e]||(t.frames[e]=[]),this._targetDic&&this._targetDic[r]&&(t.initValues[e]=this._targetDic[r][e]),i.sort(a._sortIndexFun),t.keys.push(e),this._calculateNodePropFrames(i,t.frames[e],e,r)},e.resetToInitState=function(){if(this._targetDic&&this._animationData){var t,e,i=this._animationData.nodes,n=0,r=i.length;for(n=0;n<r;n++)if(e=(t=i[n]).initValues){var a,s=this._targetDic[t.target];if(s)for(a in e)s[a]=e[a]}}},e._calculateNodePropFrames=function(t,e,i,n){var r=0,a=t.length-1;for(e.length=t[a].index+1,r=0;r<a;r++)this._dealKeyFrame(t[r]),this._calculateFrameValues(t[r],t[r+1],e);0==a&&(e[t[0].index]=t[0].value,this._animationNewFrames&&(this._animationNewFrames[t[0].index]=!0)),this._dealKeyFrame(t[r])},e._dealKeyFrame=function(t){t.label&&""!=t.label&&this.addLabel(t.label,t.index)},e._calculateFrameValues=function(t,e,i){var n,r=0,a=t.index,s=e.index,o=t.value,l=e.value-t.value,h=s-a;if(s>this._count&&(this._count=s),t.tween)for(null==(n=En[t.tweenMethod])&&(n=En.linearNone),r=a;r<s;r++)i[r]=n(r-a,o,l,h),this._animationNewFrames&&(this._animationNewFrames[r]=!0);else for(r=a;r<s;r++)i[r]=o;this._animationNewFrames&&(this._animationNewFrames[t.index]=!0,this._animationNewFrames[e.index]=!0),i[e.index]=e.value},a._sortIndexFun=null,a}(Vs),wo=function(t){function r(t,e,i,n){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,r.__super.call(this,t,e,i,n)}E(r,"laya.webgl.shader.d2.Shader2X",t);var e=r.prototype;return e.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},e._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)t=e[i],(hn.isFlash||"size"!==t.name&&"position"!==t.name&&"texcoord"!==t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1},e.disposeResource=function(){t.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)t=e[i],(hn.isFlash||"size"!==t.name)&&this._params2dQuick2.push(t)}return this._params2dQuick2},r.create=function(t,e,i,n){return new r(t,e,i,n)},r}(ks),Co=function(t){function i(t,e){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,i.__super.call(this),this._init_(t,e)}E(i,"laya.resource.HTMLImage",Xs);var e=i.prototype;return e._init_=function(t,e){this._src=t,this._source=new vn.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),0!=t.indexOf("data:image")&&(this._source.crossOrigin=""),t&&(this._source.src=t)},e.recreateResource=function(){var t=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var e=this;this._source=new vn.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._source.onload=null,void(e._source=null);e._source.onload=null,e.memorySize=t._w*t._h*4,e._recreateLock=!1,e.completeCreate()},this._source.src=this._src}},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},e.onresize=function(){this._w=this._source.width,this._h=this._source.height},v(0,e,"onload",null,function(t){var e=this;this._onload=t,this._source&&(this._source.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),v(0,e,"onerror",null,function(t){var e=this;this._onerror=t,this._source&&(this._source.onerror=null!=this._onerror?function(){e._onerror()}:null)}),v(0,e,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t,hn.isConchApp&&this._source&&(this._source.enableMerageInAtlas=t)}),i.create=function(t,e){return new i(t,e)},i}(),Io=function(t){function e(t){this._uint8Array=null,this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,hn.isFlash||(this._buffer=new ArrayBuffer(8))}E(e,"laya.webgl.utils.IndexBuffer2D",Hs);var i=e.prototype;return i._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},e.QuadrangleIB=null,e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),Mo=function(t){function i(t,e){this._floatArray32=null,this._vertexStride=0,i.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,hn.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}E(i,"laya.webgl.utils.VertexBuffer2D",t);var e=i.prototype;return e.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},e.bind=function(t){t&&t._bind(),this._bind()},e.insertData=function(t,e){this.getFloat32Array().set(t,e),this._upload=!0},e.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},e.disposeResource=function(){t.prototype.disposeResource.call(this)},e.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},v(0,e,"vertexStride",function(){return this._vertexStride}),i.create=function(t,e){return void 0===e&&(e=35048),new i(t,e)},i}(Hs),Ao=function(t){var _;function f(){this._idMap=null,this._aniList=null,this._watchMap={},f.__super.call(this)}E(f,"laya.ui.View",eo);var e=f.prototype;return e.createView=function(t){if(t.animations&&!this._idMap&&(this._idMap={}),f.createComp(t,this,this),t.animations){var e,i,n=[],r=t.animations,a=0,s=r.length;for(a=0;a<s;a++){switch(e=new Ro,i=r[a],e._setUp(this._idMap,i),(this[i.name]=e)._setControlNode(this),i.action){case 1:e.play(0,!1);break;case 2:e.play(0,!0)}n.push(e)}this._aniList=n}0<this._width&&null==t.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},e.onEvent=function(t,e){},e.loadUI=function(t){var e=f.uiMap[t];e&&this.createView(e)},e.destroy=function(t){void 0===t&&(t=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,t)},e.changeData=function(t){var e=this._watchMap[t];if(e){console.log("change",t);for(var i=0,n=e.length;i<n;i++){e[i].exe(this)}}},f._regs=function(){for(var t in f.uiClassMap)bn.regClass(t,f.uiClassMap[t])},f.createComp=function(t,e,i,n){if(!(e=e||f.getCompInstance(t)))return console.warn("can not create:"+t.type),null;var r=t.child;if(r)for(var a=e instanceof laya.ui.List,s=0,o=r.length;s<o;s++){var l=r[s];if(!e.hasOwnProperty("itemRender")||"render"!=l.props.name&&"render"!==l.props.renderType)if("Graphic"==l.type)bn.addGraphicsToSprite(l,e);else if(bn.isDrawType(l.type))bn.addGraphicToSprite(l,e,!0);else{if(a){var h=[],u=f.createComp(l,null,i,h);h.length&&(u._$bindData=h)}else u=f.createComp(l,null,i,n);"Script"==l.type?"owner"in u?u.owner=e:"target"in u&&(u.target=e):"mask"==l.props.renderType||"mask"==l.props.name?e.mask=u:u instanceof laya.display.Sprite&&e.addChild(u)}else e.itemRender=l}var c=t.props;for(var d in c){var _=c[d];f.eventDic[d]?_&&i&&e.on(d,i,i.onEvent,[_]):f.setCompValue(e,d,_,i,n)}return S.__typeof(e,"laya.ui.IItem")&&e.initItems(),t.compId&&i&&i._idMap&&(i._idMap[t.compId]=e),e},f.setCompValue=function(t,e,i,n,r){if("string"==typeof i&&-1<i.indexOf("${")){if(f._sheet||(f._sheet=bn.getClass("laya.data.Table")),!f._sheet)return void console.warn("Can not find class Sheet");if(r)r.push(t,e,i);else if(n){-1==i.indexOf("].")&&(i=i.replace(".","[0]."));var a,s,o=new _(t,e,i);o.exe(n);for(var l=i.replace(/\[.*?\]\./g,".");null!=(a=f._parseWatchData.exec(l));){for(var h=a[1];null!=(s=f._parseKeyWord.exec(h));){var u=s[0],c=n._watchMap[u]||(n._watchMap[u]=[]);c.push(o),f._sheet.I.notifer.on(u,n,n.changeData,[u])}(c=n._watchMap[h]||(n._watchMap[h]=[])).push(o),f._sheet.I.notifer.on(h,n,n.changeData,[h])}}}else if("var"===e&&n)n[i]=t;else if("onClick"==e){var d=S._runScript("(function(){"+i+"})");t.on("click",n,d)}else t[e]="true"===i||"false"!==i&&i},f.getCompInstance=function(t){var e,i=t.props?t.props.runtime:null;return e=i?f.viewClassMap[i]||f.uiClassMap[i]||S.__classmap[i]:f.uiClassMap[t.type],t.props&&t.props.hasOwnProperty("renderType")&&"instance"==t.props.renderType?e.instance:e?new e:null},f.regComponent=function(t,e){f.uiClassMap[t]=e,bn.regClass(t,e)},f.regViewRuntime=function(t,e){f.viewClassMap[t]=e},f.uiMap={},f.viewClassMap={},f._sheet=null,m(f,["uiClassMap",function(){return this.uiClassMap={ViewStack:Ho,LinkButton:ho,TextArea:kl,ColorPicker:mo,Box:eo,Button:ho,CheckBox:hl,Clip:fo,ComboBox:po,Component:ns,HScrollBar:dl,HSlider:_l,Image:_o,Label:yo,List:Po,Panel:Zo,ProgressBar:xo,Radio:ul,RadioGroup:Ul,ScrollBar:go,Slider:vo,Tab:Zl,TextInput:ml,View:f,VScrollBar:fl,VSlider:pl,Tree:Oo,HBox:Gl,VBox:Wl,Sprite:ya,Animation:Eo,Text:Es,FontClip:cl}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),f.__init$=function(){f._regs(),_=function(){function t(t,e,i){this.comp=null,this.prop=null,this.value=null,this.comp=t,this.prop=e,this.value=i}return E(t,""),t.prototype.exe=function(t){var e=gn.getBindFun(this.value);this.comp[this.prop]=e.call(this,t)},t}()},f}(),Do=function(t){function s(t,e,i){void 0===t&&(t=0),void 0===e&&(e=.3),void 0===i&&(i=1e3),this._viewMatrix=new ye,this._projectionMatrix=new ye,this._projectionViewMatrix=new ye,this._viewport=new Ie(0,0,0,0),this._normalizedViewport=new Ie(0,0,1,1),this._aspectRatio=t,this._boundFrustumUpdate=!0,this._boundFrustum=new fe(ye.DEFAULT),s.__super.call(this,e,i),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}E(s,"laya.d3.core.Camera",ro);var e=s.prototype;return e._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},e._parseCustomProps=function(t,e,i,n){var r=i.clearColor;this.clearColor=new Ce(r[0],r[1],r[2],r[3]);var a=i.viewport;this.normalizedViewport=new Ie(a[0],a[1],a[2],a[3])},e._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.aspectRatio*.5,e=.5*this.orthographicVerticalSize;ye.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._projectionMatrix)}else ye.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},e._update=function(t){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,t)},e._renderCamera=function(t,e,i){var n,r;i.parallelSplitShadowMaps[0]&&i._renderShadowMap(t,e,this),(e.camera=this)._prepareCameraToRender(),i._preRenderUpdateComponents(e),n=e._viewMatrix=this.viewMatrix;var a=this._renderTarget;e._projectionViewMatrix=a?(a.start(),ye.multiply(ro._invertYScaleMatrix,this._projectionMatrix,ro._invertYProjectionMatrix),ye.multiply(ro._invertYScaleMatrix,this.projectionViewMatrix,ro._invertYProjectionViewMatrix),r=e._projectionMatrix=ro._invertYProjectionMatrix,ro._invertYProjectionViewMatrix):(r=e._projectionMatrix=this._projectionMatrix,this.projectionViewMatrix),this._prepareCameraViewProject(n,r),e._viewport=this.viewport,i._preRenderScene(t,e,this.boundFrustum),i._clear(t,e),i._renderScene(t,e),i._postRenderUpdateComponents(e),a&&a.end()},e.viewportPointToRay=function(t,e){We.calculateCursorRay(t,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},e.normalizedViewportPointToRay=function(t,e){var i=s._tempVector20,n=this.viewport,r=t.elements,a=i.elements;a[0]=r[0]*n.width,a[1]=r[1]*n.height,We.calculateCursorRay(i,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},e.worldToViewportPoint=function(t,e){ye.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(t,this._projectionViewMatrix,e);var i=e.elements;i[0]=i[0]/S.stage.clientScaleX,i[1]=i[1]/S.stage.clientScaleY},e.worldToNormalizedViewportPoint=function(t,e){ye.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(t,this._projectionViewMatrix,e);var i=e.elements;i[0]=i[0]/S.stage.clientScaleX,i[1]=i[1]/S.stage.clientScaleY},e.convertScreenCoordToOrthographicCoord=function(t,e){if(this._orthographic){var i=z.clientWidth,n=z.clientHeight,r=this.orthographicVerticalSize*this.aspectRatio/i,a=this.orthographicVerticalSize/n,s=t.elements,o=e.elements;return o[0]=(-i/2+s[0])*r,o[1]=(n/2-s[1])*a,o[2]=(this.nearPlane-this.farPlane)*(s[2]+1)/2-this.nearPlane,we.transformCoordinate(e,this.transform.worldMatrix,e),!0}return!1},v(0,e,"projectionViewMatrix",function(){return ye.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),v(0,e,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var t=this.viewport;return t.width/t.height},function(t){if(t<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=t,this._calculateProjectionMatrix()}),v(0,e,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),v(0,e,"needViewport",function(){var t=this.normalizedViewport;return 0===t.x&&0===t.y&&1===t.width&&1===t.height}),v(0,e,"viewport",function(){if(this._viewportExpressedInClipSpace){var t=this._normalizedViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._viewport.x=t.x*i,this._viewport.y=t.y*n,this._viewport.width=t.width*i,this._viewport.height=t.height*n}return this._viewport},function(t){if(null!=this.renderTarget&&(t.x<0||t.y<0||0==t.width||0==t.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=t,this._calculateProjectionMatrix()}),v(0,e,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var t=this._viewport,e=this.renderTargetSize,i=e.width,n=e.height;this._normalizedViewport.x=t.x/i,this._normalizedViewport.y=t.y/n,this._normalizedViewport.width=t.width/i,this._normalizedViewport.height=t.height/n}return this._normalizedViewport},function(t){t.x<0&&(t.x=0,console.warn("Camera: viewport.x must large than 0.0.")),t.y<0&&(t.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<t.x+t.width&&(t.width=1-t.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<t.y+t.height&&(t.height=1-t.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=t,this._calculateProjectionMatrix()}),v(0,e,"projectionMatrix",function(){return this._projectionMatrix},function(t){this._projectionMatrix=t,this._useUserProjectionMatrix=!0}),v(0,e,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),m(s,["_tempVector20",function(){return this._tempVector20=new Re}]),s}(),Lo=(function(e){function i(){i.__super.call(this),this._render=new Ia(this),this._render.on("materialchanged",this,this._onMaterialChanged);var t=new ss;this._render.sharedMaterial=t,this._geometryFilter=new Ga(this),t.renderMode=8,this._changeRenderObject(0)}E(i,"laya.d3.core.glitter.Glitter",e);var t=i.prototype;t._changeRenderObject=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new X),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=ss.defaultMaterial);var r=this._geometryFilter;return i._mainSortID=0,i._sprite3D=this,i.renderObj=r,i._material=n,i},t._onMaterialChanged=function(t,e,i){e<t._renderElements.length&&this._changeRenderObject(e)},t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},t._update=function(t){this._geometryFilter._update(t.elapsedTime),e.prototype._update.call(this,t)},t.addGlitterByPositions=function(t,e){this._geometryFilter.addVertexPosition(t,e)},t.addGlitterByPositionsVelocitys=function(t,e,i,n){this._geometryFilter.addVertexPositionVelocity(t,e,i,n)},t.cloneTo=function(t){var e=t,i=e.templet,n=this._geometryFilter;i.lifeTime=n.lifeTime,i.minSegmentDistance=n.minSegmentDistance,i.minInterpDistance=n.minInterpDistance,i.maxSlerpCount=n.maxSlerpCount,i._maxSegments=n._maxSegments;var r=e._render,a=this._render;r.sharedMaterials=a.sharedMaterials,r.enable=a.enable,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy(),this._geometryFilter=null)},v(0,t,"templet",function(){return this._geometryFilter}),v(0,t,"glitterRender",function(){return this._render}),i.CURRENTTIME=2,i.DURATION=3}(ao),function(t){function e(){this._direction=null,this._updateDirection=!1,e.__super.call(this),this._updateDirection=!1,this._direction=new we,this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChange)}E(e,"laya.d3.core.light.DirectionLight",t);var i=e.prototype;return i._initShadow=function(){if(this._shadow)this._parallelSplitShadowMap=new Ne,this.scene.parallelSplitShadowMaps.push(this._parallelSplitShadowMap),this.transform.worldMatrix.getForward(this._direction),we.normalize(this._direction,this._direction),this._parallelSplitShadowMap.setInfo(this.scene,this._shadowFarPlane,this._direction,this._shadowMapSize,this._shadowMapCount,this._shadowMapPCFType);else{var t=this.scene.parallelSplitShadowMaps;t.splice(t.indexOf(this._parallelSplitShadowMap),1),this._parallelSplitShadowMap.disposeAllRenderTarget(),this._parallelSplitShadowMap=null,this.scene.removeShaderDefine(Ne.SHADERDEFINE_SHADOW_PSSM1),this.scene.removeShaderDefine(Ne.SHADERDEFINE_SHADOW_PSSM2),this.scene.removeShaderDefine(Ne.SHADERDEFINE_SHADOW_PSSM3)}},i._addSelfRenderObjects=function(){t.prototype._addSelfRenderObjects.call(this),this._shadow&&this._initShadow()},i._clearSelfRenderObjects=function(){var t=this.scene,e=t._shaderValues;e.setValue(4,null),e.setValue(3,null),t.removeShaderDefine(Xr.SHADERDEFINE_DIRECTIONLIGHT)},i._prepareToScene=function(t){var e=t.scene;if(e.enableLight&&this._activeInHierarchy){var i=e._shaderValues;return e.addShaderDefine(Xr.SHADERDEFINE_DIRECTIONLIGHT),we.scale(this.color,this._intensity,this._intensityColor),i.setValue(4,this._intensityColor.elements),this.transform.worldMatrix.getForward(this._direction),we.normalize(this._direction,this._direction),i.setValue(3,this._direction.elements),!0}return e.removeShaderDefine(Xr.SHADERDEFINE_DIRECTIONLIGHT),!1},i._onWorldMatrixChange=function(){this._updateDirection=!0},v(0,i,"shadow",t.prototype._$get_shadow,function(t){this._shadow!==t&&(this._shadow=t,this.scene&&this._initShadow())}),v(0,i,"direction",function(){return console.log("Warning: discard property,please use transform's property instead."),this._updateDirection&&(this.transform.worldMatrix.getForward(this._direction),we.normalize(this._direction,this._direction),this._updateDirection=!1),this._direction},function(t){console.log("Warning: discard property,please use transform's property instead.");var e=this.transform.worldMatrix;e.setForward(t),this.transform.worldMatrix=e,we.normalize(t,t),this._direction=t,this.shadow&&this._parallelSplitShadowMap&&this._parallelSplitShadowMap._setGlobalParallelLightDir(this._direction)}),e}(so)),Vo=function(i){function n(t,e){n.__super.call(this,e),this._geometryFilter=new Ma(this),this._render=new Aa(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),t&&(this._geometryFilter.sharedMesh=t)instanceof laya.d3.resource.models.Mesh&&(t.loaded?this._render.sharedMaterials=t.materials:t.once("loaded",this,this._applyMeshMaterials))}E(n,"laya.d3.core.MeshSprite3D",i);var t=n.prototype;return t._changeRenderObjectByMesh=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new Nr),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=us.defaultMaterial);var r=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(r,n),i._sprite3D=this,i.renderObj=r,i._material=n,i},t._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements[t];e||(e=us.defaultMaterial);var n=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(n,e),i._sprite3D=this,i.renderObj=n,i._material=e,i},t._changeRenderObjectsByMesh=function(){var t=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=t;for(var e=0;e<t;e++)this._changeRenderObjectByMesh(e)},t._onMeshChanged=function(t){var e=t.sharedMesh;e.loaded?this._changeRenderObjectsByMesh():e.once("loaded",this,this._onMeshLoaded)},t._onMeshLoaded=function(t){t===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},t._onMaterialChanged=function(t,e,i){e<this._render._renderElements.length&&this._changeRenderObjectByMaterial(e,i)},t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},t._parseCustomProps=function(t,e,i,n){var r=this.meshRender,a=i.lightmapIndex;null!=a&&(r.lightmapIndex=a);var s,o,l=i.lightmapScaleOffset;if(l&&(r.lightmapScaleOffset=new Ce(l[0],l[1],l[2],l[3])),n.instanceParams)(s=n.instanceParams.loadPath)&&(o=kr.getRes(e[s]),(this.meshFilter.sharedMesh=o).loaded?r.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(s=i.meshPath)&&(o=kr.getRes(e[s]),this.meshFilter.sharedMesh=o);var h=i.materials;if(h){var u=r.sharedMaterials,c=h.length;u.length=c;for(var d=0;d<c;d++)u[d]=kr.getRes(e[h[d].path]);r.sharedMaterials=u}}},t._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},t._addToInitStaticBatchManager=function(){n._staticBatchManager._addInitBatchSprite(this)},t.cloneTo=function(t){var e=t;e._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.lightmapIndex=i.lightmapIndex,n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},t.destroy=function(t){if(void 0===t&&(t=!0),!this.destroyed){var e=this.meshFilter.sharedMesh;e.loaded||e.off("loaded",this,this._applyMeshMaterials),i.prototype.destroy.call(this,t),this._geometryFilter._destroy()}},v(0,t,"meshFilter",function(){return this._geometryFilter}),v(0,t,"meshRender",function(){return this._render}),n.__init__=function(){at._staticBatchManagers.push(n._staticBatchManager)},n.load=function(t){return S.loader.create(t,null,null,n)},m(n,["_staticBatchManager",function(){return this._staticBatchManager=new Or}]),n}(ao),No=function(t){function l(){this._tY=0,l.__super.call(this),Oi.setViewScale(this)}E(l,"laya.debug.uicomps.ContextMenu",eo);var e=l.prototype;return e.addItem=function(t){this.addChild(t),t.y=this._tY,this._tY+=t.height,t.on("mousedown",this,this.onClick)},e.onClick=function(t){this.event("select",t),this.removeSelf()},e.show=function(t,e){void 0===t&&(t=-999),void 0===e&&(e=-999),S.timer.once(100,this,l.showMenu,[this,t,e])},l.init=function(){S.stage.on("click",null,l.cleanMenu)},l.cleanMenu=function(t){var e,i=0;for(e=l._menuList.length,i=0;i<e;i++)l._menuList[i]&&l._menuList[i].removeSelf();l._menuList.length=0},l.showMenu=function(t,e,i){void 0===e&&(e=-999),void 0===i&&(i=-999),l.cleanMenu(),l.adptMenu(t),S.stage.addChild(t),oi.showToStage(t),-999!=e&&-999!=i&&t.pos(e,i),l._menuList.push(t)},l.createMenu=function(t){return l.createMenuByArray(arguments)},l.createMenuByArray=function(t){for(var e,i=new l,n=!1,r=0,a=t.length;r<a;r++){var s=t[r],o={};"string"==typeof s?o.label=s:o=s,n=""!=o.label?((e=new Xo(o.label,n)).data=s,i.addItem(e),!1):((e=new Xo("",n)).data=s,i.addItem(e),!0)}return i.zOrder=9999,i},l.adptMenu=function(t){var e=80,i=80,n=0,r=t.numChildren;for(n=0;n<r;n++)i<(e=t.getChildAt(n).width)&&(i=e);for(n=0;n<r;n++)t.getChildAt(n).width=i},l._menuList=[],l}(),Po=function(t){function e(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new en,e.__super.call(this)}E(e,"laya.ui.List",t);var i=e.prototype;return S.imps(i,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),i.destroy=function(t){void 0===t&&(t=!0),this._content&&this._content.destroy(t),this._scrollBar&&this._scrollBar.destroy(t),laya.ui.Component.prototype.destroy.call(this,t),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},i.createChildren=function(){this.addChild(this._content=new eo)},i.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=S.superGet(eo,this,"cacheAs")),S.superSet(eo,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){S.superSet(eo,this,"cacheAs",this._$P.cacheAs)},i._removePreScrollBar=function(){var t=this.removeChildByName("scrollBar");t&&t.destroy(!0)},i.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var t=this._getOneCell(),e=t.width+this._spaceX||1,i=t.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/i):Math.round(this._height/i));var n=this._width?this._width:e*this.repeatX-this._spaceX,r=this._height?this._height:i*this.repeatY-this._spaceY;this._cellSize=this._isVertical?i:e,this._cellOffset=this._isVertical?i*Math.max(this._repeatY2,this._repeatY)-r-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-n-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=r:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=n),this.setContentSize(n,r);var a=this._isVertical?this.repeatX:this.repeatY,s=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,a,s),this._createdLine=s,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},i._getOneCell=function(){if(0===this._cells.length){var t=this.createItem();if(this._offset.setTo(t.x,t.y),this.cacheContent)return t;this._cells.push(t)}return this._cells[0]},i._createItems=function(t,e,i){var n=this._content,r=this._getOneCell(),a=r.width+this._spaceX,s=r.height+this._spaceY;if(this.cacheContent){var o=new eo;o.cacheAsBitmap=!0,o.pos((this._isVertical?0:t)*a,(this._isVertical?t:0)*s),this._content.addChild(o),this._content.optimizeScrollRect=!0,n=o}else{for(var l=[],h=this._cells.length-1;-1<h;h--){var u=this._cells[h];u.removeSelf(),l.push(u)}this._cells.length=0}for(var c=t;c<i;c++)for(var d=0;d<e;d++)(r=l&&l.length?l.pop():this.createItem()).x=(this._isVertical?d:c)*a-n.x,r.y=(this._isVertical?c:d)*s-n.y,r.name="item"+(c*e+d),n.addChild(r),this.addCell(r)},i.createItem=function(){var t=[];if("function"==typeof this._itemRender)var e=new this._itemRender;else e=Ao.createComp(this._itemRender,null,null,t);if(0==t.length&&e._watchMap){var i=e._watchMap;for(var n in i)for(var r=i[n],a=0;a<r.length;a++){var s=r[a];t.push(s.comp,s.prop,s.value)}}return t.length&&(e._$bindData=t),e},i.addCell=function(t){t.on("click",this,this.onCellMouse),t.on("rightclick",this,this.onCellMouse),t.on("mouseover",this,this.onCellMouse),t.on("mouseout",this,this.onCellMouse),t.on("mousedown",this,this.onCellMouse),t.on("mouseup",this,this.onCellMouse),this._cells.push(t)},i.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var t=0,e=t=0;e<1e4;e++){var i=this.getChildByName("item"+e);if(!i)break;this.addCell(i),t++}this.repeatY=t}},i.setContentSize=function(t,e){this._content.width=t,this._content.height=e,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new nn),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,t,e),this._content.scrollRect=this._content.scrollRect),this.event("resize")},i.onCellMouse=function(t){"mousedown"===t.type&&(this._isMoved=!1);var e=t.currentTarget,i=this._startIndex+this._cells.indexOf(e);i<0||("click"===t.type||"rightclick"===t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=i:this.changeCellState(e,!0,0):"mouseover"!==t.type&&"mouseout"!==t.type||this._selectedIndex===i||this.changeCellState(e,"mouseover"===t.type,0),this.mouseHandler&&this.mouseHandler.runWith([t,i]))},i.changeCellState=function(t,e,i){var n=t.getChildByName("selectBox");n&&(this.selectEnable=!0,n.visible=e,n.index=i)},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},i.onScrollBarChange=function(t){this.runCallLater(this.changeCells);var e=this._scrollBar.value,i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.floor(e/this._cellSize);if(this.cacheContent)s=n+1,this._createdLine-r<s&&(this._createItems(this._createdLine,i,this._createdLine+s),this.renderItems(this._createdLine*i,0),this._createdLine+=s);else{var a=r*i,s=0;if(a>this._startIndex){s=a-this._startIndex;var o=!0,l=this._startIndex+i*(n+1);this._isMoved=!0}else a<this._startIndex&&(s=this._startIndex-a,o=!1,l=this._startIndex-1,this._isMoved=!0);for(var h=0;h<s;h++){if(o){var u=this._cells.shift();this._cells[this._cells.length]=u;var c=l+h}else u=this._cells.pop(),this._cells.unshift(u),c=l-h;var d=Math.floor(c/i)*this._cellSize;this._isVertical?u.y=d:u.x=d,this.renderItem(u,c)}this._startIndex=a,this.changeSelectStatus()}var _=this._content.scrollRect;this._isVertical?(_.y=e-this._offset.y,_.x=-this._offset.x):(_.y=-this._offset.y,_.x=e-this._offset.x),this._content.scrollRect=_},i.posCell=function(t,e){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY,n=(this._isVertical?this.repeatY:this.repeatX,Math.floor(e/i)*this._cellSize);this._isVertical?t.y=n:t.x=n}},i.changeSelectStatus=function(){for(var t=0,e=this._cells.length;t<e;t++)this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)},i.renderItems=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=t,n=e||this._cells.length;i<n;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus()},i.renderItem=function(t,e){this._array&&0<=e&&e<this._array.length?(t.visible=!0,t._$bindData?(t._dataSource=this._array[e],this._bindData(t,this._array[e])):t.dataSource=this._array[e],this.cacheContent||this.posCell(t,e),this.hasListener("render")&&this.event("render",[t,e]),this.renderHandler&&this.renderHandler.runWith([t,e])):(t.visible=!1,t.dataSource=null)},i._bindData=function(t,e){for(var i=t._$bindData,n=0,r=i.length;n<r;n++){var a=i[n++],s=i[n++],o=i[n],l=gn.getBindFun(o);a[s]=l.call(this,e)}},i.refresh=function(){this.array=this._array},i.getItem=function(t){return-1<t&&t<this._array.length?this._array[t]:null},i.changeItem=function(t,e){-1<t&&t<this._array.length&&(this._array[t]=e,t>=this._startIndex&&t<this._startIndex+this._cells.length&&this.renderItem(this.getCell(t),t))},i.setItem=function(t,e){this.changeItem(t,e)},i.addItem=function(t){this._array.push(t),this.array=this._array},i.addItemAt=function(t,e){this._array.splice(e,0,t),this.array=this._array},i.deleteItem=function(t){this._array.splice(t,1),this.array=this._array},i.getCell=function(t){return this.runCallLater(this.changeCells),-1<t&&this._cells?this._cells[(t-this._startIndex)%this._cells.length]:null},i.scrollTo=function(t){if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/e)*this._cellSize}else this.startIndex=t},i.tweenTo=function(t,e,i){if(void 0===e&&(e=200),this._scrollBar){var n=this._isVertical?this.repeatX:this.repeatY;An.to(this._scrollBar,{value:Math.floor(t/n)*this._cellSize},e,null,i,0,!0)}else this.startIndex=t,i&&i.run()},i._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},i.commitMeasure=function(){this.runCallLater(this.changeCells)},v(0,i,"cacheAs",t.prototype._$get_cacheAs,function(t){S.superSet(eo,this,"cacheAs",t),this._scrollBar&&(this._$P.cacheAs=null,"none"!==t?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),v(0,i,"content",function(){return this._content}),v(0,i,"height",t.prototype._$get_height,function(t){t!=this._height&&(S.superSet(eo,this,"height",t),this._setCellChanged())}),v(0,i,"itemRender",function(){return this._itemRender},function(t){if(this._itemRender!=t){this._itemRender=t;for(var e=this._cells.length-1;-1<e;e--)this._cells[e].destroy();this._cells.length=0,this._setCellChanged()}}),v(0,i,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this._removePreScrollBar();var e=new fl;e.name="scrollBar",e.right=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()}),v(0,i,"page",function(){return this._page},function(t){this._page=t,this._array&&(this._page=0<t?t:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),v(0,i,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this._removePreScrollBar();var e=new dl;e.name="scrollBar",e.bottom=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()}),v(0,i,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(t){this._repeatX=t,this._setCellChanged()}),v(0,i,"scrollBar",function(){return this._scrollBar},function(t){this._scrollBar!=t&&(this._scrollBar=t)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),v(0,i,"width",t.prototype._$get_width,function(t){t!=this._width&&(S.superSet(eo,this,"width",t),this._setCellChanged())}),v(0,i,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(t){this._repeatY=t,this._setCellChanged()}),v(0,i,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,this._setCellChanged()}),v(0,i,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,this._setCellChanged()}),v(0,i,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(t),this.startIndex=this._startIndex)}),v(0,i,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(t){this.selectedIndex=this._array.indexOf(t)}),v(0,i,"length",function(){return this._array?this._array.length:0}),v(0,i,"selection",function(){return this.getCell(this._selectedIndex)},function(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)}),v(0,i,"startIndex",function(){return this._startIndex},function(t){this._startIndex=0<t?t:0,this.callLater(this.renderItems)}),v(0,i,"array",function(){return this._array},function(t){this.runCallLater(this.changeCells),this._array=t||[];var e=this._array.length;if(this.totalPage=Math.ceil(e/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<e?this._selectedIndex:e-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.ceil(e/i),a=0<this._cellOffset?this.totalPage+1:this.totalPage;this._scrollBar.target=(1<a?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=n/r,this._scrollBar.setScroll(0,(r-n)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._content)}}),v(0,i,"dataSource",t.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.array=t:S.superSet(eo,this,"dataSource",t)}),v(0,i,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),e}(eo),Fo=function(e){function Rt(t){Rt.__super.call(this),this._render=new La(this),this._render.on("materialchanged",this,this._onMaterialChanged),this._geometryFilter=new Da(this),this._createRenderElement(0),t&&(this._render.sharedMaterial=t)}E(Rt,"laya.d3.core.particleShuriKen.ShuriKenParticle3D",e);var t=Rt.prototype;return t._initParticleVelocity=function(t){for(var e=new F,i=t.velocitys,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},t._initParticleColor=function(t){var e=new N,i=t.alphas,n=0,r=0;for(n=0,r=i.length;n<r;n++){var a=i[n];e.addAlpha(a.key,a.value)}var s=t.rgbs;for(n=0,r=s.length;n<r;n++){var o=s[n],l=o.value;e.addRGB(o.key,new we(l[0],l[1],l[2]))}return e},t._initParticleSize=function(t){for(var e=new F,i=t.sizes,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},t._initParticleRotation=function(t){for(var e=new F,i=t.angularVelocitys,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value/180*Math.PI)}return e},t._initParticleFrame=function(t){for(var e=new P,i=t.frames,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},t._createRenderElement=function(t){var e=this._render._renderElements[t]=new X;e._render=this._render;var i=this._render.sharedMaterials[t];i||(i=_s.defaultMaterial);var n=this._geometryFilter;e._mainSortID=0,e._sprite3D=this,e.renderObj=n,e._material=i},t._onMaterialChanged=function(t,e,i){var n=t._renderElements;e<n.length&&(n[e]._material=i||_s.defaultMaterial)},t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},t._parseCustomProps=function(t,e,i,n){var r,a=Math.PI/180,s=0,o=0,l=this.particleRender,h=i.material;if(h)r=kr.getRes(e[h.path]);else{var u=i.materialPath;u?r=kr.getRes(e[u]):(r=new _s).diffuseTexture=e?kr.getRes(e[i.texturePath]):Gs.load(i.texturePath)}l.sharedMaterial=r;var c=i.meshPath;c&&(l.mesh=kr.getRes(e[c])),l.renderMode=i.renderMode,l.stretchedBillboardCameraSpeedScale=i.stretchedBillboardCameraSpeedScale,l.stretchedBillboardSpeedScale=i.stretchedBillboardSpeedScale,l.stretchedBillboardLengthScale=i.stretchedBillboardLengthScale,l.sortingFudge=i.sortingFudge?i.sortingFudge:0;var d=this.particleSystem;d.isPerformanceMode=i.isPerformanceMode,d.duration=i.duration,d.looping=i.looping,d.prewarm=i.prewarm,d.startDelayType=i.startDelayType,d.startDelay=i.startDelay,d.startDelayMin=i.startDelayMin,d.startDelayMax=i.startDelayMax,d.startLifetimeType=i.startLifetimeType,d.startLifetimeConstant=i.startLifetimeConstant,d.startLifeTimeGradient=Rt._initStartLife(i.startLifetimeGradient),d.startLifetimeConstantMin=i.startLifetimeConstantMin,d.startLifetimeConstantMax=i.startLifetimeConstantMax,d.startLifeTimeGradientMin=Rt._initStartLife(i.startLifetimeGradientMin),d.startLifeTimeGradientMax=Rt._initStartLife(i.startLifetimeGradientMax),d.startSpeedType=i.startSpeedType,d.startSpeedConstant=i.startSpeedConstant,d.startSpeedConstantMin=i.startSpeedConstantMin,d.startSpeedConstantMax=i.startSpeedConstantMax,d.threeDStartSize=i.threeDStartSize,d.startSizeType=i.startSizeType,d.startSizeConstant=i.startSizeConstant;var _=i.startSizeConstantSeparate,f=d.startSizeConstantSeparate.elements;f[0]=_[0],f[1]=_[1],f[2]=_[2],d.startSizeConstantMin=i.startSizeConstantMin,d.startSizeConstantMax=i.startSizeConstantMax;var m=i.startSizeConstantMinSeparate,p=d.startSizeConstantMinSeparate.elements;p[0]=m[0],p[1]=m[1],p[2]=m[2];var g=i.startSizeConstantMaxSeparate,v=d.startSizeConstantMaxSeparate.elements;v[0]=g[0],v[1]=g[1],v[2]=g[2],d.threeDStartRotation=i.threeDStartRotation,d.startRotationType=i.startRotationType,d.startRotationConstant=i.startRotationConstant*a;var y=i.startRotationConstantSeparate,x=d.startRotationConstantSeparate.elements;x[0]=y[0]*a,x[1]=y[1]*a,x[2]=y[2]*a,d.startRotationConstantMin=i.startRotationConstantMin*a,d.startRotationConstantMax=i.startRotationConstantMax*a;var b=i.startRotationConstantMinSeparate,T=d.startRotationConstantMinSeparate.elements;T[0]=b[0]*a,T[1]=b[1]*a,T[2]=b[2]*a;var S=i.startRotationConstantMaxSeparate,E=d.startRotationConstantMaxSeparate.elements;E[0]=S[0]*a,E[1]=S[1]*a,E[2]=S[2]*a,d.randomizeRotationDirection=i.randomizeRotationDirection,d.startColorType=i.startColorType;var R=i.startColorConstant,w=d.startColorConstant.elements;w[0]=R[0],w[1]=R[1],w[2]=R[2],w[3]=R[3];var C=i.startColorConstantMin,I=d.startColorConstantMin.elements;I[0]=C[0],I[1]=C[1],I[2]=C[2],I[3]=C[3];var M=i.startColorConstantMax,A=d.startColorConstantMax.elements;A[0]=M[0],A[1]=M[1],A[2]=M[2],A[3]=M[3],d.gravityModifier=i.gravityModifier,d.simulationSpace=i.simulationSpace,d.scaleMode=i.scaleMode,d.playOnAwake=i.playOnAwake,d.maxParticles=i.maxParticles;var D=i.autoRandomSeed;null!=D&&(d.autoRandomSeed=D);var L=i.randomSeed;null!=L&&(d.randomSeed[0]=L);var V=i.emission,N=d.emission;if(V){N.emissionRate=V.emissionRate;var P=V.bursts;if(P)for(s=0,o=P.length;s<o;s++){var F=P[s];N.addBurst(new wt(F.time,F.min,F.max))}N.enbale=V.enable}else N.enbale=!1;var O=i.shape;if(O){var B;switch(O.shapeType){case 0:var G;B=G=new Vr,G.radius=O.sphereRadius,G.emitFromShell=O.sphereEmitFromShell,G.randomDirection=O.sphereRandomDirection;break;case 1:var W;B=W=new Lr,W.radius=O.hemiSphereRadius,W.emitFromShell=O.hemiSphereEmitFromShell,W.randomDirection=O.hemiSphereRandomDirection;break;case 2:var U;B=U=new Dr,U.angle=O.coneAngle*a,U.radius=O.coneRadius,U.length=O.coneLength,U.emitType=O.coneEmitType,U.randomDirection=O.coneRandomDirection;break;case 3:var Z;B=Z=new Mr,Z.x=O.boxX,Z.y=O.boxY,Z.z=O.boxZ,Z.randomDirection=O.boxRandomDirection;break;case 7:var k;B=k=new Ar,k.radius=O.circleRadius,k.arc=O.circleArc*a,k.emitFromEdge=O.circleEmitFromEdge,k.randomDirection=O.circleRandomDirection;break;default:var H;B=H=new Ar,H.radius=O.circleRadius,H.arc=O.circleArc*a,H.emitFromEdge=O.circleEmitFromEdge,H.randomDirection=O.circleRandomDirection}B.enable=O.enable,d.shape=B}var X=i.velocityOverLifetime;if(X){var Y,z=X.velocity;switch(z.type){case 0:var j=z.constant;Y=Lt.createByConstant(new we(j[0],j[1],j[2]));break;case 1:Y=Lt.createByGradient(this._initParticleVelocity(z.gradientX),this._initParticleVelocity(z.gradientY),this._initParticleVelocity(z.gradientZ));break;case 2:var J=z.constantMin,K=z.constantMax;Y=Lt.createByRandomTwoConstant(new we(J[0],J[1],J[2]),new we(K[0],K[1],K[2]));break;case 3:Y=Lt.createByRandomTwoGradient(this._initParticleVelocity(z.gradientXMin),this._initParticleVelocity(z.gradientXMax),this._initParticleVelocity(z.gradientYMin),this._initParticleVelocity(z.gradientYMax),this._initParticleVelocity(z.gradientZMin),this._initParticleVelocity(z.gradientZMax))}var Q=new Ot(Y);Q.space=X.space,Q.enbale=X.enable,d.velocityOverLifetime=Q}var q=i.colorOverLifetime;if(q){var $,tt=q.color;switch(tt.type){case 0:var et=tt.constant;$=At.createByConstant(new Ce(et[0],et[1],et[2],et[3]));break;case 1:$=At.createByGradient(this._initParticleColor(tt.gradient));break;case 2:var it=tt.constantMin,nt=tt.constantMax;$=At.createByRandomTwoConstant(new Ce(it[0],it[1],it[2],it[3]),new Ce(nt[0],nt[1],nt[2],nt[3]));break;case 3:$=At.createByRandomTwoGradient(this._initParticleColor(tt.gradientMin),this._initParticleColor(tt.gradientMax))}var rt=new Ct($);rt.enbale=q.enable,d.colorOverLifetime=rt}var at=i.sizeOverLifetime;if(at){var st,ot=at.size;switch(ot.type){case 0:st=ot.separateAxes?Dt.createByGradientSeparate(this._initParticleSize(ot.gradientX),this._initParticleSize(ot.gradientY),this._initParticleSize(ot.gradientZ)):Dt.createByGradient(this._initParticleSize(ot.gradient));break;case 1:if(ot.separateAxes){var lt=ot.constantMinSeparate,ht=ot.constantMaxSeparate;st=Dt.createByRandomTwoConstantSeparate(new we(lt[0],lt[1],lt[2]),new we(ht[0],ht[1],ht[2]))}else st=Dt.createByRandomTwoConstant(ot.constantMin,ot.constantMax);break;case 2:st=ot.separateAxes?Dt.createByRandomTwoGradientSeparate(this._initParticleSize(ot.gradientXMin),this._initParticleSize(ot.gradientYMin),this._initParticleSize(ot.gradientZMin),this._initParticleSize(ot.gradientXMax),this._initParticleSize(ot.gradientYMax),this._initParticleSize(ot.gradientZMax)):Dt.createByRandomTwoGradient(this._initParticleSize(ot.gradientMin),this._initParticleSize(ot.gradientMax))}var ut=new Nt(st);ut.enbale=at.enable,d.sizeOverLifetime=ut}var ct=i.rotationOverLifetime;if(ct){var dt,_t=ct.angularVelocity;switch(_t.type){case 0:_t.separateAxes||(dt=Mt.createByConstant(_t.constant*a));break;case 1:_t.separateAxes||(dt=Mt.createByGradient(this._initParticleRotation(_t.gradient)));break;case 2:if(_t.separateAxes){var ft=_t.constantMinSeparate,mt=_t.constantMaxSeparate;dt=Mt.createByRandomTwoConstantSeparate(new we(ft[0]*a,ft[1]*a,ft[2]*a),new we(mt[0]*a,mt[1]*a,mt[2]*a))}else dt=Mt.createByRandomTwoConstant(_t.constantMin*a,_t.constantMax*a);break;case 3:_t.separateAxes||(dt=Mt.createByRandomTwoGradient(this._initParticleRotation(_t.gradientMin),this._initParticleRotation(_t.gradientMax)))}var pt=new Vt(dt);pt.enbale=ct.enable,d.rotationOverLifetime=pt}var gt=i.textureSheetAnimation;if(gt){var vt,yt=gt.frame;switch(yt.type){case 0:vt=It.createByConstant(yt.constant);break;case 1:vt=It.createByOverTime(this._initParticleFrame(yt.overTime));break;case 2:vt=It.createByRandomTwoConstant(yt.constantMin,yt.constantMax);break;case 3:vt=It.createByRandomTwoOverTime(this._initParticleFrame(yt.overTimeMin),this._initParticleFrame(yt.overTimeMax))}var xt,bt=gt.startFrame;switch(bt.type){case 0:xt=Pt.createByConstant(bt.constant);break;case 1:xt=Pt.createByRandomTwoConstant(bt.constantMin,bt.constantMax)}var Tt=new Ft(vt,xt);Tt.enable=gt.enable;var St=gt.tiles;Tt.tiles=new Re(St[0],St[1]),Tt.type=gt.type,Tt.randomRow=gt.randomRow;var Et=gt.rowIndex;void 0!==Et&&(Tt.rowIndex=Et),Tt.cycles=gt.cycles,d.textureSheetAnimation=Tt}},t._activeHierarchy=function(){laya.d3.core.Sprite3D.prototype._activeHierarchy.call(this),this.particleSystem.playOnAwake&&this.particleSystem.play()},t._inActiveHierarchy=function(){laya.d3.core.Sprite3D.prototype._inActiveHierarchy.call(this),this.particleSystem.isAlive&&this.particleSystem.simulate(0,!0)},t.cloneTo=function(t){var e=t,i=e._geometryFilter;this._geometryFilter.cloneTo(i);var n=e._render,r=this._render;n.sharedMaterials=r.sharedMaterials,n.enable=r.enable,n.renderMode=r.renderMode,n.mesh=r.mesh,n.stretchedBillboardCameraSpeedScale=r.stretchedBillboardCameraSpeedScale,n.stretchedBillboardSpeedScale=r.stretchedBillboardSpeedScale,n.stretchedBillboardLengthScale=r.stretchedBillboardLengthScale,n.sortingFudge=r.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy(),this._geometryFilter=null)},v(0,t,"particleSystem",function(){return this._geometryFilter}),v(0,t,"particleRender",function(){return this._render}),Rt.__init__=function(){Rt.SHADERDEFINE_RENDERMODE_BILLBOARD=Rt.shaderDefines.registerDefine("SPHERHBILLBOARD"),Rt.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=Rt.shaderDefines.registerDefine("STRETCHEDBILLBOARD"),Rt.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=Rt.shaderDefines.registerDefine("HORIZONTALBILLBOARD"),Rt.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=Rt.shaderDefines.registerDefine("VERTICALBILLBOARD"),Rt.SHADERDEFINE_COLOROVERLIFETIME=Rt.shaderDefines.registerDefine("COLOROVERLIFETIME"),Rt.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=Rt.shaderDefines.registerDefine("RANDOMCOLOROVERLIFETIME"),Rt.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=Rt.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECONSTANT"),Rt.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=Rt.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECURVE"),Rt.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=Rt.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),Rt.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=Rt.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),Rt.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=Rt.shaderDefines.registerDefine("TEXTURESHEETANIMATIONCURVE"),Rt.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=Rt.shaderDefines.registerDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),Rt.SHADERDEFINE_ROTATIONOVERLIFETIME=Rt.shaderDefines.registerDefine("ROTATIONOVERLIFETIME"),Rt.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=Rt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMESEPERATE"),Rt.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=Rt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECONSTANT"),Rt.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=Rt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECURVE"),Rt.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=Rt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),Rt.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=Rt.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),Rt.SHADERDEFINE_SIZEOVERLIFETIMECURVE=Rt.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVE"),Rt.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=Rt.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVESEPERATE"),Rt.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=Rt.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVES"),Rt.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=Rt.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),Rt.SHADERDEFINE_RENDERMODE_MESH=Rt.shaderDefines.registerDefine("RENDERMODE_MESH"),Rt.SHADERDEFINE_SHAPE=Rt.shaderDefines.registerDefine("SHAPE")},Rt.load=function(t){return S.loader.create(t,null,null,Rt)},Rt._initStartLife=function(t){for(var e=new F,i=t.startLifetimes,n=0,r=i.length;n<r;n++){var a=i[n];e.add(a.key,a.value)}return e},Rt.SHADERDEFINE_RENDERMODE_BILLBOARD=0,Rt.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=0,Rt.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=0,Rt.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=0,Rt.SHADERDEFINE_COLOROVERLIFETIME=0,Rt.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=0,Rt.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=0,Rt.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=0,Rt.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=0,Rt.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=0,Rt.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=0,Rt.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=0,Rt.SHADERDEFINE_ROTATIONOVERLIFETIME=0,Rt.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=0,Rt.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=0,Rt.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=0,Rt.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=0,Rt.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=0,Rt.SHADERDEFINE_SIZEOVERLIFETIMECURVE=0,Rt.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=0,Rt.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=0,Rt.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=0,Rt.SHADERDEFINE_RENDERMODE_MESH=0,Rt.SHADERDEFINE_SHAPE=0,Rt.WORLDPOSITION=0,Rt.WORLDROTATION=1,Rt.POSITIONSCALE=4,Rt.SIZESCALE=5,Rt.SCALINGMODE=6,Rt.GRAVITY=7,Rt.THREEDSTARTROTATION=8,Rt.STRETCHEDBILLBOARDLENGTHSCALE=9,Rt.STRETCHEDBILLBOARDSPEEDSCALE=10,Rt.SIMULATIONSPACE=11,Rt.CURRENTTIME=12,Rt.VOLVELOCITYCONST=13,Rt.VOLVELOCITYGRADIENTX=14,Rt.VOLVELOCITYGRADIENTY=15,Rt.VOLVELOCITYGRADIENTZ=16,Rt.VOLVELOCITYCONSTMAX=17,Rt.VOLVELOCITYGRADIENTXMAX=18,Rt.VOLVELOCITYGRADIENTYMAX=19,Rt.VOLVELOCITYGRADIENTZMAX=20,Rt.VOLSPACETYPE=21,Rt.COLOROVERLIFEGRADIENTALPHAS=22,Rt.COLOROVERLIFEGRADIENTCOLORS=23,Rt.MAXCOLOROVERLIFEGRADIENTALPHAS=24,Rt.MAXCOLOROVERLIFEGRADIENTCOLORS=25,Rt.SOLSIZEGRADIENT=26,Rt.SOLSIZEGRADIENTX=27,Rt.SOLSIZEGRADIENTY=28,Rt.SOLSizeGradientZ=29,Rt.SOLSizeGradientMax=30,Rt.SOLSIZEGRADIENTXMAX=31,Rt.SOLSIZEGRADIENTYMAX=32,Rt.SOLSizeGradientZMAX=33,Rt.ROLANGULARVELOCITYCONST=34,Rt.ROLANGULARVELOCITYCONSTSEPRARATE=35,Rt.ROLANGULARVELOCITYGRADIENT=36,Rt.ROLANGULARVELOCITYGRADIENTX=37,Rt.ROLANGULARVELOCITYGRADIENTY=38,Rt.ROLANGULARVELOCITYGRADIENTZ=39,Rt.ROLANGULARVELOCITYGRADIENTW=40,Rt.ROLANGULARVELOCITYCONSTMAX=41,Rt.ROLANGULARVELOCITYCONSTMAXSEPRARATE=42,Rt.ROLANGULARVELOCITYGRADIENTMAX=43,Rt.ROLANGULARVELOCITYGRADIENTXMAX=44,Rt.ROLANGULARVELOCITYGRADIENTYMAX=45,Rt.ROLANGULARVELOCITYGRADIENTZMAX=46,Rt.ROLANGULARVELOCITYGRADIENTWMAX=47,Rt.TEXTURESHEETANIMATIONCYCLES=48,Rt.TEXTURESHEETANIMATIONSUBUVLENGTH=49,Rt.TEXTURESHEETANIMATIONGRADIENTUVS=50,Rt.TEXTURESHEETANIMATIONGRADIENTMAXUVS=51,m(Rt,["shaderDefines",function(){return this.shaderDefines=new De(ao.shaderDefines)}]),Rt}(ao),Oo=function(t){function e(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,e.__super.call(this),this.width=this.height=200}E(e,"laya.ui.Tree",t);var i=e.prototype;return S.imps(i,{"laya.ui.IRender":!0}),i.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._list&&this._list.destroy(t),this._list=null,this._source=null,this._renderHandler=null},i.createChildren=function(){this.addChild(this._list=new Po),this._list.renderHandler=C.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},i.onListChange=function(t){this.event("change")},i.getArray=function(){var t,e=[];for(var i in this._source)t=this._source[i],this.getParentOpenStatus(t)&&(t.x=this._spaceLeft*this.getDepth(t),e.push(t));return e},i.getDepth=function(t,e){return void 0===e&&(e=0),null==t.nodeParent?e:this.getDepth(t.nodeParent,e+1)},i.getParentOpenStatus=function(t){var e=t.nodeParent;return null==e||!!e.isOpen&&(null==e.nodeParent||this.getParentOpenStatus(e))},i.renderItem=function(t,e){var i=t.dataSource;if(i){t.left=i.x;var n=t.getChildByName("arrow");n&&(i.hasChild?(n.visible=!0,n.index=i.isOpen?1:0,n.tag=e,n.off("click",this,this.onArrowClick),n.on("click",this,this.onArrowClick)):n.visible=!1);var r=t.getChildByName("folder");r&&(2==r.clipY?r.index=i.isDirectory?0:1:r.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([t,e])}},i.onArrowClick=function(t){var e=t.currentTarget.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen,this.event("open"),this._list.array=this.getArray()},i.setItemState=function(t,e){this._list.array[t]&&(this._list.array[t].isOpen=e,this._list.array=this.getArray())},i.fresh=function(){this._list.array=this.getArray(),this.repaint()},i.parseXml=function(t,e,i,n){var r,a=t.childNodes,s=a.length;if(!n){r={};var o,l=t.attributes;for(var h in l){var u=(o=l[h]).nodeName,c=o.nodeValue;r[u]="true"==c||"false"!=c&&c}r.nodeParent=i,0<s&&(r.isDirectory=!0),r.hasChild=0<s,e.push(r)}for(var d=0;d<s;d++){var _=a[d];this.parseXml(_,e,r,!1)}},i.parseOpenStatus=function(t,e){for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.isDirectory)for(var a=0,s=t.length;a<s;a++){var o=t[a];if(o.isDirectory&&this.isSameParent(o,r)&&r.label==o.label){r.isOpen=o.isOpen;break}}}},i.isSameParent=function(t,e){return null==t.nodeParent&&null==e.nodeParent||null!=t.nodeParent&&null!=e.nodeParent&&(t.nodeParent.label==e.nodeParent.label&&this.isSameParent(t.nodeParent,e.nodeParent))},i.filter=function(t){if(Boolean(t)){var e=[];this.getFilterSource(this._source,e,t),this._list.array=e}else this._list.array=this.getArray()},i.getFilterSource=function(t,e,i){var n;for(var r in i=i.toLocaleLowerCase(),t)!(n=t[r]).isDirectory&&-1<String(n.label).toLowerCase().indexOf(i)&&(n.x=0,e.push(n)),n.child&&0<n.child.length&&this.getFilterSource(n.child,e,i)},v(0,i,"spaceBottom",function(){return this._list.spaceY},function(t){this._list.spaceY=t}),v(0,i,"keepStatus",function(){return this._keepStatus},function(t){this._keepStatus=t}),v(0,i,"itemRender",function(){return this._list.itemRender},function(t){this._list.itemRender=t}),v(0,i,"array",function(){return this._list.array},function(t){this._keepStatus&&this._list.array&&t&&this.parseOpenStatus(this._list.array,t),this._source=t,this._list.array=this.getArray()}),v(0,i,"mouseHandler",function(){return this._list.mouseHandler},function(t){this._list.mouseHandler=t}),v(0,i,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,S.superSet(eo,this,"dataSource",t)}),v(0,i,"source",function(){return this._source}),v(0,i,"scrollBar",function(){return this._list.scrollBar}),v(0,i,"list",function(){return this._list}),v(0,i,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(t){this._list.vScrollBarSkin=t}),v(0,i,"renderHandler",function(){return this._renderHandler},function(t){this._renderHandler=t}),v(0,i,"selectedIndex",function(){return this._list.selectedIndex},function(t){this._list.selectedIndex=t}),v(0,i,"spaceLeft",function(){return this._spaceLeft},function(t){this._spaceLeft=t}),v(0,i,"selectedItem",function(){return this._list.selectedItem},function(t){this._list.selectedItem=t}),v(0,i,"width",t.prototype._$get_width,function(t){S.superSet(eo,this,"width",t),this._list.width=t}),v(0,i,"height",t.prototype._$get_height,function(t){S.superSet(eo,this,"height",t),this._list.height=t}),v(0,i,"xml",null,function(t){var e=[];this.parseXml(t.childNodes[0],e,null,!0),this.array=e}),v(0,i,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),e}(eo),Bo=function(e){function i(t,e){this._subMeshOffset=null,i.__super.call(this,e),this._subMeshOffset=[],this._geometryFilter=new Ma(this),this._render=new Cs(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),t&&(this._geometryFilter.sharedMesh=t)}E(i,"laya.d3.core.SkinnedMeshSprite3D",e);var t=i.prototype;return t._changeRenderObjectByMesh=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new Nr),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=us.defaultMaterial);var r=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(r,n),i._sprite3D=this,i.renderObj=r,i._material=n,i},t._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements[t];e||(e=us.defaultMaterial);var n=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(n,e),i._sprite3D=this,i.renderObj=n,i._material=e,i},t._changeRenderObjectsByMesh=function(){var t=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=t;for(var e=0;e<t;e++)this._changeRenderObjectByMesh(e)},t._onMeshChanged=function(t){var e=t.sharedMesh;e.loaded?this._changeRenderObjectsByMesh():e.once("loaded",this,this._changeRenderObjectsByMesh)},t._onMaterialChanged=function(t,e,i){e<this._render._renderElements.length&&this._changeRenderObjectByMaterial(e,i)},t._parseCustomProps=function(t,e,i,n){var r=this.skinnedMeshRender,a=i.lightmapIndex;null!=a&&(r.lightmapIndex=a);var s,o,l=i.lightmapScaleOffset;if(l&&(r.lightmapScaleOffset=new Ce(l[0],l[1],l[2],l[3])),n.instanceParams)(s=n.instanceParams.loadPath)&&(o=kr.getRes(e[s]),(this.meshFilter.sharedMesh=o).loaded?r.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(s=i.meshPath)&&(o=kr.getRes(e[s]),this.meshFilter.sharedMesh=o);var h=i.materials;if(h){var u=r.sharedMaterials,c=h.length;u.length=c;for(var d=0;d<c;d++)u[d]=kr.getRes(e[h[d].path]);r.sharedMaterials=u}var _=i.rootBone;_&&r._setRootBone(_);var f=i.boundBox;if(f){var m=f.min,p=f.max,g=new _e(new we(m[0],m[1],m[2]),new we(p[0],p[1],p[2]));r.localBoundBox=g}else r._hasIndependentBound=!1;var v=i.boundSphere;if(v){var y=v.center,x=new me(new we(y[0],y[1],y[2]),v.radius);r.localBoundSphere=x}}},t._changeHierarchyAnimator=function(t){if(t){var e=this.skinnedMeshRender;e._setCacheAnimator(t);var i=t.avatar;i&&e._setCacheAvatar(i)}laya.d3.core.Sprite3D.prototype._changeHierarchyAnimator.call(this,t)},t._clearSelfRenderObjects=function(){this._scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this._scene.addFrustumCullingObject(this._render)},t._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},t.cloneTo=function(t){var e=t;e._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,n._rootBone=i._rootBone;var a=i.localBoundSphere;a&&(n.localBoundSphere=a.clone());var s=i.localBoundBox;s&&(n.localBoundBox=s.clone()),n._hasIndependentBound=i._hasIndependentBound,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy())},v(0,t,"meshFilter",function(){return this._geometryFilter}),v(0,t,"skinnedMeshRender",function(){return this._render}),i.__init__=function(){i.SHADERDEFINE_BONE=i.shaderDefines.registerDefine("BONE")},i.load=function(t){return S.loader.create(t,null,null,i)},i.SHADERDEFINE_BONE=8,i.BONES=0,m(i,["shaderDefines",function(){return this.shaderDefines=new De(ao.shaderDefines)}]),i}(ao),Go=function(e){function t(){t.__super.call(this),this._geometryFilter=new Na(this),this._render=new Fa(this),this._changeRenderObjectsByMaterial(this._render,0,gs.defaultMaterial),this._render.on("materialchanged",this,this._changeRenderObjectsByMaterial),this._geometryFilter.on("trailfilterchange",this,this._changeRenderObjectsByRenderElement)}E(t,"laya.d3.core.trail.TrailSprite3D",e);var i=t.prototype;return i._changeRenderObjectsByMaterial=function(t,e,i){var n=this._geometryFilter.getRenderElementsCount();this._render._renderElements.length=n;for(var r=0;r<n;r++)this._changeRenderObjectByMaterial(r,i)},i._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements;e||(e=gs.defaultMaterial);var n=i[t];n||(n=i[t]=new X),n._sprite3D=this,n.renderObj=this._geometryFilter.getRenderElement(t),n._render=this._render,n._material=e},i._changeRenderObjectsByRenderElement=function(t,e){var i=this._render._renderElements,n=i[t];n||(n=i[t]=new X),n._sprite3D=this,n.renderObj=e,n._render=this._render,n._material=this._render.sharedMaterial},i._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},i._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},i._update=function(t){e.prototype._update.call(this,t),this._geometryFilter._update(t)},i._parseCustomProps=function(t,e,i,n){var r=this._render,a=this._geometryFilter,s=0,o=0,l=i.materials;if(l){var h=r.sharedMaterials,u=l.length;for(h.length=u,s=0;s<u;s++)h[s]=kr.getRes(e[l[s].path]);r.sharedMaterials=h}var c=n.props;a.time=c.time,a.minVertexDistance=c.minVertexDistance,a.widthMultiplier=c.widthMultiplier,a.textureMode=c.textureMode;var d=[],_=i.widthCurve;for(s=0,o=_.length;s<o;s++){var f=new $;f.time=_[s].time,f.inTangent=_[s].inTangent,f.outTangent=_[s].outTangent,f.value=_[s].value,d.push(f)}a.widthCurve=d;var m=i.colorGradient,p=new K;p.mode=m.mode;var g,v,y=[],x=m.colorKeys;for(s=0,o=x.length;s<o;s++)v=x[s],g=new q(new J(v.value[0],v.value[1],v.value[2],1),v.time),y.push(g);var b,T,S=[],E=m.alphaKeys;for(s=0,o=E.length;s<o;s++)T=E[s],b=new Q(T.value,T.time),S.push(b);p.setKeys(y,S),a.colorGradient=p},i.reset=function(){this.trailFilter.reset()},i.cloneTo=function(t){laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t);var e,i=0,n=t,r=n.trailFilter;r.time=this.trailFilter.time,r.minVertexDistance=this.trailFilter.minVertexDistance,r.widthMultiplier=this.trailFilter.widthMultiplier;var a=this.trailFilter.widthCurve,s=[];for(i=0,e=a.length;i<e;i++){var o=new $;a[i].cloneTo(o),s.push(o)}r.widthCurve=s;var l=new K;this.trailFilter.colorGradient.cloneTo(l),r.colorGradient=l,r.textureMode=this.trailFilter.textureMode,n.trailRender.sharedMaterial=this.trailRender.sharedMaterial},i.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy(),this._geometryFilter=null)},v(0,i,"trailFilter",function(){return this._geometryFilter}),v(0,i,"trailRender",function(){return this._render}),t.__init__=function(){t.SHADERDEFINE_GRADIENTMODE_BLEND=t.shaderDefines.registerDefine("GRADIENTMODE_BLEND")},t.CURTIME=3,t.LIFETIME=4,t.WIDTHCURVE=5,t.WIDTHCURVEKEYLENGTH=6,t.GRADIENTCOLORKEY=7,t.GRADIENTALPHAKEY=8,t.SHADERDEFINE_GRADIENTMODE_BLEND=0,m(t,["shaderDefines",function(){return this.shaderDefines=new De(ao.shaderDefines)}]),t}(ao),Wo=function(e){function l(t,e,i,n,r,a,s,o){l.__super.call(this,o),this._geometryFilter=new Wa(this,t,e,i,n,r,a,s),this._render=new Ua(this)}E(l,"laya.d3.terrain.TerrainChunk",e);var t=l.prototype;return t.buildRenderElementAndMaterial=function(t,e,i,n,r,a,s,o,l,h,u,c,d,_,f,m,p,g){void 0===u&&(u=1),void 0===c&&(c=1),void 0===d&&(d=1),void 0===_&&(_=1),void 0===f&&(f=1),void 0===m&&(m=1),void 0===p&&(p=1),void 0===g&&(g=1);var v=new cs;l&&(v.diffuseColor=l),o&&(v.ambientColor=o),h&&(v.specularColor=h),v.splatAlphaTexture=kr.getRes(i),v.normalTexture=e?kr.getRes(e):null,v.diffuseTexture1=n?kr.getRes(n):null,v.diffuseTexture2=r?kr.getRes(r):null,v.diffuseTexture3=a?kr.getRes(a):null,v.diffuseTexture4=s?kr.getRes(s):null,v.setDiffuseScale1(u,c),v.setDiffuseScale2(d,_),v.setDiffuseScale3(f,m),v.setDiffuseScale4(p,g),v.setDetailNum(t),0!=this._render._renderElements.length&&(v.renderMode=2);var y=new X;y._mainSortID=0,y._sprite3D=this,y.renderObj=this._geometryFilter,y._material=v,this._render._materials.push(v),this._render._renderElements.push(y)},t._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},t._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},t._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},t.cloneTo=function(t){console.log("Terrain Chunk can't clone")},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter._destroy())},v(0,t,"terrainFilter",function(){return this._geometryFilter}),v(0,t,"terrainRender",function(){return this._render}),l.load=function(t){return S.loader.create(t,null,null,l,null,1,!1)},l}(ao),Uo=function(t){function e(){this._space=0,this._align="none",this._itemChanged=!1,e.__super.call(this)}E(e,"laya.ui.LayoutBox",eo);var i=e.prototype;return i.addChild=function(t){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,t)},i.onResize=function(t){this._setItemChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,t,e)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,t)},i.refresh=function(){this._setItemChanged()},i.changeItems=function(){this._itemChanged=!1},i.sortItem=function(t){t&&t.sort(function(t,e){return t.y-e.y})},i._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},v(0,i,"space",function(){return this._space},function(t){this._space=t,this._setItemChanged()}),v(0,i,"align",function(){return this._align},function(t){this._align=t,this._setItemChanged()}),e}(),Zo=function(t){function e(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,e.__super.call(this),this.width=this.height=100}E(e,"laya.ui.Panel",t);var i=e.prototype;return i.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._content&&this._content.destroy(t),this._vScrollBar&&this._vScrollBar.destroy(t),this._hScrollBar&&this._hScrollBar.destroy(t),this._vScrollBar=null,this._hScrollBar=null,this._content=null},i.destroyChildren=function(){this._content.destroyChildren()},i.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new eo)},i.addChild=function(t){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(t)},i.onResize=function(){this._setScrollChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(t)},i.removeChildren=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=2147483647),this._content.removeChildren(t,e),this._setScrollChanged(),this},i.getChildAt=function(t){return this._content.getChildAt(t)},i.getChildByName=function(t){return this._content.getChildByName(t)},i.getChildIndex=function(t){return this._content.getChildIndex(t)},i.changeScroll=function(){this._scrollChanged=!1;var t=this.contentWidth||1,e=this.contentHeight||1,i=this._vScrollBar,n=this._hScrollBar,r=i&&e>this._height,a=n&&t>this._width,s=r?this._width-i.width:this._width,o=a?this._height-n.height:this._height;i&&(i.x=this._width-i.width,i.y=0,i.height=this._height-(a?n.height:0),i.scrollSize=Math.max(.033*this._height,1),i.thumbPercent=o/e,i.setScroll(0,e-o,i.value)),n&&(n.x=0,n.y=this._height-n.height,n.width=this._width-(r?i.width:0),n.scrollSize=Math.max(.033*this._width,1),n.thumbPercent=s/t,n.setScroll(0,t-s,n.value))},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},i.setContentSize=function(t,e){var i=this._content;i.width=t,i.height=e,i.scrollRect||(i.scrollRect=new nn),i.scrollRect.setTo(0,0,t,e),i.scrollRect=i.scrollRect},i.onScrollBarChange=function(t){var e=this._content.scrollRect;if(e){var i=Math.round(t.value);t.isVertical?e.y=i:e.x=i,this._content.scrollRect=e}},i.scrollTo=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.vScrollBar&&(this.vScrollBar.value=e),this.hScrollBar&&(this.hScrollBar.value=t)},i.refresh=function(){this.changeScroll()},i.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=S.superGet(eo,this,"cacheAs")),S.superSet(eo,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){S.superSet(eo,this,"cacheAs",this._$P.cacheAs)},i._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},v(0,i,"numChildren",function(){return this._content.numChildren}),v(0,i,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new dl),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=t}),v(0,i,"contentWidth",function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i.x+i.width*i.scaleX,t)}return t}),v(0,i,"contentHeight",function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i.y+i.height*i.scaleY,t)}return t}),v(0,i,"width",t.prototype._$get_width,function(t){S.superSet(eo,this,"width",t),this._setScrollChanged()}),v(0,i,"hScrollBar",function(){return this._hScrollBar}),v(0,i,"content",function(){return this._content}),v(0,i,"height",t.prototype._$get_height,function(t){S.superSet(eo,this,"height",t),this._setScrollChanged()}),v(0,i,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new fl),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=t}),v(0,i,"vScrollBar",function(){return this._vScrollBar}),v(0,i,"cacheAs",t.prototype._$get_cacheAs,function(t){S.superSet(eo,this,"cacheAs",t),this._$P.cacheAs=null,"none"!==t?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),e}(eo),ko=function(t){function i(t,e){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,i.__super.call(this),this.skin=e,this.labels=t}E(i,"laya.ui.UIGroup",t);var e=i.prototype;return S.imps(e,{"laya.ui.IItem":!0}),e.preinitialize=function(){this.mouseEnabled=!0},e.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},e.addItem=function(t,e){void 0===e&&(e=!0);var i=t,n=this._items.length;if(i.name="item"+n,this.addChild(i),this.initItems(),e&&0<n){var r=this._items[n-1];"horizontal"==this._direction?i.x=r.x+r.width+this._space:i.y=r.y+r.height+this._space}else e&&(i.x=0,i.y=0);return n},e.delItem=function(t,e){void 0===e&&(e=!0);var i=this._items.indexOf(t);if(-1!=i){var n=t;this.removeChild(n);for(var r=i+1,a=this._items.length;r<a;r++){var s=this._items[r];s.name="item"+(r-1),e&&("horizontal"==this._direction?s.x-=n.width+this._space:s.y-=n.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var o;o=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=o}}},e.initItems=function(){this._items||(this._items=[]);for(var t=this._items.length=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.selected=t===this._selectedIndex,e.clickHandler=C.create(this,this.itemClick,[t],!1)}},e.itemClick=function(t){this.selectedIndex=t},e.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].selected=e)},e.createItem=function(t,e){return null},e.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var t=0,e=0,i=this._items.length;e<i;e++){var n=this._items[e];this._skin&&(n.skin=this._skin),this._labelColors&&(n.labelColors=this._labelColors),this._labelSize&&(n.labelSize=this._labelSize),this._labelStroke&&(n.labelStroke=this._labelStroke),this._labelStrokeColor&&(n.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(n.strokeColors=this._strokeColors),this._labelBold&&(n.labelBold=this._labelBold),this._labelPadding&&(n.labelPadding=this._labelPadding),this._labelAlign&&(n.labelAlign=this._labelAlign),this._stateNum&&(n.stateNum=this._stateNum),this._labelFont&&(n.labelFont=this._labelFont),"horizontal"===this._direction?(n.y=0,n.x=t,t+=n.width+this._space):(n.x=0,n.y=t,t+=n.height+this._space)}this.changeSize()},e.commitMeasure=function(){this.runCallLater(this.changeLabels)},e._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},v(0,e,"labelStrokeColor",function(){return this._labelStrokeColor},function(t){this._labelStrokeColor!=t&&(this._labelStrokeColor=t,this._setLabelChanged())}),v(0,e,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._setLabelChanged())}),v(0,e,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(t,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),v(0,e,"labels",function(){return this._labels},function(t){if(this._labels!=t){if(this._labels=t,this.removeChildren(),this._setLabelChanged(),this._labels)for(var e=this._labels.split(","),i=0,n=e.length;i<n;i++){var r=this.createItem(this._skin,e[i]);r.name="item"+i,this.addChild(r)}this.initItems()}}),v(0,e,"strokeColors",function(){return this._strokeColors},function(t){this._strokeColors!=t&&(this._strokeColors=t,this._setLabelChanged())}),v(0,e,"labelColors",function(){return this._labelColors},function(t){this._labelColors!=t&&(this._labelColors=t,this._setLabelChanged())}),v(0,e,"labelStroke",function(){return this._labelStroke},function(t){this._labelStroke!=t&&(this._labelStroke=t,this._setLabelChanged())}),v(0,e,"labelSize",function(){return this._labelSize},function(t){this._labelSize!=t&&(this._labelSize=t,this._setLabelChanged())}),v(0,e,"stateNum",function(){return this._stateNum},function(t){this._stateNum!=t&&(this._stateNum=t,this._setLabelChanged())}),v(0,e,"labelBold",function(){return this._labelBold},function(t){this._labelBold!=t&&(this._labelBold=t,this._setLabelChanged())}),v(0,e,"labelFont",function(){return this._labelFont},function(t){this._labelFont!=t&&(this._labelFont=t,this._setLabelChanged())}),v(0,e,"labelPadding",function(){return this._labelPadding},function(t){this._labelPadding!=t&&(this._labelPadding=t,this._setLabelChanged())}),v(0,e,"direction",function(){return this._direction},function(t){this._direction=t,this._setLabelChanged()}),v(0,e,"space",function(){return this._space},function(t){this._space=t,this._setLabelChanged()}),v(0,e,"items",function(){return this._items}),v(0,e,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),v(0,e,"dataSource",t.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):S.superSet(eo,this,"dataSource",t)}),i}(eo),Ho=function(t){function e(){this._items=null,this._selectedIndex=0,e.__super.call(this),this._setIndexHandler=C.create(this,this.setIndex,null,!1)}E(e,"laya.ui.ViewStack",t);var i=e.prototype;return S.imps(i,{"laya.ui.IItem":!0}),i.setItems=function(t){this.removeChildren();for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i];r&&(r.name="item"+e,this.addChild(r),e++)}this.initItems()},i.addItem=function(t){t.name="item"+this._items.length,this.addChild(t),this.initItems()},i.initItems=function(){this._items=[];for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.visible=t==this._selectedIndex}},i.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].visible=e)},i.setIndex=function(t){this.selectedIndex=t},v(0,i,"dataSource",t.prototype._$get_dataSource,function(t){if("number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t)this.selectedIndex=parseInt(t);else for(var e in this._dataSource)this.hasOwnProperty(e)&&(this[e]=this._dataSource[e])}),v(0,i,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(this._selectedIndex,!0))}),v(0,i,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),v(0,i,"items",function(){return this._items}),v(0,i,"setIndexHandler",function(){return this._setIndexHandler},function(t){this._setIndexHandler=t}),e}(eo),Xo=function(t){function i(t,e){this.data=null,this.img=null,i.__super.call(this),this.img||(this.img=new _o),""!=t?(this.label=t,this.name=t):(this.label="------",this.height=5,this.mouseEnabled=!1,this.img.skin=He.base64.getAdptUrl("comp/line2.png"),this.img.sizeGrid="0,2,0,2",this.addChild(this.img)),this.labelColors="#000000,#000000,#000000,#000000",this._text.x=10,this._text.padding=[-2,0,0,0],this._text.align="left",this._text.wordWrap=!1,this._text.typeset(),this.width=this._text.width+25,this.sizeGrid="3,3,3,3",this.skin=He.base64.getAdptUrl("comp/button1.png")}return E(i,"laya.debug.uicomps.ContextMenuItem",t),v(0,i.prototype,"width",t.prototype._$get_width,function(t){S.superSet(ho,this,"width",t),this.img.width=this.width,this.img.x=0}),i}(ho),Yo=function(t){function a(){this.view=null,a.__super.call(this)}E(a,"laya.debug.view.nodeInfo.views.CacheRankView",uo);var e=a.prototype;return e.createPanel=function(){this.view=new ah,this.view.top=this.view.bottom=this.view.left=this.view.right=0,this.addChild(this.view),Ni.I.setNodeListAction(this.view.itemList),this.view.closeBtn.on("click",this,this.close),this.view.freshBtn.on("click",this,this.fresh),this.view.itemList.scrollBar.hide=!0,this.view.autoUpdate.on("change",this,this.onAutoUpdateChange),(this.dis=this).view.itemList.array=[],this.onAutoUpdateChange(),this.fresh()},e.onRightClick=function(){var t,e;(t=this.view.itemList).selectedItem&&(e=t.selectedItem.path,Ni.I.objRightClick(e))},e.onAutoUpdateChange=function(){this.autoUpdate=this.view.autoUpdate.selected},e.fresh=function(){var t,e,i,n,r;for(e in Qe.counter.updates(),this.view.title.text="ReCache排行",Xe.enableCacheAnalyse||(this.view.title.text="ReCache排行(未开启)",this.view.title.toolTip="DebugTool.init(true)可开启该功能"),r=[],t=Qe.counter.resultNodeDic)i=t[e],a.filterDebugNodes&&oi.isInTree(Is.I,i)||Qe.counter.getCount(i)<=0||((n={}).time=Qe.counter.getCount(i),n.path=i,n.label=$e.getNodeClassAndName(i)+":"+n.time,r.push(n));r.sort(vi.sortByKey("time",!0,!0)),this.view.itemList.array=r},v(0,e,"autoUpdate",null,function(t){S.timer.clear(this,this.fresh),t&&(this.fresh(),S.timer.loop(Pi.RenderCostMaxTime,this,this.fresh))}),v(1,a,"I",function(){return a._I||(a._I=new a),a._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),a._I=null,a.filterDebugNodes=!0,a}(),zo=function(t){function e(){this.view=null,this.dragIcon=null,this.tSelectTar=null,this._selectTip=new ya,e.__super.call(this),this._selectTip.setBounds(new nn(0,0,0,0))}E(e,"laya.debug.view.nodeInfo.views.DebugPanelView",uo);var i=e.prototype;return i.createPanel=function(){this.view=new zl,this.dis=this.view,this.view.minBtn.minHandler=this.minHandler,this.view.minBtn.maxHandler=this.maxHandler,this.view.minBtn.tar=this.view,oi.setDragingItem(this.view.bg,this.view),oi.setDragingItem(this.view.tab,this.view),oi.setDragingItem(this.view.clearBtn,this.view),this.clickSelectChange(),this.view.selectWhenClick.on("change",this,this.clickSelectChange),Fr.listen("ItemClicked",this,this.itemClicked),Oi.setViewScale(this.view),this.dragIcon=this.view.dragIcon,this.dragIcon.removeSelf(),this.view.mouseAnalyseBtn.on("mousedown",this,this.mouseAnalyserMouseDown),this.dragIcon.on("dragend",this,this.mouseAnalyserDragEnd),this.view.clearBtn.on("mousedown",this,this.clearBtnClick)},i.clearBtnClick=function(){Xe.clearDebugLayer()},i.mouseAnalyserMouseDown=function(){var t=e.tempPos;t.setTo(0,0),t=this.view.mouseAnalyseBtn.localToGlobal(t),this.dragIcon.pos(t.x,t.y),this.dragIcon.mouseEnabled=!1,S.stage.addChild(this.dragIcon),this.dragIcon.startDrag()},i.mouseAnalyserDragEnd=function(){this.dragIcon.removeSelf(),this.selectTarget(li.instance.getDisUnderMouse()),qo.I.showByNode(li.instance.getDisUnderMouse(),!1)},i.switchToTree=function(){this.view.tab.selectedIndex=0},i.swichToSelect=function(){this.view.tab.selectedIndex=1},i.itemClicked=function(t){e.isClickSelectState&&(e.ignoreDebugTool&&Is.I.isDebugItem(t)||t instanceof laya.debug.uicomps.ContextMenuItem||t.parent instanceof laya.debug.uicomps.ContextMenuItem||(Ls.I.showSelectInStage(t),qo.I.showByNode(t,!1),this.view.selectWhenClick.selected=!1,Xe.showDisBound(t),this.clickSelectChange()))},i.selectTarget=function(t){t&&(Ls.I.showSelectInStage(t),Xe.showDisBound(t))},i.clickSelectChange=function(){e.isClickSelectState=this.view.selectWhenClick.selected,vn.onPC&&(this.tSelectTar=null,this.clearSelectTip(),e.isClickSelectState?S.timer.loop(200,this,this.updateSelectTar,null,!0):S.timer.clear(this,this.updateSelectTar))},i.clearSelectTip=function(){this._selectTip.removeSelf()},i.updateSelectTar=function(){var t,e;(this.clearSelectTip(),this.tSelectTar=li.instance.getDisUnderMouse(),this.tSelectTar)&&(Is.I.isDebugItem(this.tSelectTar)||((t=this._selectTip.graphics).clear(),e=Fi.getGRec(this.tSelectTar),Is.I.popLayer.addChild(this._selectTip),t.drawRect(0,0,e.width,e.height,null,"#00ffff",2),this._selectTip.pos(e.x,e.y)))},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e.ignoreDebugTool=!0,e.isClickSelectState=!1,m(e,["tempPos",function(){return this.tempPos=new en}]),e}(),jo=function(t){function e(){this.input=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.FilterView",t);var i=e.prototype;return i.createPanel=function(){this.input=new To,this.input.size(400,500),this.input.multiline=!0,this.input.bgColor="#ff00ff",this.input.fontSize=24,this.addChild(this.input)},i.show=function(){this.input.text=As.showValues.join("\n"),t.prototype.show.call(this)},i.close=function(){t.prototype.close.call(this),As.showValues=this.input.text.split("\n")},e}(uo),Jo=function(t){function e(){this.view=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.FindSmallView",uo);var i=e.prototype;return i.createPanel=function(){this.view=new Jl,Oi.setViewScale(this.view),oi.setDragingItem(this.view.bg,this.view),this.view.typeSelect.selectedIndex=1,this.view.closeBtn.on("click",this,this.close),this.view.findBtn.on("click",this,this.onFind),this.dis=this.view},i.onFind=function(){var t,e;t=this.view.findTxt.text,t=Ii.trimSide(t),e=0==this.view.typeSelect.selectedIndex?Xe.findNameHas(t,!1):Xe.findClassHas(S.stage,t),Ls.I.showSelectItems(e),this.close()},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e}(),Ko=function(t){function e(){this.view=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.FindView",uo);var i=e.prototype;return i.createPanel=function(){this.view=new jl,oi.setDragingItem(this.view.bg,this.view),this.view.result.scrollBar.hide=!0,this.view.result.array=[],this.view.typeSelect.selectedIndex=1,this.view.closeBtn.on("click",this,this.close),this.view.findBtn.on("click",this,this.onFind),Ni.I.setNodeListAction(this.view.result),this.dis=this.view},i.onRightClick=function(){var t,e;(t=this.view.result).selectedItem&&(e=t.selectedItem.path,Ni.I.objRightClick(e))},i.onFind=function(){var t,e;t=this.view.findTxt.text,t=Ii.trimSide(t),e=0==this.view.typeSelect.selectedIndex?Xe.findNameHas(t,!1):Xe.findClassHas(S.stage,t),this.showFindResult(e)},i.showFindResult=function(t){if(t){var e,i,n,r,a=0;for(e=t.length,i=[],a=0;a<e;a++)r=t[a],(n={}).label=$e.getNodeClassAndName(r),n.path=r,i.push(n);this.view.result.array=i}},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e}(),Qo=function(t){function e(){this.view=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.NodeListPanelView",uo);var i=e.prototype;return i.createPanel=function(){this.view=new Ql,this.addChild(this.view),oi.setDragingItem(this.view.bg,this.view),Ni.I.setNodeListAction(this.view.itemList),this.view.closeBtn.on("click",this,this.close),this.view.itemList.scrollBar.hide=!0,(this.dis=this).view.itemList.array=[]},i.showList=function(t){this.view.itemList.array=t,this.show()},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e.filterDebugNodes=!0,e}(),qo=function(i){function e(){this.view=null,this.dragIcon=null,this._tar=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.NodeToolView",i);var t=e.prototype;return t.show=function(){this.showByNode()},t.createPanel=function(){this.view=new ql,this.addChild(this.view),this.view.on("click",this,this.onBtnClick),this.view.closeBtn.on("click",this,this.onCloseBtn),oi.setDragingItem(this.view.bg,this.view),this.dis=this.view,this.view.freshBtn.on("click",this,this.onFreshBtn),this.dragIcon=this.view.dragIcon,this.dragIcon.removeSelf(),this.dragIcon.on("dragend",this,this.mouseAnalyserDragEnd),this.view.mouseAnalyseBtn.on("mousedown",this,this.mouseAnalyserMouseDown)},t.mouseAnalyserMouseDown=function(){var t=e.tempPos;t.setTo(0,0),t=this.view.mouseAnalyseBtn.localToGlobal(t),this.dragIcon.pos(t.x,t.y),this.dragIcon.mouseEnabled=!1,S.stage.addChild(this.dragIcon),this.dragIcon.startDrag()},t.mouseAnalyserDragEnd=function(){this.dragIcon.removeSelf(),laya.debug.view.nodeInfo.views.NodeToolView.I.target&&yi.analyseNode(laya.debug.view.nodeInfo.views.NodeToolView.I.target)},t.onFreshBtn=function(){this._tar&&(this._tar.reCache(),this._tar.repaint())},t.onCloseBtn=function(){this.close()},t.onBtnClick=function(t){var e;if(this._tar)switch(e=t.target,console.log("onBtnClick:",e),e.label){case"父链":Xe.showParentChain(this._tar),sl.I.setSelectList(Xe.selectedNodes);break;case"子":Xe.showAllChild(this._tar),sl.I.setSelectList(Xe.selectedNodes);break;case"兄弟":Xe.showAllBrother(this._tar),sl.I.setSelectList(Xe.selectedNodes);break;case"Enable链":nl.I.dTrace(Xe.traceDisMouseEnable(this._tar)),sl.I.setSelectList(Xe.selectedNodes);break;case"Size链":nl.I.dTrace(Xe.traceDisSizeChain(this._tar)),sl.I.setSelectList(Xe.selectedNodes);break;case"隐藏旁支":Ms.I.recoverNodes(),Ms.I.hideOtherChain(this._tar);break;case"隐藏兄弟":Ms.I.recoverNodes(),Ms.I.hideBrothers(this._tar);break;case"隐藏子":Ms.I.recoverNodes(),Ms.I.hideChilds(this._tar);break;case"恢复":Ms.I.recoverNodes();break;case"节点树定位":Ls.I.showSelectInStage(this._tar);break;case"显示边框":Xe.showDisBound(this._tar);break;case"输出到控制台":console.log(this._tar);break;case"显示切换":this._tar.visible=!this._tar.visible}},t.showByNode=function(t,e){void 0===e&&(e=!0),t||(t=S.stage),e&&i.prototype.show.call(this),this._tar=t,this.fresh()},t.fresh=function(){this._tar&&(this.view.tarTxt.text=$e.getNodeClassAndName(this._tar))},v(0,t,"target",function(){return this._tar}),v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,m(e,["tempPos",function(){return this.tempPos=new en}]),e}(uo),$o=function(t){function e(){this.view=null,this._handler=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.NodeTreeSettingView",t);var i=e.prototype;return i.createPanel=function(){t.prototype.createPanel.call(this),this.view=new th,Oi.setViewScale(this.view),this.addChild(this.view),this.inits(),this.dis=this.view},i.show=function(){t.prototype.show.call(this)},i.showSetting=function(t,e,i){i instanceof laya.display.Node?this.view.showTxt.text=Pi.defaultFitlerStr.split(",").join("\n"):this.view.showTxt.text=t.join("\n"),this._handler=e,this.show()},i.inits=function(){this.view.okBtn.on("click",this,this.onOkBtn),this.view.closeBtn.on("click",this,this.onCloseBtn),oi.setDragingItem(this.view.bg,this.view),this.dis=this.view},i.onCloseBtn=function(){this.close()},i.onOkBtn=function(){var t;this.close(),t=this.view.showTxt.text.split("\n"),this._handler&&(this._handler.runWith([t]),this._handler=null)},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e}(uo),tl=function(e){function t(){this.nodeTree=null,t.__super.call(this)}E(t,"laya.debug.view.nodeInfo.views.NodeTreeView",e);var i=t.prototype;return i.show=function(){this.showByNode()},i.showByNode=function(t){t||(t=S.stage),this.nodeTree.setDis(t)},i.createPanel=function(){var t;e.prototype.createPanel.call(this),this.nodeTree||(this.nodeTree=new $l),this.dis=null,(t=this.nodeTree).top=t.bottom=t.left=t.right=0,this.addChild(t),this.showByNode(S.stage)},i.showSelectInStage=function(t){this.showByNode(S.stage),this.nodeTree.selectByNode(t)},t}(uo),el=function(t){function e(){this.view=null,this._menu=null,this._menuItems=["统计详情","增量详情"],this._tSelectKey=null,this.preInfo={},e.__super.call(this),e._I=this}E(e,"laya.debug.view.nodeInfo.views.ObjectCreateView",uo);var i=e.prototype;return i.createPanel=function(){this.view=new eh,this.view.top=this.view.bottom=this.view.left=this.view.right=0,this.addChild(this.view),this.view.itemList.on(Xe.getMenuShowEvent(),this,this.onRightClick),this.view.closeBtn.on("click",this,this.close),this.view.freshBtn.on("click",this,this.fresh),this.view.itemList.scrollBar.hide=!0,this._menu=No.createMenuByArray(this._menuItems),this._menu.on("select",this,this.onEmunSelect),this.fresh()},i.onEmunSelect=function(t){if(this._tSelectKey){var e,i=t.target.data;if("string"==typeof i)switch(i){case"统计详情":(e=Ci.getRunInfo(this._tSelectKey))&&nl.I.showTxt(this._tSelectKey+" createInfo:\n"+e.traceSelfR());break;case"增量详情":(e=Ci.getRunInfo(this._tSelectKey))&&nl.I.showTxt(this._tSelectKey+" createInfo:\n"+e.traceSelfR(e.changeO))}}},i.onRightClick=function(){var t,e;(t=this.view.itemList).selectedItem&&(e=t.selectedItem.path,this._tSelectKey=e,this._tSelectKey&&this._menu.show())},i.show=function(){this.fresh()},i.fresh=function(){var t,e,i,n,r;for(e in i=[],t=ui.I.createInfo)this.preInfo[e]||(this.preInfo[e]=0),(n={}).path=e,n.count=t[e],n.add=t[e]-this.preInfo[e],0<n.add?n.label=e+":"+t[e]+" +"+n.add:n.label=e+":"+t[e],(r=Ci.getRunInfo(e))&&r.record(),n.rank=1e3*n.add+n.count,this.preInfo[e]=t[e],i.push(n);i.sort(vi.sortByKey("rank",!0,!0)),this.view.itemList.array=i},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e}(),il=function(t){function s(){this.view=null,this.showKeys=["x","y","width","height","renderCost"],this._closeSettingHandler=null,this._tar=null,s.__super.call(this)}E(s,"laya.debug.view.nodeInfo.views.ObjectInfoView",t);var e=s.prototype;return e.createPanel=function(){t.prototype.createPanel.call(this),this.view=new ih,Oi.setViewScale(this.view),this.addChild(this.view),this.inits()},e.inits=function(){this.view.closeBtn.on("click",this,this.close),this.view.settingBtn.on("click",this,this.onSettingBtn),this.view.autoUpdate.on("change",this,this.onAutoUpdateChange),oi.setDragingItem(this.view.bg,this.view),oi.setResizeAbleEx(this.view),this._closeSettingHandler=new C(this,this.closeSetting),this.dis=this.view},e.onAutoUpdateChange=function(){this.autoUpdate=this.view.autoUpdate.selected},e.onSettingBtn=function(){$o.I.showSetting(this.showKeys,this._closeSettingHandler,this._tar)},e.reset=function(){this.showKeys=["x","y","width","height","renderCost"]},e.closeSetting=function(t){this.showKeys=t,this.fresh()},e.showObjectInfo=function(t){this._tar=t,this.fresh(),this.show(),this.onAutoUpdateChange()},e.fresh=function(){this._tar?(this.view.title.text=$e.getNodeClassAndName(this._tar),this.view.showTxt.text=s.getObjValueStr(this._tar,this.showKeys,!1)):(this.view.showTxt.text="",this.view.title.text="未选中对象")},e.freshKeyInfos=function(){this.fresh()},e.close=function(){t.prototype.close.call(this),this.autoUpdate=!1,wn.recover("ObjectInfoView",this)},e.show=function(){t.prototype.show.call(this)},v(0,e,"autoUpdate",null,function(t){S.timer.clear(this,this.freshKeyInfos),t&&S.timer.loop(2e3,this,this.freshKeyInfos)}),s.getObjValueStr=function(t,e,i){void 0===i&&(i=!0);var n,r,a=0;for(s._txts.length=0,n=e.length,i&&(t.name?s._txts.push($e.getClassName(t)+"("+t.name+")"):s._txts.push($e.getClassName(t))),a=0;a<n;a++)r=e[a],s._txts.push(r+":"+s.getNodeValue(t,r));return s._txts.join("\n")},s.getNodeValue=function(t,e){var i,n;if(t instanceof laya.display.Sprite)switch(n=t,e){case"gRec":i=Fi.getGRec(n).toString();break;case"gAlpha":i=Fi.getGAlpha(n)+"";break;case"cmdCount":i=Fi.getNodeCmdCount(n)+"";break;case"cmdAll":i=Fi.getNodeCmdTotalCount(n)+"";break;case"nodeAll":i=""+Fi.getNodeCount(n);break;case"nodeVisible":i=""+Fi.getNodeCount(n,!0);break;case"nodeRender":i=""+Fi.getRenderNodeCount(n);break;case"nodeReCache":i=""+Fi.getReFreshRenderNodeCount(n);break;case"renderCost":i=""+Si.I.getTime(n);break;case"renderCount":i=""+Si.I.getCount(n);break;default:i=t[e]+""}else i=t[e]+"";return i},s.showObject=function(t){var e;(e=wn.getItemByClass("ObjectInfoView",s)).reset(),e.showObjectInfo(t)},s._txts=[],s}(uo),nl=function(t){function e(){this.view=null,e.__super.call(this),Xe._logFun=e.log}E(e,"laya.debug.view.nodeInfo.views.OutPutView",uo);var i=e.prototype;return i.createPanel=function(){this.view=new nh,oi.setDragingItem(this.view.txt,this.view),oi.setDragingItem(this.view.bg,this.view),Oi.setViewScale(this.view),this.view.txt.textField.overflow=Es.SCROLL,this.view.txt.textField.wordWrap=!0,this.view.on("mousewheel",this,this.mouseWheel),this.view.txt.text="",oi.setResizeAbleEx(this.view),this.view.closeBtn.on("click",this,this.close),this.view.clearBtn.on("click",this,this.onClearBtn),this.dis=this.view},i.onClearBtn=function(){this.clearText()},i.mouseWheel=function(t){this.view.txt.textField.scrollY-=10*t.delta},i.showTxt=function(t){this.view.txt.text=t,this.show(),this.view.txt.textField.scrollY=this.view.txt.textField.maxScrollY},i.clearText=function(){this.view.txt.text=""},i.dTrace=function(t){var e,i=arguments;1e3<this.view.txt.textField.scrollY&&(this.view.txt.text="");var n,r=0;for(n=i.length,e=i[0],r=1;r<n;r++)e+=" "+i[r];this.addStr(e)},i.addStr=function(t){this.view.txt.text+="\n"+t,this.show(),this.view.txt.textField.scrollY=this.view.txt.textField.maxScrollY},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e.log=function(t){e.I.addStr(t)},e._I=null,e}(),rl=function(t){function a(){this.view=null,a.__super.call(this)}E(a,"laya.debug.view.nodeInfo.views.RenderCostRankView",uo);var e=a.prototype;return e.createPanel=function(){this.view=new ah,this.view.top=this.view.bottom=this.view.left=this.view.right=0,this.addChild(this.view),Ni.I.setNodeListAction(this.view.itemList),this.view.closeBtn.on("click",this,this.close),this.view.freshBtn.on("click",this,this.fresh),this.view.itemList.scrollBar.hide=!0,this.view.autoUpdate.on("change",this,this.onAutoUpdateChange),(this.dis=this).view.itemList.array=[],this.onAutoUpdateChange(),this.fresh(),S.timer.once(5e3,this,this.fresh)},e.onRightClick=function(){var t,e;(t=this.view.itemList).selectedItem&&(e=t.selectedItem.path,Ni.I.objRightClick(e))},e.onAutoUpdateChange=function(){this.autoUpdate=this.view.autoUpdate.selected},e.fresh=function(){var t,e,i,n,r;for(e in this.view.title.text="渲染用时排行("+Pi.RenderCostMaxTime+"ms)",r=[],t=Si.I.nodeDic)i=t[e],a.filterDebugNodes&&oi.isInTree(Is.I,i)||Si.I.getTime(i)<=0||((n={}).time=Si.I.getTime(i),a.filterDebugNodes&&i==S.stage&&(n.time-=Si.I.getTime(Is.I)),n.path=i,n.label=$e.getNodeClassAndName(i)+":"+n.time,r.push(n));r.sort(vi.sortByKey("time",!0,!0)),this.view.itemList.array=r},v(0,e,"autoUpdate",null,function(t){S.timer.clear(this,this.fresh),t&&(this.fresh(),S.timer.loop(Pi.RenderCostMaxTime,this,this.fresh))}),v(1,a,"I",function(){return a._I||(a._I=new a),a._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),a._I=null,a.filterDebugNodes=!0,a}(),al=function(t){function e(){this.view=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.ResRankView",uo);var i=e.prototype;return i.createPanel=function(){this.view=new ah,this.view.top=this.view.bottom=this.view.left=this.view.right=0,this.addChild(this.view),this.view.closeBtn.on("click",this,this.close),this.view.freshBtn.on("click",this,this.fresh),this.view.itemList.scrollBar.hide=!0,this.view.autoUpdate.on("change",this,this.onAutoUpdateChange),(this.dis=this).view.itemList.array=[],this.view.itemList.on("rightclick",this,this.onRightClick),this.onAutoUpdateChange(),this.fresh()},i.onRightClick=function(){var t;(t=this.view.itemList).selectedItem&&console.log(t.selectedItem.url)},i.onAutoUpdateChange=function(){this.autoUpdate=this.view.autoUpdate.selected},i.fresh=function(){var t,e,i;this.view.title.text="图片缓存列表",i=[];var n,r=0;for(n=(t=wi.getCachedResList()).length,r=0;r<n;r++){var a;e={},a=(a=t[r]).replace(on.rootPath,""),e.label=a,e.url=a,i.push(e)}this.view.itemList.array=i},v(0,i,"autoUpdate",null,function(t){S.timer.clear(this,this.fresh),t&&(this.fresh(),S.timer.loop(Pi.RenderCostMaxTime,this,this.fresh))}),v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e.filterDebugNodes=!0,e}(),sl=function(t){function e(){this.showKeys=[],this.view=null,this.fliterTxt=null,this.itemList=null,e.__super.call(this),(e._I=this).setSelectList(null)}E(e,"laya.debug.view.nodeInfo.views.SelectInfosView",uo);var i=e.prototype;return i.createPanel=function(){this.view=new sh,this.addChild(this.view),this.view.top=this.view.bottom=this.view.left=this.view.right=0,Ni.I.setNodeListAction(this.view.selectList),this.view.closeBtn.on("click",this,this.close),this.view.selectList.scrollBar.hide=!0,this.dis=null,this.view.findBtn.on("click",this,this.onFindBtn),this.fliterTxt=this.view.fliterTxt,this.view.fliterTxt.on("enter",this,this.onFliterTxtChange),this.view.fliterTxt.on("blur",this,this.onFliterTxtChange)},i.onFliterTxtChange=function(t){var e;""==(e=this.fliterTxt.text)?0!=this.showKeys.length&&(this.showKeys.length=0,this.fresh()):e!=this.showKeys.join(",")&&(this.showKeys=e.split(","),this.fresh())},i.onFindBtn=function(){Jo.I.show()},i.onRightClick=function(){var t,e;(t=this.view.selectList).selectedItem&&(e=t.selectedItem.path,Ni.I.objRightClick(e))},i.setSelectTarget=function(t){t&&this.setSelectList([t])},i.setSelectList=function(t){this.itemList=t,this.fresh()},i.fresh=function(){var t;if(!(t=this.itemList)||t.length<1)this.view.selectList.array=[];else{var e,i,n,r,a=0;for(e=t.length,r=[],a=0;a<e;a++)i=t[a],(n={}).label=this.getLabelTxt(i),n.path=i,r.push(n);this.view.selectList.array=r}},i.getLabelTxt=function(t){var e;e=$e.getNodeClassAndName(t);var i,n=0;for(i=this.showKeys.length,n=0;n<i;n++)e+=","+il.getNodeValue(t,this.showKeys[n]);return e},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e}(),ol=(function(t){function e(){this.view=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.ToolBarView",uo);var i=e.prototype;i.createPanel=function(){this.view=new oh,this.addChild(this.view),oi.setDragingItem(this.view.bg,this.view),this.view.on("click",this,this.onBtnClick),this.view.minBtn.minHandler=this.minHandler,this.view.minBtn.maxHandler=this.maxHandler,this.view.minBtn.tar=this.view,this.clickSelectChange(),this.view.selectWhenClick.on("change",this,this.clickSelectChange),Fr.listen("ItemClicked",this,this.itemClicked),this.dis=this.view},i.itemClicked=function(t){e.isClickSelectState&&(oi.isInTree(this.view.selectWhenClick,t)||!e.ignoreDebugTool||Is.I.isDebugItem(t))},i.clickSelectChange=function(){e.isClickSelectState=this.view.selectWhenClick.selected},i.firstShowFun=function(){this.dis.x=S.stage.width-this.dis.width-20,this.dis.y=5},i.onBtnClick=function(t){switch(t.target){case this.view.treeBtn:Ls.I.switchShow("Tree");break;case this.view.findBtn:Ls.I.switchShow("Find");break;case this.view.clearBtn:Xe.clearDebugLayer();break;case this.view.rankBtn:rl.I.show();break;case this.view.nodeRankBtn:el.I.show();break;case this.view.cacheBtn:Fi.showCachedSpriteRecs()}},v(1,e,"I",function(){return e._I||(e._I=new e),e._I},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I),e._I=null,e.ignoreDebugTool=!0,e.isClickSelectState=!1}(),function(t){function e(){this.input=null,this.btn=null,e.__super.call(this)}E(e,"laya.debug.view.nodeInfo.views.TxtInfoView",uo);var i=e.prototype;return i.createPanel=function(){this.input=new To,this.input.size(200,400),this.input.multiline=!0,this.input.bgColor="#ff00ff",this.input.fontSize=12,this.input.wordWrap=!0,this.addChild(this.input),this.btn=this.getButton(),this.btn.text="关闭",this.btn.size(50,20),this.btn.align="center",this.btn.on("mousedown",this,this.onCloseBtn),this.btn.pos(5,this.input.height+5),this.addChild(this.btn)},i.showInfo=function(t){this.input.text=t,this.show()},i.show=function(){Is.I.setTop(),Is.I.popLayer.addChild(this),this.x=S.stage.width-this.width,this.y=0},i.onCloseBtn=function(){this.close()},e}()),ll=function(t){function e(){e.__super.call(this),this.bgColor="#11ff00"}return E(e,"laya.debug.tools.debugUI.DInput",To),e}(),hl=function(t){function i(t,e){void 0===e&&(e=""),i.__super.call(this,t,e)}E(i,"laya.ui.CheckBox",t);var e=i.prototype;return e.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},e.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},v(0,e,"dataSource",t.prototype._$get_dataSource,function(t){"boolean"==typeof(this._dataSource=t)?this.selected=t:"string"==typeof t?this.selected="true"===t:S.superSet(ho,this,"dataSource",t)}),i}(ho),ul=function(e){function i(t,e){this._value=null,void 0===e&&(e=""),i.__super.call(this,t,e)}E(i,"laya.ui.Radio",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._value=null},t.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},t.initialize=function(){e.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},t.onClick=function(t){this.selected=!0},v(0,t,"value",function(){return null!=this._value?this._value:this.label},function(t){this._value=t}),i}(ho),cl=function(e){function i(t,e){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,i.__super.call(this),t&&(this.skin=t),e&&(this.sheet=e)}E(i,"laya.ui.FontClip",e);var t=i.prototype;return t.createChildren=function(){this._bitmap=new Yr,this.on("loaded",this,this._onClipLoaded)},t._onClipLoaded=function(){this.callLater(this.changeValue)},t.changeValue=function(){var t;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),t=this._sources[0]))){var e="horizontal"===this._direction;this._wordsH=e?(this._wordsW=this._valueArr.length*(t.sourceWidth+this.spaceX),t.sourceHeight):(this._wordsW=t.sourceWidth,(t.sourceHeight+this.spaceY)*this._valueArr.length);var i=0;if(this._width)switch(this._align){case"center":i=.5*(this._width-this._wordsW);break;case"right":i=this._width-this._wordsW;break;default:i=0}for(var n=0,r=this._valueArr.length;n<r;n++){var a=this._indexMap[this._valueArr.charAt(n)];this.sources[a]&&(t=this.sources[a],e?this.graphics.drawTexture(t,i+n*(t.sourceWidth+this.spaceX),0,t.sourceWidth,t.sourceHeight):this.graphics.drawTexture(t,0+i,n*(t.sourceHeight+this.spaceY),t.sourceWidth,t.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},t.destroy=function(t){void 0===t&&(t=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),e.prototype.destroy.call(this,t)},v(0,t,"sheet",function(){return this._sheet},function(t){t+="";var e=(this._sheet=t).split(" ");this._clipX=String(e[0]).length,this.clipY=e.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var n=e[i].split(""),r=0,a=n.length;r<a;r++)this._indexMap[n[r]]=i*this._clipX+r}),v(0,t,"height",e.prototype._$get_height,function(t){S.superSet(fo,this,"height",t),this.callLater(this.changeValue)}),v(0,t,"direction",function(){return this._direction},function(t){this._direction=t,this.callLater(this.changeValue)}),v(0,t,"value",function(){return this._valueArr?this._valueArr:""},function(t){t+="",this._valueArr=t,this.callLater(this.changeValue)}),v(0,t,"width",e.prototype._$get_width,function(t){S.superSet(fo,this,"width",t),this.callLater(this.changeValue)}),v(0,t,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,"horizontal"===this._direction&&this.callLater(this.changeValue)}),v(0,t,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),v(0,t,"align",function(){return this._align},function(t){this._align=t,this.callLater(this.changeValue)}),v(0,t,"measureWidth",function(){return this._wordsW}),v(0,t,"measureHeight",function(){return this._wordsH}),i}(fo),dl=function(t){function e(){e.__super.call(this)}return E(e,"laya.ui.HScrollBar",t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.slider.isVertical=!1},e}(go),_l=function(t){function e(t){e.__super.call(this,t),this.isVertical=!1}return E(e,"laya.ui.HSlider",vo),e}(),fl=function(t){function e(){e.__super.call(this)}return E(e,"laya.ui.VScrollBar",go),e}(),ml=function(e){function i(t){this._bg=null,this._skin=null,i.__super.call(this),void 0===t&&(t=""),this.text=t,this.skin=this.skin}E(i,"laya.ui.TextInput",e);var t=i.prototype;return t.preinitialize=function(){this.mouseEnabled=!0},t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(),this._bg=null},t.createChildren=function(){this.addChild(this._tf=new To),this._tf.padding=pn.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},t._onFocus=function(){this.event("focus",this)},t._onBlur=function(){this.event("blur",this)},t._onInput=function(){this.event("input",this)},t._onEnter=function(){this.event("enter",this)},t.initialize=function(){this.width=128,this.height=22},t.select=function(){this._tf.select()},t.setSelection=function(t,e){this._tf.setSelection(t,e)},v(0,t,"text",e.prototype._$get_text,function(t){this._tf.text!=t&&(t+="",this._tf.text=t,this.event("change"))}),v(0,t,"bg",function(){return this._bg},function(t){this.graphics=this._bg=t}),v(0,t,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(t){this._tf.inputElementYAdjuster=t}),v(0,t,"multiline",function(){return this._tf.multiline},function(t){this._tf.multiline=t}),v(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg||(this.graphics=this._bg=new Yr),this._bg.source=kr.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),v(0,t,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(t){this._bg||(this.graphics=this._bg=new Yr),this._bg.sizeGrid=gn.fillArray(pn.defaultSizeGrid,t,Number)}),v(0,t,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(t){this._tf.inputElementXAdjuster=t}),v(0,t,"width",e.prototype._$get_width,function(t){S.superSet(yo,this,"width",t),this._bg&&(this._bg.width=t)}),v(0,t,"height",e.prototype._$get_height,function(t){S.superSet(yo,this,"height",t),this._bg&&(this._bg.height=t)}),v(0,t,"editable",function(){return this._tf.editable},function(t){this._tf.editable=t}),v(0,t,"restrict",function(){return this._tf.restrict},function(t){this._tf.restrict=t}),v(0,t,"prompt",function(){return this._tf.prompt},function(t){this._tf.prompt=t}),v(0,t,"promptColor",function(){return this._tf.promptColor},function(t){this._tf.promptColor=t}),v(0,t,"maxChars",function(){return this._tf.maxChars},function(t){this._tf.maxChars=t}),v(0,t,"focus",function(){return this._tf.focus},function(t){this._tf.focus=t}),v(0,t,"type",function(){return this._tf.type},function(t){this._tf.type=t}),v(0,t,"asPassword",function(){return this._tf.asPassword},function(t){this._tf.asPassword=t}),i}(yo),pl=function(t){function e(){e.__super.call(this)}return E(e,"laya.ui.VSlider",vo),e}(),gl=function(e){var C;function I(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,I.__super.call(this)}E(I,"laya.utils.GraphicAnimation",e);var t=I.prototype;return t._parseNodeList=function(t){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[t.compId]=t.props,t.compId&&this._nodeList.push(t.compId);var e=t.child;if(e){var i=0,n=e.length;for(i=0;i<n;i++)this._parseNodeList(e[i])}},t._calGraphicData=function(t){var e;if(this._setUp(null,t),this._createGraphicData(),this._nodeIDAniDic)for(e in this._nodeIDAniDic)this._nodeIDAniDic[e]=null},t._createGraphicData=function(){var t,e=[],i=0,n=this.count,r=this._animationNewFrames;for(r||(r=[]),i=0;i<n;i++)!r[i]&&t||(t=this._createFrameGraphic(i)),e.push(t);this._gList=e},t._createFrameGraphic=function(t){var e=M.createGraphics();return I._rootMatrix||(I._rootMatrix=new tn),this._updateNodeGraphic(this._rootNode,t,I._rootMatrix,e),e},t._updateNodeGraphic=function(t,e,i,n,r){var a;void 0===r&&(r=1);var s,o,l,h=(a=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId])).alpha*r;if(!(h<.01)&&(a.resultTransform||(a.resultTransform=tn.create()),s=a.resultTransform,tn.mul(a.transform,i,s),a.skin&&(o=this._getTextureByUrl(a.skin))&&(s._checkTransform()?(n.drawTexture(o,0,0,a.width,a.height,s,h),a.resultTransform=null):n.drawTexture(o,s.tx,s.ty,a.width,a.height,null,h)),l=t.child)){var u,c=0;for(u=l.length,c=0;c<u;c++)this._updateNodeGraphic(l[c],e,s,n,h)}},t._updateNoChilds=function(t,e){if(t.skin){var i=this._getTextureByUrl(t.skin);if(i){var n=t.transform;n._checkTransform();!n.bTransform?e.drawTexture(i,n.tx,n.ty,t.width,t.height,null,t.alpha):e.drawTexture(i,0,0,t.width,t.height,n.clone(),t.alpha)}}},t._updateNodeGraphic2=function(t,e,i){var n;if(n=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]),t.child){var r=n.transform;r._checkTransform();var a,s;s=(a=!r.bTransform)&&(0!=r.tx||0!=r.ty);var o,l,h;if((o=r.bTransform||1!=n.alpha)&&i.save(),1!=n.alpha&&i.alpha(n.alpha),a?s&&i.translate(r.tx,r.ty):i.transform(r.clone()),l=t.child,n.skin&&(h=this._getTextureByUrl(n.skin))&&i.drawTexture(h,0,0,n.width,n.height),l){var u,c=0;for(u=l.length,c=0;c<u;c++)this._updateNodeGraphic2(l[c],e,i)}o?i.restore():a?s&&i.translate(-r.tx,-r.ty):i.transform(r.clone().invert())}else this._updateNoChilds(n,i)},t._calculateNodeKeyFrames=function(t){e.prototype._calculateNodeKeyFrames.call(this,t),this._nodeIDAniDic[t.target]=t},t.getNodeDataByID=function(t){return this._nodeIDAniDic[t]},t._getParams=function(t,e,i,n){var r=I._temParam;r.length=e.length;var a=0,s=e.length;for(a=0;a<s;a++)r[a]=this._getObjVar(t,e[a][0],i,e[a][1],n);return r},t._getObjVar=function(t,e,i,n,r){if(t.hasOwnProperty(e)){var a=t[e];if(i>=a.length&&(i=a.length-1),null!=t[e][i])return t[e][i]}return r.hasOwnProperty(e)?r[e]:n},t._getNodeGraphicData=function(t,e,i){i||(i=C.create()),i.transform?i.transform.identity():i.transform=tn.create();var n=this.getNodeDataByID(t);if(!n)return i;var r,a,s=n.frames,o=this._getParams(s,I._drawTextureCmd,e,this._nodeDefaultProps[t]),l=o[0],h=NaN,u=NaN,c=o[5],d=o[6],_=o[13],f=o[14],m=o[7],p=o[8],g=o[9],v=o[11],y=o[12];h=o[3],u=o[4],0!=h&&0!=u||(l=null),-1==h&&(h=0),-1==u&&(u=0),i.skin=l,i.width=h,i.height=u,l&&((r=this._getTextureByUrl(l))?(h||(h=r.sourceWidth),u||(u=r.sourceHeight)):console.warn("lost skin:",l,",you may load pics first")),i.alpha=o[10],a=i.transform,0!=_&&(c=_*h),0!=f&&(d=f*u),0==c&&0==d||a.translate(-c,-d);var x=null;if(g||1!==m||1!==p||v||y){(x=I._tempMt).identity(),x.bTransform=!0;var b=.0174532922222222*(g-v),T=.0174532922222222*(g+y),S=Math.cos(T),E=Math.sin(T),R=Math.sin(b),w=Math.cos(b);x.a=m*S,x.b=m*E,x.c=-p*R,x.d=p*w,x.tx=x.ty=0}return x&&(a=tn.mul(a,x,a)),a.translate(o[1],o[2]),i},t._getTextureByUrl=function(t){return kr.getRes(t)},t.setAniData=function(t,e){if(t.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=t,this._parseNodeList(t);var i,n={},r=[],a=t.animations,s=0,o=a.length;for(s=0;s<o;s++)if(i=a[s],this._labels=null,(!e||e==i.name)&&i){try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var l={};l.interval=1e3/i.frameRate,l.frames=this._gList,l.labels=this._labels,l.name=i.name,r.push(l),n[i.name]=l}this.animationList=r,this.animationDic=n}I._temParam.length=0},t.parseByData=function(t){var e,i;e=t.nodeRoot,i=t.aniO,delete t.nodeRoot,delete t.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=e,this._parseNodeList(e),this._labels=null;try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var n=t;return n.interval=1e3/i.frameRate,n.frames=this._gList,n.labels=this._labels,n.name=i.name,n},t.setUpAniData=function(t){if(t.animations){var e,i={},n=[],r=t.animations,a=0,s=r.length;for(a=0;a<s;a++)if(e=r[a]){var o={};o.name=e.name,o.aniO=e,o.nodeRoot=t,n.push(o),i[e.name]=o}this.animationList=n,this.animationDic=i}},t._clear=function(){var t,e;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(t in this._nodeGDic)(e=this._nodeGDic[t])&&e.recover();this._nodeGDic=null},I.parseAnimationByData=function(t){var e;return I._I||(I._I=new I),e=I._I.parseByData(t),I._I._clear(),e},I.parseAnimationData=function(t){var e;return I._I||(I._I=new I),I._I.setUpAniData(t),(e={}).animationList=I._I.animationList,e.animationDic=I._I.animationDic,I._I._clear(),e},I._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],I._temParam=[],I._I=null,I._rootMatrix=null,m(I,["_tempMt",function(){return this._tempMt=new tn}]),I.__init$=function(){C=function(){function t(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return E(t,""),t.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),wn.recover("GraphicNode",this)},t.create=function(){return wn.getItemByClass("GraphicNode",t)},t}()},I}(Ro),vl=function(t){function a(t,e,i,n){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===i&&(i=6408),void 0===n&&(n=!0),a.__super.call(this,t,e),this._format=i,this._mipmap=n,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof t)this._url=t,this._src=t,this._image=new vn.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),this._image.crossOrigin=t&&0==t.indexOf("data:")?null:"",t&&(this._image.src=t);else if(t instanceof ArrayBuffer){this._src=e,this._url=this._src;var r=new yn(t);r.readUTFBytes(4),r.readUTFBytes(2),r.getInt16();r.endian="bigEndian",this._w=r.getInt16(),this._h=r.getInt16();r.getInt16(),r.getInt16();this._image=new Uint8Array(t,r.pos),this._format=mr.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,Fn.enabled&&this._w<Fn.atlasLimitWidth&&this._h<Fn.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else this._src=e,this._url=this._src,this._image=t.source||t,this.onresize();this._$5__enableMerageInAtlas=!0}E(a,"laya.webgl.resource.WebGLImage",Co);var e=a.prototype;return S.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e._init_=function(t,e){},e._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=mr.mainContext,e=this._source=t.createTexture(),i=pr.curBindTexTarget,n=pr.curBindTexValue;if(pr.bindTexture(t,3553,e),hn.isConchWebGL)switch(this._format){case 6408:t.texImage2DEx(!0,3553,0,this._format,6408,5121,this._image);break;case mr.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}else{switch(t.pixelStorei(37441,!0),this._format){case 6408:t.texImage2D(3553,0,this._format,6408,5121,this._image);break;case mr.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}t.pixelStorei(37441,!1)}var r=this.minFifter,a=this.magFifter,s=this.repeat?10497:33071,o=Ki.isPOT(this._w,this._h);o?(this.mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,s),t.texParameteri(3553,10243,s),this.mipmap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&n&&pr.bindTexture(t,i,n),this._image.onload=null,this._image=null,o&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},e.recreateResource=function(){var t=this;if(null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var e=this;this._image=new vn.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._image.onload=null,void(e._image=null);e._allowMerageInAtlas&&e._enableMerageInAtlas?(t.memorySize=0,t._recreateLock=!1):e._createWebGlTexture(),e.completeCreate()},this._image.src=this._src}},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(mr.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},e.onresize=function(){this._w=this._image.width,this._h=this._image.height,Fn.enabled&&this._w<Fn.atlasLimitWidth&&this._h<Fn.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},e.clearAtlasSource=function(){this._image=null},v(0,e,"format",function(){return this._format}),v(0,e,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(t){this._$5__enableMerageInAtlas=t}),v(0,e,"mipmap",function(){return this._mipmap}),v(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),v(0,e,"atlasSource",function(){return this._image}),v(0,e,"onload",null,function(t){var e=this;this._onload=t,this._image&&(this._image.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),v(0,e,"onerror",null,function(t){var e=this;this._onerror=t,this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)}),a}(),yl=function(t){function n(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,n.__super.call(this)}E(n,"laya.ui.Dialog",t);var e=n.prototype;return e.initialize=function(){this.popupEffect=n.manager.popupEffectHandler,this.closeEffect=n.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},e._dealDragArea=function(){var t=this.getChildByName("drag");t&&(this.dragArea=t.x+","+t.y+","+t.width+","+t.height,t.removeSelf())},e._onClick=function(t){var e=t.target;if(e)switch(e.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(e.name)}},e.show=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!1,t,e)},e.popup=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!0,t,e)},e._open=function(t,e,i){n.manager.lock(!1),this.isModal=t,n.manager.open(this,e,i)},e.onOpened=function(){},e.close=function(t,e){void 0===e&&(e=!0),n.manager.close(this,t,e)},e.onClosed=function(t){},e._onMouseDown=function(t){var e=this.getMousePoint();this._dragArea.contains(e.x,e.y)?this.startDrag():this.stopDrag()},v(0,e,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(t){if(t){var e=gn.fillArray([0,0,0,0],t,Number);this._dragArea=new nn(e[0],e[1],e[2],e[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),v(0,e,"isPopup",function(){return null!=this.parent}),v(0,e,"zOrder",t.prototype._$get_zOrder,function(t){S.superSet(Ao,this,"zOrder",t),n.manager._checkMask()}),v(1,n,"manager",function(){return n._manager=n._manager||new Zs},function(t){n._manager=t}),n.setLockView=function(t){n.manager.setLockView(t)},n.lock=function(t){n.manager.lock(t)},n.closeAll=function(){n.manager.closeAll()},n.getDialogsByGroup=function(t){return n.manager.getDialogsByGroup(t)},n.closeByGroup=function(t){return n.manager.closeByGroup(t)},n.CLOSE="close",n.CANCEL="cancel",n.SURE="sure",n.NO="no",n.OK="ok",n.YES="yes",n._manager=null,n}(Ao),xl=function(t){function e(){e.__super.call(this)}E(e,"laya.debug.ui.debugui.comps.ListItemUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){},m(e,["uiView",function(){return this.uiView={type:"View",props:{base64pic:!0,width:244,height:19},child:[{type:"Clip",props:{y:-1,skin:"comp/clip_selectBox.png",clipY:2,height:19,name:"selectBox",left:2,right:2,x:0}},{type:"Label",props:{x:25,text:"render",color:"#dcea36",width:77,height:17,name:"label",y:2,fontSize:12}},{type:"Clip",props:{skin:"comp/clip_tree_arrow.png",clipY:2,name:"arrow",x:8,y:4,mouseEnabled:!1}}]}}]),e}(),bl=function(t){function e(){e.__super.call(this)}E(e,"laya.debug.ui.debugui.comps.RankListItemUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{y:-1,skin:"comp/clip_selectBox.png",clipY:2,height:19,name:"selectBox",left:0,right:0,x:0},type:"Clip"},{props:{text:"render",color:"#a0a0a0",height:15,name:"label",y:2,left:11,right:5,fontSize:12,x:11,width:163},type:"Label"}],props:{width:179,height:19}}}]),e}(),Tl=function(t){function e(){this.bg=null,this.minBtn=null,this.treePanel=null,this.selectWhenClick=null,this.profilePanel=null,this.resizeBtn=null,this.mouseAnalyseBtn=null,this.dragIcon=null,this.clearBtn=null,this.selectPanel=null,this.tab=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.DebugPanelUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.view.nodeInfo.nodetree.MinBtnComp",Kl),Ao.regComponent("laya.debug.view.nodeInfo.views.NodeTreeView",tl),Ao.regComponent("laya.debug.view.nodeInfo.nodetree.Profile",rh),Ao.regComponent("laya.debug.view.nodeInfo.views.SelectInfosView",sl)},m(e,["uiView",function(){return this.uiView={type:"View",props:{base64pic:!0,width:260,height:400},child:[{type:"Image",props:{x:205,y:254,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"}},{type:"Image",props:{y:0,skin:"view/bg_top.png",left:0,right:0}},{type:"MinBtnComp",props:{y:-3,var:"minBtn",runtime:"laya.debug.view.nodeInfo.nodetree.MinBtnComp",right:-3,x:207}},{type:"NodeTree",props:{left:0,right:0,top:32,bottom:0,name:"节点树",var:"treePanel",runtime:"laya.debug.view.nodeInfo.views.NodeTreeView"}},{type:"CheckBox",props:{x:8,y:9,skin:"view/clickselect.png",toolTip:"点击选取",var:"selectWhenClick",mouseEnabled:!0,width:14,height:14}},{type:"Profile",props:{name:"性能",top:32,right:0,left:0,bottom:0,var:"profilePanel",runtime:"laya.debug.view.nodeInfo.nodetree.Profile"}},{type:"Button",props:{x:169,y:247,skin:"view/resize.png",right:2,bottom:2,name:"resizeBtn",var:"resizeBtn",stateNum:3}},{type:"Clip",props:{y:9,skin:"view/clickanalyse.png",var:"mouseAnalyseBtn",toolTip:"拖动选取",left:33,x:33,clipY:3}},{type:"Clip",props:{y:0,skin:"view/clickanalyse.png",var:"dragIcon",x:33,clipY:3}},{type:"Button",props:{y:7,skin:"view/res.png",stateNum:2,toolTip:"清除边框",var:"clearBtn",right:34,x:184}},{type:"SelectInfos",props:{top:32,left:0,right:0,bottom:0,name:"选中",var:"selectPanel",runtime:"laya.debug.view.nodeInfo.views.SelectInfosView"}},{type:"Tab",props:{x:59,y:0,name:"tab",var:"tab",selectedIndex:0},child:[{type:"Button",props:{skin:"view/tab_panel.png",label:"节点",width:42,height:32,name:"item0",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:42,skin:"view/tab_panel.png",label:"查询",width:42,height:32,name:"item1",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:84,skin:"view/tab_panel.png",label:"性能",width:42,height:32,name:"item2",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}}]}]}}]),e}(),Sl=function(t){function e(){this.bg=null,this.closeBtn=null,this.title=null,this.typeSelect=null,this.findTxt=null,this.findBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.FindNodeSmallUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:185,y:234,skin:"view/bg_tool.png",left:0,right:0,top:0,bottom:0,var:"bg"},type:"Image"},{props:{x:185,y:15,skin:"view/btn_close.png",var:"closeBtn",top:2,right:2},type:"Button"},{props:{x:6,y:4,text:"查找对象",width:67,height:20,color:"#288edf",var:"title"},type:"Label"},{props:{x:60,y:81,skin:"comp/combobox.png",labels:"name,class",width:63,height:21,var:"typeSelect",sizeGrid:"5,35,5,5",labelColors:"#a0a0a0,#fffff,#ffffff#fffff"},type:"ComboBox"},{props:{x:27,y:83,text:"类型",width:27,height:20,color:"#288edf",align:"right"},type:"Label"},{props:{x:7,y:40,text:"包含内容",width:47,height:20,color:"#288edf",align:"right"},type:"Label"},{props:{x:60,y:37,skin:"comp/textinput.png",text:"Sprite",width:164,height:22,var:"findTxt",sizeGrid:"5,5,5,5",color:"#a0a0a0"},type:"TextInput"},{props:{x:158,y:79,skin:"comp/button.png",label:"查找",width:65,height:23,var:"findBtn",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"},type:"Button"}],props:{base64pic:!0,width:233,height:120}}}]),e}(),El=function(t){function e(){this.bg=null,this.closeBtn=null,this.title=null,this.typeSelect=null,this.findTxt=null,this.result=null,this.findBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.FindNodeUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.uicomps.RankListItem",Xl)},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:185,y:234,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"},type:"Image"},{props:{x:185,y:15,skin:"view/btn_close.png",var:"closeBtn",top:2,right:2},type:"Button"},{props:{x:6,y:4,text:"查找对象",width:67,height:20,color:"#88ef19",var:"title"},type:"Label"},{props:{x:52,y:75,skin:"comp/combobox.png",labels:"name,class",width:63,height:21,var:"typeSelect",sizeGrid:"5,35,5,5",labelColors:"#a0a0a0,#fffff,#ffffff#fffff"},type:"ComboBox"},{props:{x:10,y:77,text:"类型",width:27,height:20,color:"#88ef19",align:"right"},type:"Label"},{props:{x:7,y:34,text:"包含内容",width:47,height:20,color:"#88ef19",align:"right"},type:"Label"},{props:{x:59,y:31,skin:"comp/textinput.png",text:"Sprite",width:131,height:22,var:"findTxt",sizeGrid:"5,5,5,5",color:"#a0a0a0"},type:"TextInput"},{type:"List",child:[{type:"RankListItem",props:{y:30,left:5,right:5,name:"render",x:30,runtime:"laya.debug.uicomps.RankListItem"}}],props:{x:6,y:106,width:188,height:180,vScrollBarSkin:"comp/vscroll.png",var:"result"}},{props:{x:125,y:73,skin:"comp/button.png",label:"查找",width:65,height:23,var:"findBtn",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"},type:"Button"}],props:{width:200,height:300,base64pic:!0}}}]),e}(),Rl=function(t){function e(){this.minBtn=null,this.maxUI=null,this.bg=null,this.maxBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.MinBtnCompUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:7,y:8,skin:"comp/minBtn.png",stateNum:"3",var:"minBtn",width:22,height:20,toolTip:"最小化"},type:"Button"},{type:"Box",child:[{props:{x:0,y:0,skin:"view/bg_panel.png",var:"bg",width:36,height:36,sizeGrid:"5,5,5,5"},type:"Image"},{props:{x:6,y:8,skin:"view/zoom_out.png",stateNum:"2",var:"maxBtn"},type:"Button"}],props:{var:"maxUI"}}],props:{width:36,height:36,base64pic:!0}}}]),e}(),wl=function(t){function e(){this.bg=null,this.closeBtn=null,this.title=null,this.itemList=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.NodeListPanelUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.uicomps.RankListItem",Xl)},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:235,y:284,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"},type:"Image"},{props:{x:204,y:32,skin:"view/btn_close.png",var:"closeBtn",top:2,right:2,visible:!0},type:"Button"},{props:{x:10,y:6,text:"节点信息",width:147,height:16,color:"#288edf",var:"title"},type:"Label"},{type:"List",child:[{type:"RankListItem",props:{left:5,right:5,name:"render",runtime:"laya.debug.uicomps.RankListItem"}}],props:{vScrollBarSkin:"comp/vscroll.png",var:"itemList",left:2,right:2,top:26,bottom:0,repeatX:1,x:20}}],props:{width:200,height:300}}}]),e}(),Cl=function(t){function e(){this.bg=null,this.closeBtn=null,this.tarTxt=null,this.freshBtn=null,this.mouseAnalyseBtn=null,this.dragIcon=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.NodeToolUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){},m(e,["uiView",function(){return this.uiView={type:"View",props:{base64pic:!0,width:200,height:341},child:[{type:"Image",props:{x:195,y:244,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"}},{type:"Label",props:{x:9,y:5,text:"当前选中对象",width:67,height:16,color:"#a0a0a0"}},{type:"Button",props:{x:195,y:25,skin:"view/btn_close.png",var:"closeBtn",top:2,right:2}},{type:"Label",props:{x:10,y:25,text:"当前对象",width:67,height:16,color:"#a0a0a0",var:"tarTxt"}},{type:"Button",props:{x:15,y:65,skin:"comp/button.png",label:"父链",width:39,height:23,mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:66,y:65,skin:"comp/button.png",label:"子",width:35,height:23,mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:112,y:65,skin:"comp/button.png",label:"兄弟",width:49,height:23,mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:13,y:117,skin:"comp/button.png",label:"Enable链",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:100,y:117,skin:"comp/button.png",label:"Size链",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Label",props:{x:14,y:97,text:"节点链信息",width:67,height:16,color:"#a0a0a0"}},{type:"Label",props:{x:15,y:45,text:"对象选取",width:67,height:16,color:"#a0a0a0"}},{type:"Label",props:{x:16,y:145,text:"节点显示",width:67,height:16,color:"#a0a0a0"}},{type:"Button",props:{x:13,y:164,skin:"comp/button.png",label:"隐藏旁支",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:100,y:164,skin:"comp/button.png",label:"隐藏兄弟",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:13,y:197,skin:"comp/button.png",label:"隐藏子",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:99,y:197,skin:"comp/button.png",label:"恢复",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Label",props:{x:15,y:228,text:"其他",width:67,height:16,color:"#a0a0a0"}},{type:"Button",props:{x:12,y:247,skin:"comp/button.png",label:"节点树定位",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:99,y:247,skin:"comp/button.png",label:"显示边框",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Label",props:{x:12,y:315,text:"Alt+A分析鼠标能否够点中对象",width:173,height:16,color:"#a0a0a0"}},{type:"Button",props:{x:156,y:1,skin:"view/refresh2.png",var:"freshBtn",left:156,toolTip:"recache节点"}},{type:"Button",props:{x:12,y:279,skin:"comp/button.png",label:"输出到控制台",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Button",props:{x:99,y:279,skin:"comp/button.png",label:"显示切换",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"}},{type:"Clip",props:{y:44,skin:"view/clickanalyse.png",var:"mouseAnalyseBtn",toolTip:"拖动到对象上方判断是否能够点中",left:84,x:84,clipY:3}},{type:"Clip",props:{y:35,skin:"view/clickanalyse.png",var:"dragIcon",x:94,clipY:3}}]}}]),e}(),Il=function(t){function e(){this.bg=null,this.showTxt=null,this.okBtn=null,this.closeBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.NodeTreeSettingUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:0,y:0,skin:"view/bg_panel.png",left:0,top:0,bottom:0,right:0,var:"bg",width:200,height:300,sizeGrid:"5,5,5,5"},type:"Image"},{props:{x:9,y:7,text:"要显示的属性",width:76,height:16,color:"#ffffff",align:"left"},type:"Label"},{props:{x:6,y:29,skin:"comp/textinput.png",text:"x\\ny\\nwidth\\nheight",width:188,height:230,multiline:!0,var:"showTxt",color:"#a0a0a0",sizeGrid:"5,5,5,5"},type:"TextInput"},{props:{x:57,y:269,skin:"comp/button.png",label:"确定",var:"okBtn",mouseEnabled:"true",labelColors:"#ffffff,#ffffff,#ffffff,#ffffff"},type:"Button"},{props:{x:175,y:5,skin:"view/btn_close.png",var:"closeBtn"},type:"Button"}],props:{base64pic:!0,width:200,height:300}}}]),e}(),Ml=function(t){function e(){this.nodeTree=null,this.controlBar=null,this.settingBtn=null,this.freshBtn=null,this.fliterTxt=null,this.closeBtn=null,this.ifShowProps=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.NodeTreeUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.uicomps.TreeListItem",Yl)},m(e,["uiView",function(){return this.uiView={type:"View",props:{width:200,height:260,base64pic:!0},child:[{type:"Image",props:{x:-22,y:-47,skin:"view/bg_panel.png",width:211,height:206,left:0,right:0,top:0,bottom:0,sizeGrid:"5,5,5,5"}},{props:{y:0,skin:"view/bg_tool.png",left:0,right:0},type:"Image"},{type:"Tree",props:{x:0,scrollBarSkin:"comp/vscroll.png",width:195,height:229,var:"nodeTree",left:0,right:0,top:38,bottom:20},child:[{type:"ListItem",props:{y:0,name:"render",left:0,right:0,runtime:"laya.debug.uicomps.TreeListItem"}}]},{type:"Box",props:{x:3,y:5,var:"controlBar",left:3,right:3,top:5,height:23},child:[{type:"Button",props:{x:6,skin:"view/setting.png",stateNum:3,var:"settingBtn",toolTip:"设置显示的属性",y:6}},{type:"Button",props:{y:6,skin:"view/refresh.png",var:"freshBtn",left:30,toolTip:"刷新数据"}},{type:"TextInput",props:{y:0,skin:"view/bg_top.png",height:22,var:"fliterTxt",left:53,right:0,color:"#a0a0a0"}},{type:"Button",props:{x:172,y:2,skin:"view/btn_close.png",var:"closeBtn",right:1,visible:!1}}]},{props:{y:243,skin:"comp/checkbox.png",label:"显示属性",var:"ifShowProps",bottom:3,selected:!0,visible:!0,x:2,width:70,height:14,labelColors:"#a0a0a0,#fffff,#ffffff,#fffff"},type:"CheckBox"}]}}]),e}(),Al=function(t){function e(){this.bg=null,this.closeBtn=null,this.itemList=null,this.freshBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.ObjectCreateUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.uicomps.RankListItem",Xl)},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:215,y:264,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"},type:"Image"},{props:{x:184,y:12,skin:"view/btn_close.png",var:"closeBtn",top:2,right:2,visible:!1},type:"Button"},{props:{x:11,y:5,text:"对象创建统计",width:83,height:16,color:"#288edf"},type:"Label"},{type:"List",child:[{type:"RankListItem",props:{y:0,left:5,right:5,name:"render",runtime:"laya.debug.uicomps.RankListItem"}}],props:{vScrollBarSkin:"comp/vscroll.png",var:"itemList",top:26,bottom:5,left:5,right:5,repeatX:1}},{props:{y:1,skin:"view/refresh2.png",var:"freshBtn",toolTip:"刷新数据",right:1,x:178},type:"Button"}],props:{width:200,height:300,base64pic:!0}}}]),e}(),Dl=function(t){function e(){this.bg=null,this.title=null,this.showTxt=null,this.closeBtn=null,this.autoUpdate=null,this.settingBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.ObjectInfoUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:-1,y:0,skin:"view/bg_panel.png",left:-1,right:1,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"},type:"Image"},{props:{x:7,y:5,text:"对象类型",width:67,height:20,color:"#ffffff",var:"title",left:7,right:6},type:"Label"},{props:{x:2,skin:"comp/textinput.png",text:"属性内容",width:196,height:228,left:2,right:2,var:"showTxt",top:25,bottom:20,editable:!1,multiline:!0,sizeGrid:"5,5,5,5",color:"#a0a0a0"},type:"TextArea"},{props:{x:178,y:4,skin:"view/btn_close.png",var:"closeBtn",top:4,right:2},type:"Button"},{props:{skin:"comp/checkbox.png",label:"自动刷新属性",var:"autoUpdate",bottom:2,x:3,labelColors:"#a0a0a0,#fffff,#ffffff,#fffff"},type:"CheckBox"},{props:{x:164,skin:"view/setting.png",stateNum:"3",var:"settingBtn",y:6,top:6,right:24,toolTip:"设置显示属性"},type:"Button"},{props:{x:179,y:257,skin:"view/resize.png",right:2,bottom:2,name:"resizeBtn",stateNum:3},type:"Button"}],props:{base64pic:!0,width:200,height:200}}}]),e}(),Ll=function(t){function e(){this.bg=null,this.txt=null,this.closeBtn=null,this.clearBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.OutPutUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){},m(e,["uiView",function(){return this.uiView={type:"View",props:{width:300,height:200,base64pic:!0},child:[{type:"Image",props:{x:205,y:254,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"}},{type:"Label",props:{skin:"comp/textarea.png",text:"TextArea",color:"#a0a0a0",var:"txt",left:5,right:5,top:22,bottom:5,mouseEnabled:!0,sizeGrid:"3,3,3,3"}},{type:"Button",props:{x:185,y:15,skin:"view/btn_close.png",var:"closeBtn",top:2,right:2}},{props:{x:253,y:1,skin:"view/re.png",stateNum:"2",var:"clearBtn",right:25},type:"Button"},{props:{x:169,y:247,skin:"view/resize.png",right:2,bottom:2,name:"resizeBtn",stateNum:3},type:"Button"}]}}]),e}(),Vl=function(t){function e(){this.renderPanel=null,this.createPanel=null,this.cachePanel=null,this.tab=null,this.resPanel=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.ProfileUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.view.nodeInfo.views.RenderCostRankView",rl),Ao.regComponent("laya.debug.view.nodeInfo.views.ObjectCreateView",el),Ao.regComponent("laya.debug.view.nodeInfo.views.CacheRankView",Yo),Ao.regComponent("laya.debug.view.nodeInfo.views.ResRankView",al)},m(e,["uiView",function(){return this.uiView={type:"View",props:{width:260,height:329,base64pic:!0},child:[{type:"Image",props:{y:0,skin:"view/bg_tool.png",right:0,left:0}},{type:"Rank",props:{var:"renderPanel",top:29,runtime:"laya.debug.view.nodeInfo.views.RenderCostRankView",right:0,name:"渲染用时",left:0,bottom:0}},{type:"ObjectCreate",props:{var:"createPanel",top:29,runtime:"laya.debug.view.nodeInfo.views.ObjectCreateView",right:0,name:"对象创建统计",left:0,bottom:0}},{type:"Rank",props:{x:10,var:"cachePanel",top:29,runtime:"laya.debug.view.nodeInfo.views.CacheRankView",right:0,name:"cache用时",left:0,bottom:0}},{type:"Tab",props:{y:9,x:7,width:191,var:"tab",selectedIndex:0,height:19},child:[{type:"CheckBox",props:{y:0,x:0,width:50,skin:"view/create.png",name:"item0",labelColors:"#a0a0a0,#ffffff,#ffffff,#ffffff",label:"  对象",height:17}},{type:"CheckBox",props:{y:0,x:55,width:50,skin:"view/rendertime.png",name:"item1",labelColors:"#a0a0a0,#ffffff,#ffffff,#ffffff",label:" 渲染",height:19}},{type:"CheckBox",props:{y:0,x:110,width:50,skin:"view/cache.png",name:"item2",labelColors:"#a0a0a0,#ffffff,#ffffff,#ffffff",label:" 重绘",height:16}},{type:"CheckBox",props:{y:0,x:165,width:50,skin:"view/cache.png",name:"item3",labelColors:"#a0a0a0,#ffffff,#ffffff,#ffffff",label:" 资源",height:16}}]},{type:"Rank",props:{y:40,x:50,var:"resPanel",top:29,runtime:"laya.debug.view.nodeInfo.views.ResRankView",right:0,name:"资源缓存",left:0,bottom:0}}]}}]),e}(),Nl=function(t){function e(){this.bg=null,this.closeBtn=null,this.title=null,this.itemList=null,this.autoUpdate=null,this.freshBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.RankUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.uicomps.RankListItem",Xl)},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:225,y:274,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"},type:"Image"},{props:{x:194,y:22,skin:"view/btn_close.png",var:"closeBtn",top:2,right:2,visible:!1},type:"Button"},{props:{x:8,y:5,text:"渲染用时表(3000ms)",width:109,height:16,color:"#288edf",var:"title"},type:"Label"},{type:"List",child:[{type:"RankListItem",props:{left:5,right:5,name:"render",runtime:"laya.debug.uicomps.RankListItem"}}],props:{vScrollBarSkin:"comp/vscroll.png",var:"itemList",left:2,right:2,top:26,bottom:25,repeatX:1,x:10,y:10}},{props:{skin:"comp/checkbox.png",label:"自动刷新属性",var:"autoUpdate",bottom:3,selected:!1,visible:!0,left:2,labelColors:"#a0a0a0,#fffff,#ffffff,#fffff"},type:"CheckBox"},{props:{y:1,skin:"view/refresh2.png",var:"freshBtn",toolTip:"刷新数据",right:1},type:"Button"}],props:{width:200,height:300}}}]),e}(),Pl=function(t){function e(){this.bg=null,this.closeBtn=null,this.selectList=null,this.findBtn=null,this.fliterTxt=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.SelectInfosUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.uicomps.RankListItem",Xl)},m(e,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:205,y:254,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"},type:"Image"},{props:{skin:"view/btn_close.png",var:"closeBtn",top:32,visible:!1,right:2},type:"Button"},{props:{x:7,y:36,text:"当前选中列表",width:83,height:16,color:"#288edf"},type:"Label"},{type:"List",child:[{type:"RankListItem",props:{left:5,right:5,name:"render",runtime:"laya.debug.uicomps.RankListItem"}}],props:{vScrollBarSkin:"comp/vscroll.png",var:"selectList",left:5,right:5,top:56,bottom:25,repeatX:1,x:20}},{props:{x:6,text:"Alt+V选取鼠标下的对象",width:189,height:16,color:"#a0a0a0",bottom:3},type:"Label"},{type:"Image",props:{y:0,skin:"view/bg_tool.png",left:0,right:0}},{type:"Clip",props:{y:6,skin:"view/search.png",clipY:2,var:"findBtn",right:5,toolTip:"查找",x:174}},{type:"TextInput",props:{y:6,skin:"view/bg_top.png",height:22,var:"fliterTxt",left:8,right:45,color:"#a0a0a0",x:8,width:147}}],props:{width:200,height:300,base64pic:!0}}}]),e}(),Fl=function(t){function e(){this.bg=null,this.treeBtn=null,this.findBtn=null,this.minBtn=null,this.selectWhenClick=null,this.clearBtn=null,this.rankBtn=null,this.nodeRankBtn=null,this.cacheBtn=null,e.__super.call(this)}E(e,"laya.debug.ui.debugui.ToolBarUI",Ao);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists(),laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},i.viewMapRegists=function(){Ao.regComponent("laya.debug.view.nodeInfo.nodetree.MinBtnComp",Kl)},m(e,["uiView",function(){return this.uiView={type:"View",props:{base64pic:!0,width:250,height:30},child:[{type:"Image",props:{x:195,y:244,skin:"view/bg_panel.png",left:0,right:0,top:0,bottom:0,var:"bg",sizeGrid:"5,5,5,5"}},{type:"Button",props:{x:2,y:6,skin:"view/save.png",stateNum:2,var:"treeBtn",toolTip:"节点树"}},{type:"Button",props:{x:25,y:6,skin:"view/save.png",stateNum:2,var:"findBtn",toolTip:"查找面板"}},{type:"MinBtnComp",props:{x:218,y:-3,var:"minBtn",runtime:"laya.debug.view.nodeInfo.nodetree.MinBtnComp"}},{type:"CheckBox",props:{x:124,y:8,skin:"comp/checkbox.png",label:"点击选取",var:"selectWhenClick",labelColors:"#a0a0a0,#fffff,#ffffff,#fffff"}},{type:"Button",props:{x:193,y:5,skin:"view/res.png",stateNum:2,toolTip:"清除边框",var:"clearBtn"}},{type:"Button",props:{x:49,y:6,skin:"view/save.png",stateNum:2,var:"rankBtn",toolTip:"渲染用时排行"}},{type:"Button",props:{x:72,y:6,skin:"view/save.png",stateNum:2,var:"nodeRankBtn",toolTip:"创建对象排行"}},{type:"Button",props:{x:94,y:6,skin:"view/save.png",stateNum:2,var:"cacheBtn",toolTip:"cache对象"}}]}}]),e}(),Ol=function(t){function e(){e.__super.call(this)}return E(e,"laya.debug.uicomps.ListBase",t),v(0,e.prototype,"selectedIndex",t.prototype._$get_selectedIndex,function(t){if(this._selectedIndex!=t&&(this._selectedIndex=t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(t)),this.selectEnable&&this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;(t<this._startIndex||t+e>this._startIndex+this.repeatX*this.repeatY)&&this.scrollTo(t)}}),e}(Po),Bl=function(t){function e(){e.__super.call(this)}return E(e,"laya.debug.uicomps.TreeBase",Oo),e.prototype.createChildren=function(){this.addChild(this._list=new Ol),this._list.renderHandler=C.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},e}(),Gl=function(t){function e(){e.__super.call(this)}E(e,"laya.ui.HBox",t);var i=e.prototype;return i.sortItem=function(t){t&&t.sort(function(t,e){return t.x-e.x})},i.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&r.layoutEnabled&&(t.push(r),e=this._height?this._height:Math.max(e,r.height*r.scaleY))}this.sortItem(t);var a=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).x=a,a+=r.width*r.scaleX+this._space,"top"==this._align?r.y=0:"middle"==this._align?r.y=.5*(e-r.height*r.scaleY):"bottom"==this._align&&(r.y=e-r.height*r.scaleY);this.changeSize()},v(0,i,"height",t.prototype._$get_height,function(t){this._height!=t&&(S.superSet(Uo,this,"height",t),this.callLater(this.changeItems))}),e.NONE="none",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom",e}(Uo),Wl=function(t){function e(){e.__super.call(this)}E(e,"laya.ui.VBox",t);var i=e.prototype;return i.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&r.layoutEnabled&&(t.push(r),e=this._width?this._width:Math.max(e,r.width*r.scaleX))}this.sortItem(t);var a=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).y=a,a+=r.height*r.scaleY+this._space,"left"==this._align?r.x=0:"center"==this._align?r.x=.5*(e-r.width*r.scaleX):"right"==this._align&&(r.x=e-r.width*r.scaleX);this.changeSize()},v(0,i,"width",t.prototype._$get_width,function(t){this._width!=t&&(S.superSet(Uo,this,"width",t),this.callLater(this.changeItems))}),e.NONE="none",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e}(Uo),Ul=function(t){function e(){e.__super.call(this)}return E(e,"laya.ui.RadioGroup",ko),e.prototype.createItem=function(t,e){return new ul(t,e)},e}(),Zl=function(t){function e(){e.__super.call(this)}return E(e,"laya.ui.Tab",ko),e.prototype.createItem=function(t,e){return new ho(t,e)},e}(),kl=function(e){function i(t){this._vScrollBar=null,this._hScrollBar=null,void 0===t&&(t=""),i.__super.call(this,t)}E(i,"laya.ui.TextArea",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},t.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},t.onVBarChanged=function(t){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},t.onHBarChanged=function(t){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},t.changeScroll=function(){var t=this._vScrollBar&&0<this._tf.maxScrollY,e=this._hScrollBar&&0<this._tf.maxScrollX,i=t?this._width-this._vScrollBar.width:this._width,n=e?this._height-this._hScrollBar.height:this._height,r=this._tf.padding||pn.labelPadding;this._tf.width=i,this._tf.height=n,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-r[2],this._vScrollBar.y=r[1],this._vScrollBar.height=this._height-(e?this._hScrollBar.height:0)-r[1]-r[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=n/Math.max(this._tf.textHeight,n),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=t),this._hScrollBar&&(this._hScrollBar.x=r[0],this._hScrollBar.y=this._height-this._hScrollBar.height-r[3],this._hScrollBar.width=this._width-(t?this._vScrollBar.width:0)-r[0]-r[2],this._hScrollBar.scrollSize=Math.max(.033*i,1),this._hScrollBar.thumbPercent=i/Math.max(this._tf.textWidth,i),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=e)},t.scrollTo=function(t){this.commitMeasure(),this._tf.scrollY=t},v(0,t,"scrollY",function(){return this._tf.scrollY}),v(0,t,"width",e.prototype._$get_width,function(t){S.superSet(ml,this,"width",t),this.callLater(this.changeScroll)}),v(0,t,"hScrollBar",function(){return this._hScrollBar}),v(0,t,"height",e.prototype._$get_height,function(t){S.superSet(ml,this,"height",t),this.callLater(this.changeScroll)}),v(0,t,"maxScrollX",function(){return this._tf.maxScrollX}),v(0,t,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new fl),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=t}),v(0,t,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new dl),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=t}),v(0,t,"vScrollBar",function(){return this._vScrollBar}),v(0,t,"maxScrollY",function(){return this._tf.maxScrollY}),v(0,t,"scrollX",function(){return this._tf.scrollX}),i}(ml),Hl=function(t){function e(){this.Btn_Start=null,e.__super.call(this)}return E(e,"ui.UiMenuPanelUI",yl),e.prototype.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"Dialog",props:{width:600,height:400},child:[{type:"Button",props:{y:262,x:278,var:"Btn_Start",skin:"comp/button.png",label:"label"}}]},e}(),Xl=function(t){function e(){e.__super.call(this),He.replaceRes(bl.uiView),this.createView(bl.uiView)}return E(e,"laya.debug.uicomps.RankListItem",bl),e.prototype.createChildren=function(){},e}(),Yl=function(t){function e(){e.__super.call(this),He.replaceRes(xl.uiView),this.createView(xl.uiView)}return E(e,"laya.debug.uicomps.TreeListItem",xl),e.prototype.createChildren=function(){},e}(),zl=function(t){function e(){this.views=null,e.__super.call(this),this.msRec=new nn,He.replaceRes(Tl.uiView),this.createView(Tl.uiView),oi.setResizeAbleEx(this),this.views=[this.treePanel,this.selectPanel,this.profilePanel],this.tab.selectedIndex=0,this.tabChange(),this.tab.on("change",this,this.tabChange),this.changeSize()}E(e,"laya.debug.view.nodeInfo.nodetree.DebugPage",Tl);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists()},i.tabChange=function(){oi.addOnlyByIndex(this.views,this.tab.selectedIndex,this),oi.setTop(this.resizeBtn)},i.changeSize=function(){this.width<245&&(this.width=245),this.height<100&&(this.height=200),laya.ui.Component.prototype.changeSize.call(this),this.msRec.setTo(0,0,this.width,this.height),this.scrollRect=this.msRec},e}(),jl=function(t){function e(){e.__super.call(this),He.replaceRes(El.uiView),this.createView(El.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.FindNode",El),e.prototype.createChildren=function(){this.viewMapRegists()},e}(),Jl=function(t){function e(){e.__super.call(this),He.replaceRes(Sl.uiView),this.createView(Sl.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.FindNodeSmall",Sl),e.prototype.createChildren=function(){},e}(),Kl=function(t){function e(){this.tar=null,this.minHandler=null,this.maxHandler=null,this.prePos=new en,e.__super.call(this),He.replaceRes(Rl.uiView),this.createView(Rl.uiView),this.init()}E(e,"laya.debug.view.nodeInfo.nodetree.MinBtnComp",Rl);var i=e.prototype;return i.createChildren=function(){},i.init=function(){this.minBtn.on("click",this,this.onMinBtn),this.maxBtn.on("click",this,this.onMaxBtn),this.minState=!1,this.maxUI.removeSelf(),oi.setDragingItem(this.bg,this.maxUI)},i.onMaxBtn=function(){this.maxUI.removeSelf(),this.maxHandler&&this.maxHandler.run(),this.tar&&(this.tar.x+=this.maxUI.x-this.prePos.x,this.tar.y+=this.maxUI.y-this.prePos.y)},i.onMinBtn=function(){var t;this.displayedInStage&&((t=en.TEMP).setTo(0,0),t=this.localToGlobal(t),t=Is.I.popLayer.globalToLocal(t),this.maxUI.pos(t.x,t.y),Is.I.popLayer.addChild(this.maxUI),this.tar&&this.prePos.setTo(t.x,t.y),this.minHandler&&this.minHandler.run())},v(0,i,"minState",null,function(t){}),e}(),Ql=function(t){function e(){e.__super.call(this),He.replaceRes(wl.uiView),this.createView(wl.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.NodeListPanel",wl),e.prototype.createChildren=function(){this.viewMapRegists()},e}(),ql=function(t){function e(){e.__super.call(this),He.replaceRes(Cl.uiView),this.createView(Cl.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.NodeTool",Cl),e.prototype.createChildren=function(){},e}(),$l=function(t){function i(){this.showProps=!1,this._closeSettingHandler=null,this._tar=null,i.__super.call(this),He.replaceRes(Ml.uiView),Ao.regComponent("Tree",Bl),this.createView(Ml.uiView),Ao.regComponent("Tree",Oo),this.inits(),i.I=this}E(i,"laya.debug.view.nodeInfo.nodetree.NodeTree",Ml);var e=i.prototype;return e.createChildren=function(){this.viewMapRegists()},e.inits=function(){this.nodeTree.list.scrollBar.hide=!0,this.nodeTree.list.selectEnable=!0,this.settingBtn.on("click",this,this.onSettingBtn),this.freshBtn.on("click",this,this.fresh),this.closeBtn.on("click",this,this.onCloseBtn),this.fliterTxt.on("enter",this,this.onFliterTxtChange),this.fliterTxt.on("blur",this,this.onFliterTxtChange),Ni.I.setNodeListAction(this.nodeTree.list),this.nodeTree.list.on("click",this,this.onListClick,[this.nodeTree.list]),this.nodeTree.renderHandler=new C(this,this.treeRender),this._closeSettingHandler=new C(this,this.closeSetting),this.onIfShowPropsChange(),this.ifShowProps.on("change",this,this.onIfShowPropsChange)},e.onIfShowPropsChange=function(){this.showProps=this.ifShowProps.selected,this.fresh()},e.onListClick=function(t){t.selectedItem&&t.selectedItem.isDirectory&&(t.selectedItem.isOpen=!t.selectedItem.isOpen,this.nodeTree.fresh())},e.onFindBtn=function(){Jo.I.show()},e.onCloseBtn=function(){this.removeSelf()},e.onTreeDoubleClick=function(t){var e;this.nodeTree.selectedItem&&(e=this.nodeTree.selectedItem.path,Ni.I.objRightClick(e))},e.onTreeRightMouseDown=function(t){var e;this.nodeTree.selectedItem&&(e=this.nodeTree.selectedItem.path,Ni.I.objRightClick(e))},e.onSettingBtn=function(){$o.I.showSetting(i.showKeys,this._closeSettingHandler,this._tar)},e.closeSetting=function(t){i.showKeys=t,this.fresh()},e.onFliterTxtChange=function(t){var e;""!=(e=this.fliterTxt.text)&&e!=i.showKeys.join(",")&&(i.showKeys=e.split(","),this.fresh())},e.selecteByFile=function(t){var e,i,n;(e=this.nodeTree.source,(i=Xe.findNameHas(t,!1))&&0<i.length)&&(n=i[0],this.parseOpen(e,n))},e.showSelectInStage=function(t){this.setDis(S.stage),this.selectByNode(t)},e.selectByNode=function(t){var e;t&&(e=this.nodeTree.source,this.parseOpen(e,t))},e.showNodeList=function(t){if(t){var e,i,n,r,a=0;for(e=t.length,i=[],a=0;a<e;a++)r=t[a],(n={}).label=$e.getNodeClassAndName(r),n.path=r,i.push(n);this.nodeTree.array=i}},e.parseOpen=function(t,e){if(!(t.length<1)&&e){var i,n,r=0;for(i=t.length,r=0;r<i;r++)if((n=t[r]).path==e){var a;for(a=n;n;)n.isOpen=!0,this.nodeTree.fresh(),n=n.nodeParent;return void(this.nodeTree.selectedItem=a)}}},e.getFilterSource=function(t,e,i){var n;for(var r in i=i.toLocaleLowerCase(),t)(n=t[r]).isDirectory&&-1<String(n.label).toLowerCase().indexOf(i)&&(n.x=0,e.push(n)),n.child&&0<n.child.length&&this.getFilterSource(n.child,e,i)},e.onControlDown=function(){this.startDrag()},e.setDis=function(t){this._tar=t,this.fresh()},e.fresh=function(){var t;if(this.nodeTree.selectedItem){var e;for(e=this.nodeTree.selectedItem;e&&!(e.path instanceof laya.display.Sprite);)e=e.nodeParent;e&&e.path&&(t=e.path)}this._tar?this.nodeTree.array=Fi.getNodeTreeData(this._tar,this.showProps?i.showKeys:i.emptyShowKey):this.nodeTree.array=[],t&&this.selectByNode(t)},e.treeRender=function(t,e){var i=t.dataSource;if(i){i.child||i.isDirectory;var n=t.getChildByName("label");i.path instanceof laya.display.Node?n.color="#09a4f6":i.isChilds?n.color="#00ff11":n.color="#838bc5"}},i.I=null,i.emptyShowKey=[],m(i,["showKeys",function(){return this.showKeys=["x","y","width","height","renderCost"]}]),i}(),th=function(t){function e(){e.__super.call(this),He.replaceRes(Il.uiView),this.createView(Il.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.NodeTreeSetting",Il),e.prototype.createChildren=function(){},e}(),eh=function(t){function e(){e.__super.call(this),He.replaceRes(Al.uiView),this.createView(Al.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.ObjectCreate",Al),e.prototype.createChildren=function(){this.viewMapRegists()},e}(),ih=function(t){function e(){e.__super.call(this),He.replaceRes(Dl.uiView),this.createView(Dl.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.ObjectInfo",Dl),e.prototype.createChildren=function(){},e}(),nh=function(t){function e(){e.__super.call(this),He.replaceRes(Ll.uiView),this.createView(Ll.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.OutPut",Ll),e.prototype.createChildren=function(){},e}(),rh=function(t){function e(){this.views=null,e.__super.call(this),He.replaceRes(Vl.uiView),this.createView(Vl.uiView),this.views=[this.createPanel,this.renderPanel,this.cachePanel,this.resPanel],this.tab.selectedIndex=0,this.tabChange(),this.tab.on("change",this,this.tabChange)}E(e,"laya.debug.view.nodeInfo.nodetree.Profile",Vl);var i=e.prototype;return i.createChildren=function(){this.viewMapRegists()},i.tabChange=function(){oi.addOnlyByIndex(this.views,this.tab.selectedIndex,this)},e}(),ah=function(t){function e(){e.__super.call(this),He.replaceRes(Nl.uiView),this.createView(Nl.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.Rank",Nl),e.prototype.createChildren=function(){this.viewMapRegists()},e}(),sh=function(t){function e(){e.__super.call(this),He.replaceRes(Pl.uiView),this.createView(Pl.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.SelectInfos",Pl),e.prototype.createChildren=function(){this.viewMapRegists()},e}(),oh=function(t){function e(){e.__super.call(this),He.replaceRes(Fl.uiView),this.createView(Fl.uiView)}return E(e,"laya.debug.view.nodeInfo.nodetree.ToolBar",Fl),e.prototype.createChildren=function(){},e}(),lh=function(t){function e(){e.__super.call(this),this.Btn_Start.on("click",this,this.onStart)}return E(e,"code.ui.MenuPanel",Hl),e.prototype.onStart=function(){console.log("onstart"),this.close(),b.Instance.SpawnPlayer(1),b.Instance.playerLeader.InitFollowerCount(x.UserData.Level-1+0),i.GameStart=!0,b.Instance.StartGame(),b.Instance.EnablePlayerController(),b.Instance.level.camera.getComponentByType(la).OnGameStart(),b.Instance.level.camera.getComponentByType(da).GameStart(b.Instance.level.leader._transform)},e}(),hh=function(t){function e(){this.lastMouseX=NaN,this.lastMouseY=NaN,this.isMouseDown=!1,this.rotaionSpeed=6e-5,this.camera=null,this.scene=null,e.__super.call(this),this.yawPitchRoll=new we,this.resultRotation=new Te,this.tempRotationZ=new Te,this.tempRotationX=new Te,this.tempRotationY=new Te}E(e,"common.CameraMoveScript",ua);var i=e.prototype;return i._initialize=function(t){laya.d3.component.Component3D.prototype._initialize.call(this,t),S.stage.on("mousedown",this,this.mouseDown),S.stage.on("mouseup",this,this.mouseUp),S.stage.on("mouseout",this,this.mouseOut),this.camera=t},i._update=function(t){laya.d3.component.Component3D.prototype._update.call(this,t),this.updateCamera(t.elapsedTime)},i.mouseDown=function(t){this.camera.transform.localRotation.getYawPitchRoll(this.yawPitchRoll),this.lastMouseX=S.stage.mouseX,this.lastMouseY=S.stage.mouseY,this.isMouseDown=!0},i.mouseUp=function(t){this.isMouseDown=!1},i.mouseOut=function(t){this.isMouseDown=!1},i.updateCamera=function(t){if(!isNaN(this.lastMouseX)&&!isNaN(this.lastMouseY)){this.owner.scene;if(Hi.hasKeyDown(87)&&this.camera.moveForward(-.005*t),Hi.hasKeyDown(83)&&this.camera.moveForward(.005*t),Hi.hasKeyDown(65)&&this.camera.moveRight(-.005*t),Hi.hasKeyDown(68)&&this.camera.moveRight(.005*t),Hi.hasKeyDown(81)&&this.camera.moveVertical(.005*t),Hi.hasKeyDown(69)&&this.camera.moveVertical(-.005*t),this.isMouseDown){var e=S.stage.mouseX-this.lastMouseX,i=S.stage.mouseY-this.lastMouseY,n=this.yawPitchRoll.elements;n[0]-=e*this.rotaionSpeed*t,n[1]-=i*this.rotaionSpeed*t,this.updateRotation()}}this.lastMouseX=S.stage.mouseX,this.lastMouseY=S.stage.mouseY},i.updateRotation=function(){var t=this.yawPitchRoll.elements;Math.abs(t[1])<1.5&&(Te.createFromYawPitchRoll(t[0],t[1],t[2],this.tempRotationZ),this.tempRotationZ.cloneTo(this.camera.transform.localRotation),this.camera.transform.localRotation=this.camera.transform.localRotation)},e}();S.__init([l,Pr,hr,vn,hn,an,Ao,qr,Ae,Mn,gl,Pn]),new t}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}});