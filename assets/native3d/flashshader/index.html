<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>swf</title>
	<meta name="description" content="" />
	
	<script src="/assets/js/swfobject.js"></script>
	<script>
		var flashvars = {
		};
		var params = {
			menu: "false",
			scale: "noScale",
			allowFullscreen: "true",
			allowScriptAccess: "always",
			bgcolor: "",
			wmode: "direct" // can cause issues with FP settings & webcam
		};
		var attributes = {
			id:"swf"
		};
		swfobject.embedSWF(
			"native3dHaxe.swf", 
			"altContent", "800", "600", "11.0.0", 
			"expressInstall.swf", 
			flashvars, params, attributes);
	</script>
	<style>
		html, body { height:100%; overflow:hidden; }
		body { margin:0; }
	</style>
</head>
<body>
	<div id="altContent">
		<h1>swf</h1>
		<p><a href="http://www.adobe.com/go/getflashplayer">Get Adobe Flash player</a></p>
	</div>
	<pre>
class VShader extends FlShader {
	public function VShader() 
	{
		super(Context3DProgramType.VERTEX);
		var model:Var = C();
		var view:Var = C(4);
		var perspective:Var = C(8);
		var lightPos:Var = mov(C(12));
		var pos:Var = VA();
		var norm:Var = VA(1);
		var worldPos:Var = m44(pos, model);
		var viewPos:Var = m44(worldPos, view);
		m44(viewPos, perspective, op);
		
		var eyeDirection:Var = neg(viewPos, null);
		mov(eyeDirection, null, V(2));
		var viewPosLight:Var = add(m44(lightPos, view),eyeDirection,V());
		var viewNormal:Var = m33(norm, model);
		mov(viewNormal, null, V(1));
		
	}
}

class FShader extends FlShader {
	public function FShader() 
	{
		super(Context3DProgramType.FRAGMENT);
		var diffColor:Var = C();
		var lightColor:Var = C(1);
		var lightPower:Var = lightColor.w;
		var ambientColor:Var = C(2);
		var specularPow:Var = C(3).x;
		
		var n:Var = nrm(V(1));
		var l:Var = nrm(V());
		var cosTheta:Var = sat(dp3(n,l));
		
		var e:Var = nrm(V(2));
		var r:Var = nrm(sub(mul2([C(3).y, dp3(l, n), n]), l));
		var cosAlpha:Var = sat(dp3(e,r));
		
		var color:Var = add(ambientColor, mul2([mov(lightColor), add(cosTheta, pow(cosAlpha, specularPow)), lightPower]));
		mul(color, diffColor, oc);
	}
}
	</pre>
	</pre>
</body>
</html>